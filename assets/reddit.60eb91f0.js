import{r as e,s as t,e as i,a as n,g as r,b as o,c as d}from"./index.643f2d7f.js";import{e as a}from"./base.50b98d34.js";import"./vendor.f1632930.js";function s(...e){console.log(...e)}function l(e,t,i,n){if(Array.isArray(n)){if(1!==n[0].data.children.length)return c(t,n);const r=n[0].data.children[0];if("t3"!==r.kind)return c(t,n);r.data.name;const o=n[1].data.children[0];o&&"t1"===o.kind&&o.data.parent_id;let d=h(e,{kind:"post",post:r,replies:n[1]});if("comments"===i.kind&&null!=i.focus_comment){const t="t1_"+i.focus_comment.toLowerCase();e.has(t)?d=t:s("focused comment not found in tree `"+t+"`")}return b(e,d)}if("Listing"===n.kind){const t={kind:"subreddit_unloaded",listing:n,details:"subreddit"===i.kind?i.sub:"unknown"};h(e,t);return b(e,p(t))}if("wikipage"===n.kind){const i={kind:"wikipage",listing:n,pathraw:t};h(e,i);return b(e,p(i))}return"t5"===n.kind?s("TODO t5"):"UserList"===n.kind?s("TODO userlist"):P(n.kind),c(t,n)}function u(e){return"homepage"===e.kind?"SR_home":"mod"===e.kind?"SR_mod":"multireddit"===e.kind?"SR_multi/u:"+e.user.toLowerCase()+"/m:"+e.multireddit.toLowerCase():"userpage"===e.kind?"SR_user/"+e.user.toLowerCase():"subreddit"===e.kind?"SR_sub/"+e.subreddit.toLowerCase():void n(e)}function c(t,i){return{ref:{kind:"post",client_id:Ce.id,parent:null,url:null,replies:null,content:{kind:"post",title:{text:"Error!"},collapsible:!1,body:{kind:"richtext",content:[...H(t),e.pre(JSON.stringify(i,null,"  "),"json")]},show_replies_when_below_pivot:!1},internal_data:null,display_style:"centered"},err:void 0}}function m(e){const t=k(e,void 0);return t?p(t):"__ERROR_FULLNAME__"}function p(e){return"comment"===e.kind?e.comment.data.name:"post"===e.kind?e.post.data.name:"subreddit_unloaded"===e.kind?"unknown"===e.details?"__UNKNOWN_LISTING_ROOT":u(e.details):"depth_more"===e.kind?"DEPTH_MORE_"+e.parent_permalink:"more"===e.kind?"MORE_"+e.item.data.children.join(","):"wikipage"===e.kind?"WIKIPAGE_there_should_only_be_one":void n(e)}function k(e,t){return"t1"===e.kind?{kind:"comment",comment:e}:"t3"===e.kind?{kind:"post",post:e,replies:"not_loaded"}:"more"===e.kind?0===e.data.children.length?null==t?void s("TODO setUpCommentOrUnmounted was called with not loaded parent but req. parent submission"):{kind:"depth_more",item:e,parent_permalink:t}:{kind:"more",item:e}:(P(e.kind),void s("TODO setUpCommentOrUnmounted",e.kind,e))}function _(e,t,i){const n=k(t,i);null!=n&&h(e,n)}function h(e,t){const i=p(t);if(e.get(i))return console.log("Note: Two objects with the same id were created. ID: `"+i+"`"),i;if("comment"===t.kind){const n=t.comment;if("t1"===n.kind){const t=n.data;if(t.replies)for(const i of t.replies.data.children)_(e,i,t.permalink)}else if("more"===n.kind){if("t1__"===n.data.name)return i}else console.log("TODO setUpMap "+n.kind)}else if("post"===t.kind){const i=t.post.data;if(i.crosspost_parent_list)for(const t of i.crosspost_parent_list)h(e,{kind:"post",post:{kind:"t3",data:t},replies:"not_loaded"});if("not_loaded"!==t.replies)for(const n of t.replies.data.children)_(e,n,i.permalink)}else if("subreddit_unloaded"===t.kind)for(const n of t.listing.data.children)_(e,n,"not_loaded");else"more"===t.kind||"depth_more"===t.kind||"wikipage"===t.kind||n(t);return e.set(i,{kind:"unprocessed",link:{ref:void 0,err:"processing not completed"},data:t}),i}function b(e,t){const i=e.get(t);if(!i)return{ref:void 0,err:"post was not found in tree (TODO load more) ("+t+")"};if("unprocessed"===i.kind){i.kind="processing";const t=function(e,t){var i,r;if("comment"===t.data.kind){const n=t.data.comment,o=n.data,d={reply:{action:ce(o.name),locked:o.locked},items:[]};if(o.replies)for(const t of o.replies.data.children)d.items.push(b(e,m(t)));const a=e.get(o.parent_id),s="FatFingerHelperBot"===o.author;return{kind:"post",client_id:Ce.id,url:L(o.permalink,{context:"3"}),parent:b(e,o.parent_id),replies:d,content:{kind:"post",title:null,author:_e(o,v(null!=(i=o.all_awardings)?i:[])),body:ge(o),info:f(n),collapsible:{default_collapsed:s||null!=(r=o.collapsed)&&r},show_replies_when_below_pivot:!0,actions:{vote:"post"===(null==a?void 0:a.data.kind)&&"CHAT"===a.data.post.data.discussion_type?void 0:re(o),code:ye(o.body),other:[me(o.name),se(o.name),pe(o.name,o.saved),ue(o.name,o.subreddit)]}},internal_data:t.data,display_style:"centered"}}if("post"===t.data.kind){const i=t.data.post,n=i.data;return{kind:"post",client_id:Ce.id,url:n.permalink,parent:b(e,u({kind:"subreddit",subreddit:n.subreddit,base:["r",n.subreddit]})),replies:{reply:{action:ce(n.name),locked:n.locked},items:"not_loaded"!==t.data.replies?t.data.replies.data.children.map((t=>b(e,m(t)))):[{ref:{kind:"loader",key:w.encode({kind:"comments",post:n.id}),parent:t.link,replies:null,client_id:Ce.id,url:null,load_count:null}}]},content:{kind:"post",title:{text:n.title},collapsible:{default_collapsed:!0},flair:Ne(n),author:_e(n),body:xe(n),thumbnail:ve(n,"open"),info:f(i),show_replies_when_below_pivot:!1,actions:{vote:re(n),code:ye(n.is_self?n.selftext:n.url),other:[{kind:"link",client_id:Ce.id,url:"/domain/"+n.domain,text:n.domain},se(n.name),pe(n.name,n.saved),{kind:"link",client_id:Ce.id,url:n.permalink.replace("/comments/","/duplicates/"),text:"Duplicates"},ue(n.name,n.subreddit),me(n.name)]}},internal_data:t.data,display_style:"centered"}}if("subreddit_unloaded"===t.data.kind){const i=[];for(const n of t.data.listing.data.children)i.push(b(e,m(n)));return null!=t.data.listing.data.after&&i.push(b(e,"TODO next")),{kind:"post",client_id:Ce.id,url:null,parent:null,replies:{items:i},content:{kind:"post",title:{text:p(t.data)},collapsible:!1,body:{kind:"none"},show_replies_when_below_pivot:!1},internal_data:t.data,display_style:"fullscreen"}}if("depth_more"===t.data.kind){const i=t.data.item.data;return{kind:"loader",client_id:Ce.id,parent:b(e,i.parent_id),replies:null,url:null,load_count:null,key:w.encode({kind:"depth",data:i})}}if("more"===t.data.kind){const i=t.data.item.data;return{kind:"loader",client_id:Ce.id,parent:b(e,i.parent_id),replies:null,url:null,load_count:i.children.length,key:w.encode({kind:"more",data:i})}}if("wikipage"===t.data.kind){const e=t.data.listing,i=t.data.pathraw.substr(t.data.pathraw.lastIndexOf("/")+1);return{kind:"post",client_id:Ce.id,url:t.data.pathraw,parent:null,replies:null,content:{kind:"post",title:{text:i},collapsible:!1,body:{kind:"text",content:e.data.content_html,client_id:Ce.id,markdown_format:"reddit_html"},show_replies_when_below_pivot:!1,info:{edited:{date:1e3*e.data.revision_date}},author:he(e.data.revision_by),actions:{other:e.data.may_revise?[{kind:"link",client_id:Ce.id,text:"Edit",url:"TODO edit wiki page"}]:[]}},internal_data:t.data,display_style:"centered"}}n(t.data)}(e,i);return[i.link.ref,i.link.err]=[t,void 0],i.kind="processed",i.link}if("processing"===i.kind||"processed"===i.kind)return i.link;n(i.kind)}function f(e){const t=e.data;return{creation_date:1e3*t.created_utc,edited:t.edited?{date:1e3*t.edited}:void 0,pinned:t.pinned||t.stickied||!1,in:"t3"===e.kind?{name:t.subreddit_name_prefixed,link:"/"+t.subreddit_name_prefixed,client_id:Ce.id}:void 0,comments:"t3"===e.kind?e.data.num_comments:void 0}}const w=a("loader");const y="biw1k0YZmDUrjg",g="https://thread.pfg.pw/login/reddit";function x(e){var t,i;if(null==e.type)return[];if("text"===e.type&&(null==e.text||""===e.text))return[];const n="richtext"===e.type?(null!=(t=e.richtext)?t:[]).map((e=>"text"===e.e?{kind:"text",text:e.t}:"emoji"===e.e?{kind:"emoji",url:e.u,name:e.a,w:16,h:16}:(P(e.e),{kind:"text",text:"#TODO("+e.e+")"}))):"text"===e.type?[{kind:"text",text:e.text}]:[{kind:"text",text:"TODO: "+e.type}],r=n.map((e=>"text"===e.kind?e.text:"")).join("");return[{color:null!=(i=e.background_color)?i:void 0,fg_color:"light"===e.text_color?"light":"dark",elems:n,content_warning:r.toLowerCase().startsWith("cw:")||r.toLowerCase().startsWith("tw:")}]}function v(e){const t=[];for(const i of e.sort(((e,t)=>t.count-e.count))){t.length>0&&t.push({kind:"text",text:" "});const e=i.resized_static_icons[0];t.push({kind:"emoji",url:e.url,w:e.width,h:e.height,name:i.name}),i.count>1&&t.push({kind:"text",text:"×"+i.count})}return 0===t.length?[]:[{elems:t,content_warning:!1,system:"none"}]}function N(e){return O.encode({kind:"vote",query:e})}function T(e){return O.encode({kind:"delete",fullname:e})}const O=a("act");function E(t,i){try{return S(t.document,i)}catch(n){return console.log("Error parsing richtext:",n),[e.p(e.error("Error parsing richtext: "+n,n))]}}function S(t,i){return t.map((t=>function(t,i){var n,r,o;switch(t.e){case"par":if(1!==t.c.length||"gif"!==(null==(n=t.c[0])?void 0:n.e)&&"img"!==(null==(r=t.c[0])?void 0:r.e))return 1===t.c.length&&"text"===(null==(o=t.c[0])?void 0:o.e)&&t.c[0].t.match(/^---+$/)?e.hr():e.p(...C(t.c,i));{const n=t.c[0],r=i.media_metadata[n.id];return r?e.kind("body",{body:j(r,n.id.split("|")[0]).body}):e.p(e.error("Missing media id "+n.id,r))}case"img":case"video":case"gif":{const n=i.media_metadata[t.id];return n?e.kind("body",{body:j(n,t.c).body}):e.p(e.error("unknown id "+t.id,i))}case"h":return e.hn(t.l,...C(t.c,i));case"hr":return e.hr();case"blockquote":return e.blockquote(...S(t.c,i));case"list":return e.kind("list",{ordered:t.o},t.c.map((t=>e.li(...S(t.c,i)))));case"code":return e.pre(t.c.map((e=>{switch(e.e){case"raw":return e.t;case"unsupported":return"Err «"+JSON.stringify(e)+"»"}})).join("\n"));case"table":return e.table(t.h.map((t=>function(t,i){var n;return e.th(null!=t.a?{L:"left",C:"center",R:"right"}[t.a]:void 0,...C(null!=(n=t.c)?n:[],i))}(t,i))),...t.c.map((t=>t.map((t=>function(t,i){return e.td(...C(t.c,i))}(t,i))))))}return P(t.e),e.p(e.error("TODO "+t.e,t))}(t,i)))}function P(e){console.log("Expected unsupported",e)}function j(t,i){var n,o,d,a,s;if("valid"!==t.status)return{thumb:null,aspect:void 0,body:{kind:"richtext",content:[e.p(e.error("Bad Status "+t.status+", "+i,t))]}};if("Image"===t.e){const e=null!=(o=null==(n=t.p)?void 0:n[0])?o:t.s;return{thumb:null!=(d=e.u)?d:"error",aspect:e.x/e.y,body:{kind:"captioned_image",url:t.s.u,w:t.s.x,h:t.s.y,caption:i}}}if("AnimatedImage"===t.e){const e=null==(a=t.p)?void 0:a[0];return{thumb:e?e.u:"error",aspect:e?e.x/e.y:void 0,body:{kind:"video",source:null!=t.s.mp4?{kind:"video",sources:[{url:t.s.mp4,quality:t.s.x+"×"+t.s.y}]}:{kind:"img",url:t.s.gif},aspect:t.s.x/t.s.y,gifv:!0,caption:i}}}return"RedditVideo"===t.e?{thumb:null,aspect:void 0,body:{kind:"video",source:r(t.id),aspect:t.x/t.y,gifv:null!=(s=t.isGif)&&s,caption:i}}:(P(t.e),{thumb:null,aspect:void 0,body:{kind:"richtext",content:[e.p(e.error("TODO "+t.e+", "+i,t))]}})}function R(e){return e>=10240&&e<=10495}function I(t,i,n){if(0===i.length){t=t.replaceAll("¯_(ツ)_/¯","¯\\_(ツ)_/¯");let i=0,n=0;if([...t].forEach((e=>{const t=e.codePointAt(0);8206!==t&&32!==t&&(n+=1),R(t)&&i++})),i>.9*n&&i>10){const i=[];let n=[];for(const e of t.split(" ")){[...e].filter((e=>R(e.codePointAt(0)))).length>5?i.length>0?(n.length>0&&(i[i.length-1]+=" "+n.join(" ")),n=[],i.push(e)):(i.push([...n,e].join(" ")),n=[]):n.push(e)}return i.push(...n),[e.txt(i.join("\n"))]}return[e.txt(t)]}const r=[];let o=0;const d=i=>{const n=t.substring(o,i);n.length>0&&r.push(e.txt(n))},a=[...t];return i.forEach((([t,i,n])=>{d(i),o=i+n;const s=a.slice(i,i+n).join(""),l={strong:!!(1&(u=t)),emphasis:!!(2&u),strike:!!(8&u),super:!!(32&u),code:!!(64&u),error:-108&u?"unsupported style "+u.toString(2):void 0};var u;null!=l.error?r.push(e.error(s,l.error)):l.code?r.push(e.code(s)):r.push(e.txt(s,{strong:l.strong,emphasis:l.emphasis,strikethrough:l.strike,superscript:l.super}))})),d(t.length),r}function C(t,i){return(null!=t?t:[]).flatMap((t=>function(t,i){var n,r,o;switch(t.e){case"text":return I(t.t,null!=(n=t.f)?n:[]);case"r/":case"u/":return[e.link(Ce,"/"+t.e+t.t,{is_user_link:"u/"===t.e?t.t:void 0},e.txt((t.l?"/":"")+t.e+t.t))];case"link":return[e.link(Ce,t.u,{title:t.a},...I(t.t,null!=(r=t.f)?r:[]))];case"br":return[e.br()];case"spoilertext":return[e.spoiler(...C(t.c,i))];case"raw":return[e.txt(t.t)];case"gif":case"img":{const n=i.media_metadata[t.id];return n?"valid"!==n.status?[e.error("Bad status "+n.status,n)]:"AnimatedImage"===n.e?[e.link(Ce,null!=(o=n.s.mp4)?o:n.s.gif,{},e.txt("[embedded "+t.id.split("|")[0]+"]"))]:"Image"===n.e?"emoji"===n.t?[{kind:"emoji",url:n.s.u,name:":"+t.id.split("|")[2]+":"}]:[e.link(Ce,n.s.u,{},e.txt("[embedded "+t.id.split("|")[0]+"]"))]:[e.error("Unsupported "+n.e,n)]:[e.error("Missing media id "+t.id,n)]}}return P(t.e),[e.error("TODO "+t.e,t)]}(t,i)))}function D(e){return"https://"+(e?"oauth.reddit.com":"www.reddit.com")}let q=[];function U(){return new Promise((e=>{q.push(e),1===q.length&&async function(){var e;const t=localStorage.getItem("reddit-secret");if(""===t||null==t){const e=localStorage.getItem("reddit-app-data");let t;if(null!=e){const i=JSON.parse(e);if(!(i.expires<Date.now()))return i.access_token;t=i.device_id}else t=[...crypto.getRandomValues(new Uint8Array(25))].map((e=>e.toString(16).padStart(2,"0"))).join("");const n=await fetch("https://www.reddit.com/api/v1/access_token",{method:"POST",mode:"cors",credentials:"omit",headers:{Authorization:"Basic "+btoa(y+":"),"Content-Type":"application/x-www-form-urlencoded"},body:i({grant_type:"https://oauth.reddit.com/grants/installed_client",device_id:t,redirect_uri:g})}).then((e=>e.json()));if(n.error)throw console.log(n),new Error("error: "+JSON.stringify(n));const r={access_token:n.access_token,expires:Date.now()+1e3*n.expires_in,scope:n.scope,device_id:t};return localStorage.setItem("reddit-app-data",JSON.stringify(r)),r.access_token}const n=JSON.parse(t);if(console.log(n.expires,Date.now()),n.expires<Date.now()){console.log("Token expired, refreshing…");const[t,i]=await fetch("https://www.reddit.com/api/v1/access_token",{method:"POST",mode:"cors",credentials:"omit",headers:{Authorization:"Basic "+btoa(y+":"),"Content-Type":"application/x-www-form-urlencoded"},body:d`grant_type=refresh_token&refresh_token=${n.refresh_token}`}).then((async e=>[e.status,await e.json()]));if(200!==t)throw console.log("Error! got",i,"with status code",t),new Error("Status code "+t);if("error"in i)throw console.log("refresh attempt: ",i,n),new Error("Got error while refreshing token: "+i.error);const r={access_token:i.access_token,refresh_token:null!=(e=i.refresh_token)?e:n.refresh_token,expires:Date.now()+1e3*i.expires_in,scope:i.scope};return console.log("Refresh info:",i,r),localStorage.setItem("reddit-secret",JSON.stringify(r)),console.log("Refreshed √"),r.access_token}return n.access_token}().then((e=>{q.forEach((t=>t(e))),q=[]})).catch((e=>{console.log("Get access token error",e),q.forEach((e=>e(null))),q=[]}))}))}function A(e){const[t,...i]=e.split("?"),n=i.join("?"),[r,...o]=n.split("#");return[null!=t?t:"",new URLSearchParams(r),o.join("#")]}function L(e,t){const[i,n,r]=A(e);for(const[o,d]of Object.entries(t))null!=d?n.set(o,d):n.delete(o);return i+"?"+n.toString()+(""!==r?"#"+r:"")}function M(e,t,i){return{kind:"counter",client_id:Ce.id,unique_id:"/subscribe/"+e+"/",time:Date.now(),label:"Subscribe",incremented_label:"Subscribed",style:"pill-filled",incremented_style:"pill-empty",count_excl_you:i?t-1:t,you:i?"increment":void 0,actions:{increment:O.encode({kind:"subscribe",subreddit:e,direction:"sub"}),reset:O.encode({kind:"subscribe",subreddit:e,direction:"unsub"})}}}function G(t,i){try{return function(t,i){if("moderators"===t.kind)return{kind:"widget",title:"Moderators",raw_value:t,widget_content:{kind:"body",body:{kind:"richtext",content:[e.p(e.link(Ce,"/message/compose?to=/r/"+i,{style:"pill-empty"},e.txt("Message the mods"))),e.ul(...t.mods.map((t=>e.li(e.p(e.link(Ce,"/u/"+t.name,{is_user_link:t.name},e.txt("u/"+t.name)),...x({type:t.authorFlairType,text:t.authorFlairText,text_color:t.authorFlairTextColor,background_color:t.authorFlairBackgroundColor,richtext:t.authorFlairRichText}).flatMap((t=>[e.txt(" "),e.flair(t)]))))))),e.p(e.link(Ce,"/r/"+i+"/about/moderators",{},e.txt("View All Moderators")))]}}};if("community-list"===t.kind)return{kind:"widget",title:t.shortName,raw_value:t,widget_content:{kind:"list",items:t.data.map((t=>"subreddit"===t.type?{icon:t.communityIcon||void 0,name:{kind:"text",text:"r/"+t.name},click:{kind:"link",url:"/r/"+t.name},action:M(t.name,t.subscribers,t.isSubscribed)}:(P(t.type),{name:{kind:"text",text:"ERROR UNSUPPORTED"+t.type},click:{kind:"body",body:{kind:"richtext",content:[e.pre(JSON.stringify(t,null,"\t"),"json")]}}})))}};if("id-card"===t.kind)return{kind:"widget",title:"Error!",raw_value:t,widget_content:{kind:"body",body:{kind:"richtext",content:[e.p(e.error("Not supported "+t.kind,t))]}}};if("menu"===t.kind)return{kind:"widget",title:"Error!",raw_value:t,widget_content:{kind:"body",body:{kind:"richtext",content:[e.p(e.error("Uh oh! TODO widget "+t.kind,t))]}}};if("textarea"===t.kind)return{kind:"widget",title:t.shortName,raw_value:t,widget_content:{kind:"body",body:{kind:"text",client_id:Ce.id,content:t.text,markdown_format:"reddit"}}};if("subreddit-rules"===t.kind)return{kind:"widget",title:t.shortName,raw_value:t,widget_content:{kind:"list",items:t.data.map(((e,t)=>({name:{kind:"text",text:t+1+". "+e.shortName},click:{kind:"body",body:{kind:"text",client_id:Ce.id,content:e.description,markdown_format:"reddit"}}})))}};if("image"===t.kind)return{kind:"widget",title:t.shortName,raw_value:t,widget_content:{kind:"image",src:t.data[t.data.length-1].url,link_url:t.data[t.data.length-1].linkUrl,width:t.data[t.data.length-1].width,height:t.data[t.data.length-1].height}};if("post-flair"===t.kind)return{kind:"widget",title:t.shortName,raw_value:t,widget_content:{kind:"list",items:t.order.map((n=>{const r=t.templates[n],o=x({type:r.type,text:r.text,text_color:r.textColor,background_color:r.backgroundColor,richtext:r.richtext});return 1!==o.length?(console.log("bad flair",r,o),{name:{kind:"text",text:"error bad flair"},click:{kind:"body",body:{kind:"richtext",content:[e.p(e.error("bad flair",[r,o]))]}}}):{name:{kind:"flair",flair:o[0]},click:{kind:"link",url:"/r/"+i+'/search?q=flair:"'+encodeURIComponent(r.text)+'"&restrict_sr=1'}}}))}};if("custom"===t.kind)return{kind:"widget",title:t.shortName,raw_value:t,widget_content:{kind:"iframe",height:""+t.height,srcdoc:`\n            <head>\n                <link rel="stylesheet" href="${t.stylesheetUrl}">\n                <base target="_blank">\n            </head>\n            <body>${t.textHtml}</body>\n        `}};if("button"===t.kind)return{kind:"widget",title:t.shortName,raw_value:t,widget_content:{kind:"list",above_text:{kind:"text",content:t.description,client_id:Ce.id,markdown_format:"reddit"},items:t.buttons.map((e=>"text"===e.kind?{name:{kind:"text",text:e.text},click:{kind:"link",url:e.url}}:"image"===e.kind?{name:{kind:"image",src:e.url,w:e.width,h:e.height,alt:e.text},click:{kind:"link",url:e.linkUrl}}:(P(e.kind),{name:{kind:"text",text:"TODO "+e.kind},click:{kind:"body",body:{kind:"none"}}})))}};if("calendar"===t.kind)return{kind:"widget",title:t.shortName,raw_value:t,widget_content:{kind:"body",body:{kind:"array",body:t.data.flatMap(((t,i)=>[...0!==i?[{kind:"richtext",content:[e.hr()]}]:[],{kind:"text",client_id:Ce.id,content:t.title,markdown_format:"reddit"},{kind:"richtext",content:[e.p(e.timeAgo(1e3*t.startTime))]},{kind:"text",client_id:Ce.id,content:t.location,markdown_format:"reddit"},{kind:"text",client_id:Ce.id,content:t.description,markdown_format:"reddit"}]))}}};return P(t.kind),{kind:"widget",title:"Error!",raw_value:t,widget_content:{kind:"body",body:{kind:"richtext",content:[e.p(e.error("Uh oh! Unsupported widget "+t.kind,t))]}}}}(t,i)}catch(n){return console.log("widget error",n),{kind:"widget",title:"Error!",raw_value:t,widget_content:{kind:"body",body:{kind:"richtext",content:[e.p(e.error("Uh oh! Error "+n.toString(),t))]}}}}}function F(e,t,{collapsed:i}){return{kind:"thread",raw_value:e,body:{kind:"text",client_id:Ce.id,markdown_format:"reddit",content:e.data.description},display_mode:{body:i?"collapsed":"visible",comments:"visible"},link:"/r/"+t+"/about/sidebar",layout:"reddit-post",title:{text:"old.reddit sidebar"},actions:[],default_collapsed:!1}}function W(t){const i=t.widgets,n=e=>{const t=i.items[e];if(!t)throw new Error("bad widget "+e);return t},r=e=>G(e,t.subreddit),o=[...t.sub_t5?[(d=t.sub_t5,a=t.subreddit,{kind:"widget",title:d.data.title,raw_value:d,widget_content:{kind:"community-details",description:d.data.public_description},actions_bottom:[M(a,d.data.subscribers,null!=(s=d.data.user_is_subscriber)&&s)]})]:[],...t.sub_t5?[F(t.sub_t5,t.subreddit,{collapsed:!!i})]:[],...i?i.layout.sidebar.order.map((e=>r(n(e)))):[],...i?[r(n(i.layout.moderatorWidget))]:[]];var d,a,s;return 0===o.length&&o.push({kind:"widget",title:"Error",widget_content:{kind:"body",body:{kind:"richtext",content:[e.p(e.txt("Failed to fetch sidebar for this page :("))]}},raw_value:t}),o}function V(e){var t,i,n;if(!e)return{kind:"thread",title:{text:"Listing"},body:{kind:"text",client_id:Ce.id,content:"Listing",markdown_format:"none"},display_mode:{body:"collapsed",comments:"collapsed"},link:"TODO no link",layout:"error",actions:[],default_collapsed:!1,raw_value:e};const r=[{text:"Posts",action:{kind:"link",client_id:Ce.id,url:"/r/"+e.subreddit},selected:!0}];e:if(e.widgets){const i=null==(t=e.widgets)?void 0:t.layout.topbar.order.length;if(0===i)break e;if(1!==i){r.push({text:"ERROR Topbar Order",action:{kind:"link",client_id:Ce.id,url:"error"},selected:!1});break e}const n=e.widgets.items[e.widgets.layout.topbar.order[0]];if("menu"!==n.kind){r.push({text:"ERROR Topbar Item",action:{kind:"link",client_id:Ce.id,url:"error"},selected:!1});break e}n.showWiki&&r.push({text:"Wiki",action:{kind:"link",client_id:Ce.id,url:"/r/"+e.subreddit+"/wiki/index"},selected:!1});const o=e=>"children"in e?{text:e.text,selected:!1,action:{kind:"menu",children:e.children.map(o)}}:"url"in e?{text:e.text,selected:!1,action:{kind:"link",client_id:Ce.id,url:e.url}}:void De(e);r.push(...n.data.map((e=>({...o(e),selected:!1}))))}return{kind:"bio",...e.sub_t5?Pe(e.sub_t5.data):{banner:null,icon:null},name:{display:null==(i=e.sub_t5)?void 0:i.data.title,link_name:e.sub_t5?e.sub_t5.data.display_name_prefixed:"r/"+e.subreddit},body:null,subscribe:e.sub_t5?M(e.subreddit,e.sub_t5.data.subscribers,null!=(n=e.sub_t5.data.user_is_subscriber)&&n):void 0,menu:1===r.length?null:r,raw_value:e}}const J=a("deferred_inbox");function $(){return function(){const e=localStorage.getItem("reddit-secret");return null!=e&&""!==e}()?{actions:[{kind:"act",client_id:Ce.id,action:O.encode({kind:"log_out"}),text:"Log Out"}],inboxes:[{id:"/messages",name:"Messages",active_color:"orange",hydrate:J.encode({kind:"inbox"}),url:"/message/inbox"},{id:"/modmail",name:"Modmail",active_color:"green",hydrate:J.encode({kind:"modmail"}),url:"/mod/mail/all"}]}:{actions:[{kind:"link",client_id:Ce.id,url:Oe(),text:"Log In"},{kind:"link",client_id:Ce.id,url:"raw!https://www.reddit.com/register",text:"Sign Up"}],inboxes:[]}}function z(t,i,n){var r;const o=[];return n.warning&&o.push(...n.warning),{title:"Error View",navbar:$(),body:{kind:"one",item:{parents:[{kind:"thread",raw_value:i,body:{kind:"richtext",content:[...o,e.pre(JSON.stringify(i,null,"\t"),"json")]},display_mode:{body:"visible",comments:"visible"},link:t,layout:"error",actions:[],default_collapsed:!1}],replies:[]}},sidebar:null!=(r=n.sidebar)?r:void 0,display_style:"comments-view"}}function B(t,i,n,r){var o,d,a,s,l,u,c,m;const p=i;if(Array.isArray(n)){if(1!==n[0].data.children.length)return z(t,n,{sidebar:r.sidebar,warning:H(t)});const i=n[0].data.children[0];if("t3"!==i.kind)return z(t,n,{sidebar:r.sidebar,warning:H(t)});const s=i.data.name,l=null!=(o=i.data.suggested_sort)?o:"confidence",u=i.data.contest_mode,c=i.data.can_mod_post,m=i.data.permalink,k=i.data.locked,_="CHAT"===i.data.discussion_type,h=n[1].data.children,b=[],f=h[0];f&&"t1"===f.kind&&f.data.parent_id!==s&&b.push(de(f.data.subreddit,(null!=s?s:"").replace("t3_",""),f.data.parent_id.replace("t1_","")));let w,y=h.map((e=>ae(e,{link_fullname:s},{permalink:m,sort:l,is_chat:_})));if("comments"===p.kind&&null!=p.focus_comment){const e=e=>{if(1!==e.length)return;const t=e[0];return"thread"===t.kind?t:void 0},t=e=>{const t=e.raw_value;if("object"==typeof t&&t&&"data"in t&&"object"==typeof t.data&&t.data&&"name"in t.data&&"string"==typeof t.data.name){const e=t.data.name;return e.startsWith("t1_")?e.replace("t1_",""):void 0}};let i,n=e(y);for(;n;){if(t(n)===p.focus_comment){i=n;break}n=e(null!=(d=n.replies)?d:[])}if(i){for(n=e(y);n&&n!==i;){b.push(n);const t=n.replies;n.replies=void 0,n=e(null!=t?t:[])}if(n){b.push(n);const e=n.replies;n.replies=void 0,y=null!=e?e:[]}else y=[]}}return null!=n[1].data.after&&y.push({kind:"load_more",url:"TODO",load_more:ne.encode({kind:"duplicates",lmurl:"todo"}),raw_value:n[1]}),w="comments"===p.kind?u&&!c?[{selected:!0,text:"Random",action:{kind:"link",client_id:Ce.id,url:L(m,{sort:"random"})}}]:[["confidence","Best"],["top","Top"],["new","New"],["controversial","Controversial"],["old","Old"],["random","Random"],["qa","Q&A"],["live","Live"]].map((([e,t])=>{var i;return{selected:(null!=(i=p.sort_override)?i:l)===e,text:t,action:{kind:"link",client_id:Ce.id,url:L(m,{sort:e})}}})):"duplicates"===p.kind?[["num_comments","Comments"],["new","New"]].map((([e,t])=>({selected:p.sort===e,text:t,action:{kind:"link",client_id:Ce.id,url:L(m.replace("/comments","/duplicates"),{sort:e})}}))):[{selected:!1,text:"error "+p.kind,action:{kind:"link",client_id:Ce.id,url:"error"}}],{title:"t3"===i.kind?i.data.title:"ERR top not t3",navbar:$(),body:{kind:"one",item:{parents:[ae(i,{force_expand:b.length>0?"closed":"open",show_post_reply_button:!0},{permalink:m,sort:"unsupported",is_chat:_}),...u?[{kind:"thread",body:{kind:"richtext",content:[e.p(e.txt("This thread is in contest mode.")),e.p(e.txt(c?"As a mod, you can sort comments however you wish. Regular users have randomized sorting and cannot see scores.":"Sorting is randomized and scores are hidden."))]},display_mode:{body:"visible",comments:"collapsed"},raw_value:u,link:"no",actions:[],default_collapsed:!1,layout:"reddit-post"}]:[],...k?[{kind:"thread",body:{kind:"richtext",content:[e.p(e.txt("This thread is locked.")),e.p(e.txt(c?"Only mods like you can comment on this thread.":"You are not able to comment on this thread."))]},display_mode:{body:"visible",comments:"collapsed"},raw_value:k,link:"no",actions:[],default_collapsed:!1,layout:"reddit-post"}]:[],...b],menu:w,replies:y}},sidebar:null!=(a=r.sidebar)?a:void 0,display_style:"comments-view"}}if("wikipage"===n.kind)return{title:t+" | Wiki",navbar:$(),body:{kind:"one",item:{parents:[{kind:"thread",raw_value:n,body:{kind:"text",client_id:Ce.id,markdown_format:"reddit_html",content:n.data.content_html},display_mode:{body:"visible",comments:"visible"},link:t,layout:"error",actions:[],default_collapsed:!1}],replies:[]}},sidebar:null!=(s=r.sidebar)?s:void 0,display_style:"comments-view"};if("t5"===n.kind)return{title:t+" | Sidebar",navbar:$(),body:{kind:"one",item:{parents:[{kind:"thread",raw_value:n,body:{kind:"text",client_id:Ce.id,markdown_format:"reddit",content:n.data.description},display_mode:{body:"visible",comments:"visible"},link:t,layout:"reddit-post",title:{text:"old.reddit sidebar"},actions:[],default_collapsed:!1}],replies:[]}},sidebar:null!=(l=r.sidebar)?l:void 0,display_style:"comments-view"};if("UserList"===n.kind)return{title:t,navbar:$(),body:{kind:"one",item:{parents:[{kind:"thread",body:{kind:"richtext",content:[e.h1(e.txt("User List")),e.table([e.th("left",e.txt("Username")),e.th("left",e.txt("Added")),e.th("left",e.txt("Perms"))],...n.data.children.map((t=>[e.td(e.link(Ce,"/u/"+t.name,{is_user_link:t.name},e.txt("u/"+t.name))),e.td(e.timeAgo(1e3*t.date)),e.td(...t.mod_permissions.flatMap(((t,i)=>[...0!==i?[e.txt(", ")]:[],e.txt(t)])))])))]},display_mode:{body:"visible",comments:"visible"},raw_value:n,layout:"reddit-post",link:t,actions:[],default_collapsed:!1}],replies:[]}},sidebar:null!=(u=r.sidebar)?u:void 0,display_style:"comments-view"};if("Listing"===n.kind){let i;if(n.data.before,null!=n.data.after){const e=L(t,{before:void 0,after:n.data.after});i={kind:"load_more_unmounted",load_more_unmounted:ie.encode({kind:"listing",url:e}),url:e,count:void 0,raw_value:n}}const o=[["overview","Overview"],["comments","Comments"],["submitted","Submitted"]],d=[["upvoted","Upvoted"],["downvoted","Downvoted"],["hidden","Hidden"],["saved","Saved"]];return{title:t,navbar:$(),body:{kind:"listing",menu:"subreddit"===p.kind?[{selected:"hot"===p.current_sort.v,text:"Hot",action:{kind:"link",client_id:Ce.id,url:"/"+[...p.sub.base,...p.is_user_page?["hot"]:[]].join("/")}},{selected:"best"===p.current_sort.v,text:"Best",action:{kind:"link",client_id:Ce.id,url:"/"+[...p.sub.base,"best"].join("/")}},{selected:"new"===p.current_sort.v,text:"New",action:{kind:"link",client_id:Ce.id,url:"/"+[...p.sub.base,"new"].join("/")}},{selected:"rising"===p.current_sort.v,text:"Rising",action:{kind:"link",client_id:Ce.id,url:"/"+[...p.sub.base,"rising"].join("/")}},...[["top","Top"],["controversial","Controversial"]].map((([e,t])=>({selected:p.current_sort.v===e,text:p.current_sort.v===e?t+" ("+p.current_sort.t+")":t,action:{kind:"menu",children:[["hour","Hour"],["day","Day"],["week","Week"],["month","Month"],["year","Year"],["all","All Time"]].map((([t,i])=>({text:i,selected:p.current_sort.v===e&&p.current_sort.t===t,action:{kind:"link",client_id:Ce.id,url:"/"+[...p.sub.base,e].join("/")+"?t="+t}})))}})))]:"user"===p.kind?[...o.map((([e,t])=>({selected:p.current.tab===e,text:t,action:{kind:"show-line-two",children:[{selected:p.current.tab===e&&"hot"===p.current.sort.sort,text:"Hot",action:{kind:"link",client_id:Ce.id,url:L("/"+["u",p.username,e].join("/"),{sort:"hot"})}},{selected:p.current.tab===e&&"new"===p.current.sort.sort,text:"New",action:{kind:"link",client_id:Ce.id,url:L("/"+["u",p.username,e].join("/"),{sort:"new"})}},...[["top","Top"],["controversial","Controversial"]].map((([t,i])=>({selected:p.current.tab===e&&p.current.sort.sort===t,text:p.current.tab===e&&p.current.sort.sort===t?i+" ("+p.current.sort.t+")":i,action:{kind:"menu",children:[["hour","Hour"],["day","Day"],["week","Week"],["month","Month"],["year","Year"],["all","All Time"]].map((([i,n])=>({text:n,selected:p.current.tab===e&&p.current.sort.sort===t&&p.current.sort.t===i,action:{kind:"link",client_id:Ce.id,url:L("/"+["u",p.username,e].join("/"),{sort:t,t:i})}})))}})))]}}))),{selected:"gilded"===p.current.tab,text:"Gilded",action:{kind:"show-line-two",children:[{selected:"gilded"===p.current.tab&&"received"===p.current.by,text:"Received",action:{kind:"link",client_id:Ce.id,url:"/"+["u",p.username,"gilded"].join("/")}},{selected:"gilded"===p.current.tab&&"given"===p.current.by,text:"Given",action:{kind:"link",client_id:Ce.id,url:"/"+["u",p.username,"gilded","given"].join("/")}}]}},...d.map((([e,t])=>({selected:p.current.tab===e,text:t,action:{kind:"link",client_id:Ce.id,url:"/"+["u",p.username,e].join("/")}})))]:"inbox"===p.kind?[{selected:"compose"===p.current.tab,text:"Compose",action:{kind:"link",client_id:Ce.id,url:"/message/compose"}},{selected:"inbox"===p.current.tab,text:"Inbox",action:{kind:"show-line-two",children:[["inbox","All"],["unread","Unread"],["messages","Messages"],["comments","Comment Replies"],["selfreply","Post Replies"],["mentions","Username Mentions"]].map((([e,t])=>({text:t,selected:"inbox"===p.current.tab&&p.current.inbox_tab===e,action:{kind:"link",client_id:Ce.id,url:"/message/"+e}})))}},{selected:"sent"===p.current.tab,text:"Sent",action:{kind:"link",client_id:Ce.id,url:"/message/sent"}}]:[{text:"Error! "+p.kind,selected:!1,action:{kind:"link",client_id:Ce.id,url:t}}],header:null!=(c=r.header)?c:{kind:"thread",title:{text:"Listing"},body:{kind:"text",client_id:Ce.id,content:"Listing",markdown_format:"none"},display_mode:{body:"collapsed",comments:"collapsed"},link:"TODO no link",layout:"error",actions:[],default_collapsed:!1,raw_value:p},items:"inbox"===p.kind?n.data.children.map((t=>function(t){if("t1"===t.kind||"t4"===t.kind){const e=t.data;return{parents:[{kind:"thread",title:{text:e.subject},body:{kind:"none"},display_mode:{body:"visible",comments:"collapsed"},link:"no",layout:"reddit-post",default_collapsed:!1,actions:[],raw_value:t},oe(t)],replies:"object"==typeof e.replies?e.replies.data.children.map((e=>oe(e))):[]}}return{parents:[{kind:"thread",body:{kind:"richtext",content:[e.p(e.error("Unsupported "+t.kind,t))]},display_mode:{body:"visible",comments:"collapsed"},layout:"error",default_collapsed:!1,actions:[],raw_value:t,link:"no"}],replies:[]}}(t))):n.data.children.map((e=>function(e,t={},i){const n=ae(e,t,i);if("t1"===e.kind&&"link_title"in e.data)return{parents:[{kind:"thread",title:{text:e.data.link_title},info:{time:!1,edited:!1,in:{name:e.data.subreddit_name_prefixed,link:"/"+e.data.subreddit_name_prefixed},author:{color_hash:e.data.link_author,name:e.data.link_author,link:"/u/"+e.data.link_author,client_id:Ce.id},pinned:!1},body:{kind:"link",client_id:Ce.id,url:e.data.link_permalink},display_mode:{body:"visible",comments:"collapsed"},link:e.data.link_permalink,layout:"reddit-post",default_collapsed:!1,actions:[{kind:"link",client_id:Ce.id,url:e.data.link_permalink,text:"Permalink"}],raw_value:e,replies:[]},...e.data.parent_id===e.data.link_id?[]:[de(e.data.subreddit,e.data.link_id.replace("t3_",""),e.data.parent_id.replace("t1_",""))],n],replies:[]};return{parents:[n],replies:[]}}(e,void 0,{permalink:t,sort:"unsupported",is_chat:!1}))),next:i},sidebar:null!=(m=r.sidebar)?m:void 0,display_style:"fullscreen-view"}}return P(n.kind),z(t,n,{sidebar:r.sidebar,warning:H(t)})}function H(t){const i=t.startsWith("/mod/")||t.startsWith("/mod?")||t.startsWith("/mod#")||"/mod"===t;return i&&(t=t.replace("/mod","")),[e.h1(e.txt("This url is not supported yet")),i?e.h2(e.txt("View it on mod.reddit.com: "),e.link(Ce,"raw!https://mod.reddit.com"+t,{},e.txt("mod.reddit.com"+t))):e.h2(e.txt("View it on reddit.com: "),e.link(Ce,"raw!https://www.reddit.com"+t,{},e.txt("reddit.com"+t))),e.p(e.txt("Submit an issue "),e.link(Ce,"https://github.com/pfgithub/threadclient/issues",{},e.txt("here")),e.txt(" if you would like to see this supported. Mention the url: "),e.code(t))]}const Y=o(),K=[],Q=new Set(["/acknowledgements","/appeal","/appeals","/avatar","/user/me/avatar","/u/me/avatar","/user/:profileName/avatar","/coins","/coins/mobile","/user/me","/user/me/:rest(.*)","/r/u_:profileName","/r/u_:profileName/:rest(.*)","/u/:profileName","/u/:profileName/:rest(.*)","/user/:profileName/submitted","/user/:profileName/submitted/:rest(.*)","/:routePrefix(r)/:subredditName/collection/:collectionId/:partialPostId/:partialCommentId","/:routePrefix(r)/:subredditName/collection/:collectionId/:partialPostId","/:routePrefix(r)/:subredditName/collection/:collectionId","/:routePrefix(user)/:subredditName/collection/:collectionId/:partialPostId/:partialCommentId","/:routePrefix(user)/:subredditName/collection/:collectionId/:partialPostId","/:routePrefix(user)/:subredditName/collection/:collectionId","/:routePrefix(r)/:subredditName/comments/:partialPostId/:urlSafePostTitle/:partialCommentId","/:routePrefix(r)/:subredditName/comments/:partialPostId/:urlSafePostTitle?","/comments/:partialPostId/:urlSafePostTitle/:partialCommentId","/comments/:partialPostId/:urlSafePostTitle?","/:routePrefix(r)/:subredditName/duplicates/:partialPostId/:urlSafePostTitle?","/:routePrefix(user)/:subredditName/duplicates/:partialPostId/:urlSafePostTitle?","/duplicates/:partialPostId/:urlSafePostTitle?","/:routePrefix(user)/:subredditName/comments/:partialPostId/:urlSafePostTitle/:partialCommentId","/:routePrefix(user)/:subredditName/comments/:partialPostId/:urlSafePostTitle?","/verification/:verificationToken","/","/:sort(best|hot|new|rising|controversial|top|gilded|awarded)?","/label/subreddits","/premium","/framedGild/:thingId","/framedModal/:type","/submit","/r/:subredditName/submit","/user/:profileName/submit","/user/:profileName/draft/:draftId","/original/submit","/original","/original/:categoryName/:sort([a-z]+)?","/explore","/explore/:categoryName","/community-points/","/vault/","/web/community-points/","/web/special-membership/:subredditName","/web/membership/:subredditName","/vault/burn","/me/m/:multiredditName","/user/:username/m/:multiredditName","/me/m/:multiredditName/:sort(best)?","/me/m/:multiredditName/:sort(hot)?","/me/m/:multiredditName/:sort(new)?","/me/m/:multiredditName/:sort(rising)?","/me/m/:multiredditName/:sort(controversial)?","/me/m/:multiredditName/:sort(top)?","/me/m/:multiredditName/:sort(gilded)?","/me/m/:multiredditName/:sort(awarded)?","/user/:username/m/:multiredditName/:sort(best)?","/user/:username/m/:multiredditName/:sort(hot)?","/user/:username/m/:multiredditName/:sort(new)?","/user/:username/m/:multiredditName/:sort(rising)?","/user/:username/m/:multiredditName/:sort(controversial)?","/user/:username/m/:multiredditName/:sort(top)?","/user/:username/m/:multiredditName/:sort(gilded)?","/user/:username/m/:multiredditName/:sort(awarded)?","/r/mod/about/:pageName(edited|modqueue|reports|spam|unmoderated)?","/r/mod/:sort(best)?","/r/mod/:sort(hot)?","/r/mod/:sort(new)?","/r/mod/:sort(rising)?","/r/mod/:sort(controversial)?","/r/mod/:sort(top)?","/r/mod/:sort(gilded)?","/r/mod/:sort(awarded)?","/me/f/mod/:sort(best)?","/me/f/mod/:sort(hot)?","/me/f/mod/:sort(new)?","/me/f/mod/:sort(rising)?","/me/f/mod/:sort(controversial)?","/me/f/mod/:sort(top)?","/me/f/mod/:sort(gilded)?","/me/f/mod/:sort(awarded)?","/notifications/","/message/:pageName(inbox|unread|messages|comments|selfreply|mentions|compose|sent|moderator)","/message/messages/:messageId","/user/:profileName/comments","/user/:profileName/about/edit/moderation","/user/:profileName","/user/:profileName/posts","/user/:profileName/snoo","/user/:profileName/:listingType(downvoted|hidden|saved|upvoted|gilded|given)","/user/:profileName/gilded/:listingType(given)","/rpan/r/:subredditName/:partialPostId?","/rpan/:partialPostId?","/settings/:page(account|messaging|profile|privacy|notifications|feed|gold|payments|premium|creator|special)?","/settings/data-request","inexact|/prefs/:page(deactivate|blocked)?","inexact|/user/:username/about/edit","inexact|/user/:username/about/edit/privacy","/search","/r/:subredditName/search","/me/m/:multiredditName/search","/user/:username/m/:multiredditName/search","/wiki/","/r/:subredditName/wiki/","/r/:subredditName/w/:wikiPageName*","/w/:wikiPageName*","/r/:subredditName/wiki/:wikiSubRoute(settings)/:wikiPageName+","/r/:subredditName/wiki/:wikiSubRoute(revisions)","/r/:subredditName/wiki/:wikiSubRoute(edit|create|revisions)/:wikiPageName+","/r/:subredditName/wiki/:wikiPageName+","/wiki/:wikiPageName+","/t/:topicSlug","/r/:subredditName","/r/:subredditName/:sort(best)?","/r/:subredditName/:sort(hot)?","/r/:subredditName/:sort(new)?","/r/:subredditName/:sort(rising)?","/r/:subredditName/:sort(controversial)?","/r/:subredditName/:sort(top)?","/r/:subredditName/:sort(gilded)?","/r/:subredditName/:sort(awarded)?","/subreddits/create","/subreddits/leaderboard","/subreddits/leaderboard/:categoryName/","/r/:subredditName/about","/r/:subredditName/about/:pageName(awards|muted|badges|banned|chat|settings|contributors|emojis|emotes|eventposts|moderators|rules|removal|modqueue|reports|spam|unmoderated|edited|postflair|log|flair|edit|userflair|wiki|wikicontributors|wikibanned|traffic|scheduledposts|broadcasting|content)","/user/:profileName/about/:pageName(awards)","/r/:subredditName/about/:pageName(wiki)/:wikiSubRoute(revisions|wikibanned|wikicontributors)","/r/:subredditName/about/:pageName(wiki)/:wikiSubRoute(edit|create|settings|revisions)/:wikiPageName+","/r/:subredditName/about/:pageName(wiki)/:wikiPageName*","/report"]),Z=e=>({kind:"link_out",out:"https://www.reddit.com"+e.path+"?"+i(e.query)}),X=e=>t=>({kind:"todo",path:t.path+"?"+i(t.query),msg:e});function ee(e,t){const i=e=>null!=e.multireddit&&null!=e.user?{kind:"multireddit",multireddit:e.multireddit,user:e.user,base:["user",e.user,"m",e.multireddit]}:null!=e.user?{kind:"userpage",user:e.user,base:["user",e.user]}:null!=e.subreddit?{kind:"subreddit",subreddit:e.subreddit,base:["r",e.subreddit]}:{kind:"homepage",base:[]};"home"!==t&&"subreddit"!==t&&"user"!==t||("home"===t&&K.push("/submit"),"subreddit"===t&&K.push("/r/:subredditName/submit"),"user"===t&&K.push("/user/:profileName/submit"),e.route(["submit"],X("submit post")));const n=["best","hot","new","rising","controversial","top","gilded","awarded"];if("home"===t&&K.push("/","/:sort("+n.join("|")+")?"),"subreddit"===t&&K.push("/r/:subredditName",...n.map((e=>"/r/:subredditName/:sort("+e+")?"))),"multireddit"===t&&K.push("/user/:username/m/:multiredditName",...n.map((e=>"/user/:username/m/:multiredditName/:sort("+e+")?"))),e.route([{sort:[...n,..."user"===t?[]:[null]]}],(e=>{var t,n,r,o;return{kind:"subreddit",sub:i(e),is_user_page:!1,current_sort:{v:null!=(t=e.sort)?t:"hot",t:null!=(n=e.query.t)?n:"all"},before:null!=(r=e.query.before)?r:null,after:null!=(o=e.query.after)?o:null}})),"subreddit"===t||"user"===t||"home"===t){const n="subreddit"===t?"/:routePrefix(r)/:subredditName":"user"===t?"/:routePrefix(user)/:subredditName":"home"===t?"":De(t);K.push(n+"/duplicates/:partialPostId/:urlSafePostTitle?"),e.route(["duplicates",{post_id_unprefixed:"any"},{url_safe_post_title:"optional"}],(e=>{var t,n,r;return{kind:"duplicates",sub:i(e),post_id_unprefixed:e.post_id_unprefixed,after:null!=(t=e.query.after)?t:null,before:null!=(n=e.query.before)?n:null,crossposts_only:"true"===e.query.crossposts_only,sort:null!=(r=e.query.sort)?r:"num_comments"}})),K.push(n+"/comments/:partialPostId/:urlSafePostTitle?"),e.route(["comments",{post_id_unprefixed:"any"},{url_safe_post_title:"optional"}],(e=>{var t,n,r;return{kind:"comments",sub:i(e),post_id_unprefixed:e.post_id_unprefixed,focus_comment:null!=(t=e.query.comment)?t:null,sort_override:null!=(n=e.query.sort)?n:null,context:null!=(r=e.query.context)?r:null}})),K.push(n+"/comments/:partialPostId/:urlSafePostTitle/:partialCommentId"),e.route(["comments",{post_id_unprefixed:"any"},{url_safe_post_title:"any"},{partial_comment_id:"any"}],(e=>{var t,n;return{kind:"comments",sub:i(e),post_id_unprefixed:e.post_id_unprefixed,focus_comment:e.partial_comment_id,sort_override:null!=(t=e.query.sort)?t:null,context:null!=(n=e.query.context)?n:null}}))}}Y.route(["raw",{path:"rest"}],(e=>({kind:"raw",path:"/"+e.path.join("/")+"?"+i(e.query)}))),K.push("/acknowledgements"),Y.route(["acknowledgements"],Z),K.push("/appeal"),Y.route(["appeal"],Z),K.push("/appeals"),Y.route(["appeals"],Z),K.push("/avatar"),Y.route(["appeals"],Z),K.push("/coins"),Y.route(["coins"],Z),K.push("/coins/mobile"),Y.route(["coins","mobile"],Z),K.push("/r/u_:profileName","/r/u_:profileName/:rest(.*)"),Y.route(["r",{user:{kind:"starts-with",text:"u_"}},{remainder:"rest"}],(e=>({kind:"redirect",to:"/"+["user",e.user,...e.remainder].join("/")+"?"+i(e.query)}))),K.push("/u/:profileName","/u/:profileName/:rest(.*)","/u/me/avatar"),Y.route(["u",{user:"any"},{remainder:"rest"}],(e=>({kind:"redirect",to:"/"+["user",e.user,...e.remainder].join("/")+"?"+i(e.query)}))),K.push("/verification/:verificationToken"),Y.route(["verification",{vtoken:"any"}],Z),K.push("/label/subreddits"),Y.route(["label","subreddits"],Z),K.push("/premium"),Y.route(["premium"],Z),K.push("/framedGild/:thingId"),Y.route(["framedGild",{thing:"any"}],Z),K.push("/framedModal/:type"),Y.route(["framedModal",{type:"any"}],Z),K.push("/community-points/","/vault/","/web/community-points/"),Y.route(["community-points"],Z),Y.route(["vault"],Z),Y.route(["web","community-points"],Z),Y.with(["user","me"],(e=>{K.push("/user/me/avatar"),e.catchall(X("redirect to current user"))})),Y.with(["user",{user:"any"}],(e=>{K.push("/user/:profileName/avatar"),e.route(["user",{profile_name:"any"},"avatar"],(e=>({kind:"redirect",to:"/avatar"}))),K.push("/user/:profileName","/user/:profileName/comments","/user/:profileName/submitted","/user/:profileName/submitted/:rest(.*)"),e.route([{tab:["overview","comments","submitted",null]}],(e=>{var t,i,n;return{kind:"user",username:e.user,current:{kind:"sorted-tab",tab:null!=(t=e.tab)?t:"overview",sort:{sort:null!=(i=e.query.sort)?i:"submitted"===e.tab?"hot":"new",t:null!=(n=e.query.t)?n:"all"}}}})),K.push("/user/:profileName/posts"),e.route(["posts"],(e=>({kind:"redirect",to:"/user/"+e.user+"/submitted?"+i(e.query)})));const t=["downvoted","hidden","saved","upvoted"];K.push("/user/:profileName/:listingType("+t.join("|")+"|gilded|given)"),K.push("/user/:profileName/gilded/:listingType(given)"),e.route([{tab:t}],(e=>({kind:"user",username:e.user,current:{kind:"unsorted-tab",tab:e.tab}}))),e.route(["gilded",{by:["received","given",null]}],(e=>{var t,i;return{kind:"user",username:e.user,current:{kind:"gild-tab",tab:"gilded",by:null!=(i=null!=(t=e.by)?t:e.query.show)?i:"received"}}})),e.route(["given"],(e=>({kind:"user",username:e.user,current:{kind:"gild-tab",tab:"gilded",by:"given"}}))),K.push("/user/:profileName/snoo"),e.route(["snoo"],X("snoo")),K.push("/user/:profileName/draft/:draftId"),e.route(["draft",{draft_id:"any"}],X("drafts")),K.push("/user/:profileName/about/edit/moderation"),e.route(["about","edit","moderation"],X("user profile moderation settings")),e.with(["m",{multireddit:"any"}],(e=>ee(e,"multireddit"))),ee(e,"user")})),Y.with(["r",{subreddit:"any"}],(e=>{K.push("/r/:subredditName/wiki/:wikiSubRoute(revisions)","/r/:subredditName/wiki/:wikiSubRoute(settings)/:wikiPageName+","/r/:subredditName/wiki/:wikiSubRoute(edit|create|revisions)/:wikiPageName+","/r/:subredditName/wiki/","/r/:subredditName/w/:wikiPageName*","/r/:subredditName/wiki/:wikiPageName+"),e.with([{w_wiki:["w","wiki"]}],(e=>{e.route([{wiki_path:"rest"}],(e=>({kind:"wiki",sub:{kind:"subreddit",base:["r",e.subreddit],subreddit:e.subreddit},path:0===e.wiki_path.length?["index"]:e.wiki_path,query:e.query})))})),ee(e,"subreddit")})),Y.route([{w_wiki:["w","wiki"]},{wiki_path:"rest"}],(e=>({kind:"wiki",sub:{kind:"homepage",base:[]},path:e.wiki_path,query:e.query}))),Y.with(["message"],(e=>{const t=["inbox","unread","messages","comments","selfreply","mentions"];K.push("/message/:pageName("+t.join("|")+"|compose|sent|moderator)"),e.route([{tab:[...t]}],(e=>({kind:"inbox",current:{tab:"inbox",inbox_tab:e.tab}}))),e.route(["compose"],(e=>({kind:"inbox",current:{tab:"compose",to:e.query.to,subject:e.query.subject,message:e.query.message}}))),e.route(["sent"],(e=>({kind:"inbox",current:{tab:"sent"}}))),e.route(["moderator"],(e=>({kind:"inbox",current:{tab:"mod"}}))),K.push("/message/messages/:messageId"),e.route(["messages",{message_id:"any"}],(e=>({kind:"inbox",current:{tab:"message",msgid:e.message_id}})))})),ee(Y,"home"),Y.with(["mod"],(e=>{Y.catchall(X("not supported"))})),Y.catchall(X("not supported"));const te=[];for(const Fe of K)Q.has(Fe)?Q.delete(Fe):te.push("• unknown: "+Fe);if(Q.size>0)for(const Fe of Q)te.push("• missing: "+Fe);if(te.length>0){console.log("reddit router ::");for(const e of te)console.log(e)}const ie=a("load_more_unmounted"),ne=a("load_more");function re(e){var t,i,n;const r={id:e.name,rank:"2"};return{kind:"counter",client_id:Ce.id,unique_id:"/vote/"+e.name+"/",time:Date.now(),special:"reddit-points",label:"Vote",incremented_label:"Voted",decremented_label:"Voted",count_excl_you:null!=(i=null!=(t=e.score_hidden)?t:e.hide_score)&&i&&1===e.score?"hidden":e.score+(!0===e.likes?-1:!1===e.likes?1:0),you:!0===e.likes?"increment":!1===e.likes?"decrement":void 0,percent:e.upvote_ratio,actions:null!=(n=e.archived)&&n?{error:"archived <6mo"}:{increment:N({...r,dir:"1"}),decrement:N({...r,dir:"-1"}),reset:N({...r,dir:"0"})}}}function oe(t){if("t1"===t.kind||"t4"===t.kind){const e=t.data;return{kind:"thread",info:{time:1e3*e.created_utc,edited:!1,author:{name:"u/"+e.author,link:"/u/"+e.author,color_hash:e.author,client_id:Ce.id},pinned:!1},body:{kind:"text",client_id:Ce.id,content:e.body,markdown_format:"reddit"},display_mode:{body:"visible",comments:"collapsed"},link:e.context,layout:"reddit-comment",default_collapsed:!1,actions:[..."t1"===t.kind?[re(e)]:[],...e.context?[{kind:"link",client_id:Ce.id,url:e.context,text:"Context"}]:[],..."t4"===t.kind?[{kind:"link",client_id:Ce.id,url:"/message/messages/"+e.id,text:"Permalink"}]:[],{kind:"counter",client_id:Ce.id,count_excl_you:"none",you:e.new?"increment":void 0,unique_id:"/unread/"+e.name+"/",time:Date.now(),label:"Mark Unread",incremented_label:"🠶 New",actions:{increment:O.encode({kind:"mark_read",direction:"un",fullname:e.name}),reset:O.encode({kind:"mark_read",direction:"",fullname:e.name})}}],raw_value:t}}return{kind:"thread",body:{kind:"richtext",content:[e.p(e.error("Unsupported "+t.kind,t))]},display_mode:{body:"visible",comments:"collapsed"},layout:"error",default_collapsed:!1,actions:[],raw_value:t,link:"no"}}function de(e,t,i){return{kind:"load_more",load_more:ne.encode({kind:"context",subreddit:e,link_id:t,parent_id:i}),url:"/r/"+e+"/comments/"+t+"?comment="+i.replace("t1_","")+"&context=8",raw_value:[e,t,i]}}function ae(t,i={},n){try{return function(t,i={},n){var r,o,d;if(null!=i.force_expand||(i.force_expand="closed"),"t1"===t.kind){const o=t.data;return{kind:"thread",body:ge(o),display_mode:{body:"visible",comments:"visible"},raw_value:t,link:L(o.permalink,{context:"3",sort:n.sort}),layout:"reddit-comment",info:{time:1e3*o.created_utc,edited:!1!==o.edited&&1e3*o.edited,author:_e(o,v(null!=(r=o.all_awardings)?r:[])),pinned:o.pinned||o.stickied||!1},actions:[ce(o.name),{kind:"link",client_id:Ce.id,text:"Permalink",url:o.permalink?L(o.permalink,{context:"3",sort:n.sort}):"Error no permalink"},me(o.name),se(o.name),pe(o.name,o.saved),ue(o.name,o.subreddit),...n.is_chat?[]:[re(o)],ye(o.body)],default_collapsed:o.collapsed,replies:[...o.locked?[{kind:"thread",body:{kind:"richtext",content:[e.p(e.txt("This comment is locked.")),e.p(e.txt("Only moderators are able to comment on this thread."))]},display_mode:{body:"visible",comments:"collapsed"},raw_value:o.locked,link:"no",actions:[],default_collapsed:!1,layout:"reddit-post"}]:[],...o.replies?o.replies.data.children.map((e=>ae(e,i,fe(n,o.permalink)))):[]]}}if("t3"===t.kind){const e=t.data,n=null!=e.removed_by_category?(null!=(o=we[e.removed_by_category])?o:we.unsupported)(e.removed_by_category,e.subreddit_name_prefixed):void 0,r=e.name.substring(3);e.mod_reports.length,e.user_reports.length;const a=xe(e);return{kind:"thread",title:{text:e.title},flair:Ne(e),body:null!=n?{kind:"removed",removal_message:n,fetch_path:be.encode({path:"https://api.pushshift.io/reddit/submission/search?ids="+r}),body:a,client_id:Ce.id}:a,display_mode:"crosspost"===i.force_expand?{body:"visible",comments:"collapsed"}:{body:"collapsed",body_default:i.force_expand,comments:"collapsed"},raw_value:t,link:e.permalink,thumbnail:ve(e,i.force_expand),layout:"reddit-post",info:{time:1e3*e.created_utc,edited:!1!==e.edited&&1e3*e.edited,author:_e(e,[]),in:{link:"/"+e.subreddit_name_prefixed,name:e.subreddit_name_prefixed},pinned:e.stickied||!1},actions:[...null!=(d=i.show_post_reply_button)&&d?[ce(e.name)]:[],{kind:"link",client_id:Ce.id,url:e.permalink,text:e.num_comments.toLocaleString()+" comment"+(1===e.num_comments?"":"s")},{kind:"link",client_id:Ce.id,url:"/domain/"+e.domain,text:e.domain},me(e.name),se(e.name),pe(e.name,e.saved),re(e),{kind:"link",client_id:Ce.id,url:e.permalink.replace("/comments/","/duplicates/"),text:"Duplicates"},ue(e.name,e.subreddit)],default_collapsed:!1}}if("more"===t.kind){const e=t.data;if(0===e.children.length)return{kind:"load_more",load_more:ne.encode({kind:"parent_permalink",permalink:n.permalink}),url:n.permalink,count:void 0,raw_value:t};if(null==i.link_fullname)throw new Error("!options.link_fullname");return{kind:"load_more",load_more:ne.encode({kind:"api_loadmore",link_fullname:i.link_fullname,children:e.children,parent_permalink:n}),url:n.permalink,count:e.children.length,raw_value:t}}return{kind:"thread",title:{text:"unsupported listing kind "+t.kind},body:{kind:"text",client_id:Ce.id,content:"unsupported",markdown_format:"none"},display_mode:{body:"collapsed",comments:"collapsed"},raw_value:t,link:"TODO no link",layout:"error",actions:[],default_collapsed:!1}}(t,i,n)}catch(r){return console.log(r),{kind:"thread",body:{kind:"richtext",content:[e.p(e.error("Error! "+r.toString(),r))]},display_mode:{body:"visible",comments:"visible"},raw_value:{error:r,listing:t},link:"Error!",layout:"error",actions:[],default_collapsed:!1}}}function se(e){return{kind:"delete",client_id:Ce.id,data:T(e)}}const le=a("report");function ue(e,t){return{kind:"report",client_id:Ce.id,data:le.encode({subreddit:t,fullname:e})}}function ce(e){return{kind:"reply",client_id:Ce.id,key:"reply-"+e,text:"Reply",reply_info:Me.encode({parent_id:e}),mode:"reply"}}function me(e){return{kind:"reply",client_id:Ce.id,key:"edit-"+e,text:"Edit",reply_info:Me.encode({parent_id:e}),mode:"edit"}}function pe(e,t){return{kind:"counter",client_id:Ce.id,unique_id:`/save/${e}/`,time:Date.now(),label:"Save",incremented_label:"Unsave",style:"action-button",incremented_style:"save-button-saved",count_excl_you:"none",you:t?"increment":void 0,actions:{increment:O.encode({kind:"save",fullname:e,direction:""}),reset:O.encode({kind:"save",fullname:e,direction:"un"})}}}function ke(e){var t,i,n;const r={admin:"admin",moderator:"moderator",unsupported:"error"};return{color_hash:e.author,client_id:Ce.id,name:e.author,link:"/u/"+e.author,flair:[...e.flair_bits?x(e.flair_bits):[],...e.is_submitter?Te([{elems:[{kind:"text",text:"«OP»"}],content_warning:!1,system:"op"}]):[],...null!=(t=e.author_cakeday)&&t?Te([{elems:[{kind:"text",text:"«🍰»"}],content_warning:!1,system:"cake"}]):[],...null!=e.distinguished?Te([{elems:[{kind:"text",text:"«"+e.distinguished+"»"}],content_warning:!1,system:null!=(i=r[e.distinguished])?i:r.unsupported}]):[],...null!=(n=e.additional_flairs)?n:[]],pfp:null!=e.pfp&&""!==e.pfp?{url:e.pfp,hover:e.pfp}:void 0}}function _e(e,t){var i;return ke({author:e.author,flair_bits:{type:e.author_flair_type,text:e.author_flair_text,text_color:e.author_flair_text_color,background_color:e.author_flair_background_color,richtext:e.author_flair_richtext},additional_flairs:t,distinguished:e.distinguished,is_submitter:"is_submitter"in e&&(null!=(i=e.is_submitter)&&i),author_cakeday:e.author_cakeday,pfp:e.profile_img})}function he(e){return ke({author:e.data.name,flair_bits:null,additional_flairs:[],distinguished:null,is_submitter:!1,author_cakeday:!1,pfp:e.data.icon_img})}const be=a("fetch_removed_path");function fe(e,t){return{permalink:L(t,{sort:e.sort}),sort:e.sort,is_chat:e.is_chat}}const we={anti_evil_ops:()=>({short:"Anti-Evil Operations",title:"Removed by Reddit's Anti-Evil Operations",body:"For violations of reddit's Content Policy: https://reddit.com/help/contentpolicy"}),community_ops:()=>({short:"Community Operations",title:"Sorry, this post was removed by Reddit's Community team.",body:"It's rare, but Reddit's Community Team will occasionally remove posts from feeds to keep communities safe and civil."}),legal_operations:()=>({short:"Legal Operations",title:"This post was removed for legal reasons",body:"«TODO fill this»"}),copyright_takedown:()=>({short:"Copyright Takedown",title:"Removed for Copyright Infringement",body:"«TODO fill this»"}),reddit:()=>({short:"Spam Filters",title:"Sorry, this post was removed by Reddit's spam filters.",body:"Reddit's automated bots frequently filter posts it thinks might be spam."}),author:()=>({short:"Author",title:"Removed by the author",body:"The author of this post decided to remove it."}),deleted:()=>({short:"Author",title:"Deleted by the author",body:"The author of this post decided to delete it."}),moderator:(e,t)=>({short:"Moderators",title:"Removed by moderators of "+t,body:"Moderators of "+t+" decided to remove this post, likely due to a violation of the subreddit rules."}),automod_filtered:()=>({short:"Filtered by AutoModerator",title:"This post was filtered by AutoModerator",body:"«TODO fill this»"}),unsupported:e=>({short:e,title:"This post was removed for «"+e+"»",body:"ThreadClient does not know what that means."})};function ye(t){return{kind:"code",body:{kind:"richtext",content:[e.pre(t,"markdown")]}}}function ge(e){var t;let i;"[deleted]"===e.author&&(JSON.stringify(e.rtjson)===JSON.stringify({document:[{c:[{e:"text",t:"[deleted]"}],e:"par"}]})?i=we.deleted("deleted",e.subreddit_name_prefixed):JSON.stringify(e.rtjson)===JSON.stringify({document:[{c:[{e:"text",t:"[removed]"}],e:"par"}]})&&(i=we.moderator("moderator",e.subreddit_name_prefixed)));const n={kind:"richtext",content:E(e.rtjson,{media_metadata:null!=(t=e.media_metadata)?t:{}})};return null!=i?{kind:"removed",removal_message:i,fetch_path:be.encode({path:"https://api.pushshift.io/reddit/comment/search?ids="+e.id}),body:n,client_id:Ce.id}:n}function xe(e){var t,i,n;if(e.crosspost_parent_list&&1===e.crosspost_parent_list.length)return{kind:"crosspost",source:ae({kind:"t3",data:e.crosspost_parent_list[0]},{force_expand:"crosspost"},fe({permalink:e.permalink,sort:"unsupported",is_chat:!1},e.permalink)),client_id:Ce.id};if(e.is_self)return{kind:"array",body:[e.rtjson.document.length?{kind:"richtext",content:E(e.rtjson,{media_metadata:null!=(t=e.media_metadata)?t:{}})}:e.url==="https://www.reddit.com"+e.permalink?{kind:"none"}:{kind:"link",client_id:Ce.id,url:e.url,embed_html:null==(i=e.media_embed)?void 0:i.content},e.poll_data?{kind:"poll",votable:"Cannot vote",total_votes:e.poll_data.total_vote_count,choices:e.poll_data.options.map((e=>{var t;return{name:e.text,votes:null!=(t=e.vote_count)?t:"hidden",id:e.id}})),vote_data:"",select_many:!1,your_votes:null!=e.poll_data.user_selection?[{id:e.poll_data.user_selection}]:[],close_time:e.poll_data.voting_end_timestamp}:void 0]};if(e.gallery_data)return{kind:"gallery",images:e.gallery_data.items.map((t=>{if(!e.media_metadata)throw new Error("missing media metadata");const i=e.media_metadata[t.media_id];if(!i)throw new Error("missing mediameta for "+t.media_id);return j(i,t.caption)}))};if(e.rpan_video)return{kind:"video",source:{kind:"video",sources:[{url:e.rpan_video.hls_url}]},gifv:!1};if(e.preview&&1===e.preview.images.length){const t=e.preview.images[0];if(t.variants.mp4){const e=t.variants.mp4,i=[...e.resolutions,e.source].sort(((e,t)=>t.width-e.width)).map((e=>({url:e.url,quality:e.width+"×"+e.height})));return{kind:"video",source:{kind:"video",sources:i,preview:[...i].reverse()},gifv:!0}}if(e.preview.enabled)return{kind:"captioned_image",url:t.source.url,w:t.source.width,h:t.source.height}}return{kind:"link",client_id:Ce.id,url:e.url,embed_html:null==(n=e.media_embed)?void 0:n.content}}function ve(e,t){var i,n,r,o,d,a;if("crosspost"!==t)return null!=(null==(d=null==(o=null==(r=null==(n=null==(i=e.preview)?void 0:i.images)?void 0:n[0])?void 0:r.resolutions)?void 0:o[0])?void 0:d.url)?{kind:"image",url:e.preview.images[0].resolutions[0].url}:e.rpan_video?{kind:"image",url:e.rpan_video.scrubber_media_url}:null!=e.thumbnail&&""!==e.thumbnail?e.thumbnail.includes("/")?{kind:"image",url:e.thumbnail}:{kind:"default",thumb:null!=(a=Te({self:"self",default:"default",image:"image",spoiler:"spoiler",nsfw:"nsfw",account:"account"})[e.thumbnail])?a:"error"}:{kind:"default",thumb:"default"}}function Ne(e){var t;const i=[];return i.push(...x({type:e.link_flair_type,text:e.link_flair_text,text_color:e.link_flair_text_color,background_color:e.link_flair_background_color,richtext:e.link_flair_richtext})),e.spoiler&&i.push({elems:[{kind:"text",text:"Spoiler"}],content_warning:!0}),e.over_18&&i.push({elems:[{kind:"text",text:"NSFW"}],content_warning:!0}),e.is_original_content&&i.push({elems:[{kind:"text",text:"OC"}],content_warning:!1}),i.push(...v(null!=(t=e.all_awardings)?t:[])),!0===e.approved&&i.push({elems:[{kind:"text",text:"✓ Approved"}],content_warning:!1,system:"approved"}),i}const Te=e=>e;function Oe(){const e="undefined"!=typeof location?location.host:"NOSTATE",t=["account","creddits","edit","flair","history","identity","livemanage","modconfig","modcontributors","modflair","modlog","modmail","modothers","modposts","modself","modwiki","mysubreddits","privatemessages","read","report","save","structuredstyles","submit","subscribe","vote","wikiedit","wikiread"].join(" ");return"raw!https://www.reddit.com/api/v1/authorize?"+i({client_id:y,response_type:"code",state:e,redirect_uri:g,duration:"permanent",scope:t})}async function Ee(e){if("homepage"===e.kind)return{sidebar:null};if("userpage"===e.kind)return{sidebar:null};if("mod"===e.kind)return{sidebar:null};if("subreddit"===e.kind){const[t,i]=await Promise.all([Le(`/r/${e.subreddit}/api/widgets`,{method:"GET",onerror:e=>{},cache:!0}),Le(`/r/${e.subreddit}/about`,{method:"GET",onerror:e=>{},cache:!0})]),n={subreddit:e.subreddit,sub_t5:null!=i?i:null,widgets:null!=t?t:null};return{sidebar:W(n),header:V(n)}}if("multireddit"===e.kind){const[t]=await Promise.all([Le("/"+["api","multi",...e.base].join("/"),{method:"GET",onerror:e=>{},cache:!0})]);return{sidebar:t?Se(t):null}}De(e)}function Se(t){const i=t.data;return[{kind:"widget",title:i.display_name,raw_value:t,widget_content:{kind:"body",body:{kind:"array",body:[{kind:"richtext",content:[e.p(e.txt("Curated by "),e.link(Ce,"/u/"+i.owner,{is_user_link:i.owner.toLowerCase()},e.txt("u/"+i.owner))),e.p(e.txt("Created "),e.timeAgo(1e3*i.created_utc))]},{kind:"text",client_id:Ce.id,content:i.description_md,markdown_format:"reddit"}]}},actions_bottom:[{kind:"link",client_id:Ce.id,text:"Create a copy",url:"TODO"}]},{kind:"widget",title:"Subreddits ("+i.subreddits.length+")",raw_value:i.subreddits,widget_content:{kind:"list",items:i.subreddits.map((e=>({name:{kind:"text",text:"r/"+e.name},click:{kind:"link",client_id:Ce.id,url:"/r/"+e.name}})))}}]}function Pe(e){const t=e.banner_background_image||e.banner_img||"",i=e.community_icon||e.icon_img||"";return{banner:t?{desktop:t}:null,icon:i?{url:i}:null}}function je(t,i,n){const r=[];return(null==t?void 0:t.data)?r.push({kind:"bio",...Pe(t.data.subreddit),name:{display:t.data.name,link_name:"u/"+t.data.name},menu:null,raw_value:t,body:{kind:"text",client_id:Ce.id,content:t.data.subreddit.public_description,markdown_format:"reddit"},subscribe:{kind:"counter",client_id:Ce.id,unique_id:"/follow/"+t.data.name+"/",time:Date.now(),label:"Follow",incremented_label:"Following",style:"pill-filled",incremented_style:"pill-empty",count_excl_you:t.data.is_friend?t.data.subreddit.subscribers-1:t.data.subreddit.subscribers,you:t.data.is_friend?"increment":void 0,actions:{error:"TODO implement add friend"}}},{kind:"widget",title:"About",widget_content:{kind:"body",body:{kind:"richtext",content:[e.h1(e.link(Ce,"/u/"+t.data.name,{is_user_link:t.data.name},e.txt(t.data.name))),e.p(e.txt(t.data.link_karma+" post karma")),e.p(e.txt(t.data.comment_karma+" comment karma")),e.p(e.txt("Account created "),e.timeAgo(1e3*t.data.created_utc))]}},raw_value:t}):r.push({kind:"widget",title:"TODO",widget_content:{kind:"body",body:{kind:"richtext",content:[e.p(e.txt("Failed to fetch user info for this user :("))]}},raw_value:t}),(null==n?void 0:n.data)?r.push({kind:"widget",title:"Moderates",raw_value:n,widget_content:{kind:"list",items:n.data.map((e=>({icon:e.community_icon||e.icon_img||"undefined",name:{kind:"text",text:e.sr_display_name_prefixed},click:{kind:"link",url:e.url}})))}}):n||r.push({kind:"widget",title:"TODO",widget_content:{kind:"body",body:{kind:"richtext",content:[e.p(e.txt("Failed to fetch modded subs for this user :("))]}},raw_value:n}),(null==i?void 0:i.data)?r.push({kind:"widget",title:"Trophy Case",widget_content:{kind:"body",body:{kind:"richtext",content:[...i.data.trophies.map((({data:t})=>{const i=[...null!=t.url?[e.p(e.link(Ce,t.url,{},e.txt(t.url)))]:[],...null!=t.description?[e.p(e.txt(t.description))]:[]];return{kind:"body",body:{kind:"crosspost",client_id:Ce.id,source:{kind:"thread",title:{text:t.name},body:i.length?{kind:"richtext",content:i}:{kind:"none"},thumbnail:{kind:"image",url:t.icon_70},display_mode:{body:"collapsed",comments:"collapsed",body_default:"closed"},raw_value:t,link:t.icon_70,layout:"reddit-post",info:{time:null!=t.granted_at&&1e3*t.granted_at,edited:!1,pinned:!0},actions:[],default_collapsed:!1}}}}))]}},raw_value:t}):r.push({kind:"widget",title:"TODO",widget_content:{kind:"body",body:{kind:"richtext",content:[e.p(e.txt("Failed to fetch trophy case for this user :("))]}},raw_value:i}),r}function Re(e){let t=Y.parse(e);for(let i=0;"redirect"===t.kind&&i<100;i++)e=t.to,t=Y.parse(e);return[t,e]}function Ie(e){return e}const Ce={id:"reddit",getPage:async function(n){const r=new Map,o=Date.now();try{const[o,d]=Re(n);if(console.log("PARSED URL:",o),"link_out"===o.kind)return{pivot:{ref:{kind:"post",client_id:Ce.id,content:{kind:"post",title:{text:"Not Supported"},body:{kind:"richtext",content:[e.h1(e.link(Ce,"raw!"+o.out,{},e.txt("View on reddit.com"))),e.p(e.txt("ThreadClient does not support this URL"))]},show_replies_when_below_pivot:!1,collapsible:!1},display_style:"centered",parent:null,replies:null,url:null,internal_data:o}}};if("todo"===o.kind)return{pivot:{ref:{kind:"post",client_id:Ce.id,content:{kind:"post",title:{text:"Not Supported"},body:{kind:"richtext",content:[e.h1(e.link(Ce,"raw!https://www.reddit.com"+o.path,{},e.txt("View on reddit.com"))),e.p(e.txt("ThreadClient does not yet support this URL")),e.p(e.txt(o.msg))]},show_replies_when_below_pivot:!1,collapsible:!1},display_style:"centered",parent:null,replies:null,url:null,internal_data:o}}};if("raw"===o.kind){const e=await Le(o.path,{method:"GET"});return{pivot:c(d,e)}}if("redirect"===o.kind)return{pivot:{ref:{kind:"post",client_id:Ce.id,content:{kind:"post",title:{text:"Not Supported"},body:{kind:"richtext",content:[e.h1(e.link(Ce,"raw!https://www.reddit.com"+d,{},e.txt("View on reddit.com"))),e.p(e.txt("Error! Redirect Loop. ThreadClient tried to redirect more than 100 times."))]},show_replies_when_below_pivot:!1,collapsible:!1},display_style:"centered",parent:null,replies:null,url:null,internal_data:o}}};const a=t(o,{comments:e=>"/comments/"+e.post_id_unprefixed+"?"+i({sort:e.sort_override,comment:e.focus_comment,context:e.context}),duplicates:e=>"/duplicates/"+e.post_id_unprefixed+"?"+i({after:e.after,before:e.before,sort:e.sort,crossposts_only:""+e.crossposts_only}),subreddit:e=>"/"+[...e.sub.base,e.current_sort.v].join("/")+"?"+i({t:e.current_sort.t,before:e.before,after:e.after}),wiki:e=>"/"+[...e.sub.base,"wiki",...e.path].join("/")+"?"+i(e.query),user:()=>d,inbox:()=>d}),s=await Le(a,{method:"GET"});return{pivot:l(r,d,o,s)}}catch(d){const t=d;console.log(t);const i=t.toString().includes("NetworkError"),r=o>Date.now()-50,a=navigator.userAgent.includes("Firefox");if(i)return{pivot:{ref:{kind:"post",client_id:Ce.id,content:{kind:"post",title:{text:"Error Loading Page"},body:{kind:"richtext",content:[...r&&a?[e.h1(e.txt("Firefox Enhanced Tracking Protection may be active")),e.p(e.txt("Try disabling Enhanced Tracking Protection for this site.")),e.ul(e.ili(e.txt("Look at the left side of the URL bar for a shield icon")),e.ili(e.txt("Click it")),e.ili(e.txt("Flip the switch to turn Enhanced Tracking Protection off"))),e.p(e.txt("Enhanced Tracking Protection blocks ThreadClient from sending requests to Reddit, which prevents ThreadClient from functioning.")),e.h2(e.txt("Other things to check:"))]:[e.h1(e.txt("There was a network error loading this page")),e.h2(e.txt("Things to check:"))],e.ul(e.ili(e.txt("Make sure your internet is working")),e.ili(e.txt("Make sure "),e.link(Ce,"https://www.redditstatus.com/",{},e.txt("Reddit is working"))),e.ili(e.txt("If your browser has tracking protection, try disabling it.")))]},show_replies_when_below_pivot:!1,collapsible:!1},display_style:"centered",parent:null,replies:null,url:null,internal_data:[n,t,{is_networkerror:i,error_was_instant:r,browser_is_firefox:a}]}}};throw t}},async getThread(t){try{const[n,r]=Re(t);if(console.log("PARSED URL:",n),"comments"===n.kind){const[e,t]=await Promise.all([Le(`/comments/${n.post_id_unprefixed}`,{method:"GET",query:{sort:n.sort_override,comment:n.focus_comment,context:n.context}}),Ee(n.sub)]);return B(r,n,e,{...t})}if("duplicates"===n.kind){const[e,t]=await Promise.all([Le(`/duplicates/${n.post_id_unprefixed}`,{method:"GET",query:{after:n.after,before:n.before,sort:n.sort,crossposts_only:""+n.crossposts_only}}),Ee(n.sub)]);return B(r,n,e,{...t})}if("subreddit"===n.kind){const e="/"+[...n.sub.base,n.current_sort.v].join("/"),[t,i]=await Promise.all([Le(e,{method:"GET",query:{t:n.current_sort.t,before:n.before,after:n.after}}),Ee(n.sub)]);return B(r,n,t,{...i})}if("wiki"===n.kind){const e="/"+[...n.sub.base,"wiki",...n.path].join("/")+"?"+i(n.query),[t,o]=await Promise.all([Le(e,{method:"GET"}),Ee(n.sub)]);return B(r,n,t,{...o})}if("user"===n.kind){const e=r,[t,i,o,d]=await Promise.all([Le(e,{method:"GET"}),Le(`/user/${n.username}/about`,{method:"GET",onerror:e=>{},cache:!0}),Le(`/api/v1/user/${n.username}/trophies`,{method:"GET",onerror:e=>{},cache:!0}),Le(`/user/${n.username}/moderated_subreddits`,{method:"GET",onerror:e=>{},cache:!0})]);return B(r,n,t,{sidebar:je(i,o,d)})}if("inbox"===n.kind)if("compose"===n.current.tab);else if("mod"===n.current.tab);else if("message"===n.current.tab);else{if("inbox"===n.current.tab){const e="/message/"+n.current.inbox_tab;return B(r,n,await Le(e,{method:"GET"}),{sidebar:null})}"sent"===n.current.tab||De(n.current)}else{if("link_out"===n.kind)return{title:"LinkOut",navbar:$(),body:{kind:"one",item:{parents:[{kind:"thread",body:{kind:"richtext",content:[e.h1(e.link(Ce,"raw!"+n.out,{},e.txt("View on reddit.com"))),e.p(e.txt("ThreadClient does not support this URL"))]},display_mode:{comments:"visible",body:"visible"},link:r,raw_value:n,layout:"reddit-post",actions:[],default_collapsed:!1}],replies:[]}},display_style:"comments-view"};if("todo"===n.kind){return B(r,n,await Le(n.path,{method:"GET",onerror:e=>({kind:"unsupported",extra:{title:e.message,stack:e.stack,console:e}})}),{sidebar:[{kind:"widget",title:"TODO",widget_content:{kind:"body",body:{kind:"richtext",content:[e.p(e.txt("This page "),e.code(r),e.txt(" is not supported (yet)")),e.p(e.link(Ce,"raw!https://www.reddit.com"+n.path,{},e.txt("View on reddit.com"))),e.p(e.txt(n.msg))]}},raw_value:n}]})}if("raw"===n.kind){return z(r,await Le(n.path,{method:"GET"}),{sidebar:[{kind:"widget",title:"Raw",widget_content:{kind:"body",body:{kind:"richtext",content:[e.p(e.txt("This is a raw page.")),e.p(e.link(Ce,n.path,{},e.txt("View Rendered")))]}},raw_value:n}]})}if("redirect"===n.kind)return{title:"LinkOut",navbar:$(),body:{kind:"one",item:{parents:[{kind:"thread",body:{kind:"richtext",content:[e.h1(e.txt("Error! Redirect Loop")),e.p(e.txt("ThreadClient tried to redirect over 100 times.")),e.p(e.txt("Path: "),e.code(r),e.error("Code",n))]},display_mode:{comments:"visible",body:"visible"},link:r,raw_value:n,layout:"reddit-post",actions:[],default_collapsed:!1}],replies:[]}},display_style:"comments-view"};De(n)}return z(r,n,{sidebar:[{kind:"widget",title:"TODO",widget_content:{kind:"body",body:{kind:"richtext",content:[e.p(e.txt("This page "),e.code(r),e.txt(" is not supported (yet)")),e.p(e.txt(n.kind)),e.p(e.txt("View it on "),e.link(Ce,"raw!https://reddit.com"+r,{},e.txt("reddit.com")),e.txt("."))]}},raw_value:n}]})}catch(n){const e=n;console.log(e);const i=e.toString().includes("NetworkError");return{title:"Error",navbar:$(),body:{kind:"one",item:{parents:[{kind:"thread",title:{text:"Error"},body:{kind:"text",client_id:Ce.id,content:`Error ${e.toString()}`+(i?". If you're using Firefox, try disabling 'Enhanced Tracker Protection'  for this site. Enhanced tracker protection indiscriminately blocks all  requests to social media sites, including Reddit.":"."),markdown_format:"none"},display_mode:{body:"visible",comments:"collapsed"},link:t,layout:"error",actions:[],default_collapsed:!1,raw_value:{}}],replies:[]}},display_style:"comments-view"}}},async login(e,t){const n=t.get("code"),r=t.get("state");if(null==n||null==r)throw new Error("No login requested");if(r!==location.host)throw new Error("Login was for "+r);const o=await fetch("https://www.reddit.com/api/v1/access_token",{method:"POST",mode:"cors",credentials:"omit",headers:{Authorization:"Basic "+btoa(y+":"),"Content-Type":"application/x-www-form-urlencoded"},body:i({grant_type:"authorization_code",code:n,redirect_uri:g})}).then((e=>e.json()));if(o.error)throw console.log(o.error),new Error("error "+o.error);const d={access_token:o.access_token,refresh_token:o.refresh_token,expires:Date.now()+1e3*o.expires_in,scope:o.scope};console.log(o,d),localStorage.setItem("reddit-secret",JSON.stringify(d))},async fetchRemoved(e){const t=be.decode(e),[i,n]=await fetch(t.path).then((async e=>[e.status,await e.text()])),r=JSON.parse(n.split("&lt;").join("<").split("&gt;").join(">").split("&amp;").join("&"));if(200!==i)throw console.log(i,r),new Error("Got status "+i);if(0===r.data.length)throw console.log(i,r),new Error("Post was deleted before it could be saved:.");const o=r.data[0];if("[deleted]"===o.selftext||"[removed]"===o.selftext||"[deleted]"===o.body||"[removed]"===o.body)throw new Error("Post was deleted before it could be saved.");if(o.selftext)return{kind:"text",client_id:Ce.id,content:o.selftext,markdown_format:"reddit"};if(o.body)return{kind:"text",client_id:Ce.id,content:o.body,markdown_format:"reddit"};throw new Error("no selftext or body")},async act(e){const t=O.decode(e);if("vote"===t.kind){const e=await Le("/api/vote",{method:"POST",mode:"urlencoded",body:t.query});console.log(e)}else if("delete"===t.kind){const e=await Le("/api/del",{method:"POST",mode:"urlencoded",body:{id:t.fullname}});console.log(e)}else if("save"===t.kind){const e=await Le(`/api/${t.direction}save`,{method:"POST",mode:"urlencoded",body:{id:t.fullname}});console.log(e)}else if("subscribe"===t.kind){const e=await Le("/api/subscribe",{method:"POST",mode:"urlencoded",body:{action:t.direction,sr_name:t.subreddit}});console.log(e)}else if("mark_read"===t.kind){const e=await Le(`/api/${t.direction}read_message`,{method:"POST",mode:"urlencoded",body:{id:t.fullname},override:!0});console.log(e)}else"log_out"===t.kind?localStorage.removeItem("reddit-secret"):Ge(t)},previewReply(e,t){Me.decode(t);const i={kind:"thread",body:{kind:"text",client_id:Ce.id,content:e,markdown_format:"reddit"},display_mode:{body:"visible",comments:"visible"},raw_value:[e,t],link:"no link",layout:"reddit-comment",info:{time:Date.now(),edited:!1,author:{name:"TODO You",color_hash:"TODO You",link:"/u/TODO You",client_id:Ce.id},pinned:!1},actions:[{kind:"counter",client_id:Ce.id,special:"reddit-points",unique_id:null,time:Date.now(),label:"Vote",incremented_label:"Voted",decremented_label:"Voted",count_excl_you:0,you:"increment",percent:1,actions:{error:"reply not posted"}}],default_collapsed:!1};return{kind:"legacy",client_id:Ce.id,thread:i}},async sendReply(e,t,i){const n=Me.decode(t),r=[];for(let l=0;l<=7;l++){if(4===l)continue;if(7===l)continue;const e="Testing 1<<"+l;r.push({e:"par",c:[{e:"text",t:e,f:[[1<<l,0,7],[64,8,e.length]]}]})}const o={document:r},d={api_type:"json",thing_id:n.parent_id,return_rtjson:"true",..."richtext_demo"===e?{richtext_json:JSON.stringify(o)}:{text:e}},a={reply:"/api/comment",edit:"/api/editusertext"}[i],s=await Le(a,{method:"POST",mode:"urlencoded",body:d});return console.log(s),ae({kind:"t1",data:s},{},{permalink:"TODO",sort:"unsupported",is_chat:!1})},async fetchReportScreen(e){const t=le.decode(e),[i,n]=await Promise.all([await Le(`/r/${t.subreddit}/about/rules`,{method:"GET",cache:!0}),await Le(`/r/${t.subreddit}/about`,{method:"GET",cache:!0})]),r=t.fullname.startsWith("t1_")?"comment":t.fullname.startsWith("t3_")?"link":"unsupported",o=[],d=[];for(const a of i.rules){if("link"===a.kind){if("link"!==r)continue}else if("comment"===a.kind){if("comment"!==r)continue}else"all"===a.kind||P(a.kind);d.push({title:a.violation_reason,description:{kind:"text",client_id:Ce.id,content:a.description,markdown_format:"reddit"},report:{kind:"submit",data:Ue.encode({fullname:t.fullname,subreddit:t.subreddit,reason:{kind:"sub",id:a.short_name}})}})}if(n.data.free_form_reports){const e=100;d.push({title:"Custom Reason",report:{kind:"textarea",input_title:"Custom Reason",char_limit:e,data:Ue.encode({fullname:t.fullname,subreddit:t.subreddit,reason:{kind:"sub_other"},text_max:e})}})}o.push({title:"r/"+t.subreddit+"'s rules",report:{kind:"more",screens:d}});for(const a of i.site_rules_flow)o.push(qe(t,a));return o},async sendReport(e,t){const i=Ue.decode(e);if(console.log(i,t),null==i.text_max){if(null!=t)throw new Error("never. got text in non-textual entry?")}else{if(null==t)throw new Error("never. missing text");if(t.length>i.text_max)throw new Error("report text too long (max "+i.text_max+")")}if("sub_other"===i.reason.kind&&null==t)throw new Error("never. missing text on sub_other");const n=await Le("/api/report",{method:"POST",mode:"urlencoded",body:{sr_name:i.subreddit,thing_id:i.fullname,..."sub"===i.reason.kind?{rule_reason:i.reason.id}:"site"===i.reason.kind?{site_reason:i.reason.id,custom_text:null==t?void 0:t}:"sub_other"===i.reason.kind?{reason:t}:De(i.reason)}});if(console.log("GOT Response:",n),!0!==n.success)throw console.log(n),new Error("Got error response, check console");return{title:"sub_other"===i.reason.kind?"Report Sent!":i.reason.id,body:null!=t?{kind:"text",client_id:Ce.id,content:t,markdown_format:"none"}:{kind:"none"}}},async loadMore(e){var t;const i=ne.decode(e);if("api_loadmore"===i.kind){const e=[...i.children],n=e.splice(0,100),r=await Le("/api/morechildren",{method:"GET",query:{limit_children:"false",children:n.join(","),link_id:i.link_fullname,sort:i.parent_permalink.sort}}),o=[],d=new Map;for(const i of r.json.data.things){d.set(i.data.name,i);const e=d.get(i.data.parent_id);if(e){if("t1"!==e.kind)throw new Error("expected t1 here");(t=e.data).replies||(t.replies={kind:"Listing",data:{before:null,children:[],after:null}}),e.data.replies.data.children.push(i)}else o.push(i)}const a=o.map((e=>ae(e,{link_fullname:i.link_fullname},i.parent_permalink)));if(e.length>0){const t=a[a.length-1];if(t&&"load_more"===t.kind){const i=ne.decode(t.load_more);if("api_loadmore"!==i.kind)throw new Error("bad (this is not good)");i.children=[...e,...i.children],t.load_more=ne.encode(i)}else a.push({kind:"load_more",load_more:ne.encode({kind:"api_loadmore",link_fullname:i.link_fullname,children:e,parent_permalink:i.parent_permalink}),url:i.parent_permalink.permalink,raw_value:e})}return a}if("parent_permalink"===i.kind){const e=await Le(i.permalink,{method:"GET"}),[t,n]=Re(i.permalink);if("comments"!==t.kind)throw new Error("bad link to parent_permalink: "+t.kind);const r=B(n,t,e,{sidebar:null});if("one"===r.body.kind)return r.body.item.replies;throw console.log("Error",r),new Error("todo support load more returning other body ("+r.body.kind+")")}if("context"===i.kind)throw new Error("TODO load more context");if("duplicates"===i.kind)throw new Error("TODO load more duplicates");De(i)},async loadMoreUnmounted(e){const t=ie.decode(e);if("listing"===t.kind){const e=await Le(t.url,{method:"GET"}),[i,n]=Re(t.url),r=B(n,i,e,{sidebar:null});if("listing"===r.body.kind)return{children:r.body.items,next:r.body.next};throw console.log("Error",r),new Error("todo support load more returning other body ("+r.body.kind+")")}if("TODO more"===t.kind)throw new Error("TODO more");De(t)},async hydrateInbox(e){const t=J.decode(e);if("inbox"===t.kind){const e=await Le("/message/unread",{method:"GET"}),t=null!=e.data.after?{kind:"minimum",min:e.data.children.length}:e.data.children.length>0?{kind:"exact",value:e.data.children.length}:{kind:"zero"};return{messages:t,url:"zero"===t.kind?"/message/inbox":"/message/unread"}}if("modmail"===t.kind){const e=await Le("/api/mod/conversations/unread/count",{method:"GET"});return{messages:e.notifications>0?{kind:"exact",value:e.notifications}:{kind:"zero"},url:"/mod/mail/all"}}De(t)}};function De(e){throw console.log("not never:",e),new Error("Expected never")}function qe(e,t){var i;let n;if("nextStepReasons"in t)n={kind:"more",screens:t.nextStepReasons.map((t=>qe(e,t)))};else if("fileComplaint"in t&&!0===t.fileComplaint){const i=t.complaintUrl.replace("%25%28thing%29",encodeURIComponent(e.fullname));n={kind:"more",screens:[{title:t.complaintPageTitle,description:{kind:"text",client_id:Ce.id,content:t.complaintPrompt,markdown_format:"none"},report:{kind:"link",url:"raw!"+i,text:t.complaintButtonText}}]}}else if("canWriteNotes"in t&&!0===t.canWriteNotes){const r=null!=(i=t.isAbuseOfReportButton)&&i?250:2e3;n={kind:"textarea",input_title:t.notesInputTitle,char_limit:r,data:Ue.encode({fullname:e.fullname,subreddit:e.subreddit,text_max:r,reason:{kind:"site",id:t.reasonText}})}}else n="canSpecifyUsernames"in t&&!0===t.canSpecifyUsernames?{kind:"link",url:"raw!https://reddit.com/report",text:"Open Reddit"}:{kind:"submit",data:Ue.encode({fullname:e.fullname,subreddit:e.subreddit,reason:{kind:"site",id:t.reasonText}})};return{title:t.reasonTextToShow,report:n}}const Ue=a("send_report"),Ae=new Map;async function Le(e,t){var i,n,r;try{const o=await async function(){const e=await U();return null==e?"":"Bearer "+e}(),d=function(e,t,i){var n;const[r,o,d]=A(t);if(!r.startsWith("/"))throw new Error("path didn't start with `/` : `"+t+"`");return null!=(n=i.override)&&n?D(e)+r+o.toString():(o.set("raw_json","1"),o.set("rtj","yes"),o.set("emotes_as_images","true"),o.set("gilding_detail","1"),o.set("profile_img","true"),D(e)+r+".json?"+o.toString()+(""===d?"":"#"+d))}(!!o,L(e,null!=(i=t.query)?i:{}),{override:t.override}),a={method:t.method,mode:"cors",credentials:"omit",headers:{...o?{Authorization:o}:{},..."POST"===t.method?{"Content-Type":{json:"application/json",urlencoded:"application/x-www-form-urlencoded"}[t.mode]}:{}},..."POST"===t.method?{body:"json"===t.mode?JSON.stringify(t.body):"urlencoded"===t.mode?Object.entries(t.body).flatMap((([e,t])=>null==t?[]:[encodeURIComponent(e)+"="+encodeURIComponent(t)])).join("&"):Ge(t)}:{}},s=JSON.stringify([d,a]),l=Ae.get(s);if(null!=l&&null!=(n=t.cache)&&n)return l;const[u,c]=await fetch(d,a).then((async e=>[e.status,await e.json()]));if(200!==u){if(t.onstatus)return t.onstatus(u,c);throw console.log(u,c),new Error("got status "+u)}const m=c;if("object"==typeof m){if("json"in m&&"object"==typeof m.json&&"errors"in m.json&&m.json.errors.length>0)throw new Error(m.json.errors.map((([e,t])=>e+": "+t)).join(", "));if("jquery"in m&&Array.isArray(m.jquery)&&"success"in m&&!1===m.success)throw new Error(m.jquery.flatMap((e=>"call"===e[2]?e[3].map((e=>"string"==typeof e?e:"")):[])).join(", "))}return null!=(r=t.cache)&&r&&Ae.set(s,c),c}catch(o){if(console.log("Got error",o),t.onerror)return t.onerror(o);throw o}}const Me=a("reply");function Ge(e){throw console.log(e),new Error("not unreachable")}export{ke as authorFromInfo,_e as authorFromPostOrComment,he as authorFromT2,v as awardingsToFlair,Ce as client,se as deleteButton,Ie as ec,me as editButton,P as expectUnsupported,ye as getCodeButton,ge as getCommentBody,re as getPointsOn,xe as getPostBody,Ne as getPostFlair,ve as getPostThumbnail,B as pageFromListing,Re as parseLink,Le as redditRequest,ce as replyButton,ue as reportButton,pe as saveButton,fe as sortWrap,L as updateQuery,H as urlNotSupportedYet};
