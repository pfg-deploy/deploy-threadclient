import{b as e,a as n}from"./index.fba3e9f4.js";import"./vendor.f1632930.js";const t=e();t.route([],(()=>({kind:"redirect",to:"/news"})));for(const l of["news","newest","newcomments","ask","show","jobs"])t.route([l],(e=>{var n;return{kind:"home",tab:l,page:+(null!=(n=e.query.page)?n:"1")}}));function i(e,t){var r;const d=o(t),a=e.get(d);if(a){if(a.data!==t)throw new Error("ERROR it already exists "+d+" but it's different");throw new Error("ERROR it already exists "+d)}if("header"===t.kind)for(const n of t.replies)i(e,{kind:"item",item:n,parent:d});else if("item"===t.kind)for(const n of null!=(r=t.item.comments)?r:[])i(e,{kind:"item",item:n,parent:d});else n(t);e.set(d,{kind:"unprocessed",link:{ref:void 0,err:"processing not completed"},data:t})}function r(e,t){const i=e.get(t);if(!i)return{ref:void 0,err:"post was not found in tree (TODO load more) ("+t+")"};if("unprocessed"===i.kind){i.kind="processing";const t=function(e,t){var i,l;if("header"===t.data.kind)return s=t.data.parsed,u={items:t.data.replies.map((n=>r(e,d(n))))},{kind:"post",url:null,client_id:a.id,parent:null,replies:u,content:{kind:"page",title:"home"===s.kind?{news:"Hacker News",newest:"New Links",newcomments:"New Comments",ask:"Ask",show:"Show",jobs:"Jobs"}[s.tab]:s.kind,wrap_page:{sidebar:{items:[]},header:{kind:"bio",banner:null,icon:null,name:{link_name:"home"===s.kind?s.tab:s.kind},body:{kind:"none"},menu:null,raw_value:s}}},internal_data:s,display_style:"fullscreen"};if("item"===t.data.kind){const n=t.data.item;return{kind:"post",url:"/item?id="+n.id,client_id:a.id,parent:r(e,t.data.parent),replies:{items:(null!=(i=n.comments)?i:[]).map((n=>r(e,d(n))))},content:{kind:"post",title:null!=n.title?{text:n.title}:null,thumbnail:null!=n.title?{kind:"default",thumb:"default"}:void 0,author:null!=n.user?{name:n.user,color_hash:n.user.toLowerCase(),link:"/user?id="+n.user,client_id:a.id}:void 0,info:{creation_date:1e3*n.time,comments:n.comments_count},body:null!=n.content?{kind:"text",client_id:a.id,markdown_format:"reddit_html",content:n.content}:null!=n.url?{kind:"link",url:n.url,client_id:a.id}:{kind:"none"},actions:{vote:"job"!==n.type?{kind:"counter",client_id:a.id,unique_id:"/vote/"+o(t.data),time:Date.now(),incremented_label:"Voted",label:"Vote",count_excl_you:null!=(l=n.points)?l:"hidden",you:void 0,actions:{}}:void 0},collapsible:{default_collapsed:null!=n.title},show_replies_when_below_pivot:null==n.title},internal_data:t,display_style:"centered"}}n(t.data);var s,u}(e,i);return[i.link.ref,i.link.err]=[t,void 0],i.kind="processed",i.link}if("processing"===i.kind||"processed"===i.kind)return i.link;n(i.kind)}function o(e){return"item"===e.kind?d(e.item):"header"===e.kind?"PAGE_HEADER":void n(e)}function d(e){return"item="+e.id}t.route(["front"],(e=>{var n;return{kind:"front",day:e.query.day,page:+(null!=(n=e.query.page)?n:"1")}})),t.route(["item"],(e=>{var n;return{kind:"item",id:null!=(n=e.query.id)?n:"0"}})),t.route(["user"],(e=>{var n;return{kind:"user",name:null!=(n=e.query.id)?n:"0"}}));const a={id:"hackernews",async getPage(e){const[o,a]=function(e){let n=t.parse(e);for(let i=0;"redirect"===n.kind&&i<100;i++)e=n.to,n=t.parse(e);if("redirect"===n.kind)throw new Error(">100 redirects. "+e);return[n,e]}(e),l=function(e,t){if("user"===e.kind)throw new Error("TODO user");if("home"===e.kind||"front"===e.kind)return{kind:"node-hnapi",url:"https://node-hnapi.herokuapp.com"+t};if("item"===e.kind)return{kind:"node-hnapi",url:"https://node-hnapi.herokuapp.com/item/"+e.id};n(e)}(o,a),s=new Map;if("firebaseio"===l.kind)throw new Error("TODO");if("node-hnapi"===l.kind){const e=await fetch(l.url).then((e=>e.json()));return i(s,{kind:"header",parsed:o,replies:Array.isArray(e)?e:[e]}),{pivot:r(s,Array.isArray(e)?"PAGE_HEADER":d(e))}}n(l)}};export{a as client};
