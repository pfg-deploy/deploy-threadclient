import{r as o,s as Xe,e as w,b as M,g as et,c as tt,d as it}from"./index.f083279e.js";import{e as I}from"./base.50b98d34.js";function Z(...e){console.log(...e)}async function Ae(e){const t=new Map,i=Date.now(),n={};try{const[r,d]=re(e);if(console.log("PARSED URL:",r),r.kind==="link_out")return{content:n,pivot:U(n,{kind:"post",client_id:s.id,content:{kind:"post",title:{text:"Not Supported"},body:{kind:"richtext",content:[o.h1(o.link(s,"raw!"+r.out,{},o.txt("View on reddit.com"))),o.p(o.txt("ThreadClient does not support this URL"))]},show_replies_when_below_pivot:!1,collapsible:!1},display_style:"centered",parent:null,replies:null,url:null,internal_data:r})};if(r.kind==="todo")return{content:n,pivot:U(n,{kind:"post",client_id:s.id,content:{kind:"post",title:{text:"Not Supported"},body:{kind:"richtext",content:[o.h1(o.link(s,"raw!https://www.reddit.com"+r.path,{},o.txt("View on reddit.com"))),o.p(o.txt("ThreadClient does not yet support this URL")),o.p(o.txt(r.msg))]},show_replies_when_below_pivot:!1,collapsible:!1},display_style:"centered",parent:null,replies:null,url:null,internal_data:r})};if(r.kind==="raw"){const a=await _(r.path,{method:"GET"});return{content:n,pivot:X(n,d,a)}}else if(r.kind==="redirect")return{content:n,pivot:U(n,{kind:"post",client_id:s.id,content:{kind:"post",title:{text:"Not Supported"},body:{kind:"richtext",content:[o.h1(o.link(s,"raw!https://www.reddit.com"+d,{},o.txt("View on reddit.com"))),o.p(o.txt("Error! Redirect Loop. ThreadClient tried to redirect more than 100 times."))]},show_replies_when_below_pivot:!1,collapsible:!1},display_style:"centered",parent:null,replies:null,url:null,internal_data:r})};const l=Xe(r,{comments:a=>"/comments/"+a.post_id_unprefixed+"?"+w({sort:a.sort_override,comment:a.focus_comment,context:a.context}),duplicates:a=>"/duplicates/"+a.post_id_unprefixed+"?"+w({after:a.after,before:a.before,sort:a.sort,crossposts_only:""+a.crossposts_only}),subreddit:a=>"/"+[...a.sub.base,a.current_sort.v].join("/")+"?"+w({t:a.current_sort.t,before:a.before,after:a.after}),wiki:a=>"/"+[...a.sub.base,"wiki",...a.path].join("/")+"?"+w(a.query),user:()=>d,inbox:()=>d}),u=await _(l,{method:"GET"});return{content:n,pivot:rt(n,t,d,r,u)}}catch(r){const d=r;console.log(d);const l=d.toString().includes("NetworkError"),u=i>Date.now()-50,a=navigator.userAgent.includes("Firefox");if(l)return{content:n,pivot:U(n,{kind:"post",client_id:s.id,content:{kind:"post",title:{text:"Error Loading Page"},body:{kind:"richtext",content:[...u&&a?[o.h1(o.txt("Firefox Enhanced Tracking Protection may be active")),o.p(o.txt("Try disabling Enhanced Tracking Protection for this site.")),o.ul(o.ili(o.txt("Look at the left side of the URL bar for a shield icon")),o.ili(o.txt("Click it")),o.ili(o.txt("Flip the switch to turn Enhanced Tracking Protection off"))),o.p(o.txt("Enhanced Tracking Protection blocks ThreadClient from sending requests to Reddit, which prevents ThreadClient from functioning.")),o.h2(o.txt("Other things to check:"))]:[o.h1(o.txt("There was a network error loading this page")),o.h2(o.txt("Things to check:"))],o.ul(o.ili(o.txt("Make sure your internet is working")),o.ili(o.txt("Make sure "),o.link(s,"https://www.redditstatus.com/",{},o.txt("Reddit is working"))),o.ili(o.txt("If your browser has tracking protection, try disabling it.")))]},show_replies_when_below_pivot:!1,collapsible:!1},display_style:"centered",parent:null,replies:null,url:null,internal_data:[e,d,{is_networkerror:l,error_was_instant:u,browser_is_firefox:a}]})};throw d}}function U(e,t){const i=Ne("immediate value");return e[i]={data:t},i}function rt(e,t,i,n,r){if(Array.isArray(r)){if(r[0].data.children.length!==1)return X(e,i,r);const d=r[0].data.children[0];if(d.kind!=="t3")return X(e,i,r);const l=d.data.name,a=r[1].data.children[0];a&&a.kind==="t1"&&a.data.parent_id;const c=n.kind==="comments"?n.focus_comment:null;let m=H(t,{kind:"post",post:d,replies:c!=null?"not_loaded":r[1]});if(c!=null)for(const b of r[1].data.children)ee(t,b,d.data.permalink);const k=m;if(c!=null){const b="t1_"+c.toLowerCase();t.has(b)?m=b:Z("focused comment not found in tree `"+b+"`")}let v=m;for(;v!==k;){const b=t.get(v)?.data;if(b?.kind==="comment")v!==m&&(b.missing_replies=!0),v=b.comment.data.parent_id;else break}return T(e,t,m)}else if(r.kind==="Listing"){const d={kind:"subreddit_unloaded",listing:r,details:n.kind==="subreddit"?n.sub:"unknown"};H(t,d);const l=V(d);return T(e,t,l)}else if(r.kind==="wikipage"){const d={kind:"wikipage",listing:r,pathraw:i};H(t,d);const l=V(d);return T(e,t,l)}else r.kind==="t5"?Z("TODO t5"):r.kind==="UserList"?Z("TODO userlist"):O(r.kind);return X(e,i,r)}function qe(e){if(e.kind==="homepage")return"SR_home";if(e.kind==="mod")return"SR_mod";if(e.kind==="multireddit")return"SR_multi/u:"+e.user.toLowerCase()+"/m:"+e.multireddit.toLowerCase();if(e.kind==="userpage")return"SR_user/"+e.user.toLowerCase();if(e.kind==="subreddit")return"SR_sub/"+e.subreddit.toLowerCase();M(e)}function X(e,t,i){return U(e,{kind:"post",client_id:s.id,parent:null,url:null,replies:null,content:{kind:"post",title:{text:"Error!"},collapsible:!1,body:{kind:"richtext",content:[...te(t),o.pre(JSON.stringify(i,null,"  "),"json")]},show_replies_when_below_pivot:!1},internal_data:null,display_style:"centered"})}function be(e,t){const i=Le(e,t);return i?V(i):"__ERROR_FULLNAME__"}function V(e){if(e.kind==="comment")return e.comment.data.name;if(e.kind==="post")return e.post.data.name;if(e.kind==="subreddit_unloaded")return e.details==="unknown"?"__UNKNOWN_LISTING_ROOT":qe(e.details);if(e.kind==="depth_more")return"DEPTH_MORE_"+e.parent_id;if(e.kind==="more")return"MORE_"+e.item.data.children.join(",");if(e.kind==="wikipage")return"WIKIPAGE_there_should_only_be_one";M(e)}function Le(e,t){if(e.kind==="t1")return{kind:"comment",comment:e};if(e.kind==="t3")return{kind:"post",post:e,replies:"not_loaded"};if(e.kind==="more")if(e.data.children.length===0){if(t==null){console.trace("TODO setUpCommentOrUnmounted was called with not loaded parent but req. parent submission");return}return{kind:"depth_more",item:e,parent_id:t}}else return{kind:"more",item:e};else{O(e.kind),Z("TODO setUpCommentOrUnmounted",e.kind,e);return}}function ee(e,t,i){const n=Le(t,i);n!=null&&H(e,n)}function H(e,t){const i=V(t);if(e.get(i))return console.log("Note: Two objects with the same id were created. ID: `"+i+"`"),i;if(t.kind==="comment"){const r=t.comment;if(r.kind==="t1"){const d=r.data;if(d.replies)for(const l of d.replies.data.children)ee(e,l,d.link_id.replace("t3_",""))}else if(r.kind==="more"){if(r.data.name==="t1__")return i}else console.log("TODO setUpMap "+r.kind)}else if(t.kind==="post"){const r=t.post.data;if(r.crosspost_parent_list)for(const d of r.crosspost_parent_list)H(e,{kind:"post",post:{kind:"t3",data:d},replies:"not_loaded"});if(t.replies!=="not_loaded")for(const d of t.replies.data.children)ee(e,d,r.id)}else if(t.kind==="subreddit_unloaded")for(const r of t.listing.data.children)ee(e,r,"not_loaded");else t.kind==="more"||t.kind==="depth_more"||t.kind==="wikipage"||M(t);return e.set(i,{kind:"unprocessed",link:Ne("id: "+i),data:t}),i}function nt(e,t){const i=Ne("immediate error value");return e[i]={error:t},i}function T(e,t,i){const n=t.get(i);if(!n)return nt(e,"post was not found in tree (TODO load more) ("+i+")");if(n.kind==="unprocessed"){n.kind="processing";const r=ot(e,t,n);return e[n.link]={data:r},n.kind="processed",n.link}else{if(n.kind==="processing"||n.kind==="processed")return n.link;M(n.kind)}}function Re(e){const t=e.data;return{creation_date:t.created_utc*1e3,edited:t.edited?{date:t.edited*1e3}:void 0,pinned:t.pinned||t.stickied||!1,in:e.kind==="t3"?{name:t.subreddit_name_prefixed,link:"/"+t.subreddit_name_prefixed,client_id:s.id}:void 0,comments:e.kind==="t3"?e.data.num_comments:void 0}}function ot(e,t,i){if(i.data.kind==="comment"){const n=i.data.comment,r=n.data,d={reply:{action:ue(r.name),locked:r.locked},items:[]};if(i.data.missing_replies??!1){if(r.replies&&r.replies.data.children.length>0){const a=U(e,{kind:"loader",key:$.encode({kind:"parent_permalink",post_id:r.link_id.replace("t3_",""),parent_id:r.id}),load_count:null,parent:i.link,replies:null,url:null,client_id:s.id});d.items.push(a)}}else if(r.replies)for(const a of r.replies.data.children)d.items.push(T(e,t,be(a,r.link_id.replace("t3_",""))));const l=t.get(r.parent_id),u=r.author==="FatFingerHelperBot";return{kind:"post",client_id:s.id,url:g(r.permalink,{context:"3"}),parent:T(e,t,r.parent_id),replies:d,content:{kind:"post",title:null,author:ke(r,Oe(r.all_awardings??[])),body:Je(r),info:Re(n),collapsible:{default_collapsed:u||(r.collapsed??!1)},show_replies_when_below_pivot:!0,actions:{vote:l?.data.kind==="post"&&l.data.post.data.discussion_type==="CHAT"?void 0:K(r),code:ve(r.body),other:[me(r.name),le(r.name),pe(r.name,r.saved),ce(r.name,r.subreddit)]}},internal_data:i.data,display_style:"centered"}}else if(i.data.kind==="post"){const n=i.data.post,r=n.data;return{kind:"post",client_id:s.id,url:r.permalink,parent:T(e,t,qe({kind:"subreddit",subreddit:r.subreddit,base:["r",r.subreddit]})),replies:{reply:{action:ue(r.name),locked:r.locked},items:i.data.replies!=="not_loaded"?i.data.replies.data.children.map(d=>T(e,t,be(d,r.id))):[U(e,{kind:"loader",key:$.encode({kind:"parent_permalink",post_id:r.id,parent_id:null}),parent:i.link,replies:null,client_id:s.id,url:null,load_count:null})]},content:{kind:"post",title:{text:r.title},collapsible:{default_collapsed:!0},flair:Ye(r),author:ke(r),body:ze(r),thumbnail:Ve(r,"open"),info:Re(n),show_replies_when_below_pivot:!1,actions:{vote:K(r),code:ve(r.is_self?r.selftext:r.url),other:[{kind:"link",client_id:s.id,url:"/domain/"+r.domain,text:r.domain},le(r.name),pe(r.name,r.saved),{kind:"link",client_id:s.id,url:"/duplicates/"+r.id,text:"Duplicates"},ce(r.name,r.subreddit),me(r.name)]}},internal_data:i.data,display_style:"centered"}}else if(i.data.kind==="subreddit_unloaded"){const n=[];for(const r of i.data.listing.data.children)n.push(T(e,t,be(r,void 0)));return i.data.listing.data.after!=null&&n.push(T(e,t,"TODO next")),{kind:"post",client_id:s.id,url:null,parent:null,replies:{items:n},content:{kind:"post",title:{text:V(i.data)},collapsible:!1,body:{kind:"none"},show_replies_when_below_pivot:!1},internal_data:i.data,display_style:"fullscreen"}}else if(i.data.kind==="depth_more"){const n=i.data.item.data;return{kind:"loader",client_id:s.id,parent:T(e,t,n.parent_id),replies:null,url:null,load_count:null,key:$.encode({kind:"parent_permalink",post_id:i.data.parent_id,parent_id:n.parent_id})}}else if(i.data.kind==="more"){const n=i.data.item.data;return{kind:"loader",client_id:s.id,parent:T(e,t,n.parent_id),replies:null,url:null,load_count:n.children.length,key:$.encode({kind:"more",data:n})}}else if(i.data.kind==="wikipage"){const n=i.data.listing,r=i.data.pathraw.substr(i.data.pathraw.lastIndexOf("/")+1);return{kind:"post",client_id:s.id,url:i.data.pathraw,parent:null,replies:null,content:{kind:"post",title:{text:r},collapsible:!1,body:{kind:"text",content:n.data.content_html,client_id:s.id,markdown_format:"reddit_html"},show_replies_when_below_pivot:!1,info:{edited:{date:n.data.revision_date*1e3}},author:St(n.data.revision_by),actions:{other:n.data.may_revise?[{kind:"link",client_id:s.id,text:"Edit",url:"TODO edit wiki page"}]:[]}},internal_data:i.data,display_style:"centered"}}else M(i.data)}const $=I("loader");function Ne(e){return Symbol(e)}async function dt(e,t){const i=$.decode(t.key);if(i.kind==="parent_permalink"){const n=`/comments/${i.post_id}/comment/${i.parent_id??""}?context=0`,r=await Ae(n),d={kind:"loaded",parent:t.parent,replies:r.content[r.pivot].data.replies,url:null,client_id:s.id};return{content:{...r.content,[e]:{data:d}}}}else{if(i.kind==="more")throw new Error("TODO more");if(i.kind==="vertical")throw new Error("TODO vertical");M(i)}}const ne="biw1k0YZmDUrjg",Te="https://thread.pfg.pw/login/reddit";function oe(e){if(e.type==null)return[];if(e.type==="text"&&(e.text==null||e.text===""))return[];const t=e.type==="richtext"?(e.richtext??[]).map(n=>n.e==="text"?{kind:"text",text:n.t}:n.e==="emoji"?{kind:"emoji",url:n.u,name:n.a,w:16,h:16}:(O(n.e),{kind:"text",text:"#TODO("+n.e+")"})):e.type==="text"?[{kind:"text",text:e.text}]:[{kind:"text",text:"TODO: "+e.type}],i=t.map(n=>n.kind==="text"?n.text:"").join("");return[{color:e.background_color??void 0,fg_color:e.text_color==="light"?"light":"dark",elems:t,content_warning:i.toLowerCase().startsWith("cw:")||i.toLowerCase().startsWith("tw:")}]}function Oe(e){const t=[];for(const i of e.sort((n,r)=>r.count-n.count)){t.length>0&&t.push({kind:"text",text:" "});const n=i.resized_static_icons[0];t.push({kind:"emoji",url:n.url,w:n.width,h:n.height,name:i.name}),i.count>1&&t.push({kind:"text",text:"\xD7"+i.count})}return t.length===0?[]:[{elems:t,content_warning:!1,system:"none"}]}function we(e){return S.encode({kind:"vote",query:e})}function st(e){return S.encode({kind:"delete",fullname:e})}const S=I("act");function Fe(e,t){try{return ye(e.document,t)}catch(i){return console.log("Error parsing richtext:",i),[o.p(o.error("Error parsing richtext: "+i,i))]}}function ye(e,t){return e.map(i=>at(i,t))}function O(e){console.log("Expected unsupported",e)}function xe(e,t){if(e.status!=="valid")return{thumb:null,aspect:void 0,body:{kind:"richtext",content:[o.p(o.error("Bad Status "+e.status+", "+t,e))]}};if(e.e==="Image"){const i=e.p?.[0]??e.s;return{thumb:i.u??"error",aspect:i.x/i.y,body:{kind:"captioned_image",url:e.s.u,w:e.s.x,h:e.s.y,caption:t}}}if(e.e==="AnimatedImage"){const i=e.p?.[0];return{thumb:i?i.u:"error",aspect:i?i.x/i.y:void 0,body:{kind:"video",source:e.s.mp4!=null?{kind:"video",sources:[{url:e.s.mp4,quality:e.s.x+"\xD7"+e.s.y}]}:{kind:"img",url:e.s.gif},aspect:e.s.x/e.s.y,gifv:!0,caption:t}}}return e.e==="RedditVideo"?{thumb:null,aspect:void 0,body:{kind:"video",source:et(e.id),aspect:e.x/e.y,gifv:e.isGif??!1,caption:t}}:(O(e.e),{thumb:null,aspect:void 0,body:{kind:"richtext",content:[o.p(o.error("TODO "+e.e+", "+t,e))]}})}function at(e,t){switch(e.e){case"par":if(e.c.length===1&&(e.c[0]?.e==="gif"||e.c[0]?.e==="img")){const i=e.c[0],n=t.media_metadata[i.id];return n?o.kind("body",{body:xe(n,i.id.split("|")[0]).body}):o.p(o.error("Missing media id "+i.id,n))}else return e.c.length===1&&e.c[0]?.e==="text"&&e.c[0].t.match(/^---+$/)?o.hr():o.p(...Y(e.c,t));case"img":case"video":case"gif":{const i=t.media_metadata[e.id];return i?o.kind("body",{body:xe(i,e.c).body}):o.p(o.error("unknown id "+e.id,t))}case"h":return o.hn(e.l,...Y(e.c,t));case"hr":return o.hr();case"blockquote":return o.blockquote(...ye(e.c,t));case"list":return o.kind("list",{ordered:e.o},e.c.map(i=>o.li(...ye(i.c,t))));case"code":return o.pre(e.c.map(i=>{switch(i.e){case"raw":return i.t;case"unsupported":return"Err \xAB"+JSON.stringify(i)+"\xBB"}}).join(`
`));case"table":return o.table(e.h.map(i=>lt(i,t)),...e.c.map(i=>i.map(n=>ct(n,t))))}return O(e.e),o.p(o.error("TODO "+e.e,e))}function lt(e,t){return o.th(e.a!=null?{L:"left",C:"center",R:"right"}[e.a]:void 0,...Y(e.c??[],t))}function ct(e,t){return o.td(...Y(e.c,t))}function je(e){return e>=10240&&e<=10495}function Ie(e,t,i){if(t.length===0){e=e.replaceAll("\xAF_(\u30C4)_/\xAF","\xAF\\_(\u30C4)_/\xAF");let u=0,a=0;if([...e].forEach(c=>{const m=c.codePointAt(0);m!==8206&&m!==32&&(a+=1),je(m)&&u++}),u>a*.9&&u>10){const c=[];let m=[];for(const k of e.split(" "))[...k].filter(C=>je(C.codePointAt(0))).length>5?c.length>0?(m.length>0&&(c[c.length-1]+=" "+m.join(" ")),m=[],c.push(k)):(c.push([...m,k].join(" ")),m=[]):m.push(k);return c.push(...m),[o.txt(c.join(`
`))]}return[o.txt(e)]}const n=[];let r=0;const d=u=>{const a=e.substring(r,u);a.length>0&&n.push(o.txt(a))},l=[...e];return t.forEach(([u,a,c])=>{d(a),r=a+c;const m=l.slice(a,a+c).join(""),k=mt(u);k.error!=null?n.push(o.error(m,k.error)):k.code?n.push(o.code(m)):n.push(o.txt(m,{strong:k.strong,emphasis:k.emphasis,strikethrough:k.strike,superscript:k.super}))}),d(e.length),n}function ut(e,t){switch(e.e){case"text":return Ie(e.t,e.f??[]);case"r/":case"u/":return[o.link(s,"/"+e.e+e.t,{is_user_link:e.e==="u/"?e.t:void 0},o.txt((e.l?"/":"")+e.e+e.t))];case"link":return[o.link(s,e.u,{title:e.a},...Ie(e.t,e.f??[]))];case"br":return[o.br()];case"spoilertext":return[o.spoiler(...Y(e.c,t))];case"raw":return[o.txt(e.t)];case"gif":case"img":{const i=t.media_metadata[e.id];return i?i.status!=="valid"?[o.error("Bad status "+i.status,i)]:i.e==="AnimatedImage"?[o.link(s,i.s.mp4??i.s.gif,{},o.txt("[embedded "+e.id.split("|")[0]+"]"))]:i.e==="Image"?i.t==="emoji"?[{kind:"emoji",url:i.s.u,name:":"+e.id.split("|")[2]+":"}]:[o.link(s,i.s.u,{},o.txt("[embedded "+e.id.split("|")[0]+"]"))]:[o.error("Unsupported "+i.e,i)]:[o.error("Missing media id "+e.id,i)]}}return O(e.e),[o.error("TODO "+e.e,e)]}function Y(e,t){return(e??[]).flatMap(i=>ut(i,t))}function mt(e){return{strong:!!(e&1),emphasis:!!(e&2),strike:!!(e&8),super:!!(e&32),code:!!(e&64),error:e&-108?"unsupported style "+e.toString(2):void 0}}function pt(){const e=localStorage.getItem("reddit-secret");return!(e==null||e==="")}function De(e){return"https://"+(e?"oauth.reddit.com":"www.reddit.com")}function kt(e,t,i){const[n,r,d]=Me(t);if(!n.startsWith("/"))throw new Error("path didn't start with `/` : `"+t+"`");return i.override??!1?De(e)+n+r.toString():(r.set("raw_json","1"),r.set("rtj","yes"),r.set("emotes_as_images","true"),r.set("gilding_detail","1"),r.set("profile_img","true"),De(e)+n+".json?"+r.toString()+(d===""?"":"#"+d))}let F=[];function _t(){return new Promise(e=>{F.push(e),F.length===1&&ht().then(t=>{F.forEach(i=>i(t)),F=[]}).catch(t=>{console.log("Get access token error",t),F.forEach(i=>i(null)),F=[]})})}function ft(){return[...crypto.getRandomValues(new Uint8Array(25))].map(e=>e.toString(16).padStart(2,"0")).join("")}async function ht(){const e=localStorage.getItem("reddit-secret");if(e===""||e==null){const i=localStorage.getItem("reddit-app-data");let n;if(i!=null){const l=JSON.parse(i);if(l.expires<Date.now())n=l.device_id;else return l.access_token}else n=ft();const r=await fetch("https://www.reddit.com/api/v1/access_token",{method:"POST",mode:"cors",credentials:"omit",headers:{Authorization:"Basic "+btoa(ne+":"),"Content-Type":"application/x-www-form-urlencoded"},body:w({grant_type:"https://oauth.reddit.com/grants/installed_client",device_id:n,redirect_uri:Te})}).then(l=>l.json());if(r.error)throw console.log(r),new Error("error: "+JSON.stringify(r));const d={access_token:r.access_token,expires:Date.now()+r.expires_in*1e3,scope:r.scope,device_id:n};return localStorage.setItem("reddit-app-data",JSON.stringify(d)),d.access_token}const t=JSON.parse(e);if(console.log(t.expires,Date.now()),t.expires<Date.now()){console.log("Token expired, refreshing\u2026");const[i,n]=await fetch("https://www.reddit.com/api/v1/access_token",{method:"POST",mode:"cors",credentials:"omit",headers:{Authorization:"Basic "+btoa(ne+":"),"Content-Type":"application/x-www-form-urlencoded"},body:it`grant_type=refresh_token&refresh_token=${t.refresh_token}`}).then(async d=>[d.status,await d.json()]);if(i!==200)throw console.log("Error! got",n,"with status code",i),new Error("Status code "+i);if("error"in n)throw console.log("refresh attempt: ",n,t),new Error("Got error while refreshing token: "+n.error);const r={access_token:n.access_token,refresh_token:n.refresh_token??t.refresh_token,expires:Date.now()+n.expires_in*1e3,scope:n.scope};return console.log("Refresh info:",n,r),localStorage.setItem("reddit-secret",JSON.stringify(r)),console.log("Refreshed \u221A"),r.access_token}return t.access_token}async function bt(){const e=await _t();return e==null?"":"Bearer "+e}function Me(e){const[t,...i]=e.split("?"),n=i.join("?"),[r,...d]=n.split("#");return[t??"",new URLSearchParams(r),d.join("#")]}function g(e,t){const[i,n,r]=Me(e);for(const[d,l]of Object.entries(t))l!=null?n.set(d,l):n.delete(d);return i+"?"+n.toString()+(r!==""?"#"+r:"")}function Se(e,t,i){return{kind:"counter",client_id:s.id,increment:{icon:"join",color:"white",label:"Subscribe",undo_label:"Unsubscribe"},decrement:null,unique_id:"/subscribe/"+e+"/",time:Date.now(),style:"pill-filled",incremented_style:"pill-empty",count_excl_you:i?t-1:t,you:i?"increment":void 0,actions:{increment:S.encode({kind:"subscribe",subreddit:e,direction:"sub"}),reset:S.encode({kind:"subscribe",subreddit:e,direction:"unsub"})}}}function wt(e,t){try{return yt(e,t)}catch(i){return console.log("widget error",i),{kind:"widget",title:"Error!",raw_value:e,widget_content:{kind:"body",body:{kind:"richtext",content:[o.p(o.error("Uh oh! Error "+i.toString(),e))]}}}}}function yt(e,t){return e.kind==="moderators"?{kind:"widget",title:"Moderators",raw_value:e,widget_content:{kind:"body",body:{kind:"richtext",content:[o.p(o.link(s,"/message/compose?to=/r/"+t,{style:"pill-empty"},o.txt("Message the mods"))),o.ul(...e.mods.map(i=>o.li(o.p(o.link(s,"/u/"+i.name,{is_user_link:i.name},o.txt("u/"+i.name)),...oe({type:i.authorFlairType,text:i.authorFlairText,text_color:i.authorFlairTextColor,background_color:i.authorFlairBackgroundColor,richtext:i.authorFlairRichText}).flatMap(n=>[o.txt(" "),o.flair(n)]))))),o.p(o.link(s,"/r/"+t+"/about/moderators",{},o.txt("View All Moderators")))]}}}:e.kind==="community-list"?{kind:"widget",title:e.shortName,raw_value:e,widget_content:{kind:"list",items:e.data.map(i=>i.type==="subreddit"?{icon:i.communityIcon||void 0,name:{kind:"text",text:"r/"+i.name},click:{kind:"link",url:"/r/"+i.name},action:Se(i.name,i.subscribers,i.isSubscribed)}:(O(i.type),{name:{kind:"text",text:"ERROR UNSUPPORTED"+i.type},click:{kind:"body",body:{kind:"richtext",content:[o.pre(JSON.stringify(i,null,"	"),"json")]}}}))}}:e.kind==="id-card"?{kind:"widget",title:"Error!",raw_value:e,widget_content:{kind:"body",body:{kind:"richtext",content:[o.p(o.error("Not supported "+e.kind,e))]}}}:e.kind==="menu"?{kind:"widget",title:"Error!",raw_value:e,widget_content:{kind:"body",body:{kind:"richtext",content:[o.p(o.error("Uh oh! TODO widget "+e.kind,e))]}}}:e.kind==="textarea"?{kind:"widget",title:e.shortName,raw_value:e,widget_content:{kind:"body",body:{kind:"text",client_id:s.id,content:e.textHtml,markdown_format:"reddit_html"}}}:e.kind==="subreddit-rules"?{kind:"widget",title:e.shortName,raw_value:e,widget_content:{kind:"list",items:e.data.map((i,n)=>({name:{kind:"text",text:""+(n+1)+". "+i.shortName},click:{kind:"body",body:{kind:"text",client_id:s.id,content:i.descriptionHtml,markdown_format:"reddit_html"}}}))}}:e.kind==="image"?{kind:"widget",title:e.shortName,raw_value:e,widget_content:{kind:"image",src:e.data[e.data.length-1].url,link_url:e.data[e.data.length-1].linkUrl,width:e.data[e.data.length-1].width,height:e.data[e.data.length-1].height}}:e.kind==="post-flair"?{kind:"widget",title:e.shortName,raw_value:e,widget_content:{kind:"list",items:e.order.map(i=>{const n=e.templates[i],r=oe({type:n.type,text:n.text,text_color:n.textColor,background_color:n.backgroundColor,richtext:n.richtext});return r.length!==1?(console.log("bad flair",n,r),{name:{kind:"text",text:"error bad flair"},click:{kind:"body",body:{kind:"richtext",content:[o.p(o.error("bad flair",[n,r]))]}}}):{name:{kind:"flair",flair:r[0]},click:{kind:"link",url:"/r/"+t+'/search?q=flair:"'+encodeURIComponent(n.text)+'"&restrict_sr=1'}}})}}:e.kind==="custom"?{kind:"widget",title:e.shortName,raw_value:e,widget_content:{kind:"iframe",height:""+e.height,srcdoc:`
            <head>
                <link rel="stylesheet" href="${e.stylesheetUrl}">
                <base target="_blank">
            </head>
            <body>${e.textHtml}</body>
        `}}:e.kind==="button"?{kind:"widget",title:e.shortName,raw_value:e,widget_content:{kind:"list",above_text:{kind:"text",content:e.description_html,client_id:s.id,markdown_format:"reddit_html"},items:e.buttons.map(i=>i.kind==="text"?{name:{kind:"text",text:i.text},click:{kind:"link",url:i.url}}:i.kind==="image"?{name:{kind:"image",src:i.url,w:i.width,h:i.height,alt:i.text},click:{kind:"link",url:i.linkUrl}}:(O(i.kind),{name:{kind:"text",text:"TODO "+i.kind},click:{kind:"body",body:{kind:"none"}}}))}}:e.kind==="calendar"?{kind:"widget",title:e.shortName,raw_value:e,widget_content:{kind:"body",body:{kind:"array",body:e.data.flatMap((i,n)=>[...n!==0?[{kind:"richtext",content:[o.hr()]}]:[],{kind:"text",client_id:s.id,content:i.titleHtml,markdown_format:"reddit_html"},{kind:"richtext",content:[o.p(o.timeAgo(i.startTime*1e3))]},{kind:"text",client_id:s.id,content:i.locationHtml,markdown_format:"reddit_html"},{kind:"text",client_id:s.id,content:i.descriptionHtml,markdown_format:"reddit_html"}])}}}:(O(e.kind),{kind:"widget",title:"Error!",raw_value:e,widget_content:{kind:"body",body:{kind:"richtext",content:[o.p(o.error("Uh oh! Unsupported widget "+e.kind,e))]}}})}function xt(e,t){return{kind:"widget",title:e.data.title,raw_value:e,widget_content:{kind:"community-details",description:e.data.public_description},actions_bottom:[Se(t,e.data.subscribers,e.data.user_is_subscriber??!1)]}}function gt(e,t,{collapsed:i}){return{kind:"thread",raw_value:e,body:{kind:"text",client_id:s.id,markdown_format:"reddit_html",content:e.data.description_html},display_mode:{body:i?"collapsed":"visible",comments:"visible"},link:"/r/"+t+"/about/sidebar",layout:"reddit-post",title:{text:"old.reddit sidebar"},actions:[],default_collapsed:!1}}function vt(e){const t=e.widgets,i=d=>{const l=t.items[d];if(!l)throw new Error("bad widget "+d);return l},n=d=>wt(d,e.subreddit),r=[...e.sub_t5?[xt(e.sub_t5,e.subreddit)]:[],...e.sub_t5?[gt(e.sub_t5,e.subreddit,{collapsed:!!t})]:[],...t?t.layout.sidebar.order.map(d=>n(i(d))):[],...t?[n(i(t.layout.moderatorWidget))]:[]];return r.length===0&&r.push({kind:"widget",title:"Error",widget_content:{kind:"body",body:{kind:"richtext",content:[o.p(o.txt("Failed to fetch sidebar for this page :("))]}},raw_value:e}),r}function Nt(e){if(!e)return{kind:"thread",title:{text:"Listing"},body:{kind:"text",client_id:s.id,content:"Listing",markdown_format:"none"},display_mode:{body:"collapsed",comments:"collapsed"},link:"TODO no link",layout:"error",actions:[],default_collapsed:!1,raw_value:e};const t=[{text:"Posts",action:{kind:"link",client_id:s.id,url:"/r/"+e.subreddit},selected:!0}];e:if(e.widgets){const i=e.widgets?.layout.topbar.order.length;if(i===0)break e;if(i!==1){t.push({text:"ERROR Topbar Order",action:{kind:"link",client_id:s.id,url:"error"},selected:!1});break e}const n=e.widgets.items[e.widgets.layout.topbar.order[0]];if(n.kind!=="menu"){t.push({text:"ERROR Topbar Item",action:{kind:"link",client_id:s.id,url:"error"},selected:!1});break e}n.showWiki&&t.push({text:"Wiki",action:{kind:"link",client_id:s.id,url:"/r/"+e.subreddit+"/wiki/index"},selected:!1});const r=d=>{if("children"in d)return{text:d.text,selected:!1,action:{kind:"menu",children:d.children.map(r)}};if("url"in d)return{text:d.text,selected:!1,action:{kind:"link",client_id:s.id,url:d.url}};R(d)};t.push(...n.data.map(d=>({...r(d),selected:!1})))}return{kind:"bio",...e.sub_t5?Ke(e.sub_t5.data):{banner:null,icon:null},name:{display:e.sub_t5?.data.title,link_name:e.sub_t5?e.sub_t5.data.display_name_prefixed:"r/"+e.subreddit},body:null,subscribe:e.sub_t5?Se(e.subreddit,e.sub_t5.data.subscribers,e.sub_t5.data.user_is_subscriber??!1):void 0,menu:t.length===1?null:t,raw_value:e}}const ge=I("deferred_inbox");function j(){return pt()?{actions:[{kind:"act",client_id:s.id,action:S.encode({kind:"log_out"}),text:"Log Out"}],inboxes:[{id:"/messages",name:"Messages",active_color:"orange",hydrate:ge.encode({kind:"inbox"}),url:"/message/inbox"},{id:"/modmail",name:"Modmail",active_color:"green",hydrate:ge.encode({kind:"modmail"}),url:"/mod/mail/all"}]}:{actions:[{kind:"link",client_id:s.id,url:Et(),text:"Log In"},{kind:"link",client_id:s.id,url:"raw!https://www.reddit.com/register",text:"Sign Up"}],inboxes:[]}}function J(e,t,i){const n=[];return i.warning&&n.push(...i.warning),{title:"Error View",navbar:j(),body:{kind:"one",item:{parents:[{kind:"thread",raw_value:t,body:{kind:"richtext",content:[...n,o.pre(JSON.stringify(t,null,"	"),"json")]},display_mode:{body:"visible",comments:"visible"},link:e,layout:"error",actions:[],default_collapsed:!1}],replies:[]}},sidebar:i.sidebar??void 0,display_style:"comments-view"}}function E(e,t,i,n){const r=t;if(Array.isArray(i)){if(i[0].data.children.length!==1)return J(e,i,{sidebar:n.sidebar,warning:te(e)});const d=i[0].data.children[0];if(d.kind!=="t3")return J(e,i,{sidebar:n.sidebar,warning:te(e)});const l=d.data.name,u=d.data.suggested_sort??"confidence",a=d.data.contest_mode,c=d.data.can_mod_post,m=d.data.permalink,k=d.data.locked,v=d.data.discussion_type==="CHAT",b=i[1].data.children,C=[],B=b[0];B&&B.kind==="t1"&&B.data.parent_id!==l&&C.push(Ge(B.data.subreddit,(l??"").replace("t3_",""),B.data.parent_id.replace("t1_","")));let L=b.map(x=>q(x,{link_fullname:l},{permalink:m,sort:u,is_chat:v}));if(r.kind==="comments"&&r.focus_comment!=null){const x=P=>{if(P.length!==1)return;const N=P[0];if(N.kind==="thread")return N},W=P=>{const N=P.raw_value;if(typeof N=="object"&&N&&"data"in N&&typeof N.data=="object"&&N.data&&"name"in N.data&&typeof N.data.name=="string"){const Ee=N.data.name;return Ee.startsWith("t1_")?Ee.replace("t1_",""):void 0}};let h=x(L),he;for(;h;){if(W(h)===r.focus_comment){he=h;break}h=x(h.replies??[])}if(he){for(h=x(L);h&&h!==he;){C.push(h);const P=h.replies;h.replies=void 0,h=x(P??[])}if(h){C.push(h);const P=h.replies;h.replies=void 0,L=P??[]}else L=[]}}i[1].data.after!=null&&L.push({kind:"load_more",url:"TODO",load_more:D.encode({kind:"duplicates",lmurl:"todo"}),raw_value:i[1]});let G;return r.kind==="comments"?a&&!c?G=[{selected:!0,text:"Random",action:{kind:"link",client_id:s.id,url:g(m,{sort:"random"})}}]:G=[["confidence","Best"],["top","Top"],["new","New"],["controversial","Controversial"],["old","Old"],["random","Random"],["qa","Q&A"],["live","Live"]].map(([x,W])=>({selected:(r.sort_override??u)===x,text:W,action:{kind:"link",client_id:s.id,url:g(m,{sort:x})}})):r.kind==="duplicates"?G=[["num_comments","Comments"],["new","New"]].map(([x,W])=>({selected:r.sort===x,text:W,action:{kind:"link",client_id:s.id,url:g(m.replace("/comments","/duplicates"),{sort:x})}})):G=[{selected:!1,text:"error "+r.kind,action:{kind:"link",client_id:s.id,url:"error"}}],{title:d.kind==="t3"?d.data.title:"ERR top not t3",navbar:j(),body:{kind:"one",item:{parents:[q(d,{force_expand:C.length>0?"closed":"open",show_post_reply_button:!0},{permalink:m,sort:"unsupported",is_chat:v}),...a?[(()=>({kind:"thread",body:{kind:"richtext",content:[o.p(o.txt("This thread is in contest mode.")),o.p(o.txt(c?"As a mod, you can sort comments however you wish. Regular users have randomized sorting and cannot see scores.":"Sorting is randomized and scores are hidden."))]},display_mode:{body:"visible",comments:"collapsed"},raw_value:a,link:"no",actions:[],default_collapsed:!1,layout:"reddit-post"}))()]:[],...k?[(()=>({kind:"thread",body:{kind:"richtext",content:[o.p(o.txt("This thread is locked.")),o.p(o.txt(c?"Only mods like you can comment on this thread.":"You are not able to comment on this thread."))]},display_mode:{body:"visible",comments:"collapsed"},raw_value:k,link:"no",actions:[],default_collapsed:!1,layout:"reddit-post"}))()]:[],...C],menu:G,replies:L}},sidebar:n.sidebar??void 0,display_style:"comments-view"}}if(i.kind==="wikipage")return{title:e+" | Wiki",navbar:j(),body:{kind:"one",item:{parents:[{kind:"thread",raw_value:i,body:{kind:"text",client_id:s.id,markdown_format:"reddit_html",content:i.data.content_html},display_mode:{body:"visible",comments:"visible"},link:e,layout:"error",actions:[],default_collapsed:!1}],replies:[]}},sidebar:n.sidebar??void 0,display_style:"comments-view"};if(i.kind==="t5")return{title:e+" | Sidebar",navbar:j(),body:{kind:"one",item:{parents:[{kind:"thread",raw_value:i,body:{kind:"text",client_id:s.id,markdown_format:"reddit_html",content:i.data.description_html},display_mode:{body:"visible",comments:"visible"},link:e,layout:"reddit-post",title:{text:"old.reddit sidebar"},actions:[],default_collapsed:!1}],replies:[]}},sidebar:n.sidebar??void 0,display_style:"comments-view"};if(i.kind==="UserList")return{title:e,navbar:j(),body:{kind:"one",item:{parents:[{kind:"thread",body:{kind:"richtext",content:[o.h1(o.txt("User List")),o.table([o.th("left",o.txt("Username")),o.th("left",o.txt("Added")),o.th("left",o.txt("Perms"))],...i.data.children.map(d=>[o.td(o.link(s,"/u/"+d.name,{is_user_link:d.name},o.txt("u/"+d.name))),o.td(o.timeAgo(d.date*1e3)),o.td(...d.mod_permissions.flatMap((l,u)=>[...u!==0?[o.txt(", ")]:[],o.txt(l)]))]))]},display_mode:{body:"visible",comments:"visible"},raw_value:i,layout:"reddit-post",link:e,actions:[],default_collapsed:!1}],replies:[]}},sidebar:n.sidebar??void 0,display_style:"comments-view"};if(i.kind==="Listing"){i.data.before!=null;let d;if(i.data.after!=null){const a=g(e,{before:void 0,after:i.data.after});d={kind:"load_more_unmounted",load_more_unmounted:Be.encode({kind:"listing",url:a}),url:a,count:void 0,raw_value:i}}const l=[["overview","Overview"],["comments","Comments"],["submitted","Submitted"]],u=[["upvoted","Upvoted"],["downvoted","Downvoted"],["hidden","Hidden"],["saved","Saved"]];return{title:e,navbar:j(),body:{kind:"listing",menu:r.kind==="subreddit"?[{selected:r.current_sort.v==="hot",text:"Hot",action:{kind:"link",client_id:s.id,url:"/"+[...r.sub.base,...r.is_user_page?["hot"]:[]].join("/")}},{selected:r.current_sort.v==="best",text:"Best",action:{kind:"link",client_id:s.id,url:"/"+[...r.sub.base,"best"].join("/")}},{selected:r.current_sort.v==="new",text:"New",action:{kind:"link",client_id:s.id,url:"/"+[...r.sub.base,"new"].join("/")}},{selected:r.current_sort.v==="rising",text:"Rising",action:{kind:"link",client_id:s.id,url:"/"+[...r.sub.base,"rising"].join("/")}},...[["top","Top"],["controversial","Controversial"]].map(([a,c])=>({selected:r.current_sort.v===a,text:r.current_sort.v===a?c+" ("+r.current_sort.t+")":c,action:{kind:"menu",children:[["hour","Hour"],["day","Day"],["week","Week"],["month","Month"],["year","Year"],["all","All Time"]].map(([m,k])=>({text:k,selected:r.current_sort.v===a&&r.current_sort.t===m,action:{kind:"link",client_id:s.id,url:"/"+[...r.sub.base,a].join("/")+"?t="+m}}))}}))]:r.kind==="user"?[...l.map(([a,c])=>({selected:r.current.tab===a,text:c,action:{kind:"show-line-two",children:[{selected:r.current.tab===a&&r.current.sort.sort==="hot",text:"Hot",action:{kind:"link",client_id:s.id,url:g("/"+["u",r.username,a].join("/"),{sort:"hot"})}},{selected:r.current.tab===a&&r.current.sort.sort==="new",text:"New",action:{kind:"link",client_id:s.id,url:g("/"+["u",r.username,a].join("/"),{sort:"new"})}},...[["top","Top"],["controversial","Controversial"]].map(([m,k])=>({selected:r.current.tab===a&&r.current.sort.sort===m,text:r.current.tab===a&&r.current.sort.sort===m?k+" ("+r.current.sort.t+")":k,action:{kind:"menu",children:[["hour","Hour"],["day","Day"],["week","Week"],["month","Month"],["year","Year"],["all","All Time"]].map(([v,b])=>({text:b,selected:r.current.tab===a&&r.current.sort.sort===m&&r.current.sort.t===v,action:{kind:"link",client_id:s.id,url:g("/"+["u",r.username,a].join("/"),{sort:m,t:v})}}))}}))]}})),{selected:r.current.tab==="gilded",text:"Gilded",action:{kind:"show-line-two",children:[{selected:r.current.tab==="gilded"&&r.current.by==="received",text:"Received",action:{kind:"link",client_id:s.id,url:"/"+["u",r.username,"gilded"].join("/")}},{selected:r.current.tab==="gilded"&&r.current.by==="given",text:"Given",action:{kind:"link",client_id:s.id,url:"/"+["u",r.username,"gilded","given"].join("/")}}]}},...u.map(([a,c])=>({selected:r.current.tab===a,text:c,action:{kind:"link",client_id:s.id,url:"/"+["u",r.username,a].join("/")}}))]:r.kind==="inbox"?[{selected:r.current.tab==="compose",text:"Compose",action:{kind:"link",client_id:s.id,url:"/message/compose"}},{selected:r.current.tab==="inbox",text:"Inbox",action:{kind:"show-line-two",children:[["inbox","All"],["unread","Unread"],["messages","Messages"],["comments","Comment Replies"],["selfreply","Post Replies"],["mentions","Username Mentions"]].map(([a,c])=>({text:c,selected:r.current.tab==="inbox"&&r.current.inbox_tab===a,action:{kind:"link",client_id:s.id,url:"/message/"+a}}))}},{selected:r.current.tab==="sent",text:"Sent",action:{kind:"link",client_id:s.id,url:"/message/sent"}}]:[{text:"Error! "+r.kind,selected:!1,action:{kind:"link",client_id:s.id,url:e}}],header:n.header??{kind:"thread",title:{text:"Listing"},body:{kind:"text",client_id:s.id,content:"Listing",markdown_format:"none"},display_mode:{body:"collapsed",comments:"collapsed"},link:"TODO no link",layout:"error",actions:[],default_collapsed:!1,raw_value:r},items:r.kind==="inbox"?i.data.children.map(a=>Tt(a)):i.data.children.map(a=>Ot(a,void 0,{permalink:e,sort:"unsupported",is_chat:!1})),next:d},sidebar:n.sidebar??void 0,display_style:"fullscreen-view"}}return O(i.kind),J(e,i,{sidebar:n.sidebar,warning:te(e)})}function te(e){const t=e.startsWith("/mod/")||e.startsWith("/mod?")||e.startsWith("/mod#")||e==="/mod";return t&&(e=e.replace("/mod","")),[o.h1(o.txt("This url is not supported yet")),t?o.h2(o.txt("View it on mod.reddit.com: "),o.link(s,"raw!https://mod.reddit.com"+e,{},o.txt("mod.reddit.com"+e))):o.h2(o.txt("View it on reddit.com: "),o.link(s,"raw!https://www.reddit.com"+e,{},o.txt("reddit.com"+e))),o.p(o.txt("Submit an issue "),o.link(s,"https://github.com/pfgithub/threadclient/issues",{},o.txt("here")),o.txt(" if you would like to see this supported. Mention the url: "),o.code(e))]}const f=tt(),p=[],de=new Set(["/acknowledgements","/appeal","/appeals","/avatar","/user/me/avatar","/u/me/avatar","/user/:profileName/avatar","/coins","/coins/mobile","/user/me","/user/me/:rest(.*)","/r/u_:profileName","/r/u_:profileName/:rest(.*)","/u/:profileName","/u/:profileName/:rest(.*)","/user/:profileName/submitted","/user/:profileName/submitted/:rest(.*)","/:routePrefix(r)/:subredditName/collection/:collectionId/:partialPostId/:partialCommentId","/:routePrefix(r)/:subredditName/collection/:collectionId/:partialPostId","/:routePrefix(r)/:subredditName/collection/:collectionId","/:routePrefix(user)/:subredditName/collection/:collectionId/:partialPostId/:partialCommentId","/:routePrefix(user)/:subredditName/collection/:collectionId/:partialPostId","/:routePrefix(user)/:subredditName/collection/:collectionId","/:routePrefix(r)/:subredditName/comments/:partialPostId/:urlSafePostTitle/:partialCommentId","/:routePrefix(r)/:subredditName/comments/:partialPostId/:urlSafePostTitle?","/comments/:partialPostId/:urlSafePostTitle/:partialCommentId","/comments/:partialPostId/:urlSafePostTitle?","/:routePrefix(r)/:subredditName/duplicates/:partialPostId/:urlSafePostTitle?","/:routePrefix(user)/:subredditName/duplicates/:partialPostId/:urlSafePostTitle?","/duplicates/:partialPostId/:urlSafePostTitle?","/:routePrefix(user)/:subredditName/comments/:partialPostId/:urlSafePostTitle/:partialCommentId","/:routePrefix(user)/:subredditName/comments/:partialPostId/:urlSafePostTitle?","/verification/:verificationToken","/","/:sort(best|hot|new|rising|controversial|top|gilded|awarded)?","/label/subreddits","/premium","/framedGild/:thingId","/framedModal/:type","/submit","/r/:subredditName/submit","/user/:profileName/submit","/user/:profileName/draft/:draftId","/original/submit","/original","/original/:categoryName/:sort([a-z]+)?","/explore","/explore/:categoryName","/community-points/","/vault/","/web/community-points/","/web/special-membership/:subredditName","/web/membership/:subredditName","/vault/burn","/me/m/:multiredditName","/user/:username/m/:multiredditName","/me/m/:multiredditName/:sort(best)?","/me/m/:multiredditName/:sort(hot)?","/me/m/:multiredditName/:sort(new)?","/me/m/:multiredditName/:sort(rising)?","/me/m/:multiredditName/:sort(controversial)?","/me/m/:multiredditName/:sort(top)?","/me/m/:multiredditName/:sort(gilded)?","/me/m/:multiredditName/:sort(awarded)?","/user/:username/m/:multiredditName/:sort(best)?","/user/:username/m/:multiredditName/:sort(hot)?","/user/:username/m/:multiredditName/:sort(new)?","/user/:username/m/:multiredditName/:sort(rising)?","/user/:username/m/:multiredditName/:sort(controversial)?","/user/:username/m/:multiredditName/:sort(top)?","/user/:username/m/:multiredditName/:sort(gilded)?","/user/:username/m/:multiredditName/:sort(awarded)?","/r/mod/about/:pageName(edited|modqueue|reports|spam|unmoderated)?","/r/mod/:sort(best)?","/r/mod/:sort(hot)?","/r/mod/:sort(new)?","/r/mod/:sort(rising)?","/r/mod/:sort(controversial)?","/r/mod/:sort(top)?","/r/mod/:sort(gilded)?","/r/mod/:sort(awarded)?","/me/f/mod/:sort(best)?","/me/f/mod/:sort(hot)?","/me/f/mod/:sort(new)?","/me/f/mod/:sort(rising)?","/me/f/mod/:sort(controversial)?","/me/f/mod/:sort(top)?","/me/f/mod/:sort(gilded)?","/me/f/mod/:sort(awarded)?","/notifications/","/message/:pageName(inbox|unread|messages|comments|selfreply|mentions|compose|sent|moderator)","/message/messages/:messageId","/user/:profileName/comments","/user/:profileName/about/edit/moderation","/user/:profileName","/user/:profileName/posts","/user/:profileName/snoo","/user/:profileName/:listingType(downvoted|hidden|saved|upvoted|gilded|given)","/user/:profileName/gilded/:listingType(given)","/rpan/r/:subredditName/:partialPostId?","/rpan/:partialPostId?","/settings/:page(account|messaging|profile|privacy|notifications|feed|gold|payments|premium|creator|special)?","/settings/data-request","inexact|/prefs/:page(deactivate|blocked)?","inexact|/user/:username/about/edit","inexact|/user/:username/about/edit/privacy","/search","/r/:subredditName/search","/me/m/:multiredditName/search","/user/:username/m/:multiredditName/search","/wiki/","/r/:subredditName/wiki/","/r/:subredditName/w/:wikiPageName*","/w/:wikiPageName*","/r/:subredditName/wiki/:wikiSubRoute(settings)/:wikiPageName+","/r/:subredditName/wiki/:wikiSubRoute(revisions)","/r/:subredditName/wiki/:wikiSubRoute(edit|create|revisions)/:wikiPageName+","/r/:subredditName/wiki/:wikiPageName+","/wiki/:wikiPageName+","/t/:topicSlug","/r/:subredditName","/r/:subredditName/:sort(best)?","/r/:subredditName/:sort(hot)?","/r/:subredditName/:sort(new)?","/r/:subredditName/:sort(rising)?","/r/:subredditName/:sort(controversial)?","/r/:subredditName/:sort(top)?","/r/:subredditName/:sort(gilded)?","/r/:subredditName/:sort(awarded)?","/subreddits/create","/subreddits/leaderboard","/subreddits/leaderboard/:categoryName/","/r/:subredditName/about","/r/:subredditName/about/:pageName(awards|muted|badges|banned|chat|settings|contributors|emojis|emotes|eventposts|moderators|rules|removal|modqueue|reports|spam|unmoderated|edited|postflair|log|flair|edit|userflair|wiki|wikicontributors|wikibanned|traffic|scheduledposts|broadcasting|content)","/user/:profileName/about/:pageName(awards)","/r/:subredditName/about/:pageName(wiki)/:wikiSubRoute(revisions|wikibanned|wikicontributors)","/r/:subredditName/about/:pageName(wiki)/:wikiSubRoute(edit|create|settings|revisions)/:wikiPageName+","/r/:subredditName/about/:pageName(wiki)/:wikiPageName*","/report"]),y=e=>({kind:"link_out",out:"https://www.reddit.com"+e.path+"?"+w(e.query)}),A=e=>t=>({kind:"todo",path:t.path+"?"+w(t.query),msg:e});f.route(["raw",{path:"rest"}],e=>({kind:"raw",path:"/"+e.path.join("/")+"?"+w(e.query)}));p.push("/acknowledgements");f.route(["acknowledgements"],y);p.push("/appeal");f.route(["appeal"],y);p.push("/appeals");f.route(["appeals"],y);p.push("/avatar");f.route(["appeals"],y);p.push("/coins");f.route(["coins"],y);p.push("/coins/mobile");f.route(["coins","mobile"],y);p.push("/r/u_:profileName","/r/u_:profileName/:rest(.*)");f.route(["r",{user:{kind:"starts-with",text:"u_"}},{remainder:"rest"}],e=>({kind:"redirect",to:"/"+["user",e.user,...e.remainder].join("/")+"?"+w(e.query)}));p.push("/u/:profileName","/u/:profileName/:rest(.*)","/u/me/avatar");f.route(["u",{user:"any"},{remainder:"rest"}],e=>({kind:"redirect",to:"/"+["user",e.user,...e.remainder].join("/")+"?"+w(e.query)}));p.push("/verification/:verificationToken");f.route(["verification",{vtoken:"any"}],y);p.push("/label/subreddits");f.route(["label","subreddits"],y);p.push("/premium");f.route(["premium"],y);p.push("/framedGild/:thingId");f.route(["framedGild",{thing:"any"}],y);p.push("/framedModal/:type");f.route(["framedModal",{type:"any"}],y);p.push("/community-points/","/vault/","/web/community-points/");f.route(["community-points"],y);f.route(["vault"],y);f.route(["web","community-points"],y);function se(e,t){const i=r=>r.multireddit!=null&&r.user!=null?{kind:"multireddit",multireddit:r.multireddit,user:r.user,base:["user",r.user,"m",r.multireddit]}:r.user!=null?{kind:"userpage",user:r.user,base:["user",r.user]}:r.subreddit!=null?{kind:"subreddit",subreddit:r.subreddit,base:["r",r.subreddit]}:{kind:"homepage",base:[]};(t==="home"||t==="subreddit"||t==="user")&&(t==="home"&&p.push("/submit"),t==="subreddit"&&p.push("/r/:subredditName/submit"),t==="user"&&p.push("/user/:profileName/submit"),e.route(["submit"],A("submit post")));const n=["best","hot","new","rising","controversial","top","gilded","awarded"];if(t==="home"&&p.push("/","/:sort("+n.join("|")+")?"),t==="subreddit"&&p.push("/r/:subredditName",...n.map(r=>"/r/:subredditName/:sort("+r+")?")),t==="multireddit"&&p.push("/user/:username/m/:multiredditName",...n.map(r=>"/user/:username/m/:multiredditName/:sort("+r+")?")),e.route([{sort:[...n,...t==="user"?[]:[null]]}],r=>({kind:"subreddit",sub:i(r),is_user_page:!1,current_sort:{v:r.sort??"hot",t:r.query.t??"all"},before:r.query.before??null,after:r.query.after??null})),t==="subreddit"||t==="user"||t==="home"){const r=t==="subreddit"?"/:routePrefix(r)/:subredditName":t==="user"?"/:routePrefix(user)/:subredditName":t==="home"?"":R(t);p.push(r+"/duplicates/:partialPostId/:urlSafePostTitle?"),e.route(["duplicates",{post_id_unprefixed:"any"},{url_safe_post_title:"optional"}],d=>({kind:"duplicates",sub:i(d),post_id_unprefixed:d.post_id_unprefixed,after:d.query.after??null,before:d.query.before??null,crossposts_only:d.query.crossposts_only==="true",sort:d.query.sort??"num_comments"})),p.push(r+"/comments/:partialPostId/:urlSafePostTitle?"),e.route(["comments",{post_id_unprefixed:"any"},{url_safe_post_title:"optional"}],d=>({kind:"comments",sub:i(d),post_id_unprefixed:d.post_id_unprefixed,focus_comment:d.query.comment??null,sort_override:d.query.sort??null,context:d.query.context??null})),p.push(r+"/comments/:partialPostId/:urlSafePostTitle/:partialCommentId"),e.route(["comments",{post_id_unprefixed:"any"},{url_safe_post_title:"any"},{partial_comment_id:"any"}],d=>({kind:"comments",sub:i(d),post_id_unprefixed:d.post_id_unprefixed,focus_comment:d.partial_comment_id,sort_override:d.query.sort??null,context:d.query.context??null}))}}f.with(["user","me"],e=>{p.push("/user/me/avatar"),e.catchall(A("redirect to current user"))});f.with(["user",{user:"any"}],e=>{p.push("/user/:profileName/avatar"),e.route(["user",{profile_name:"any"},"avatar"],i=>({kind:"redirect",to:"/avatar"})),p.push("/user/:profileName","/user/:profileName/comments","/user/:profileName/submitted","/user/:profileName/submitted/:rest(.*)"),e.route([{tab:["overview","comments","submitted",null]}],i=>({kind:"user",username:i.user,current:{kind:"sorted-tab",tab:i.tab??"overview",sort:{sort:i.query.sort??(i.tab==="submitted"?"hot":"new"),t:i.query.t??"all"}}})),p.push("/user/:profileName/posts"),e.route(["posts"],i=>({kind:"redirect",to:"/user/"+i.user+"/submitted?"+w(i.query)}));const t=["downvoted","hidden","saved","upvoted"];p.push("/user/:profileName/:listingType("+t.join("|")+"|gilded|given)"),p.push("/user/:profileName/gilded/:listingType(given)"),e.route([{tab:t}],i=>({kind:"user",username:i.user,current:{kind:"unsorted-tab",tab:i.tab}})),e.route(["gilded",{by:["received","given",null]}],i=>({kind:"user",username:i.user,current:{kind:"gild-tab",tab:"gilded",by:i.by??i.query.show??"received"}})),e.route(["given"],i=>({kind:"user",username:i.user,current:{kind:"gild-tab",tab:"gilded",by:"given"}})),p.push("/user/:profileName/snoo"),e.route(["snoo"],A("snoo")),p.push("/user/:profileName/draft/:draftId"),e.route(["draft",{draft_id:"any"}],A("drafts")),p.push("/user/:profileName/about/edit/moderation"),e.route(["about","edit","moderation"],A("user profile moderation settings")),e.with(["m",{multireddit:"any"}],i=>se(i,"multireddit")),se(e,"user")});f.with(["r",{subreddit:"any"}],e=>{p.push("/r/:subredditName/wiki/:wikiSubRoute(revisions)","/r/:subredditName/wiki/:wikiSubRoute(settings)/:wikiPageName+","/r/:subredditName/wiki/:wikiSubRoute(edit|create|revisions)/:wikiPageName+","/r/:subredditName/wiki/","/r/:subredditName/w/:wikiPageName*","/r/:subredditName/wiki/:wikiPageName+"),e.with([{w_wiki:["w","wiki"]}],t=>{t.route([{wiki_path:"rest"}],i=>({kind:"wiki",sub:{kind:"subreddit",base:["r",i.subreddit],subreddit:i.subreddit},path:i.wiki_path.length===0?["index"]:i.wiki_path,query:i.query}))}),se(e,"subreddit")});f.route([{w_wiki:["w","wiki"]},{wiki_path:"rest"}],e=>({kind:"wiki",sub:{kind:"homepage",base:[]},path:e.wiki_path,query:e.query}));f.with(["message"],e=>{const t=["inbox","unread","messages","comments","selfreply","mentions"];p.push("/message/:pageName("+t.join("|")+"|compose|sent|moderator)"),e.route([{tab:[...t]}],i=>({kind:"inbox",current:{tab:"inbox",inbox_tab:i.tab}})),e.route(["compose"],i=>({kind:"inbox",current:{tab:"compose",to:i.query.to,subject:i.query.subject,message:i.query.message}})),e.route(["sent"],i=>({kind:"inbox",current:{tab:"sent"}})),e.route(["moderator"],i=>({kind:"inbox",current:{tab:"mod"}})),p.push("/message/messages/:messageId"),e.route(["messages",{message_id:"any"}],i=>({kind:"inbox",current:{tab:"message",msgid:i.message_id}}))});se(f,"home");f.with(["mod"],e=>{f.catchall(A("not supported"))});f.catchall(A("not supported"));const ae=[];for(const e of p)de.has(e)?de.delete(e):ae.push("\u2022 unknown: "+e);if(de.size>0)for(const e of de)ae.push("\u2022 missing: "+e);if(ae.length>0){console.log("reddit router ::");for(const e of ae)console.log(e)}const Be=I("load_more_unmounted"),D=I("load_more");function K(e){const t={id:e.name,rank:"2"};return{kind:"counter",client_id:s.id,unique_id:"/vote/"+e.name+"/",time:Date.now(),increment:{icon:"up_arrow",color:"reddit-upvote",label:"Upvote",undo_label:"Undo Upvote"},decrement:{icon:"down_arrow",color:"reddit-downvote",label:"Downvote",undo_label:"Undo Downvote"},special:"reddit-points",count_excl_you:(e.score_hidden??e.hide_score??!1)&&e.score===1?"hidden":e.score+(e.likes===!0?-1:e.likes===!1?1:0),you:e.likes===!0?"increment":e.likes===!1?"decrement":void 0,percent:e.upvote_ratio,actions:e.archived??!1?{error:"archived <6mo"}:{increment:we({...t,dir:"1"}),decrement:we({...t,dir:"-1"}),reset:we({...t,dir:"0"})}}}function Ce(e){if(e.kind==="t1"||e.kind==="t4"){const t=e.data;return{kind:"thread",info:{time:t.created_utc*1e3,edited:!1,author:{name:"u/"+t.author,link:"/u/"+t.author,color_hash:t.author,client_id:s.id},pinned:!1},body:{kind:"text",client_id:s.id,content:t.body_html,markdown_format:"reddit_html"},display_mode:{body:"visible",comments:"collapsed"},link:t.context,layout:"reddit-comment",default_collapsed:!1,actions:[...e.kind==="t1"?[K(t)]:[],...t.context?[{kind:"link",client_id:s.id,url:t.context,text:"Context"}]:[],...e.kind==="t4"?[{kind:"link",client_id:s.id,url:"/message/messages/"+t.id,text:"Permalink"}]:[],{kind:"counter",client_id:s.id,neutral_icon:"envelope_open",increment:{icon:"envelope",color:"white",label:"Mark Unread",undo_label:"\u{1F836} New"},decrement:null,count_excl_you:"none",you:t.new?"increment":void 0,unique_id:"/unread/"+t.name+"/",time:Date.now(),actions:{increment:S.encode({kind:"mark_read",direction:"un",fullname:t.name}),reset:S.encode({kind:"mark_read",direction:"",fullname:t.name})}}],raw_value:e}}return{kind:"thread",body:{kind:"richtext",content:[o.p(o.error("Unsupported "+e.kind,e))]},display_mode:{body:"visible",comments:"collapsed"},layout:"error",default_collapsed:!1,actions:[],raw_value:e,link:"no"}}function Tt(e){if(e.kind==="t1"||e.kind==="t4"){const t=e.data;return{parents:[{kind:"thread",title:{text:t.subject},body:{kind:"none"},display_mode:{body:"visible",comments:"collapsed"},link:"no",layout:"reddit-post",default_collapsed:!1,actions:[],raw_value:e},Ce(e)],replies:typeof t.replies=="object"?t.replies.data.children.map(i=>Ce(i)):[]}}return{parents:[{kind:"thread",body:{kind:"richtext",content:[o.p(o.error("Unsupported "+e.kind,e))]},display_mode:{body:"visible",comments:"collapsed"},layout:"error",default_collapsed:!1,actions:[],raw_value:e,link:"no"}],replies:[]}}function Ot(e,t={},i){const n=q(e,t,i);return e.kind==="t1"&&"link_title"in e.data?{parents:[{kind:"thread",title:{text:e.data.link_title},info:{time:!1,edited:!1,in:{name:e.data.subreddit_name_prefixed,link:"/"+e.data.subreddit_name_prefixed},author:{color_hash:e.data.link_author,name:e.data.link_author,link:"/u/"+e.data.link_author,client_id:s.id},pinned:!1},body:{kind:"link",client_id:s.id,url:e.data.link_permalink},display_mode:{body:"visible",comments:"collapsed"},link:e.data.link_permalink,layout:"reddit-post",default_collapsed:!1,actions:[{kind:"link",client_id:s.id,url:e.data.link_permalink,text:"Permalink"}],raw_value:e,replies:[]},...e.data.parent_id===e.data.link_id?[]:[Ge(e.data.subreddit,e.data.link_id.replace("t3_",""),e.data.parent_id.replace("t1_",""))],n],replies:[]}:{parents:[n],replies:[]}}function Ge(e,t,i){return{kind:"load_more",load_more:D.encode({kind:"context",subreddit:e,link_id:t,parent_id:i}),url:"/r/"+e+"/comments/"+t+"?comment="+i.replace("t1_","")+"&context=8",raw_value:[e,t,i]}}function q(e,t={},i){try{return Pt(e,t,i)}catch(n){return console.log(n),{kind:"thread",body:{kind:"richtext",content:[o.p(o.error("Error! "+n.toString(),n))]},display_mode:{body:"visible",comments:"visible"},raw_value:{error:n,listing:e},link:"Error!",layout:"error",actions:[],default_collapsed:!1}}}function le(e){return{kind:"delete",client_id:s.id,data:st(e)}}const We=I("report");function ce(e,t){return{kind:"report",client_id:s.id,data:We.encode({subreddit:t,fullname:e})}}function ue(e){return{kind:"reply",client_id:s.id,key:"reply-"+e,text:"Reply",reply_info:fe.encode({parent_id:e}),mode:"reply"}}function me(e){return{kind:"reply",client_id:s.id,key:"edit-"+e,text:"Edit",reply_info:fe.encode({parent_id:e}),mode:"edit"}}function pe(e,t){return{kind:"counter",client_id:s.id,increment:{icon:"bookmark",color:"green",label:"Save",undo_label:"Unsave"},decrement:null,unique_id:`/save/${e}/`,time:Date.now(),count_excl_you:"none",you:t?"increment":void 0,actions:{increment:S.encode({kind:"save",fullname:e,direction:""}),reset:S.encode({kind:"save",fullname:e,direction:"un"})}}}function $e(e){const t={admin:"admin",moderator:"moderator",unsupported:"error"};return{color_hash:e.author,client_id:s.id,name:e.author,link:"/u/"+e.author,flair:[...e.flair_bits?oe(e.flair_bits):[],...e.is_submitter?ie([{elems:[{kind:"text",text:"\xABOP\xBB"}],content_warning:!1,system:"op"}]):[],...e.author_cakeday??!1?ie([{elems:[{kind:"text",text:"\xAB\u{1F370}\xBB"}],content_warning:!1,system:"cake"}]):[],...e.distinguished!=null?ie([{elems:[{kind:"text",text:"\xAB"+e.distinguished+"\xBB"}],content_warning:!1,system:t[e.distinguished]??t.unsupported}]):[],...e.additional_flairs??[]],pfp:e.pfp!=null&&e.pfp!==""?{url:e.pfp,hover:e.pfp}:void 0}}function ke(e,t){return $e({author:e.author,flair_bits:{type:e.author_flair_type,text:e.author_flair_text,text_color:e.author_flair_text_color,background_color:e.author_flair_background_color,richtext:e.author_flair_richtext},additional_flairs:t,distinguished:e.distinguished,is_submitter:"is_submitter"in e?e.is_submitter??!1:!1,author_cakeday:e.author_cakeday,pfp:e.profile_img})}function St(e){return $e({author:e.data.name,flair_bits:null,additional_flairs:[],distinguished:null,is_submitter:!1,author_cakeday:!1,pfp:e.data.icon_img})}const Pe=I("fetch_removed_path");function He(e,t){return{permalink:g(t,{sort:e.sort}),sort:e.sort,is_chat:e.is_chat}}const _e={anti_evil_ops:()=>({short:"Anti-Evil Operations",title:"Removed by Reddit's Anti-Evil Operations",body:"For violations of reddit's Content Policy: https://reddit.com/help/contentpolicy"}),community_ops:()=>({short:"Community Operations",title:"Sorry, this post was removed by Reddit's Community team.",body:"It's rare, but Reddit's Community Team will occasionally remove posts from feeds to keep communities safe and civil."}),legal_operations:()=>({short:"Legal Operations",title:"This post was removed for legal reasons",body:"\xABTODO fill this\xBB"}),copyright_takedown:()=>({short:"Copyright Takedown",title:"Removed for Copyright Infringement",body:"\xABTODO fill this\xBB"}),reddit:()=>({short:"Spam Filters",title:"Sorry, this post was removed by Reddit's spam filters.",body:"Reddit's automated bots frequently filter posts it thinks might be spam."}),author:()=>({short:"Author",title:"Removed by the author",body:"The author of this post decided to remove it."}),deleted:()=>({short:"Author",title:"Deleted by the author",body:"The author of this post decided to delete it."}),moderator:(e,t)=>({short:"Moderators",title:"Removed by moderators of "+t,body:"Moderators of "+t+" decided to remove this post, likely due to a violation of the subreddit rules."}),automod_filtered:()=>({short:"Filtered by AutoModerator",title:"This post was filtered by AutoModerator",body:"\xABTODO fill this\xBB"}),content_takedown:()=>({short:"Content Takedown",title:"Sorry, this post was removed by Reddit.",body:"Reddit administrators occasionally remove posts that violate Reddit's User Agreement and Content Policy."}),unsupported:e=>({short:e,title:"This post was removed for \xAB"+e+"\xBB",body:"ThreadClient does not know what that means."})};function ve(e){return{kind:"code",body:{kind:"richtext",content:[o.pre(e,"markdown")]}}}function Je(e){let t;e.author==="[deleted]"&&(JSON.stringify(e.rtjson)===JSON.stringify({document:[{c:[{e:"text",t:"[deleted]"}],e:"par"}]})?t=_e.deleted("deleted",e.subreddit_name_prefixed):JSON.stringify(e.rtjson)===JSON.stringify({document:[{c:[{e:"text",t:"[removed]"}],e:"par"}]})&&(t=_e.moderator("moderator",e.subreddit_name_prefixed)));const i={kind:"richtext",content:Fe(e.rtjson,{media_metadata:e.media_metadata??{}})};return t!=null?{kind:"removed",removal_message:t,fetch_path:Pe.encode({path:"https://api.pushshift.io/reddit/comment/search?ids="+e.id}),body:i,client_id:s.id}:i}function ze(e){if(e.crosspost_parent_list&&e.crosspost_parent_list.length===1)return{kind:"crosspost",source:q({kind:"t3",data:e.crosspost_parent_list[0]},{force_expand:"crosspost"},He({permalink:e.permalink,sort:"unsupported",is_chat:!1},e.permalink)),client_id:s.id};if(e.is_self)return{kind:"array",body:[e.rtjson.document.length?{kind:"richtext",content:Fe(e.rtjson,{media_metadata:e.media_metadata??{}})}:e.url==="https://www.reddit.com"+e.permalink?{kind:"none"}:{kind:"link",client_id:s.id,url:e.url,embed_html:e.media_embed?.content},e.poll_data?{kind:"poll",votable:"Cannot vote",total_votes:e.poll_data.total_vote_count,choices:e.poll_data.options.map(t=>({name:t.text,votes:t.vote_count??"hidden",id:t.id})),vote_data:"",select_many:!1,your_votes:e.poll_data.user_selection!=null?[{id:e.poll_data.user_selection}]:[],close_time:e.poll_data.voting_end_timestamp}:void 0]};if(e.gallery_data)return{kind:"gallery",images:e.gallery_data.items.map(t=>{if(!e.media_metadata)throw new Error("missing media metadata");const i=e.media_metadata[t.media_id];if(!i)throw new Error("missing mediameta for "+t.media_id);return xe(i,t.caption)})};if(e.rpan_video)return{kind:"video",source:{kind:"video",sources:[{url:e.rpan_video.hls_url}]},gifv:!1};if(e.preview&&e.preview.images.length===1){const t=e.preview.images[0];if(t.variants.mp4){const i=t.variants.mp4,n=[...i.resolutions,i.source].sort((r,d)=>d.width-r.width).map(r=>({url:r.url,quality:r.width+"\xD7"+r.height}));return{kind:"video",source:{kind:"video",sources:n,preview:[...n].reverse()},gifv:!0}}if(e.preview.enabled)return{kind:"captioned_image",url:t.source.url,w:t.source.width,h:t.source.height}}return{kind:"link",client_id:s.id,url:e.url,embed_html:e.media_embed?.content}}function Ve(e,t){if(t!=="crosspost")return e.preview?.images?.[0]?.resolutions?.[0]?.url!=null?{kind:"image",url:e.preview.images[0].resolutions[0].url}:e.rpan_video?{kind:"image",url:e.rpan_video.scrubber_media_url}:e.thumbnail!=null&&e.thumbnail!==""?e.thumbnail.includes("/")?{kind:"image",url:e.thumbnail}:{kind:"default",thumb:ie({self:"self",default:"default",image:"image",spoiler:"spoiler",nsfw:"nsfw",account:"account"})[e.thumbnail]??"error"}:{kind:"default",thumb:"default"}}function Ye(e){const t=[];return t.push(...oe({type:e.link_flair_type,text:e.link_flair_text,text_color:e.link_flair_text_color,background_color:e.link_flair_background_color,richtext:e.link_flair_richtext})),e.spoiler&&t.push({elems:[{kind:"text",text:"Spoiler"}],content_warning:!0}),e.over_18&&t.push({elems:[{kind:"text",text:"NSFW"}],content_warning:!0}),e.is_original_content&&t.push({elems:[{kind:"text",text:"OC"}],content_warning:!1}),t.push(...Oe(e.all_awardings??[])),e.approved===!0&&t.push({elems:[{kind:"text",text:"\u2713 Approved"}],content_warning:!1,system:"approved"}),t}const ie=e=>e;function Pt(e,t={},i){if(t.force_expand??="closed",e.kind==="t1"){const n=e.data;return{kind:"thread",body:Je(n),display_mode:{body:"visible",comments:"visible"},raw_value:e,link:g(n.permalink,{context:"3",sort:i.sort}),layout:"reddit-comment",info:{time:n.created_utc*1e3,edited:n.edited===!1?!1:n.edited*1e3,author:ke(n,Oe(n.all_awardings??[])),pinned:n.pinned||n.stickied||!1},actions:(()=>[ue(n.name),{kind:"link",client_id:s.id,text:"Permalink",url:n.permalink?g(n.permalink,{context:"3",sort:i.sort}):"Error no permalink"},me(n.name),le(n.name),pe(n.name,n.saved),ce(n.name,n.subreddit),...i.is_chat?[]:[K(n)],ve(n.body)])(),default_collapsed:n.collapsed,replies:[...n.locked?[(()=>({kind:"thread",body:{kind:"richtext",content:[o.p(o.txt("This comment is locked.")),o.p(o.txt("Only moderators are able to comment on this thread."))]},display_mode:{body:"visible",comments:"collapsed"},raw_value:n.locked,link:"no",actions:[],default_collapsed:!1,layout:"reddit-post"}))()]:[],...n.replies?n.replies.data.children.map(d=>q(d,t,He(i,n.permalink))):[]]}}else if(e.kind==="t3"){const n=e.data,r=n.removed_by_category!=null?(_e[n.removed_by_category]??_e.unsupported)(n.removed_by_category,n.subreddit_name_prefixed):void 0,d=n.name.substring(3);n.mod_reports.length+n.user_reports.length>0;const l=ze(n);return{kind:"thread",title:{text:n.title},flair:Ye(n),body:r!=null?{kind:"removed",removal_message:r,fetch_path:Pe.encode({path:"https://api.pushshift.io/reddit/submission/search?ids="+d}),body:l,client_id:s.id}:l,display_mode:t.force_expand==="crosspost"?{body:"visible",comments:"collapsed"}:{body:"collapsed",body_default:t.force_expand,comments:"collapsed"},raw_value:e,link:n.permalink,thumbnail:Ve(n,t.force_expand),layout:"reddit-post",info:{time:n.created_utc*1e3,edited:n.edited===!1?!1:n.edited*1e3,author:ke(n,[]),in:{link:"/"+n.subreddit_name_prefixed,name:n.subreddit_name_prefixed},pinned:n.stickied||!1},actions:[...t.show_post_reply_button??!1?[ue(n.name)]:[],{kind:"link",client_id:s.id,url:n.permalink,text:n.num_comments.toLocaleString()+" comment"+(n.num_comments===1?"":"s")},{kind:"link",client_id:s.id,url:"/domain/"+n.domain,text:n.domain},me(n.name),le(n.name),pe(n.name,n.saved),K(n),{kind:"link",client_id:s.id,url:n.permalink.replace("/comments/","/duplicates/"),text:"Duplicates"},ce(n.name,n.subreddit)],default_collapsed:!1}}else if(e.kind==="more"){const n=e.data;if(n.children.length===0)return{kind:"load_more",load_more:D.encode({kind:"parent_permalink",permalink:i.permalink}),url:i.permalink,count:void 0,raw_value:e};if(t.link_fullname==null)throw new Error("!options.link_fullname");return{kind:"load_more",load_more:D.encode({kind:"api_loadmore",link_fullname:t.link_fullname,children:n.children,parent_permalink:i}),url:i.permalink,count:n.children.length,raw_value:e}}else return{kind:"thread",title:{text:"unsupported listing kind "+e.kind},body:{kind:"text",client_id:s.id,content:"unsupported",markdown_format:"none"},display_mode:{body:"collapsed",comments:"collapsed"},raw_value:e,link:"TODO no link",layout:"error",actions:[],default_collapsed:!1}}function Et(){const e=typeof location<"u"?location.host:"NOSTATE",t=["account","creddits","edit","flair","history","identity","livemanage","modconfig","modcontributors","modflair","modlog","modmail","modothers","modposts","modself","modwiki","mysubreddits","privatemessages","read","report","save","structuredstyles","submit","subscribe","vote","wikiedit","wikiread"].join(" ");return"raw!https://www.reddit.com/api/v1/authorize?"+w({client_id:ne,response_type:"code",state:e,redirect_uri:Te,duration:"permanent",scope:t})}async function Q(e){if(e.kind==="homepage")return{sidebar:null};if(e.kind==="userpage")return{sidebar:null};if(e.kind==="mod")return{sidebar:null};if(e.kind==="subreddit"){const[t,i]=await Promise.all([_(`/r/${e.subreddit}/api/widgets`,{method:"GET",onerror:r=>{},cache:!0}),_(`/r/${e.subreddit}/about`,{method:"GET",onerror:r=>{},cache:!0})]),n={subreddit:e.subreddit,sub_t5:i??null,widgets:t??null};return{sidebar:vt(n),header:Nt(n)}}if(e.kind==="multireddit"){const[t]=await Promise.all([_("/"+["api","multi",...e.base].join("/"),{method:"GET",onerror:i=>{},cache:!0})]);return{sidebar:t?Rt(t):null}}R(e)}function Rt(e){const t=e.data;return[{kind:"widget",title:t.display_name,raw_value:e,widget_content:{kind:"body",body:{kind:"array",body:[{kind:"richtext",content:[o.p(o.txt("Curated by "),o.link(s,"/u/"+t.owner,{is_user_link:t.owner.toLowerCase()},o.txt("u/"+t.owner))),o.p(o.txt("Created "),o.timeAgo(t.created_utc*1e3))]},{kind:"text",client_id:s.id,content:t.description_html,markdown_format:"reddit_html"}]}},actions_bottom:[{kind:"link",client_id:s.id,text:"Create a copy",url:"TODO"}]},{kind:"widget",title:"Subreddits ("+t.subreddits.length+")",raw_value:t.subreddits,widget_content:{kind:"list",items:t.subreddits.map(i=>({name:{kind:"text",text:"r/"+i.name},click:{kind:"link",client_id:s.id,url:"/r/"+i.name}}))}}]}function Ke(e){const t=e.banner_background_image||e.banner_img||"",i=e.primary_color||"",n=e.community_icon||e.icon_img||"";return{banner:t?{kind:"image",desktop:t}:i?{kind:"color",color:i}:null,icon:n?{url:n}:null}}function jt(e,t,i){const n=[];return e?.data?n.push({kind:"bio",...Ke(e.data.subreddit),name:{display:e.data.name,link_name:"u/"+e.data.name},menu:null,raw_value:e,body:{kind:"text",client_id:s.id,content:e.data.subreddit.public_description_html,markdown_format:"reddit_html"},subscribe:{kind:"counter",client_id:s.id,increment:{icon:"join",color:"white",label:"Follow",undo_label:"Unfollow"},decrement:null,unique_id:"/follow/"+e.data.name+"/",time:Date.now(),style:"pill-filled",incremented_style:"pill-empty",count_excl_you:e.data.is_friend?e.data.subreddit.subscribers-1:e.data.subreddit.subscribers,you:e.data.is_friend?"increment":void 0,actions:{error:"TODO implement add friend"}}},{kind:"widget",title:"About",widget_content:{kind:"body",body:{kind:"richtext",content:[o.h1(o.link(s,"/u/"+e.data.name,{is_user_link:e.data.name},o.txt(e.data.name))),o.p(o.txt(e.data.link_karma+" post karma")),o.p(o.txt(e.data.comment_karma+" comment karma")),o.p(o.txt("Account created "),o.timeAgo(e.data.created_utc*1e3))]}},raw_value:e}):n.push({kind:"widget",title:"TODO",widget_content:{kind:"body",body:{kind:"richtext",content:[o.p(o.txt("Failed to fetch user info for this user :("))]}},raw_value:e}),i?.data?n.push({kind:"widget",title:"Moderates",raw_value:i,widget_content:{kind:"list",items:i.data.map(r=>({icon:r.community_icon||r.icon_img||"undefined",name:{kind:"text",text:r.sr_display_name_prefixed},click:{kind:"link",url:r.url}}))}}):i||n.push({kind:"widget",title:"TODO",widget_content:{kind:"body",body:{kind:"richtext",content:[o.p(o.txt("Failed to fetch modded subs for this user :("))]}},raw_value:i}),t?.data?n.push({kind:"widget",title:"Trophy Case",widget_content:{kind:"body",body:{kind:"richtext",content:[...t.data.trophies.map(({data:r})=>{const d=[...r.url!=null?[o.p(o.link(s,r.url,{},o.txt(r.url)))]:[],...r.description!=null?[o.p(o.txt(r.description))]:[]];return{kind:"body",body:{kind:"crosspost",client_id:s.id,source:{kind:"thread",title:{text:r.name},body:d.length?{kind:"richtext",content:d}:{kind:"none"},thumbnail:{kind:"image",url:r.icon_70},display_mode:{body:"collapsed",comments:"collapsed",body_default:"closed"},raw_value:r,link:r.icon_70,layout:"reddit-post",info:{time:r.granted_at!=null?r.granted_at*1e3:!1,edited:!1,pinned:!0},actions:[],default_collapsed:!1}}}})]}},raw_value:e}):n.push({kind:"widget",title:"TODO",widget_content:{kind:"body",body:{kind:"richtext",content:[o.p(o.txt("Failed to fetch trophy case for this user :("))]}},raw_value:t}),n}function re(e){let t=f.parse(e);for(let i=0;t.kind==="redirect"&&i<100;i++)e=t.to,t=f.parse(e);return[t,e]}function Ct(e){return e}const s={id:"reddit",getPage:Ae,loader:dt,async getThread(e){try{const[t,i]=re(e);if(console.log("PARSED URL:",t),t.kind==="comments"){const[n,r]=await Promise.all([_(`/comments/${t.post_id_unprefixed}`,{method:"GET",query:{sort:t.sort_override,comment:t.focus_comment,context:t.context}}),Q(t.sub)]);return E(i,t,n,{...r})}else if(t.kind==="duplicates"){const[n,r]=await Promise.all([_(`/duplicates/${t.post_id_unprefixed}`,{method:"GET",query:{after:t.after,before:t.before,sort:t.sort,crossposts_only:""+t.crossposts_only}}),Q(t.sub)]);return E(i,t,n,{...r})}else if(t.kind==="subreddit"){const n="/"+[...t.sub.base,t.current_sort.v].join("/"),[r,d]=await Promise.all([_(n,{method:"GET",query:{t:t.current_sort.t,before:t.before,after:t.after}}),Q(t.sub)]);return E(i,t,r,{...d})}else if(t.kind==="wiki"){const n="/"+[...t.sub.base,"wiki",...t.path].join("/")+"?"+w(t.query),[r,d]=await Promise.all([_(n,{method:"GET"}),Q(t.sub)]);return E(i,t,r,{...d})}else if(t.kind==="user"){const n=i,[r,d,l,u]=await Promise.all([_(n,{method:"GET"}),_(`/user/${t.username}/about`,{method:"GET",onerror:a=>{},cache:!0}),_(`/api/v1/user/${t.username}/trophies`,{method:"GET",onerror:a=>{},cache:!0}),_(`/user/${t.username}/moderated_subreddits`,{method:"GET",onerror:a=>{},cache:!0})]);return E(i,t,r,{sidebar:jt(d,l,u)})}else if(t.kind==="inbox"){if(t.current.tab!=="compose"){if(t.current.tab!=="mod"){if(t.current.tab!=="message")if(t.current.tab==="inbox"){const n="/message/"+t.current.inbox_tab,r=await _(n,{method:"GET"});return E(i,t,r,{sidebar:null})}else t.current.tab==="sent"||R(t.current)}}}else{if(t.kind==="link_out")return{title:"LinkOut",navbar:j(),body:{kind:"one",item:{parents:[{kind:"thread",body:{kind:"richtext",content:[o.h1(o.link(s,"raw!"+t.out,{},o.txt("View on reddit.com"))),o.p(o.txt("ThreadClient does not support this URL"))]},display_mode:{comments:"visible",body:"visible"},link:i,raw_value:t,layout:"reddit-post",actions:[],default_collapsed:!1}],replies:[]}},display_style:"comments-view"};if(t.kind==="todo"){const n=await _(t.path,{method:"GET",onerror:r=>({kind:"unsupported",extra:{title:r.message,stack:r.stack,console:r}})});return E(i,t,n,{sidebar:[{kind:"widget",title:"TODO",widget_content:{kind:"body",body:{kind:"richtext",content:[o.p(o.txt("This page "),o.code(i),o.txt(" is not supported (yet)")),o.p(o.link(s,"raw!https://www.reddit.com"+t.path,{},o.txt("View on reddit.com"))),o.p(o.txt(t.msg))]}},raw_value:t}]})}else if(t.kind==="raw"){const n=await _(t.path,{method:"GET"});return J(i,n,{sidebar:[{kind:"widget",title:"Raw",widget_content:{kind:"body",body:{kind:"richtext",content:[o.p(o.txt("This is a raw page.")),o.p(o.link(s,t.path,{},o.txt("View Rendered")))]}},raw_value:t}]})}else{if(t.kind==="redirect")return{title:"LinkOut",navbar:j(),body:{kind:"one",item:{parents:[{kind:"thread",body:{kind:"richtext",content:[o.h1(o.txt("Error! Redirect Loop")),o.p(o.txt("ThreadClient tried to redirect over 100 times.")),o.p(o.txt("Path: "),o.code(i),o.error("Code",t))]},display_mode:{comments:"visible",body:"visible"},link:i,raw_value:t,layout:"reddit-post",actions:[],default_collapsed:!1}],replies:[]}},display_style:"comments-view"};R(t)}}return J(i,t,{sidebar:[{kind:"widget",title:"TODO",widget_content:{kind:"body",body:{kind:"richtext",content:[o.p(o.txt("This page "),o.code(i),o.txt(" is not supported (yet)")),o.p(o.txt(t.kind)),o.p(o.txt("View it on "),o.link(s,"raw!https://reddit.com"+i,{},o.txt("reddit.com")),o.txt("."))]}},raw_value:t}]})}catch(t){const i=t;console.log(i);const n=i.toString().includes("NetworkError");return{title:"Error",navbar:j(),body:{kind:"one",item:{parents:[{kind:"thread",title:{text:"Error"},body:{kind:"text",client_id:s.id,content:`Error ${i.toString()}`+(n?". If you're using Firefox, try disabling 'Enhanced Tracker Protection'  for this site. Enhanced tracker protection indiscriminately blocks all  requests to social media sites, including Reddit.":"."),markdown_format:"none"},display_mode:{body:"visible",comments:"collapsed"},link:e,layout:"error",actions:[],default_collapsed:!1,raw_value:{}}],replies:[]}},display_style:"comments-view"}}},async login(e,t){const i=t.get("code"),n=t.get("state");if(i==null||n==null)throw new Error("No login requested");if(n!==location.host)throw new Error("Login was for "+n);const r=await fetch("https://www.reddit.com/api/v1/access_token",{method:"POST",mode:"cors",credentials:"omit",headers:{Authorization:"Basic "+btoa(ne+":"),"Content-Type":"application/x-www-form-urlencoded"},body:w({grant_type:"authorization_code",code:i,redirect_uri:Te})}).then(l=>l.json());if(r.error)throw console.log(r.error),new Error("error "+r.error);const d={access_token:r.access_token,refresh_token:r.refresh_token,expires:Date.now()+r.expires_in*1e3,scope:r.scope};console.log(r,d),localStorage.setItem("reddit-secret",JSON.stringify(d))},async fetchRemoved(e){const t=Pe.decode(e),[i,n]=await fetch(t.path).then(async l=>[l.status,await l.text()]),r=JSON.parse(n.split("&lt;").join("<").split("&gt;").join(">").split("&amp;").join("&"));if(i!==200)throw console.log(i,r),new Error("Got status "+i);if(r.data.length===0)throw console.log(i,r),new Error("Post was deleted before it could be saved:.");const d=r.data[0];if(d.selftext==="[deleted]"||d.selftext==="[removed]"||d.body==="[deleted]"||d.body==="[removed]")throw new Error("Post was deleted before it could be saved.");if(d.selftext)return{kind:"text",client_id:s.id,content:d.selftext,markdown_format:"reddit"};if(d.body)return{kind:"text",client_id:s.id,content:d.body,markdown_format:"reddit"};throw console.log("got item",d),new Error("no selftext or body")},async act(e){const t=S.decode(e);if(t.kind==="vote"){const i=await _("/api/vote",{method:"POST",mode:"urlencoded",body:t.query});console.log(i)}else if(t.kind==="delete"){const i=await _("/api/del",{method:"POST",mode:"urlencoded",body:{id:t.fullname}});console.log(i)}else if(t.kind==="save"){const i=await _(`/api/${t.direction}save`,{method:"POST",mode:"urlencoded",body:{id:t.fullname}});console.log(i)}else if(t.kind==="subscribe"){const i=await _("/api/subscribe",{method:"POST",mode:"urlencoded",body:{action:t.direction,sr_name:t.subreddit}});console.log(i)}else if(t.kind==="mark_read"){const i=await _(`/api/${t.direction}read_message`,{method:"POST",mode:"urlencoded",body:{id:t.fullname},override:!0});console.log(i)}else t.kind==="log_out"?localStorage.removeItem("reddit-secret"):Ze(t)},previewReply(e,t){fe.decode(t);const i={kind:"thread",body:{kind:"text",client_id:s.id,content:e,markdown_format:"reddit"},display_mode:{body:"visible",comments:"visible"},raw_value:[e,t],link:"no link",layout:"reddit-comment",info:{time:!1,edited:!1,author:{name:"TODO You",color_hash:"TODO You",link:"/u/TODO You",client_id:s.id},pinned:!1},actions:[{kind:"counter",client_id:s.id,increment:{icon:"up_arrow",color:"reddit-upvote",label:"Upvote",undo_label:"Undo Upvote"},decrement:{icon:"down_arrow",color:"reddit-downvote",label:"Downvote",undo_label:"Undo Downvote"},special:"reddit-points",unique_id:null,time:0,count_excl_you:0,you:"increment",percent:1,actions:{error:"reply not posted"}}],default_collapsed:!1};return{kind:"legacy",client_id:s.id,thread:i}},async sendReply(e,t,i){const n=fe.decode(t),r=[];for(let c=0;c<=7;c++){if(c===4||c===7)continue;const m="Testing 1<<"+c;r.push({e:"par",c:[{e:"text",t:m,f:[[1<<c,0,7],[64,8,m.length]]}]})}const d={document:r},l={api_type:"json",thing_id:n.parent_id,return_rtjson:"true",...e==="richtext_demo"?{richtext_json:JSON.stringify(d)}:{text:e}},u={reply:"/api/comment",edit:"/api/editusertext"}[i],a=await _(u,{method:"POST",mode:"urlencoded",body:l});return console.log(a),q({kind:"t1",data:a},{},{permalink:"TODO",sort:"unsupported",is_chat:!1})},async fetchReportScreen(e){const t=We.decode(e),[i,n]=await Promise.all([await _(`/r/${t.subreddit}/about/rules`,{method:"GET",cache:!0}),await _(`/r/${t.subreddit}/about`,{method:"GET",cache:!0})]),r=t.fullname.startsWith("t1_")?"comment":t.fullname.startsWith("t3_")?"link":"unsupported",d=[],l=[];for(const u of i.rules){if(u.kind==="link"){if(r!=="link")continue}else if(u.kind==="comment"){if(r!=="comment")continue}else u.kind==="all"||O(u.kind);l.push({title:u.violation_reason,description:{kind:"text",client_id:s.id,content:u.description_html??"",markdown_format:"reddit_html"},report:{kind:"submit",data:z.encode({fullname:t.fullname,subreddit:t.subreddit,reason:{kind:"sub",id:u.short_name}})}})}n.data.free_form_reports&&l.push({title:"Custom Reason",report:{kind:"textarea",input_title:"Custom Reason",char_limit:100,data:z.encode({fullname:t.fullname,subreddit:t.subreddit,reason:{kind:"sub_other"},text_max:100})}}),d.push({title:"r/"+t.subreddit+"'s rules",report:{kind:"more",screens:l}});for(const u of i.site_rules_flow)d.push(Qe(t,u));return d},async sendReport(e,t){const i=z.decode(e);if(console.log(i,t),i.text_max==null){if(t!=null)throw new Error("never. got text in non-textual entry?")}else{if(t==null)throw new Error("never. missing text");if(t.length>i.text_max)throw new Error("report text too long (max "+i.text_max+")")}if(i.reason.kind==="sub_other"&&t==null)throw new Error("never. missing text on sub_other");const n=await _("/api/report",{method:"POST",mode:"urlencoded",body:{sr_name:i.subreddit,thing_id:i.fullname,...i.reason.kind==="sub"?{rule_reason:i.reason.id}:i.reason.kind==="site"?{site_reason:i.reason.id,custom_text:t??void 0}:i.reason.kind==="sub_other"?{reason:t}:R(i.reason)}});if(console.log("GOT Response:",n),n.success!==!0)throw console.log(n),new Error("Got error response, check console");return{title:i.reason.kind==="sub_other"?"Report Sent!":i.reason.id,body:t!=null?{kind:"text",client_id:s.id,content:t,markdown_format:"none"}:{kind:"none"}}},async loadMore(e){const t=D.decode(e);if(t.kind==="api_loadmore"){const i=[...t.children],n=i.splice(0,100),r=await _("/api/morechildren",{method:"GET",query:{api_type:"json",limit_children:"false",children:n.join(","),link_id:t.link_fullname,sort:t.parent_permalink.sort}}),d=[],l=new Map;for(const a of r.json.data.things){l.set(a.data.name,a);const c=l.get(a.data.parent_id);if(c){if(c.kind!=="t1")throw new Error("expected t1 here");c.data.replies||={kind:"Listing",data:{before:null,children:[],after:null}},c.data.replies.data.children.push(a)}else d.push(a)}const u=d.map(a=>q(a,{link_fullname:t.link_fullname},t.parent_permalink));if(i.length>0){const a=u[u.length-1];if(a&&a.kind==="load_more"){const c=D.decode(a.load_more);if(c.kind==="api_loadmore")c.children=[...i,...c.children],a.load_more=D.encode(c);else throw new Error("bad (this is not good)")}else u.push({kind:"load_more",load_more:D.encode({kind:"api_loadmore",link_fullname:t.link_fullname,children:i,parent_permalink:t.parent_permalink}),url:t.parent_permalink.permalink,raw_value:i})}return u}else if(t.kind==="parent_permalink"){const i=await _(t.permalink,{method:"GET"}),[n,r]=re(t.permalink);if(n.kind!=="comments")throw new Error("bad link to parent_permalink: "+n.kind);const d=E(r,n,i,{sidebar:null});if(d.body.kind==="one")return d.body.item.replies;throw console.log("Error",d),new Error("todo support load more returning other body ("+d.body.kind+")")}else{if(t.kind==="context")throw new Error("TODO load more context");if(t.kind==="duplicates")throw new Error("TODO load more duplicates");R(t)}},async loadMoreUnmounted(e){const t=Be.decode(e);if(t.kind==="listing"){const i=await _(t.url,{method:"GET"}),[n,r]=re(t.url),d=E(r,n,i,{sidebar:null});if(d.body.kind==="listing")return{children:d.body.items,next:d.body.next};throw console.log("Error",d),new Error("todo support load more returning other body ("+d.body.kind+")")}else{if(t.kind==="TODO more")throw new Error("TODO more");R(t)}},async hydrateInbox(e){const t=ge.decode(e);if(t.kind==="inbox"){const n=(await _("/api/me",{method:"GET"})).data.inbox_count;return{messages:n===0?{kind:"zero"}:{kind:"exact",value:n},url:n===0?"/message/inbox":"/message/unread"}}else if(t.kind==="modmail"){const i=await _("/api/mod/conversations/unread/count",{method:"GET"});return{messages:i.notifications>0?{kind:"exact",value:i.notifications}:{kind:"zero"},url:"/mod/mail/all"}}else R(t)}};function R(e){throw console.log("not never:",e),new Error("Expected never")}function Qe(e,t){let i;if("nextStepReasons"in t)i={kind:"more",screens:t.nextStepReasons.map(n=>Qe(e,n))};else if("fileComplaint"in t&&t.fileComplaint===!0){const n=t.complaintUrl.replace("%25%28thing%29",encodeURIComponent(e.fullname));i={kind:"more",screens:[{title:t.complaintPageTitle,description:{kind:"text",client_id:s.id,content:t.complaintPrompt,markdown_format:"none"},report:{kind:"link",url:"raw!"+n,text:t.complaintButtonText}}]}}else if("canWriteNotes"in t&&t.canWriteNotes===!0){const n=t.isAbuseOfReportButton??!1?250:2e3;i={kind:"textarea",input_title:t.notesInputTitle,char_limit:n,data:z.encode({fullname:e.fullname,subreddit:e.subreddit,text_max:n,reason:{kind:"site",id:t.reasonText}})}}else"canSpecifyUsernames"in t&&t.canSpecifyUsernames===!0?i={kind:"link",url:"raw!https://reddit.com/report",text:"Open Reddit"}:i={kind:"submit",data:z.encode({fullname:e.fullname,subreddit:e.subreddit,reason:{kind:"site",id:t.reasonText}})};return{title:t.reasonTextToShow,report:i}}const z=I("send_report"),Ue=new Map;async function _(e,t){try{const i=await bt(),n=kt(!!i,g(e,t.query??{}),{override:t.override}),r={method:t.method,mode:"cors",credentials:"omit",headers:{...i?{Authorization:i}:{},...t.method==="POST"?{"Content-Type":{json:"application/json",urlencoded:"application/x-www-form-urlencoded"}[t.mode]}:{}},...t.method==="POST"?{body:t.mode==="json"?JSON.stringify(t.body):t.mode==="urlencoded"?Object.entries(t.body).flatMap(([m,k])=>k==null?[]:[encodeURIComponent(m)+"="+encodeURIComponent(k)]).join("&"):Ze(t)}:{}},d=JSON.stringify([n,r]),l=Ue.get(d);if(l!=null&&(t.cache??!1))return l;const[u,a]=await fetch(n,r).then(async m=>[m.status,await m.json()]);if(u!==200){if(t.onstatus)return t.onstatus(u,a);throw console.log(u,a),new Error("got status "+u)}const c=a;if(typeof c=="object"){if("json"in c&&typeof c.json=="object"&&"errors"in c.json&&c.json.errors.length>0)throw new Error(c.json.errors.map(([m,k])=>m+": "+k).join(", "));if("jquery"in c&&Array.isArray(c.jquery)&&"success"in c&&c.success===!1)throw new Error(c.jquery.flatMap(m=>m[2]==="call"?m[3].map(k=>typeof k=="string"?k:""):[]).join(", "))}return(t.cache??!1)&&Ue.set(d,a),a}catch(i){if(console.log("Got error",i),t.onerror)return t.onerror(i);throw i}}const fe=I("reply");function Ze(e){throw console.log(e),new Error("not unreachable")}export{$e as authorFromInfo,ke as authorFromPostOrComment,St as authorFromT2,Oe as awardingsToFlair,s as client,le as deleteButton,Ct as ec,me as editButton,O as expectUnsupported,ve as getCodeButton,Je as getCommentBody,K as getPointsOn,ze as getPostBody,Ye as getPostFlair,Ve as getPostThumbnail,E as pageFromListing,re as parseLink,_ as redditRequest,ue as replyButton,ce as reportButton,pe as saveButton,He as sortWrap,g as updateQuery,te as urlNotSupportedYet};
