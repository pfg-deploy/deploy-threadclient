import{i as d,j as y,x as z,D as he,Q as we,U as pe,t as w,f as C,V as xe,W as Ee,X as ke,Y as N,n as x,K as L,Z as T,$ as ae,l as oe,G as B,E as de,z as Se,a0 as Le,a1 as Te,a2 as ve,a3 as Pe,y as Ce,p as se,_ as fe}from"./index.a7e88646.js";const Ne=w('<video class="object-contain w-full h-full"><span></span></video>'),Re=w('<div class="handles-clicks relative"><div class="w-full h-full relative overflow-hidden"><button><span class="items-center justify-center flex"><div></div></span></button><div><div class="h-1 w-full relative bg-rgray-100 bg-opacity-50"><div class="absolute h-full bg-rgray-700"></div></div></div><div><div><div class="absolute h-full bg-rgray-700"></div></div><div class="flex flex-wrap items-center transform transition-transform origin-bottom"><button class="block"></button><div></div><div class="flex-grow"></div><button class="block"></button><button class="block"></button><button class="block"></button></div></div></div><div class="flex"></div><div class="flex">Quality: </div><div class="absolute pointer-events-none transition-opacity"><div></div></div></div>'),Ve=w("<div><p>Error! </p></div>"),ue=w('<div class="absolute h-full bg-rgray-500 bg-opacity-75"></div>'),De=w('<div class="absolute h-full bg-rgray-900 bg-opacity-50"></div>'),qe=w("<button>\xD7</button>"),Ae=w("<button></button>"),ze=w("<video></video>"),Oe=w("<source>"),Fe=w("<div></div>"),Ie=w("<div>Caption: </div>");function P(i){const n=i/60/60|0,s=(i/60|0)%60,v=(i|0)%60;return(n?n.toString().padStart(2,"0")+":":"")+s.toString().padStart(n?2:1,"0")+":"+v.toString().padStart(2,"0")}let ce=!1;async function Me(i){if(window.muxjs||(window.muxjs=(await fe(()=>import("./index.8f0c9c01.js").then(function(n){return n.i}),["assets/index.8f0c9c01.js","assets/_commonjsHelpers.2cf1d77b.js"])).default),!ce){if(i.polyfill.installAll(),!i.Player.isBrowserSupported())throw new Error("Shaka player is not supported");ce=!0}}function We(i){let n,s;const v=async()=>{if(s)return s;const{default:o}=await fe(()=>import("./shaka-player.compiled.0fb9461d.js").then(function(l){return l.s}),["assets/shaka-player.compiled.0fb9461d.js","assets/_commonjsHelpers.2cf1d77b.js"]);return await Me(o),s=new o.Player,console.log(s.getConfiguration()),s.addEventListener("error",l=>{console.log("Error!",l),i.setState("error_overlay","An error occured. Check console.")}),s};Le(()=>{i.videoRef({play:()=>void n.play(),pause:()=>n.pause(),setPlaybackRate:l=>{n.playbackRate=l,t()},seek:l=>{s&&s.isLive()?n.currentTime=l+s.seekRange().start:n.currentTime=l,t()},reload:()=>{o(n.currentTime)},goToLive(){s&&s.isLive()&&s.goToLive()}}),N(Te([()=>i.source],()=>{o(0)},{defer:!0}));const o=l=>{(async()=>{console.log("Reloading Video",l);let f=new Error("No sources");for(const c of i.sources)try{if(s&&await s.detach(),n.src="",n.onerror=()=>{},n.onload=()=>{},n.onloadedmetadata=()=>{},c.url.endsWith(".m3u8")||c.url.endsWith(".mpd")){const m=await v();i.setState("playing","loading"),await m.attach(n),console.log("trying to load",c.url),await m.load(c.url,l),m.isLive()&&m.goToLive()}else await new Promise((m,E)=>{n.onerror=h=>{console.log(h),f=new Error("error "+h),i.setState("errored_sources",k=>({...k,[c.i]:!0})),E(f)},n.onload=()=>{m()},n.onloadedmetadata=()=>{n.currentTime=l},n.src=c.url,n.load()});return}catch(m){f=m,i.setState("errored_sources",E=>({...E,[c.i]:!0}))}throw f})().then(()=>{console.log("Player loaded")}).catch(f=>{console.log(f),i.setState("error_overlay",f.stack??f.toString())})};o(0),ve(()=>{s&&s.destroy().then(()=>{console.log("player destroyed")}).catch(l=>{console.log("error destroying player",l)})})});const t=()=>{const o=[];for(let l=0;l<n.buffered.length;l++)o.push({start:n.buffered.start(l),end:n.buffered.end(l)});i.setState(Pe(l=>{if(console.log(s?.seekRange()),s&&s.isLive()){const f=s.seekRange();l.current_time=n.currentTime-f.start,l.max_time=f.end-f.start,l.live={start:s.getPresentationStartTimeAsDate().getTime(),current:s.getPlayheadTimeAsDate().getTime()},l.buffered=o.map(c=>({start:c.start-f.start,end:c.end-f.start}))}else l.current_time=n.currentTime,l.max_time=n.duration,l.live=null,l.buffered=o;l.playing=n.paused||n.ended?!1:n.readyState<n.HAVE_FUTURE_DATA?"loading":!0,l.quality=n.videoWidth===0?null:{w:n.videoWidth,h:n.videoHeight},n.playbackRate!==0&&(l.playback_rate=n.playbackRate)})),n.error?i.setState("error_overlay",n.error.message):n.networkState===n.NETWORK_NO_SOURCE?i.setState("error_overlay","Video could not be loaded."):i.setState("error_overlay",null)};return(()=>{const o=Ne.cloneNode(!0),l=o.firstChild;o.addEventListener("emptied",()=>{t()}),o.addEventListener("loadeddata",()=>{t()}),o.addEventListener("durationchange",()=>{t()}),o.addEventListener("loadedmetadata",()=>{t()}),o.addEventListener("stalled",()=>{t()}),o.addEventListener("waiting",()=>{t()}),o.addEventListener("pause",()=>{t()}),o.addEventListener("timeupdate",()=>{t()}),o.addEventListener("canplaythrough",()=>{t()}),o.addEventListener("progress",()=>{t()}),o.addEventListener("volumechange",()=>{t()}),o.addEventListener("ratechange",()=>{t()}),o.addEventListener("playing",()=>{t()}),o.addEventListener("play",()=>{t()});const f=n;return typeof f=="function"?f(o):n=o,o.addEventListener("error",c=>{t()},!0),d(l,()=>i.video.alt??"Your device does not support video, and alt text was not supplied."),x(c=>{const m=!i.custom_controls,E=i.autoplay,h=i.video.gifv,k=i.source.thumbnail;return m!==c._v$&&(o.controls=c._v$=m),E!==c._v$2&&(o.autoplay=c._v$2=E),h!==c._v$3&&(o.loop=c._v$3=h),k!==c._v$4&&de(o,"poster",c._v$4=k),c},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0}),o})()}function je(i){const n=i-Date.now();if(n<=0)return()=>!0;if(n>=Number.MAX_SAFE_INTEGER)return()=>!1;const[s,v]=C(!1),t=setTimeout(()=>{v(!0)},n);return ve(()=>clearTimeout(t)),s}function Be(i){const[n,s]=C(0);let v;const[t,o]=xe({max_time:0,current_time:0,quality:null,buffered:[],playing:"loading",error_overlay:null,errored_sources:{},playback_rate:1,live:null}),[l,f]=C(null),[c,m]=C(0),E=Ce(),h=()=>E.customVideoControls()==="custom"||!!t.live,k=Ee(()=>!(!h()||je(c()+1e3)())),_e=()=>{const p=n(),_=i.source.sources.map((b,F)=>({...b,i:F}));return[..._.filter(b=>b.i>=p),..._.filter(b=>b.i<p).reverse()]},ge=()=>{const p=new Map;for(const[_,b]of i.source.sources.entries())t.errored_sources[_]!==!0&&p.set(b.quality??"Unknown",{index:_});return[...p.entries()].map(([_,b])=>({name:_,...b}))},me=ke();N(()=>{me()||v.pause()});const ye=()=>h()&&(t.playing!==!0||k());let R;const[O,V]=C(!1);return(()=>{const p=Re.cloneNode(!0),_=p.firstChild,b=_.firstChild,F=b.firstChild,U=F.firstChild,I=b.nextSibling,X=I.firstChild,Q=X.firstChild,K=I.nextSibling,S=K.firstChild,G=S.firstChild,$e=S.nextSibling,M=$e.firstChild,D=M.nextSibling,be=D.nextSibling,W=be.nextSibling,j=W.nextSibling,H=j.nextSibling,Y=_.nextSibling,q=Y.nextSibling;q.firstChild;const A=q.nextSibling,Z=A.firstChild,J=R;return typeof J=="function"?J(p):R=p,_.addEventListener("blur",()=>{m(0)}),_.addEventListener("focus",()=>{m(Date.now())}),_.addEventListener("mouseleave",()=>{m(0)}),_.$$mousemove=()=>{m(Date.now())},_.addEventListener("mouseenter",()=>{m(Date.now())}),d(_,y(We,{state:t,setState:o,videoRef:e=>v=e,get video(){return i.video},get source(){return i.source},get sources(){return _e()},get autoplay(){return i.autoplay},get custom_controls(){return h()}}),b),d(_,y(z,{get when(){return t.error_overlay},children:e=>(()=>{const r=Ve.cloneNode(!0),u=r.firstChild;return u.firstChild,d(u,e,null),x(a=>{const g=L("absolute top-0 left-0 bottom-0 right-0 p-4 bg-rgray-900 bg-opacity-75"),$=h()?"block":"none";return g!==a._v$16&&(r.className=a._v$16=g),$!==a._v$17&&r.style.setProperty("display",a._v$17=$),a},{_v$16:void 0,_v$17:void 0}),r})()}),b),b.$$click=()=>{t.playing===!1?(v.play(),m(0)):v.pause()},d(U,y(T,{size:"icon-sm",get icon(){return t.playing===!1?{class:"icon-play-button",label:"Play"}:t.playing===!0?{class:"icon-play-pause",label:"Pause"}:{class:"icon-spinner-alt",label:"Loading"}}})),d(X,y(ae,{get each(){return t.buffered},children:(e,r)=>(()=>{const u=ue.cloneNode(!0);return x(a=>{const g=(e().end-e().start)/t.max_time*100+"%",$=e().start/t.max_time*100+"%";return g!==a._v$18&&u.style.setProperty("width",a._v$18=g),$!==a._v$19&&u.style.setProperty("left",a._v$19=$),a},{_v$18:void 0,_v$19:void 0}),u})()}),Q),S.$$mouseup=e=>{const r=e.currentTarget.getBoundingClientRect(),u=(e.clientX-r.left)/r.width;v.seek(u*t.max_time)},S.addEventListener("mouseleave",()=>{f(null)}),S.$$mousemove=e=>{const r=e.currentTarget.getBoundingClientRect(),u=R.getBoundingClientRect();f({seeking:!1,percent:(e.clientX-r.left)/r.width,preview:[e.clientX-u.left,u.bottom-r.top]})},d(S,y(ae,{get each(){return t.buffered},children:(e,r)=>(()=>{const u=ue.cloneNode(!0);return x(a=>{const g=(e().end-e().start)/t.max_time*100+"%",$=e().start/t.max_time*100+"%";return g!==a._v$20&&u.style.setProperty("width",a._v$20=g),$!==a._v$21&&u.style.setProperty("left",a._v$21=$),a},{_v$20:void 0,_v$21:void 0}),u})()}),G),d(S,y(z,{get when(){return l()},children:e=>(()=>{const r=De.cloneNode(!0);return x(()=>r.style.setProperty("width",e.percent*100+"%")),r})()}),null),M.$$click=()=>{t.playing===!1?v.play():v.pause()},d(M,y(T,{size:"icon-sm",get icon(){return t.playing===!1?{class:"icon-play-button",label:"Play"}:t.playing===!0?{class:"icon-play-pause",label:"Pause"}:{class:"icon-loadbar",label:"Loading"}}})),D.$$click=()=>{t.live&&v.goToLive()},d(D,(()=>{const e=oe(()=>!!t.live,!0);return()=>e()?(()=>{const r=oe(()=>t.current_time+2>t.max_time,!0);return()=>r()?P((Date.now()-t.live.current)/1e3)+" delay":P((t.live.current-t.live.start)/1e3)+" / Live"})():P(t.current_time)+" / "+P(t.max_time)})()),W.$$click=()=>{alert("TODO")},d(W,y(T,{size:"icon-sm",icon:{class:"icon-inpicture",label:"Picture in Picture"}})),j.$$click=()=>{alert("TODO")},d(j,y(T,{size:"icon-sm",icon:{class:"icon-software-download",label:"Download Video"}})),H.$$click=()=>{if(document.fullscreenElement){document.exitFullscreen().then(e=>{V(!1)}).catch(e=>{V(!1)});return}R.requestFullscreen().then(e=>{V(!0)}).catch(e=>{V(!1)})},d(H,y(T,{size:"icon-sm",get icon(){return O()?{class:"icon-shape-square",label:"Exit Fullscreen"}:{class:"icon-square",label:"Enter Fullscreen"}}})),d(Y,y(B,{each:[.25,.5,.75,1,1.25,1.5,1.75,2],children:e=>(()=>{const r=qe.cloneNode(!0),u=r.firstChild;return r.$$click=()=>v.setPlaybackRate(e),d(r,e,u),x(a=>{const g=se["outlined-button"],$=t.playback_rate===e;return g!==a._v$22&&(r.className=a._v$22=g),$!==a._v$23&&(r.disabled=a._v$23=$),a},{_v$22:void 0,_v$23:void 0}),r})()})),d(q,()=>t.quality==null?"Loading":t.quality.w+"\xD7"+t.quality.h,null),d(q,y(B,{get each(){return ge()},children:(e,r)=>(()=>{const u=Ae.cloneNode(!0);return u.$$click=()=>{s(e.index),v.reload()},d(u,()=>e.name),x(a=>{const g=se["outlined-button"],$=n()===r();return g!==a._v$24&&(u.className=a._v$24=g),$!==a._v$25&&(u.disabled=a._v$25=$),a},{_v$24:void 0,_v$25:void 0}),u})()}),null),(e=>{N(()=>{const r=l();r&&(e.style.bottom=r.preview[1]+"px",e.style.left=r.preview[0]+"px",e.style.visibility="visible"),e.style.opacity=r?"1":"0"})})(A),A.addEventListener("transitionend",e=>{e.target===e.currentTarget&&(l()||(e.currentTarget.style.visibility="hidden"))}),d(A,y(z,{get when(){return i.source.preview},children:e=>(()=>{const r=ze.cloneNode(!0);return(u=>{N(()=>{const a=l(),g=u.duration;a&&g&&(u.currentTime=a.percent*g)})})(r),d(r,y(B,{each:e,children:u=>(()=>{const a=Oe.cloneNode(!0);return x(()=>de(a,"src",u.url)),a})()})),r})()}),Z),(e=>{N(()=>{const r=l();r&&(e.textContent=P(r.percent*t.max_time))})})(Z),x(e=>{const r=O()?"":"min(100%, 800px)",u=O()?"":"min(90vh, 500px)",a=t.quality?t.quality.w+" / "+t.quality.h:i.video.aspect!=null?""+i.video.aspect:"16 / 9",g=L("block absolute top-0 left-0 bottom-0 right-0 w-full h-full","transform transition group",h()?"":"hidden",ye()?"cursor-default":"cursor-none"),$=L("block transform transition","bg-rwhite dark:bg-rblack bg-opacity-40 dark:bg-opacity-40 hover:bg-opacity-80","rounded-full","group-focus-visible-outline-default","cursor-pointer",t.playing!==!0?"scale-200 opacity-100":"scale-0 opacity-0"),ee=L("absolute left-0 right-0 bottom-0","flex flex-col","bg-rgray-900 bg-opacity-25","transform transition-transform origin-top",k()?"scale-y-0":"scale-y-100"),te=t.current_time/t.max_time*100+"%",ne=L("absolute left-0 right-0 bottom-0","flex flex-col","bg-rgray-900 bg-opacity-25","transform transition-transform origin-bottom",k()?"scale-y-100":"scale-y-0"),re=L("w-full h-2","relative","bg-rgray-100 bg-opacity-50","transform transition-transform origin-bottom",l()!=null?"scale-y-150":""),ie=t.current_time/t.max_time*100+"%",le=L(t.live?"hover:cursor-pointer":"");return r!==e._v$5&&_.style.setProperty("max-width",e._v$5=r),u!==e._v$6&&_.style.setProperty("max-height",e._v$6=u),a!==e._v$7&&_.style.setProperty("aspect-ratio",e._v$7=a),g!==e._v$8&&(b.className=e._v$8=g),$!==e._v$9&&(U.className=e._v$9=$),ee!==e._v$10&&(I.className=e._v$10=ee),te!==e._v$11&&Q.style.setProperty("width",e._v$11=te),ne!==e._v$12&&(K.className=e._v$12=ne),re!==e._v$13&&(S.className=e._v$13=re),ie!==e._v$14&&G.style.setProperty("width",e._v$14=ie),le!==e._v$15&&(D.className=e._v$15=le),e},{_v$5:void 0,_v$6:void 0,_v$7:void 0,_v$8:void 0,_v$9:void 0,_v$10:void 0,_v$11:void 0,_v$12:void 0,_v$13:void 0,_v$14:void 0,_v$15:void 0}),p})()}function Xe(i){return(()=>{const n=Fe.cloneNode(!0);return d(n,y(z,{get when(){return i.video.caption},children:s=>(()=>{const v=Ie.cloneNode(!0);return v.firstChild,d(v,s,null),v})()}),null),d(n,y(pe,{get item(){return i.video.source},children:{video:s=>y(Be,{get video(){return i.video},source:s,get autoplay(){return i.autoplay}}),img:s=>y(he,{getValue:v=>{const t=el("div");return we(s.url,{alt:i.video.alt}).adto(t),t}})}}),null),n})()}Se(["mousemove","click","mouseup"]);export{Xe as default};
