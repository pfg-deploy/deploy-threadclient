import{e as t}from"./index.b7d67373.js";var v={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,menuitem:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},E=["address","article","aside","blockquote","canvas","dd","div","dl","dt","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","li","main","nav","noscript","ol","output","p","pre","section","table","tfoot","ul","video"],p=v;Object.keys(p).forEach(function(r){p[r.toUpperCase()]=1});var g={};E.forEach(function(r){g[r.toUpperCase()]=1});function b(r){return!!(r&&g[r.nodeName])}function L(r){return r.nodeName==="PRE"}function x(r){return!!(r&&p[r.nodeName])}function C(r,e,i){if(!(!r.firstChild||r.nodeName==="PRE")){typeof e!="function"&&(e=b),typeof i!="function"&&(i=L);for(var a=null,s=!1,o=null,n=N(o,r,i);n!==r;){if(n.nodeType===3||n.nodeType===4){var l=n.data.replace(/[ \r\n\t]+/g," ");if((!a||/ $/.test(a.data))&&!s&&l[0]===" "&&(l=l.substr(1)),!l){n=m(n);continue}n.data=l,a=n}else if(n.nodeType===1)e(n)||n.nodeName==="BR"?(a&&(a.data=a.data.replace(/ $/,"")),a=null,s=!1):x(n)&&(a=null,s=!0);else{n=m(n);continue}var u=N(o,n,i);o=n,n=u}a&&(a.data=a.data.replace(/ $/,""),a.data||m(a))}}function m(r){var e=r.nextSibling||r.parentNode;return r.parentNode.removeChild(r),e}function N(r,e,i){return r&&r.parentNode===e||i(e)?e.nextSibling||e.parentNode:e.firstChild||e.nextSibling||e.parentNode}var A=C;function h(r,e){const i=[];function a(){s.length>0&&i.push(t.p(...s)),s=[]}let s=[];for(const o of Array.from(e)){if(o instanceof Text&&!(o.nodeValue??"").trim()){s.length>0&&s.push(...d(r,o,{}));continue}const n=H(r,o);n?(a(),i.push(...n)):s.push(...d(r,o,{}))}return a(),i}function T(r,e){return Array.from(e).flatMap(i=>i instanceof Text?(i.nodeValue??"").trim()?[t.ili(t.error("Text content: "+i.nodeValue,i))]:[]:i instanceof Comment?[]:i instanceof HTMLElement?i.nodeName==="LI"?[t.li(...h(r,i.childNodes))]:[t.ili(t.error("Unsupported List Item <"+i.nodeName+">",i))]:[t.ili(t.error("Unsupported List Item Node",i))])}function H(r,e){if(!(e instanceof Text)&&!(e instanceof Comment)&&e instanceof HTMLElement){let i=Array.from(e.classList).filter(o=>!0);const a=o=>i.includes(o)?(i=i.filter(n=>n!==o),!0):!1,s=(...o)=>i.length!==0?[t.blockquote(t.p(t.error(i.map(n=>"."+n).join(""),e.outerHTML)),...o)]:o;if(e.nodeName==="P")return s(t.p(...f(r,e.childNodes,{})));if(e.nodeName==="H1")return s(t.hn(1,...f(r,e.childNodes,{})));if(e.nodeName==="H2")return s(t.hn(2,...f(r,e.childNodes,{})));if(e.nodeName==="H3")return s(t.hn(3,...f(r,e.childNodes,{})));if(e.nodeName==="H4")return s(t.hn(4,...f(r,e.childNodes,{})));if(e.nodeName==="H5")return s(t.hn(5,...f(r,e.childNodes,{})));if(e.nodeName==="H6")return s(t.hn(6,...f(r,e.childNodes,{})));if(e.nodeName==="HR")return s(t.hr());if(e.nodeName==="UL")return s(t.ul(...T(r,e.childNodes)));if(e.nodeName==="OL")return s(t.ol(...T(r,e.childNodes)));if(e.nodeName==="BLOCKQUOTE")return a("md-spoiler-text"),s(t.blockquote(...h(r,e.childNodes)));if(e.nodeName==="TABLE"){const o=e.children[0],n=e.children[1];if(!o||!n||o.nodeName!=="THEAD"||n.nodeName!=="TBODY")return[t.p(t.error("Table missing head/body",e))];if(o.children.length!==1)return[t.p(t.error("Table head has 0/2+ rows",e))];const l=o.children[0];return l.nodeName!=="TR"?[t.p(t.error("Table head does not contain a row",e))]:s(t.table(Array.from(l.children).map(u=>u.nodeName!=="TH"?t.th(void 0,t.error("Not th",u)):t.th({left:"left",center:"center",right:"right",none:void 0}[u.getAttribute("align")??"none"],...f(r,u.childNodes,{}))),...Array.from(n.children).map(u=>u.nodeName!=="TR"?[t.td(t.error("Not tr",u))]:Array.from(u.children).map(c=>c.nodeName!=="TD"?t.td(t.error("Not td",c)):t.td(...f(r,c.childNodes,{}))))))}else if(e.nodeName==="PRE"){const o=Array.from(e.children);if(o.length!==1||o[0].nodeName!=="CODE")return[t.p(t.error("Unsupported bad pre/code",e))];const n=o[0],l=Array.from(n.classList);let u;const c="md-code-language-";return l[0]!=null&&l[0].startsWith(c)&&(u=l[0].substr(c.length)),s({kind:"code_block",lang:u,text:n.textContent??"ENOTEXT"})}else if(e.nodeName==="DIV")return h(r,e.childNodes);return}}function f(r,e,i){return Array.from(e).flatMap(a=>d(r,a,i))}function d(r,e,i){if(e instanceof Text){let a=e.nodeValue??"[ENoNodeValue]";return a=a.replace(/^\s+/," "),a=a.replace(/\s+$/," "),[t.txt(a,i)]}if(e instanceof Comment)return[];if(e instanceof HTMLElement){let a=Array.from(e.classList).filter(n=>!0);const s=n=>a.includes(n)?(a=a.filter(l=>l!==n),!0):!1,o=(...n)=>a.length!==0?[t.error(a.map(l=>"."+l).join(""),e.outerHTML)]:n;if(e.nodeName==="A"){let n=e.getAttribute("href")??"no href";return n.startsWith("/")&&(n="https://www.reddit.com"+n),o(t.link({id:r.client_id},n,{},...Array.from(e.childNodes).flatMap(l=>d(r,l,i))))}else{if(e.nodeName==="BR")return o(t.br());if(e.nodeName==="SUP")return o(...f(r,e.childNodes,{...i,superscript:!0}));if(e.nodeName==="STRONG"||e.nodeName==="B")return o(...f(r,e.childNodes,{...i,strong:!0}));if(e.nodeName==="EM"||e.nodeName==="I")return o(...f(r,e.childNodes,{...i,emphasis:!0}));if(e.nodeName==="DEL")return o(...f(r,e.childNodes,{...i,strikethrough:!0}));if(e.nodeName==="CODE")return o(t.code(e.textContent??"ERRNOCODE"));if(e.nodeName==="SPAN"){const n=Array.from(e.childNodes).flatMap(l=>d(r,l,i));return s("md-spoiler-text")?o(t.spoiler(...n)):o(...n)}}return[t.error("<"+e.nodeName+">",{node:e,html:e.outerHTML})]}return[t.error("Unsupported Node",e)]}function R(r,e){const i=document.createElement("div");return i.innerHTML=r,A(i),[{client_id:e},i.childNodes]}function M(r,e){return h(...R(r,e))}export{M as parseContentHTML};
