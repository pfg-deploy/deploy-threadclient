import{d as e,q as t,z as r,t as o,w as n,x as i,I as a,n as l,l as s,_ as c}from"./index.420ef9b7.js";import{i as d,e as u,t as v,a as p,q as g,c as y,g as m,b as _,I as f,p as b,F as h,s as $,f as w,A as x,o as k,k as E,B as L}from"./vendor.f1632930.js";const S=v('<video class="object-contain w-full h-full"><span></span></video>'),T=v('<div class="handles-clicks relative"><div class="w-full h-full relative overflow-hidden"><button><span class="items-center justify-center flex"><div></div></span></button><div><div class="h-1 w-full relative bg-rgray-100 bg-opacity-50"><div class="absolute h-full bg-rgray-700"></div></div></div><div><div><div class="absolute h-full bg-rgray-700"></div></div><div class="flex flex-wrap items-center transform transition-transform origin-bottom"><button class="block"></button><div></div><div class="flex-grow"></div><button class="block"></button><button class="block"></button><button class="block"></button></div></div></div><div class="flex"></div><div class="flex">Quality: </div><div class="absolute pointer-events-none transition-opacity"><div></div></div></div>'),P=v("<div><p>Error! </p></div>"),N=v('<div class="absolute h-full bg-rgray-500 bg-opacity-75"></div>'),C=v('<div class="absolute h-full bg-rgray-900 bg-opacity-50"></div>'),R=v("<button>×</button>"),q=v("<button></button>"),D=v("<video></video>"),A=v("<source>"),O=v("<div></div>"),j=v("<div>Caption: </div>");function F(e){const t=e/60/60|0,r=(e/60|0)%60,o=(0|e)%60;return(t?t.toString().padStart(2,"0")+":":"")+r.toString().padStart(t?2:1,"0")+":"+o.toString().padStart(2,"0")}let V=!1;function z(e){let t,r;const o=async()=>{if(r)return r;const{default:t}=await c((()=>import("./shaka-player.compiled.2054d721.js").then((function(e){return e.s}))),["assets/shaka-player.compiled.2054d721.js","assets/_commonjsHelpers.4e997714.js"]);return await async function(e){if(window.muxjs||(window.muxjs=(await c((()=>import("./index.99d04dc3.js").then((function(e){return e.i}))),[])).default),!V){if(e.polyfill.installAll(),!e.Player.isBrowserSupported())throw new Error("Shaka player is not supported");V=!0}}(t),r=new t.Player,console.log(r.getConfiguration()),r.addEventListener("error",(t=>{console.log("Error!",t),e.setState("error_overlay","An error occured. Check console.")})),r};x((()=>{e.videoRef({play:()=>{t.play()},pause:()=>t.pause(),setPlaybackRate:e=>{t.playbackRate=e,n()},seek:e=>{r&&r.isLive()?t.currentTime=e+r.seekRange().start:t.currentTime=e,n()},reload:()=>{i(t.currentTime)},goToLive(){r&&r.isLive()&&r.goToLive()}}),m(E([()=>e.source],(()=>{i(0)}),{defer:!0}));const i=n=>{(async()=>{console.log("Reloading Video",n);let i=new Error("No sources");for(const l of e.sources)try{if(r&&await r.detach(),t.src="",t.onerror=()=>{},t.onload=()=>{},t.onloadedmetadata=()=>{},l.url.endsWith(".m3u8")||l.url.endsWith(".mpd")){const r=await o();e.setState("playing","loading"),await r.attach(t),console.log("trying to load",l.url),await r.load(l.url,n),r.isLive()&&r.goToLive()}else await new Promise(((r,o)=>{t.onerror=t=>{console.log(t),i=new Error("error "+t),e.setState("errored_sources",(e=>({...e,[l.i]:!0}))),o(i)},t.onload=()=>{r()},t.onloadedmetadata=()=>{t.currentTime=n},t.src=l.url,t.load()}));return}catch(a){i=a,e.setState("errored_sources",(e=>({...e,[l.i]:!0})))}throw i})().then((()=>{console.log("Player loaded")})).catch((t=>{var r;console.log(t),e.setState("error_overlay",null!=(r=t.stack)?r:t.toString())}))};i(0),k((()=>{r&&r.destroy().then((()=>{console.log("player destroyed")})).catch((e=>{console.log("error destroying player",e)}))}))}));const n=()=>{const o=[];for(let e=0;e<t.buffered.length;e++)o.push({start:t.buffered.start(e),end:t.buffered.end(e)});e.setState(L((e=>{if(console.log(null==r?void 0:r.seekRange()),r&&r.isLive()){const n=r.seekRange();e.current_time=t.currentTime-n.start,e.max_time=n.end-n.start,e.live={start:r.getPresentationStartTimeAsDate().getTime(),current:r.getPlayheadTimeAsDate().getTime()},e.buffered=o.map((e=>({start:e.start-n.start,end:e.end-n.start})))}else e.current_time=t.currentTime,e.max_time=t.duration,e.live=null,e.buffered=o;e.playing=!t.paused&&!t.ended&&(!(t.readyState<t.HAVE_FUTURE_DATA)||"loading"),e.quality=0===t.videoWidth?null:{w:t.videoWidth,h:t.videoHeight},0!==t.playbackRate&&(e.playback_rate=t.playbackRate)}))),t.error?e.setState("error_overlay",t.error.message):t.networkState===t.NETWORK_NO_SOURCE?e.setState("error_overlay","Video could not be loaded."):e.setState("error_overlay",null)};return(()=>{const r=S.cloneNode(!0),o=r.firstChild;r.addEventListener("emptied",(()=>{n()})),r.addEventListener("loadeddata",(()=>{n()})),r.addEventListener("durationchange",(()=>{n()})),r.addEventListener("loadedmetadata",(()=>{n()})),r.addEventListener("stalled",(()=>{n()})),r.addEventListener("waiting",(()=>{n()})),r.addEventListener("pause",(()=>{n()})),r.addEventListener("timeupdate",(()=>{n()})),r.addEventListener("canplaythrough",(()=>{n()})),r.addEventListener("progress",(()=>{n()})),r.addEventListener("volumechange",(()=>{n()})),r.addEventListener("ratechange",(()=>{n()})),r.addEventListener("playing",(()=>{n()})),r.addEventListener("play",(()=>{n()}));return"function"==typeof t?t(r):t=r,r.addEventListener("error",(e=>{n()}),!0),d(o,(()=>{var t;return null!=(t=e.video.alt)?t:"Your device does not support video, and alt text was not supplied."})),_((t=>{const o=!e.custom_controls,n=e.autoplay,i=e.video.gifv,a=e.source.thumbnail;return o!==t._v$&&(r.controls=t._v$=o),n!==t._v$2&&(r.autoplay=t._v$2=n),i!==t._v$3&&(r.loop=t._v$3=i),a!==t._v$4&&$(r,"poster",t._v$4=a),t}),{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0}),r})()}function B(t){const[r,o]=p(0);let c;const[v,w]=g({max_time:0,current_time:0,quality:null,buffered:[],playing:"loading",error_overlay:null,errored_sources:{},playback_rate:1,live:null}),[x,E]=p(null),[L,S]=p(0),O=l(),j=()=>"custom"===O.custom_video_controls.value()||!!v.live,V=y((()=>!!j()&&!function(e){const t=e-Date.now();if(t<=0)return()=>!0;if(t>=Number.MAX_SAFE_INTEGER)return()=>!1;const[r,o]=p(!1),n=setTimeout((()=>{o(!0)}),t);return k((()=>clearTimeout(n))),r}(L()+1e3)())),B=n();m((()=>{B()||c.pause()}));let I;const[W,U]=p(!1);return(()=>{const n=T.cloneNode(!0),l=n.firstChild,p=l.firstChild,g=p.firstChild.firstChild,y=p.nextSibling,k=y.firstChild,L=k.firstChild,O=y.nextSibling,B=O.firstChild,X=B.firstChild,H=B.nextSibling.firstChild,M=H.nextSibling,G=M.nextSibling.nextSibling,K=G.nextSibling,Q=K.nextSibling,Y=l.nextSibling,J=Y.nextSibling;J.firstChild;const Z=J.nextSibling,ee=Z.firstChild;var te,re;return"function"==typeof I?I(n):I=n,l.addEventListener("blur",(()=>{S(0)})),l.addEventListener("focus",(()=>{S(Date.now())})),l.addEventListener("mouseleave",(()=>{S(0)})),l.$$mousemove=()=>{S(Date.now())},l.addEventListener("mouseenter",(()=>{S(Date.now())})),d(l,u(z,{state:v,setState:w,videoRef:e=>c=e,get video(){return t.video},get source(){return t.source},get sources(){return(()=>{const e=r(),o=t.source.sources.map(((e,t)=>({...e,i:t})));return[...o.filter((t=>t.i>=e)),...o.filter((t=>t.i<e)).reverse()]})()},get autoplay(){return t.autoplay},get custom_controls(){return j()}}),p),d(l,u(e,{get when(){return v.error_overlay},children:e=>(()=>{const t=P.cloneNode(!0),r=t.firstChild;return r.firstChild,d(r,e,null),_((e=>{const r=i("absolute top-0 left-0 bottom-0 right-0 p-4 bg-rgray-900 bg-opacity-75"),o=j()?"block":"none";return r!==e._v$16&&(t.className=e._v$16=r),o!==e._v$17&&t.style.setProperty("display",e._v$17=o),e}),{_v$16:void 0,_v$17:void 0}),t})()}),p),p.$$click=()=>{!1===v.playing?(c.play(),S(0)):c.pause()},d(g,u(a,{size:"icon-sm",get icon(){return!1===v.playing?{class:"icon-play-button",label:"Play"}:!0===v.playing?{class:"icon-play-pause",label:"Pause"}:{class:"icon-spinner-alt",label:"Loading"}}})),d(k,u(f,{get each(){return v.buffered},children:(e,t)=>(()=>{const t=N.cloneNode(!0);return _((r=>{const o=(e().end-e().start)/v.max_time*100+"%",n=e().start/v.max_time*100+"%";return o!==r._v$18&&t.style.setProperty("width",r._v$18=o),n!==r._v$19&&t.style.setProperty("left",r._v$19=n),r}),{_v$18:void 0,_v$19:void 0}),t})()}),L),B.$$mouseup=e=>{const t=e.currentTarget.getBoundingClientRect(),r=(e.clientX-t.left)/t.width;c.seek(r*v.max_time)},B.addEventListener("mouseleave",(()=>{E(null)})),B.$$mousemove=e=>{const t=e.currentTarget.getBoundingClientRect(),r=I.getBoundingClientRect();E({seeking:!1,percent:(e.clientX-t.left)/t.width,preview:[e.clientX-r.left,r.bottom-t.top]})},d(B,u(f,{get each(){return v.buffered},children:(e,t)=>(()=>{const t=N.cloneNode(!0);return _((r=>{const o=(e().end-e().start)/v.max_time*100+"%",n=e().start/v.max_time*100+"%";return o!==r._v$20&&t.style.setProperty("width",r._v$20=o),n!==r._v$21&&t.style.setProperty("left",r._v$21=n),r}),{_v$20:void 0,_v$21:void 0}),t})()}),X),d(B,u(e,{get when(){return x()},children:e=>(()=>{const t=C.cloneNode(!0);return _((()=>t.style.setProperty("width",100*e.percent+"%"))),t})()}),null),H.$$click=()=>{!1===v.playing?c.play():c.pause()},d(H,u(a,{size:"icon-sm",get icon(){return!1===v.playing?{class:"icon-play-button",label:"Play"}:!0===v.playing?{class:"icon-play-pause",label:"Pause"}:{class:"icon-loadbar",label:"Loading"}}})),M.$$click=()=>{v.live&&c.goToLive()},d(M,(()=>{const e=b((()=>!!v.live),!0);return()=>e()?(()=>{const e=b((()=>v.current_time+2>v.max_time),!0);return()=>e()?F((Date.now()-v.live.current)/1e3)+" delay":F((v.live.current-v.live.start)/1e3)+" / Live"})():F(v.current_time)+" / "+F(v.max_time)})()),G.$$click=()=>{alert("TODO")},d(G,u(a,{size:"icon-sm",icon:{class:"icon-inpicture",label:"Picture in Picture"}})),K.$$click=()=>{alert("TODO")},d(K,u(a,{size:"icon-sm",icon:{class:"icon-software-download",label:"Download Video"}})),Q.$$click=()=>{document.fullscreenElement?document.exitFullscreen().then((e=>{U(!1)})).catch((e=>{U(!1)})):I.requestFullscreen().then((e=>{U(!0)})).catch((e=>{U(!1)}))},d(Q,u(a,{size:"icon-sm",get icon(){return W()?{class:"icon-shape-square",label:"Exit Fullscreen"}:{class:"icon-square",label:"Enter Fullscreen"}}})),d(Y,u(h,{each:[.25,.5,.75,1,1.25,1.5,1.75,2],children:e=>(()=>{const t=R.cloneNode(!0),r=t.firstChild;return t.$$click=()=>c.setPlaybackRate(e),d(t,e,r),_((r=>{const o=s["outlined-button"],n=v.playback_rate===e;return o!==r._v$22&&(t.className=r._v$22=o),n!==r._v$23&&(t.disabled=r._v$23=n),r}),{_v$22:void 0,_v$23:void 0}),t})()})),d(J,(()=>null==v.quality?"Loading":v.quality.w+"×"+v.quality.h),null),d(J,u(h,{get each(){return(()=>{var e;const r=new Map;for(const[o,n]of t.source.sources.entries())!0!==v.errored_sources[o]&&r.set(null!=(e=n.quality)?e:"Unknown",{index:o});return[...r.entries()].map((([e,t])=>({name:e,...t})))})()},children:(e,t)=>(()=>{const n=q.cloneNode(!0);return n.$$click=()=>{o(e.index),c.reload()},d(n,(()=>e.name)),_((e=>{const o=s["outlined-button"],i=r()===t();return o!==e._v$24&&(n.className=e._v$24=o),i!==e._v$25&&(n.disabled=e._v$25=i),e}),{_v$24:void 0,_v$25:void 0}),n})()}),null),te=Z,m((()=>{const e=x();e&&(te.style.bottom=e.preview[1]+"px",te.style.left=e.preview[0]+"px",te.style.visibility="visible"),te.style.opacity=e?"1":"0"})),Z.addEventListener("transitionend",(e=>{x()||(e.currentTarget.style.visibility="hidden")})),d(Z,u(e,{get when(){return t.source.preview},children:e=>(()=>{const t=D.cloneNode(!0);var r;return r=t,m((()=>{const e=x(),t=r.duration;e&&t&&(r.currentTime=e.percent*t)})),d(t,u(h,{each:e,children:e=>(()=>{const t=A.cloneNode(!0);return _((()=>$(t,"src",e.url))),t})()})),t})()}),ee),re=ee,m((()=>{const e=x();e&&(re.textContent=F(e.percent*v.max_time))})),_((e=>{const r=W()?"":"min(100%, 800px)",o=W()?"":"min(90vh, 500px)",n=v.quality?v.quality.w+" / "+v.quality.h:null!=t.video.aspect?""+t.video.aspect:"16 / 9",a=i("block absolute top-0 left-0 bottom-0 right-0 w-full h-full","transform transition group",j()?"":"hidden",j()&&(!0!==v.playing||V())?"cursor-default":"cursor-none"),s=i("block transform transition","bg-rwhite dark:bg-rblack bg-opacity-40 dark:bg-opacity-40 hover:bg-opacity-80","rounded-full","group-focus-visible-outline-default","cursor-pointer",!0!==v.playing?"scale-200 opacity-100":"scale-0 opacity-0"),c=i("absolute left-0 right-0 bottom-0","flex flex-col","bg-rgray-900 bg-opacity-25","transform transition-transform origin-top",V()?"scale-y-0":"scale-y-100"),d=v.current_time/v.max_time*100+"%",u=i("absolute left-0 right-0 bottom-0","flex flex-col","bg-rgray-900 bg-opacity-25","transform transition-transform origin-bottom",V()?"scale-y-100":"scale-y-0"),m=i("w-full h-2","relative","bg-rgray-100 bg-opacity-50","transform transition-transform origin-bottom",null!=x()?"scale-y-150":""),_=v.current_time/v.max_time*100+"%",f=i(v.live?"hover:cursor-pointer":"");return r!==e._v$5&&l.style.setProperty("max-width",e._v$5=r),o!==e._v$6&&l.style.setProperty("max-height",e._v$6=o),n!==e._v$7&&l.style.setProperty("aspect-ratio",e._v$7=n),a!==e._v$8&&(p.className=e._v$8=a),s!==e._v$9&&(g.className=e._v$9=s),c!==e._v$10&&(y.className=e._v$10=c),d!==e._v$11&&L.style.setProperty("width",e._v$11=d),u!==e._v$12&&(O.className=e._v$12=u),m!==e._v$13&&(B.className=e._v$13=m),_!==e._v$14&&X.style.setProperty("width",e._v$14=_),f!==e._v$15&&(M.className=e._v$15=f),e}),{_v$5:void 0,_v$6:void 0,_v$7:void 0,_v$8:void 0,_v$9:void 0,_v$10:void 0,_v$11:void 0,_v$12:void 0,_v$13:void 0,_v$14:void 0,_v$15:void 0}),n})()}function I(n){return(()=>{const i=O.cloneNode(!0);return d(i,u(e,{get when(){return n.video.caption},children:e=>(()=>{const t=j.cloneNode(!0);return t.firstChild,d(t,e,null),t})()}),null),d(i,u(o,{get item(){return n.video.source},children:{video:e=>u(B,{get video(){return n.video},source:e,get autoplay(){return n.autoplay}}),img:e=>u(t,{getValue:t=>{const o=el("div");return r(e.url,{alt:n.video.alt}).adto(o),o}})}}),null),i})()}w(["mousemove","click","mouseup"]);export{I as default};
