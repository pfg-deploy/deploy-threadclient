import{r as e,a as t,e as r,g as i,b as n,c as o}from"./index.69c81b10.js";import{e as d}from"./base.50b98d34.js";import"./vendor.03bc8c46.js";function a(...e){console.log(...e)}function s(e,t,r,i){if(Array.isArray(i)){if(1!==i[0].data.children.length)return u(t,i);const n=i[0].data.children[0];if("t3"!==n.kind)return u(t,i);n.data.name;const o=i[1].data.children[0];o&&"t1"===o.kind&&o.data.parent_id;let d=b(e,{kind:"post",post:n,replies:i[1]});if("comments"===r.kind&&null!=r.focus_comment){const t="t1_"+r.focus_comment.toLowerCase();e.has(t)?d=t:a("focused comment not found in tree `"+t+"`")}return h(e,d)}if("Listing"===i.kind){const t={kind:"subreddit_unloaded",listing:i,details:"subreddit"===r.kind?r.sub:"unknown"};b(e,t);return h(e,m(t))}return u(t,i)}function l(e){return"homepage"===e.kind?"SR_home":"mod"===e.kind?"SR_mod":"multireddit"===e.kind?"SR_multi/u:"+e.user.toLowerCase()+"/m:"+e.multireddit.toLowerCase():"userpage"===e.kind?"SR_user/"+e.user.toLowerCase():"subreddit"===e.kind?"SR_sub/"+e.subreddit.toLowerCase():void t(e)}function u(t,r){return{ref:{kind:"post",parent:null,url:null,replies:null,content:{kind:"post",title:{text:"Error!"},collapsible:!1,body:{kind:"richtext",content:[...B(t),e.pre(JSON.stringify(r,null,"  "),"json")]},show_replies_when_below_pivot:!1},internal_data:null,display_style:"centered"},err:void 0}}function c(e){const t=p(e,void 0);return t?m(t):"__ERROR_FULLNAME__"}function m(e){return"comment"===e.kind?e.comment.data.name:"post"===e.kind?e.post.data.name:"subreddit_unloaded"===e.kind?"unknown"===e.details?"__UNKNOWN_LISTING_ROOT":l(e.details):"depth_more"===e.kind?"DEPTH_MORE_"+e.parent_permalink:"more"===e.kind?"MORE_"+e.item.data.children.join(","):void t(e)}function p(e,t){return"t1"===e.kind?{kind:"comment",comment:e}:"t3"===e.kind?{kind:"post",post:e,replies:"not_loaded"}:"more"===e.kind?0===e.data.children.length?null==t?void a("TODO setUpCommentOrUnmounted was called with not loaded parent but req. parent submission"):{kind:"depth_more",item:e,parent_permalink:t}:{kind:"more",item:e}:(S(e.kind),void a("TODO setUpCommentOrUnmounted",e.kind,e))}function k(e,t,r){const i=p(t,r);null!=i&&b(e,i)}function b(e,r){const i=m(r);if(e.get(i))return console.log("Note: Two objects with the same id were created. ID: `"+i+"`"),i;if("comment"===r.kind){const t=r.comment;if("t1"===t.kind){const r=t.data;if(r.replies)for(const t of r.replies.data.children)k(e,t,r.permalink)}else if("more"===t.kind){if("t1__"===t.data.name)return i}else console.log("TODO setUpMap "+t.kind)}else if("post"===r.kind){const t=r.post.data;if(t.crosspost_parent_list)for(const r of t.crosspost_parent_list)b(e,{kind:"post",post:{kind:"t3",data:r},replies:"not_loaded"});if("not_loaded"!==r.replies)for(const i of r.replies.data.children)k(e,i,t.permalink)}else if("subreddit_unloaded"===r.kind)for(const t of r.listing.data.children)k(e,t,"not_loaded");else"more"===r.kind||"depth_more"===r.kind||t(r);return e.set(i,{kind:"unprocessed",link:{ref:void 0,err:"processing not completed"},data:r}),i}function h(e,r){const i=e.get(r);if(!i)return{ref:void 0,err:"post was not found in tree (TODO load more) ("+r+")"};if("unprocessed"===i.kind){i.kind="processing";const r=function(e,r){var i,n;if("comment"===r.data.kind){const t=r.data.comment,o=t.data,d={reply:{action:le(o.name),locked:o.locked},items:[]};if(o.replies)for(const r of o.replies.data.children)d.items.push(h(e,c(r)));const a=e.get(o.parent_id);return{kind:"post",url:A(o.permalink,{context:"3"}),parent:h(e,o.parent_id),replies:d,content:{kind:"post",title:null,author:ce(o,y(null!=(i=o.all_awardings)?i:[])),body:he(o),info:_(t),collapsible:{default_collapsed:null!=(n=o.collapsed)&&n},show_replies_when_below_pivot:!0,actions:{vote:"post"===(null==a?void 0:a.data.kind)&&"CHAT"===a.data.post.data.discussion_type?void 0:re(o),code:be(o.body),other:[de(o.name),ue(o.name,o.saved),se(o.name,o.subreddit)]}},internal_data:r.data,display_style:"centered"}}if("post"===r.data.kind){const t=r.data.post,i=t.data;return{kind:"post",url:i.permalink,parent:h(e,l({kind:"subreddit",subreddit:i.subreddit,base:["r",i.subreddit]})),replies:"not_loaded"!==r.data.replies?{reply:{action:le(i.name),locked:i.locked},items:r.data.replies.data.children.map((t=>h(e,c(t))))}:null,content:{kind:"post",title:{text:i.title},collapsible:{default_collapsed:!0},flair:we(i),author:ce(i),body:_e(i),thumbnail:fe(i,"open"),info:_(t),show_replies_when_below_pivot:!1,actions:{vote:re(i),code:be(i.is_self?i.selftext:i.url),other:[{kind:"link",url:"/domain/"+i.domain,text:i.domain},de(i.name),ue(i.name,i.saved),{kind:"link",url:i.permalink.replace("/comments/","/duplicates/"),text:"Duplicates"},se(i.name,i.subreddit)]}},internal_data:r.data,display_style:"centered"}}if("subreddit_unloaded"===r.data.kind){const t=[];for(const i of r.data.listing.data.children)t.push(h(e,c(i)));return null!=r.data.listing.data.after&&t.push(h(e,"TODO next")),{kind:"post",url:null,parent:null,replies:{items:t},content:{kind:"post",title:{text:m(r.data)},collapsible:!1,body:{kind:"none"},show_replies_when_below_pivot:!1},internal_data:r.data,display_style:"fullscreen"}}if("depth_more"===r.data.kind){const t=r.data.item.data;return{kind:"loader",parent:h(e,t.parent_id),replies:null,url:null}}if("more"===r.data.kind){const t=r.data.item.data;return{kind:"loader",parent:h(e,t.parent_id),replies:null,url:null}}t(r.data)}(e,i);return[i.link.ref,i.link.err]=[r,void 0],i.kind="processed",i.link}if("processing"===i.kind||"processed"===i.kind)return i.link;t(i.kind)}function _(e){const t=e.data;return{creation_date:1e3*t.created_utc,edited:t.edited?{date:1e3*t.edited}:void 0,pinned:t.pinned||t.stickied||!1,in:"t3"===e.kind?{name:t.subreddit_name_prefixed,link:"/"+t.subreddit_name_prefixed}:void 0,comments:"t3"===e.kind?e.data.num_comments:void 0}}const f="biw1k0YZmDUrjg",w="https://thread.pfg.pw/login/reddit";function g(e){var t,r;if(null==e.type)return[];if("text"===e.type&&(null==e.text||""===e.text))return[];const i="richtext"===e.type?(null!=(t=e.richtext)?t:[]).map((e=>"text"===e.e?{kind:"text",text:e.t}:"emoji"===e.e?{kind:"emoji",url:e.u,name:e.a,w:16,h:16}:(S(e.e),{kind:"text",text:"#TODO("+e.e+")"}))):"text"===e.type?[{kind:"text",text:e.text}]:[{kind:"text",text:"TODO: "+e.type}],n=i.map((e=>"text"===e.kind?e.text:"")).join("");return[{color:null!=(r=e.background_color)?r:void 0,fg_color:"light"===e.text_color?"light":"dark",elems:i,content_warning:n.toLowerCase().startsWith("cw:")||n.toLowerCase().startsWith("tw:")}]}function y(e){const t=[];for(const r of e.sort(((e,t)=>t.count-e.count))){t.length>0&&t.push({kind:"text",text:" "});const e=r.resized_static_icons[0];t.push({kind:"emoji",url:e.url,w:e.width,h:e.height,name:r.name}),r.count>1&&t.push({kind:"text",text:"×"+r.count})}return 0===t.length?[]:[{elems:t,content_warning:!1,system:""}]}function x(e){return N.encode({kind:"vote",query:e})}function v(e){return N.encode({kind:"delete",fullname:e})}const N=d("act");function T(t,r){try{return O(t.document,r)}catch(i){return console.log("Error parsing richtext:",i),[e.p(e.error("Error parsing richtext: "+i,i))]}}function O(t,r){return t.map((t=>function(t,r){var i,n,o;switch(t.e){case"par":if(1!==t.c.length||"gif"!==(null==(i=t.c[0])?void 0:i.e)&&"img"!==(null==(n=t.c[0])?void 0:n.e))return 1===t.c.length&&"text"===(null==(o=t.c[0])?void 0:o.e)&&t.c[0].t.match(/^---+$/)?e.hr():e.p(...R(t.c,r));{const i=t.c[0],n=r.media_metadata[i.id];return n?e.kind("body",{body:E(n,i.id.split("|")[0]).body}):e.p(e.error("Missing media id "+i.id,n))}case"img":case"video":case"gif":{const i=r.media_metadata[t.id];return i?e.kind("body",{body:E(i,t.c).body}):e.p(e.error("unknown id "+t.id,r))}case"h":return e.hn(t.l,...R(t.c,r));case"hr":return e.hr();case"blockquote":return e.blockquote(...O(t.c,r));case"list":return e.kind("list",{ordered:t.o},t.c.map((t=>e.li(...O(t.c,r)))));case"code":return e.pre(t.c.map((e=>{switch(e.e){case"raw":return e.t;case"unsupported":return"Err «"+JSON.stringify(e)+"»"}})).join("\n"));case"table":return e.table(t.h.map((t=>function(t,r){var i;return e.th(null!=t.a?{L:"left",C:"center",R:"right"}[t.a]:void 0,...R(null!=(i=t.c)?i:[],r))}(t,r))),...t.c.map((t=>t.map((t=>function(t,r){return e.td(...R(t.c,r))}(t,r))))))}return S(t.e),e.p(e.error("TODO "+t.e,t))}(t,r)))}function S(e){console.log("Expected unsupported",e)}function E(t,r){var n,o,d,a;if("valid"!==t.status)return{thumb:null,aspect:void 0,body:{kind:"richtext",content:[e.p(e.error("Bad Status "+t.status+", "+r,t))]}};if("Image"===t.e){const e=null!=(n=t.p[0])?n:t.s;return{thumb:null!=(o=e.u)?o:"error",aspect:e.x/e.y,body:{kind:"captioned_image",url:t.s.u,w:t.s.x,h:t.s.y,caption:r}}}if("AnimatedImage"===t.e){const e=null==(d=t.p)?void 0:d[0];return{thumb:e?e.u:"error",aspect:e?e.x/e.y:void 0,body:{kind:"video",source:null!=t.s.mp4?{kind:"video",sources:[{url:t.s.mp4,quality:t.s.x+"×"+t.s.y}]}:{kind:"img",url:t.s.gif},aspect:t.s.x/t.s.y,gifv:!0,caption:r}}}return"RedditVideo"===t.e?{thumb:null,aspect:void 0,body:{kind:"video",source:i(t.id),aspect:t.x/t.y,gifv:null!=(a=t.isGif)&&a,caption:r}}:(S(t.e),{thumb:null,aspect:void 0,body:{kind:"richtext",content:[e.p(e.error("TODO "+t.e+", "+r,t))]}})}function P(e){return e>=10240&&e<=10495}function j(t,r,i){if(0===r.length){t=t.replaceAll("¯_(ツ)_/¯","¯\\_(ツ)_/¯");let r=0,i=0;if([...t].forEach((e=>{const t=e.codePointAt(0);8206!==t&&32!==t&&(i+=1),P(t)&&r++})),r>.9*i&&r>10){const r=[];let i=[];for(const e of t.split(" ")){[...e].filter((e=>P(e.codePointAt(0)))).length>5?r.length>0?(i.length>0&&(r[r.length-1]+=" "+i.join(" ")),i=[],r.push(e)):(r.push([...i,e].join(" ")),i=[]):i.push(e)}return r.push(...i),[e.txt(r.join("\n"))]}return[e.txt(t)]}const n=[];let o=0;const d=r=>{const i=t.substring(o,r);i.length>0&&n.push(e.txt(i))};return r.forEach((([r,i,a])=>{d(i),o=i+a;const s=t.substr(i,a),l={strong:!!(1&(u=r)),emphasis:!!(2&u),strike:!!(8&u),super:!!(32&u),code:!!(64&u),error:-108&u?"unsupported style "+u.toString(2):void 0};var u;null!=l.error?n.push(e.error(s,l.error)):l.code?n.push(e.code(s)):n.push(e.txt(s,{strong:l.strong,emphasis:l.emphasis,strikethrough:l.strike,superscript:l.super}))})),d(t.length),n}function R(t,r){return(null!=t?t:[]).flatMap((t=>function(t,r){var i,n,o;switch(t.e){case"text":return j(t.t,null!=(i=t.f)?i:[]);case"r/":case"u/":return[e.link("/"+t.e+t.t,{is_user_link:"u/"===t.e?t.t:void 0},e.txt((t.l?"/":"")+t.e+t.t))];case"link":return[e.link(t.u,{title:t.a},...j(t.t,null!=(n=t.f)?n:[]))];case"br":return[e.br()];case"spoilertext":return[e.spoiler(...R(t.c,r))];case"raw":return[e.txt(t.t)];case"gif":case"img":{const i=r.media_metadata[t.id];return i?"valid"!==i.status?[e.error("Bad status "+i.status,i)]:"AnimatedImage"===i.e?[e.link(null!=(o=i.s.mp4)?o:i.s.gif,{},e.txt("[embedded "+t.id.split("|")[0]+"]"))]:"Image"===i.e?"emoji"===i.t?[{kind:"emoji",url:i.s.u,name:":"+t.id.split("|")[2]+":"}]:[e.link(i.s.u,{},e.txt("[embedded "+t.id.split("|")[0]+"]"))]:[e.error("Unsupported "+i.e,i)]:[e.error("Missing media id "+t.id,i)]}}return S(t.e),[e.error("TODO "+t.e,t)]}(t,r)))}function I(e){return"https://"+(e?"oauth.reddit.com":"www.reddit.com")}let C=[];function D(){return new Promise((e=>{C.push(e),1===C.length&&async function(){var e;const t=localStorage.getItem("reddit-secret");if(""===t||null==t){const e=localStorage.getItem("reddit-app-data");let t;if(null!=e){const r=JSON.parse(e);if(!(r.expires<Date.now()))return r.access_token;t=r.device_id}else t=[...crypto.getRandomValues(new Uint8Array(25))].map((e=>e.toString(16).padStart(2,"0"))).join("");const i=await fetch("https://www.reddit.com/api/v1/access_token",{method:"POST",mode:"cors",credentials:"omit",headers:{Authorization:"Basic "+btoa(f+":"),"Content-Type":"application/x-www-form-urlencoded"},body:r({grant_type:"https://oauth.reddit.com/grants/installed_client",device_id:t,redirect_uri:w})}).then((e=>e.json()));if(i.error)throw console.log(i),new Error("error: "+JSON.stringify(i));const n={access_token:i.access_token,expires:Date.now()+1e3*i.expires_in,scope:i.scope,device_id:t};return localStorage.setItem("reddit-app-data",JSON.stringify(n)),n.access_token}const i=JSON.parse(t);if(console.log(i.expires,Date.now()),i.expires<Date.now()){console.log("Token expired, refreshing…");const[t,r]=await fetch("https://www.reddit.com/api/v1/access_token",{method:"POST",mode:"cors",credentials:"omit",headers:{Authorization:"Basic "+btoa(f+":"),"Content-Type":"application/x-www-form-urlencoded"},body:o`grant_type=refresh_token&refresh_token=${i.refresh_token}`}).then((async e=>[e.status,await e.json()]));if(200!==t)throw console.log("Error! got",r,"with status code",t),new Error("Status code "+t);if("error"in r)throw console.log("refresh attempt: ",r,i),new Error("Got error while refreshing token: "+r.error);const n={access_token:r.access_token,refresh_token:null!=(e=r.refresh_token)?e:i.refresh_token,expires:Date.now()+1e3*r.expires_in,scope:r.scope};return console.log("Refresh info:",r,n),localStorage.setItem("reddit-secret",JSON.stringify(n)),console.log("Refreshed √"),n.access_token}return i.access_token}().then((e=>{C.forEach((t=>t(e))),C=[]})).catch((e=>{console.log("Get access token error",e),C.forEach((e=>e(null))),C=[]}))}))}function q(e){const[t,...r]=e.split("?");return[null!=t?t:"",new URLSearchParams(r.join("?"))]}function A(e,t){const[r,i]=q(e);for(const[n,o]of Object.entries(t))null!=o?i.set(n,o):i.delete(n);return r+"?"+i.toString()}function U(e,t,r){return{kind:"counter",unique_id:"/subscribe/"+e+"/",time:Date.now(),label:"Subscribe",incremented_label:"Subscribed",style:"pill-filled",incremented_style:"pill-empty",count_excl_you:r?t-1:t,you:r?"increment":void 0,actions:{increment:N.encode({kind:"subscribe",subreddit:e,direction:"sub"}),reset:N.encode({kind:"subscribe",subreddit:e,direction:"unsub"})}}}function M(t,r){try{return function(t,r){if("moderators"===t.kind)return{kind:"widget",title:"Moderators",raw_value:t,widget_content:{kind:"body",body:{kind:"richtext",content:[e.p(e.link("/message/compose?to=/r/"+r,{style:"pill-empty"},e.txt("Message the mods"))),e.ul(...t.mods.map((t=>e.li(e.p(e.link("/u/"+t.name,{is_user_link:t.name},e.txt("u/"+t.name)),...g({type:t.authorFlairType,text:t.authorFlairText,text_color:t.authorFlairTextColor,background_color:t.authorFlairBackgroundColor,richtext:t.authorFlairRichText}).flatMap((t=>[e.txt(" "),e.flair(t)]))))))),e.p(e.link("/r/"+r+"/about/moderators",{},e.txt("View All Moderators")))]}}};if("community-list"===t.kind)return{kind:"widget",title:t.shortName,raw_value:t,widget_content:{kind:"list",items:t.data.map((t=>"subreddit"===t.type?{icon:t.communityIcon||void 0,name:{kind:"text",text:"r/"+t.name},click:{kind:"link",url:"/r/"+t.name},action:U(t.name,t.subscribers,t.isSubscribed)}:(S(t.type),{name:{kind:"text",text:"ERROR UNSUPPORTED"+t.type},click:{kind:"body",body:{kind:"richtext",content:[e.pre(JSON.stringify(t,null,"\t"),"json")]}}})))},actions_top:[{kind:"link",url:"/message/compose?to="+r,text:"Message the mods"}],actions_bottom:[{kind:"link",url:"/r/"+r+"/about/moderators",text:"View All Moderators"}]};if("id-card"===t.kind)return{kind:"widget",title:"Error!",raw_value:t,widget_content:{kind:"body",body:{kind:"richtext",content:[e.p(e.error("Not supported "+t.kind,t))]}}};if("menu"===t.kind)return{kind:"widget",title:"Error!",raw_value:t,widget_content:{kind:"body",body:{kind:"richtext",content:[e.p(e.error("Uh oh! TODO widget "+t.kind,t))]}}};if("textarea"===t.kind)return{kind:"widget",title:t.shortName,raw_value:t,widget_content:{kind:"body",body:{kind:"text",content:t.text,markdown_format:"reddit"}}};if("subreddit-rules"===t.kind)return{kind:"widget",title:t.shortName,raw_value:t,widget_content:{kind:"list",items:t.data.map(((e,t)=>({name:{kind:"text",text:t+1+". "+e.shortName},click:{kind:"body",body:{kind:"text",content:e.description,markdown_format:"reddit"}}})))}};if("image"===t.kind)return{kind:"widget",title:t.shortName,raw_value:t,widget_content:{kind:"image",src:t.data[t.data.length-1].url,link_url:t.data[t.data.length-1].linkUrl,width:t.data[t.data.length-1].width,height:t.data[t.data.length-1].height}};if("post-flair"===t.kind)return{kind:"widget",title:t.shortName,raw_value:t,widget_content:{kind:"list",items:t.order.map((e=>{const i=t.templates[e],n=g({type:i.type,text:i.text,text_color:i.textColor,background_color:i.backgroundColor,richtext:i.richtext});if(1!==n.length)throw new Error("bad flair");return{name:{kind:"flair",flair:n[0]},click:{kind:"link",url:"/r/"+r+'/search?q=flair:"'+encodeURIComponent(i.text)+'"&restrict_sr=1'}}}))}};if("custom"===t.kind)return{kind:"widget",title:t.shortName,raw_value:t,widget_content:{kind:"iframe",height:""+t.height,srcdoc:`\n            <head>\n                <link rel="stylesheet" href="${t.stylesheetUrl}">\n                <base target="_blank">\n            </head>\n            <body>${t.textHtml}</body>\n        `}};if("button"===t.kind)return{kind:"widget",title:t.shortName,raw_value:t,widget_content:{kind:"list",above_text:{kind:"text",content:t.description,markdown_format:"reddit"},items:t.buttons.map((e=>"text"===e.kind?{name:{kind:"text",text:e.text},click:{kind:"link",url:e.url}}:"image"===e.kind?{name:{kind:"image",src:e.url,w:e.width,h:e.height,alt:e.text},click:{kind:"link",url:e.linkUrl}}:(S(e.kind),{name:{kind:"text",text:"TODO "+e.kind},click:{kind:"body",body:{kind:"none"}}})))}};if("calendar"===t.kind)return{kind:"widget",title:t.shortName,raw_value:t,widget_content:{kind:"body",body:{kind:"array",body:t.data.flatMap(((t,r)=>[...0!==r?[{kind:"richtext",content:[e.hr()]}]:[],{kind:"text",content:t.title,markdown_format:"reddit"},{kind:"richtext",content:[e.p(e.timeAgo(1e3*t.startTime))]},{kind:"text",content:t.location,markdown_format:"reddit"},{kind:"text",content:t.description,markdown_format:"reddit"}]))}}};return S(t.kind),{kind:"widget",title:"Error!",raw_value:t,widget_content:{kind:"body",body:{kind:"richtext",content:[e.p(e.error("Uh oh! Unsupported widget "+t.kind,t))]}}}}(t,r)}catch(i){return console.log("widget error",i),{kind:"widget",title:"Error!",raw_value:t,widget_content:{kind:"body",body:{kind:"richtext",content:[e.p(e.error("Uh oh! Error "+i.toString(),t))]}}}}}function G(e,t,{collapsed:r}){return{kind:"thread",raw_value:e,body:{kind:"text",markdown_format:"reddit",content:e.data.description},display_mode:{body:r?"collapsed":"visible",comments:"visible"},link:"/r/"+t+"/about/sidebar",layout:"reddit-post",title:{text:"old.reddit sidebar"},actions:[],default_collapsed:!1}}function L(t){const r=t.widgets,i=e=>{const t=r.items[e];if(!t)throw new Error("bad widget "+e);return t},n=e=>M(e,t.subreddit),o=[...t.sub_t5?[(d=t.sub_t5,a=t.subreddit,{kind:"widget",title:d.data.title,raw_value:d,widget_content:{kind:"community-details",description:d.data.public_description},actions_bottom:[U(a,d.data.subscribers,null!=(s=d.data.user_is_subscriber)&&s)]})]:[],...t.sub_t5?[G(t.sub_t5,t.subreddit,{collapsed:!!r})]:[],...r?r.layout.sidebar.order.map((e=>n(i(e)))):[],...r?[n(i(r.layout.moderatorWidget))]:[]];var d,a,s;return 0===o.length&&o.push({kind:"widget",title:"Error",widget_content:{kind:"body",body:{kind:"richtext",content:[e.p(e.txt("Failed to fetch sidebar for this page :("))]}},raw_value:t}),o}function W(e){var t,r,i;if(!e)return{kind:"thread",title:{text:"Listing"},body:{kind:"text",content:"Listing",markdown_format:"none"},display_mode:{body:"collapsed",comments:"collapsed"},link:"TODO no link",layout:"error",actions:[],default_collapsed:!1,raw_value:e};const n=[{text:"Posts",action:{kind:"link",url:"/r/"+e.subreddit},selected:!0}];e:if(e.widgets){const r=null==(t=e.widgets)?void 0:t.layout.topbar.order.length;if(0===r)break e;if(1!==r){n.push({text:"ERROR Topbar Order",action:{kind:"link",url:"error"},selected:!1});break e}const i=e.widgets.items[e.widgets.layout.topbar.order[0]];if("menu"!==i.kind){n.push({text:"ERROR Topbar Item",action:{kind:"link",url:"error"},selected:!1});break e}i.showWiki&&n.push({text:"Wiki",action:{kind:"link",url:"/r/"+e.subreddit+"/wiki/index"},selected:!1});const o=e=>"children"in e?{text:e.text,selected:!1,action:{kind:"menu",children:e.children.map(o)}}:"url"in e?{text:e.text,selected:!1,action:{kind:"link",url:e.url}}:void Ee(e);n.push(...i.data.map((e=>({...o(e),selected:!1}))))}return{kind:"bio",...e.sub_t5?Ne(e.sub_t5.data):{banner:null,icon:null},name:{display:null==(r=e.sub_t5)?void 0:r.data.title,link_name:e.sub_t5?e.sub_t5.data.display_name_prefixed:"r/"+e.subreddit},body:null,subscribe:e.sub_t5?U(e.subreddit,e.sub_t5.data.subscribers,null!=(i=e.sub_t5.data.user_is_subscriber)&&i):void 0,menu:1===n.length?null:n,raw_value:e}}const J=d("deferred_inbox");function F(){return function(){const e=localStorage.getItem("reddit-secret");return null!=e&&""!==e}()?{actions:[{kind:"act",action:N.encode({kind:"log_out"}),text:"Log Out"}],inboxes:[{id:"/messages",name:"Messages",active_color:"orange",hydrate:J.encode({kind:"inbox"}),url:"/message/inbox"},{id:"/modmail",name:"Modmail",active_color:"green",hydrate:J.encode({kind:"modmail"}),url:"/mod/mail/all"}]}:{actions:[{kind:"link",url:ye(),text:"Log In"},{kind:"link",url:"raw!https://www.reddit.com/register",text:"Sign Up"}],inboxes:[]}}function V(t,r,i){var n;const o=[],d=r;return"object"==typeof d&&"json"in d&&"object"==typeof d.json&&"errors"in d.json&&Array.isArray(d.json.errors)&&d.json.errors.length>0&&(o.push(e.h1(e.txt("Errors:"))),o.push(e.ul(...d.json.errors.map((t=>e.ili(e.txt(t))))))),i.warning&&o.push(...i.warning),{title:"Error View",navbar:F(),body:{kind:"one",item:{parents:[{kind:"thread",raw_value:r,body:{kind:"richtext",content:[...o,e.pre(JSON.stringify(r,null,"\t"),"json")]},display_mode:{body:"visible",comments:"visible"},link:t,layout:"error",actions:[],default_collapsed:!1}],replies:[]}},sidebar:null!=(n=i.sidebar)?n:void 0,display_style:"comments-view"}}function z(t,r,i,n){var o,d,a,s,l,u,c,m;const p=r;if(Array.isArray(i)){if(1!==i[0].data.children.length)return V(t,i,{sidebar:n.sidebar,warning:B(t)});const r=i[0].data.children[0];if("t3"!==r.kind)return V(t,i,{sidebar:n.sidebar,warning:B(t)});const s=r.data.name,l=null!=(o=r.data.suggested_sort)?o:"confidence",u=r.data.contest_mode,c=r.data.can_mod_post,m=r.data.permalink,k=r.data.locked,b="CHAT"===r.data.discussion_type,h=i[1].data.children,_=[],f=h[0];f&&"t1"===f.kind&&f.data.parent_id!==s&&_.push(ne(f.data.subreddit,(null!=s?s:"").replace("t3_",""),f.data.parent_id.replace("t1_","")));let w,g=h.map((e=>oe(e,{link_fullname:s},{permalink:m,sort:l,is_chat:b})));if("comments"===p.kind&&null!=p.focus_comment){const e=e=>{if(1!==e.length)return;const t=e[0];return"thread"===t.kind?t:void 0},t=e=>{const t=e.raw_value;if("object"==typeof t&&t&&"data"in t&&"object"==typeof t.data&&t.data&&"name"in t.data&&"string"==typeof t.data.name){const e=t.data.name;return e.startsWith("t1_")?e.replace("t1_",""):void 0}};let r,i=e(g);for(;i;){if(t(i)===p.focus_comment){r=i;break}i=e(null!=(d=i.replies)?d:[])}if(r){for(i=e(g);i&&i!==r;){_.push(i);const t=i.replies;i.replies=void 0,i=e(null!=t?t:[])}if(i){_.push(i);const e=i.replies;i.replies=void 0,g=null!=e?e:[]}else g=[]}}return null!=i[1].data.after&&g.push({kind:"load_more",url:"TODO",load_more:te.encode({kind:"duplicates",lmurl:"todo"}),raw_value:i[1]}),w="comments"===p.kind?u&&!c?[{selected:!0,text:"Random",action:{kind:"link",url:A(m,{sort:"random"})}}]:[["confidence","Best"],["top","Top"],["new","New"],["controversial","Controversial"],["old","Old"],["random","Random"],["qa","Q&A"],["live","Live"]].map((([e,t])=>{var r;return{selected:(null!=(r=p.sort_override)?r:l)===e,text:t,action:{kind:"link",url:A(m,{sort:e})}}})):"duplicates"===p.kind?[["num_comments","Comments"],["new","New"]].map((([e,t])=>({selected:p.sort===e,text:t,action:{kind:"link",url:A(m.replace("/comments","/duplicates"),{sort:e})}}))):[{selected:!1,text:"error "+p.kind,action:{kind:"link",url:"error"}}],{title:"t3"===r.kind?r.data.title:"ERR top not t3",navbar:F(),body:{kind:"one",item:{parents:[oe(r,{force_expand:_.length>0?"closed":"open",show_post_reply_button:!0},{permalink:m,sort:"unsupported",is_chat:b}),...u?[{kind:"thread",body:{kind:"richtext",content:[e.p(e.txt("This thread is in contest mode.")),e.p(e.txt(c?"As a mod, you can sort comments however you wish. Regular users have randomized sorting and cannot see scores.":"Sorting is randomized and scores are hidden."))]},display_mode:{body:"visible",comments:"collapsed"},raw_value:u,link:"no",actions:[],default_collapsed:!1,layout:"reddit-post"}]:[],...k?[{kind:"thread",body:{kind:"richtext",content:[e.p(e.txt("This thread is locked.")),e.p(e.txt(c?"Only mods like you can comment on this thread.":"You are not able to comment on this thread."))]},display_mode:{body:"visible",comments:"collapsed"},raw_value:k,link:"no",actions:[],default_collapsed:!1,layout:"reddit-post"}]:[],..._],menu:w,replies:g}},sidebar:null!=(a=n.sidebar)?a:void 0,display_style:"comments-view"}}if("wikipage"===i.kind)return{title:t+" | Wiki",navbar:F(),body:{kind:"one",item:{parents:[{kind:"thread",raw_value:i,body:{kind:"text",markdown_format:"reddit_html",content:i.data.content_html},display_mode:{body:"visible",comments:"visible"},link:t,layout:"error",actions:[],default_collapsed:!1}],replies:[]}},sidebar:null!=(s=n.sidebar)?s:void 0,display_style:"comments-view"};if("t5"===i.kind)return{title:t+" | Sidebar",navbar:F(),body:{kind:"one",item:{parents:[{kind:"thread",raw_value:i,body:{kind:"text",markdown_format:"reddit",content:i.data.description},display_mode:{body:"visible",comments:"visible"},link:t,layout:"reddit-post",title:{text:"old.reddit sidebar"},actions:[],default_collapsed:!1}],replies:[]}},sidebar:null!=(l=n.sidebar)?l:void 0,display_style:"comments-view"};if("UserList"===i.kind)return{title:t,navbar:F(),body:{kind:"one",item:{parents:[{kind:"thread",body:{kind:"richtext",content:[e.h1(e.txt("User List")),e.table([e.th("left",e.txt("Username")),e.th("left",e.txt("Added")),e.th("left",e.txt("Perms"))],...i.data.children.map((t=>[e.td(e.link("/u/"+t.name,{is_user_link:t.name},e.txt("u/"+t.name))),e.td(e.timeAgo(1e3*t.date)),e.td(...t.mod_permissions.flatMap(((t,r)=>[...0!==r?[e.txt(", ")]:[],e.txt(t)])))])))]},display_mode:{body:"visible",comments:"visible"},raw_value:i,layout:"reddit-post",link:t,actions:[],default_collapsed:!1}],replies:[]}},sidebar:null!=(u=n.sidebar)?u:void 0,display_style:"comments-view"};if("Listing"===i.kind){let r;if(i.data.before,null!=i.data.after){const e=A(t,{before:void 0,after:i.data.after});r={kind:"load_more_unmounted",load_more_unmounted:ee.encode({kind:"listing",url:e}),url:e,count:void 0,raw_value:i}}const o=[["overview","Overview"],["comments","Comments"],["submitted","Submitted"]],d=[["upvoted","Upvoted"],["downvoted","Downvoted"],["hidden","Hidden"],["saved","Saved"]];return{title:t,navbar:F(),body:{kind:"listing",menu:"subreddit"===p.kind?[{selected:"hot"===p.current_sort.v,text:"Hot",action:{kind:"link",url:"/"+[...p.sub.base,...p.is_user_page?["hot"]:[]].join("/")}},{selected:"best"===p.current_sort.v,text:"Best",action:{kind:"link",url:"/"+[...p.sub.base,"best"].join("/")}},{selected:"new"===p.current_sort.v,text:"New",action:{kind:"link",url:"/"+[...p.sub.base,"new"].join("/")}},{selected:"rising"===p.current_sort.v,text:"Rising",action:{kind:"link",url:"/"+[...p.sub.base,"rising"].join("/")}},...[["top","Top"],["controversial","Controversial"]].map((([e,t])=>({selected:p.current_sort.v===e,text:p.current_sort.v===e?t+" ("+p.current_sort.t+")":t,action:{kind:"menu",children:[["hour","Hour"],["day","Day"],["week","Week"],["month","Month"],["year","Year"],["all","All Time"]].map((([t,r])=>({text:r,selected:p.current_sort.v===e&&p.current_sort.t===t,action:{kind:"link",url:"/"+[...p.sub.base,e].join("/")+"?t="+t}})))}})))]:"user"===p.kind?[...o.map((([e,t])=>({selected:p.current.tab===e,text:t,action:{kind:"show-line-two",children:[{selected:p.current.tab===e&&"hot"===p.current.sort.sort,text:"Hot",action:{kind:"link",url:A("/"+["u",p.username,e].join("/"),{sort:"hot"})}},{selected:p.current.tab===e&&"new"===p.current.sort.sort,text:"New",action:{kind:"link",url:A("/"+["u",p.username,e].join("/"),{sort:"new"})}},...[["top","Top"],["controversial","Controversial"]].map((([t,r])=>({selected:p.current.tab===e&&p.current.sort.sort===t,text:p.current.tab===e&&p.current.sort.sort===t?r+" ("+p.current.sort.t+")":r,action:{kind:"menu",children:[["hour","Hour"],["day","Day"],["week","Week"],["month","Month"],["year","Year"],["all","All Time"]].map((([r,i])=>({text:i,selected:p.current.tab===e&&p.current.sort.sort===t&&p.current.sort.t===r,action:{kind:"link",url:A("/"+["u",p.username,e].join("/"),{sort:t,t:r})}})))}})))]}}))),{selected:"gilded"===p.current.tab,text:"Gilded",action:{kind:"show-line-two",children:[{selected:"gilded"===p.current.tab&&"received"===p.current.by,text:"Received",action:{kind:"link",url:"/"+["u",p.username,"gilded"].join("/")}},{selected:"gilded"===p.current.tab&&"given"===p.current.by,text:"Given",action:{kind:"link",url:"/"+["u",p.username,"gilded","given"].join("/")}}]}},...d.map((([e,t])=>({selected:p.current.tab===e,text:t,action:{kind:"link",url:"/"+["u",p.username,e].join("/")}})))]:"inbox"===p.kind?[{selected:"compose"===p.current.tab,text:"Compose",action:{kind:"link",url:"/message/compose"}},{selected:"inbox"===p.current.tab,text:"Inbox",action:{kind:"show-line-two",children:[["inbox","All"],["unread","Unread"],["messages","Messages"],["comments","Comment Replies"],["selfreply","Post Replies"],["mentions","Username Mentions"]].map((([e,t])=>({text:t,selected:"inbox"===p.current.tab&&p.current.inbox_tab===e,action:{kind:"link",url:"/message/"+e}})))}},{selected:"sent"===p.current.tab,text:"Sent",action:{kind:"link",url:"/message/sent"}}]:[{text:"Error! "+p.kind,selected:!1,action:{kind:"link",url:t}}],header:null!=(c=n.header)?c:{kind:"thread",title:{text:"Listing"},body:{kind:"text",content:"Listing",markdown_format:"none"},display_mode:{body:"collapsed",comments:"collapsed"},link:"TODO no link",layout:"error",actions:[],default_collapsed:!1,raw_value:p},items:"inbox"===p.kind?i.data.children.map((t=>function(t){if("t1"===t.kind||"t4"===t.kind){const e=t.data;return{parents:[{kind:"thread",title:{text:e.subject},body:{kind:"none"},display_mode:{body:"visible",comments:"collapsed"},link:"no",layout:"reddit-post",default_collapsed:!1,actions:[],raw_value:t},ie(t)],replies:"object"==typeof e.replies?e.replies.data.children.map((e=>ie(e))):[]}}return{parents:[{kind:"thread",body:{kind:"richtext",content:[e.p(e.error("Unsupported "+t.kind,t))]},display_mode:{body:"visible",comments:"collapsed"},layout:"error",default_collapsed:!1,actions:[],raw_value:t,link:"no"}],replies:[]}}(t))):i.data.children.map((e=>function(e,t={},r){const i=oe(e,t,r);if("t1"===e.kind&&"link_title"in e.data)return{parents:[{kind:"thread",title:{text:e.data.link_title},info:{time:!1,edited:!1,in:{name:e.data.subreddit_name_prefixed,link:"/"+e.data.subreddit_name_prefixed},author:{color_hash:e.data.link_author,name:e.data.link_author,link:"/u/"+e.data.link_author},pinned:!1},body:{kind:"link",url:e.data.link_permalink},display_mode:{body:"visible",comments:"collapsed"},link:e.data.link_permalink,layout:"reddit-post",default_collapsed:!1,actions:[{kind:"link",url:e.data.link_permalink,text:"Permalink"}],raw_value:e,replies:[]},...e.data.parent_id===e.data.link_id?[]:[ne(e.data.subreddit,e.data.link_id.replace("t3_",""),e.data.parent_id.replace("t1_",""))],i],replies:[]};return{parents:[i],replies:[]}}(e,void 0,{permalink:t,sort:"unsupported",is_chat:!1}))),next:r},sidebar:null!=(m=n.sidebar)?m:void 0,display_style:"fullscreen-view"}}return S(i.kind),V(t,i,{sidebar:n.sidebar,warning:B(t)})}function B(t){const r=t.startsWith("/mod/")||t.startsWith("/mod?")||t.startsWith("/mod#")||"/mod"===t;return r&&(t=t.replace("/mod","")),[e.h1(e.txt("This url is not supported yet")),r?e.h2(e.txt("View it on mod.reddit.com: "),e.link("raw!https://mod.reddit.com"+t,{},e.txt("mod.reddit.com"+t))):e.h2(e.txt("View it on reddit.com: "),e.link("raw!https://www.reddit.com"+t,{},e.txt("reddit.com"+t))),e.p(e.txt("Submit an issue "),e.link("https://github.com/pfgithub/threadclient/issues",{},e.txt("here")),e.txt(" if you would like to see this supported. Mention the url: "),e.code(t))]}const H=n(),Y=[],$=new Set(["/acknowledgements","/appeal","/appeals","/avatar","/user/me/avatar","/u/me/avatar","/user/:profileName/avatar","/coins","/coins/mobile","/user/me","/user/me/:rest(.*)","/r/u_:profileName","/r/u_:profileName/:rest(.*)","/u/:profileName","/u/:profileName/:rest(.*)","/user/:profileName/submitted","/user/:profileName/submitted/:rest(.*)","/:routePrefix(r)/:subredditName/collection/:collectionId/:partialPostId/:partialCommentId","/:routePrefix(r)/:subredditName/collection/:collectionId/:partialPostId","/:routePrefix(r)/:subredditName/collection/:collectionId","/:routePrefix(user)/:subredditName/collection/:collectionId/:partialPostId/:partialCommentId","/:routePrefix(user)/:subredditName/collection/:collectionId/:partialPostId","/:routePrefix(user)/:subredditName/collection/:collectionId","/:routePrefix(r)/:subredditName/comments/:partialPostId/:urlSafePostTitle/:partialCommentId","/:routePrefix(r)/:subredditName/comments/:partialPostId/:urlSafePostTitle?","/comments/:partialPostId/:urlSafePostTitle/:partialCommentId","/comments/:partialPostId/:urlSafePostTitle?","/:routePrefix(r)/:subredditName/duplicates/:partialPostId/:urlSafePostTitle?","/:routePrefix(user)/:subredditName/duplicates/:partialPostId/:urlSafePostTitle?","/duplicates/:partialPostId/:urlSafePostTitle?","/:routePrefix(user)/:subredditName/comments/:partialPostId/:urlSafePostTitle/:partialCommentId","/:routePrefix(user)/:subredditName/comments/:partialPostId/:urlSafePostTitle?","/verification/:verificationToken","/","/:sort(best|hot|new|rising|controversial|top|gilded|awarded)?","/label/subreddits","/premium","/framedGild/:thingId","/framedModal/:type","/submit","/r/:subredditName/submit","/user/:profileName/submit","/user/:profileName/draft/:draftId","/original/submit","/original","/original/:categoryName/:sort([a-z]+)?","/explore","/explore/:categoryName","/community-points/","/vault/","/web/community-points/","/web/special-membership/:subredditName","/web/membership/:subredditName","/vault/burn","/me/m/:multiredditName","/user/:username/m/:multiredditName","/me/m/:multiredditName/:sort(best)?","/me/m/:multiredditName/:sort(hot)?","/me/m/:multiredditName/:sort(new)?","/me/m/:multiredditName/:sort(rising)?","/me/m/:multiredditName/:sort(controversial)?","/me/m/:multiredditName/:sort(top)?","/me/m/:multiredditName/:sort(gilded)?","/me/m/:multiredditName/:sort(awarded)?","/user/:username/m/:multiredditName/:sort(best)?","/user/:username/m/:multiredditName/:sort(hot)?","/user/:username/m/:multiredditName/:sort(new)?","/user/:username/m/:multiredditName/:sort(rising)?","/user/:username/m/:multiredditName/:sort(controversial)?","/user/:username/m/:multiredditName/:sort(top)?","/user/:username/m/:multiredditName/:sort(gilded)?","/user/:username/m/:multiredditName/:sort(awarded)?","/r/mod/about/:pageName(edited|modqueue|reports|spam|unmoderated)?","/r/mod/:sort(best)?","/r/mod/:sort(hot)?","/r/mod/:sort(new)?","/r/mod/:sort(rising)?","/r/mod/:sort(controversial)?","/r/mod/:sort(top)?","/r/mod/:sort(gilded)?","/r/mod/:sort(awarded)?","/me/f/mod/:sort(best)?","/me/f/mod/:sort(hot)?","/me/f/mod/:sort(new)?","/me/f/mod/:sort(rising)?","/me/f/mod/:sort(controversial)?","/me/f/mod/:sort(top)?","/me/f/mod/:sort(gilded)?","/me/f/mod/:sort(awarded)?","/notifications/","/message/:pageName(inbox|unread|messages|comments|selfreply|mentions|compose|sent|moderator)","/message/messages/:messageId","/user/:profileName/comments","/user/:profileName/about/edit/moderation","/user/:profileName","/user/:profileName/posts","/user/:profileName/snoo","/user/:profileName/:listingType(downvoted|hidden|saved|upvoted|gilded|given)","/user/:profileName/gilded/:listingType(given)","/rpan/r/:subredditName/:partialPostId?","/rpan/:partialPostId?","/settings/:page(account|messaging|profile|privacy|notifications|feed|gold|payments|premium|creator|special)?","/settings/data-request","inexact|/prefs/:page(deactivate|blocked)?","inexact|/user/:username/about/edit","inexact|/user/:username/about/edit/privacy","/search","/r/:subredditName/search","/me/m/:multiredditName/search","/user/:username/m/:multiredditName/search","/wiki/","/r/:subredditName/wiki/","/r/:subredditName/w/:wikiPageName*","/w/:wikiPageName*","/r/:subredditName/wiki/:wikiSubRoute(settings)/:wikiPageName+","/r/:subredditName/wiki/:wikiSubRoute(revisions)","/r/:subredditName/wiki/:wikiSubRoute(edit|create|revisions)/:wikiPageName+","/r/:subredditName/wiki/:wikiPageName+","/wiki/:wikiPageName+","/t/:topicSlug","/r/:subredditName","/r/:subredditName/:sort(best)?","/r/:subredditName/:sort(hot)?","/r/:subredditName/:sort(new)?","/r/:subredditName/:sort(rising)?","/r/:subredditName/:sort(controversial)?","/r/:subredditName/:sort(top)?","/r/:subredditName/:sort(gilded)?","/r/:subredditName/:sort(awarded)?","/subreddits/create","/subreddits/leaderboard","/subreddits/leaderboard/:categoryName/","/r/:subredditName/about","/r/:subredditName/about/:pageName(awards|muted|badges|banned|chat|settings|contributors|emojis|emotes|eventposts|moderators|rules|removal|modqueue|reports|spam|unmoderated|edited|postflair|log|flair|edit|userflair|wiki|wikicontributors|wikibanned|traffic|scheduledposts|broadcasting|content)","/user/:profileName/about/:pageName(awards)","/r/:subredditName/about/:pageName(wiki)/:wikiSubRoute(revisions|wikibanned|wikicontributors)","/r/:subredditName/about/:pageName(wiki)/:wikiSubRoute(edit|create|settings|revisions)/:wikiPageName+","/r/:subredditName/about/:pageName(wiki)/:wikiPageName*","/report"]),K=e=>({kind:"link_out",out:"https://www.reddit.com"+e.path+"?"+r(e.query)}),Q=e=>t=>({kind:"todo",path:t.path+"?"+r(t.query),msg:e});function Z(e,t){const r=e=>null!=e.multireddit&&null!=e.user?{kind:"multireddit",multireddit:e.multireddit,user:e.user,base:["user",e.user,"m",e.multireddit]}:null!=e.user?{kind:"userpage",user:e.user,base:["user",e.user]}:null!=e.subreddit?{kind:"subreddit",subreddit:e.subreddit,base:["r",e.subreddit]}:{kind:"homepage",base:[]};"home"!==t&&"subreddit"!==t&&"user"!==t||("home"===t&&Y.push("/submit"),"subreddit"===t&&Y.push("/r/:subredditName/submit"),"user"===t&&Y.push("/user/:profileName/submit"),e.route(["submit"],Q("submit post")));const i=["best","hot","new","rising","controversial","top","gilded","awarded"];if("home"===t&&Y.push("/","/:sort("+i.join("|")+")?"),"subreddit"===t&&Y.push("/r/:subredditName",...i.map((e=>"/r/:subredditName/:sort("+e+")?"))),"multireddit"===t&&Y.push("/user/:username/m/:multiredditName",...i.map((e=>"/user/:username/m/:multiredditName/:sort("+e+")?"))),e.route([{sort:[...i,..."user"===t?[]:[null]]}],(e=>{var t,i,n,o;return{kind:"subreddit",sub:r(e),is_user_page:!1,current_sort:{v:null!=(t=e.sort)?t:"hot",t:null!=(i=e.query.t)?i:"all"},before:null!=(n=e.query.before)?n:null,after:null!=(o=e.query.after)?o:null}})),"subreddit"===t||"user"===t||"home"===t){const i="subreddit"===t?"/:routePrefix(r)/:subredditName":"user"===t?"/:routePrefix(user)/:subredditName":"home"===t?"":Ee(t);Y.push(i+"/duplicates/:partialPostId/:urlSafePostTitle?"),e.route(["duplicates",{post_id_unprefixed:"any"},{url_safe_post_title:"optional"}],(e=>{var t,i,n;return{kind:"duplicates",sub:r(e),post_id_unprefixed:e.post_id_unprefixed,after:null!=(t=e.query.after)?t:null,before:null!=(i=e.query.before)?i:null,crossposts_only:"true"===e.query.crossposts_only,sort:null!=(n=e.query.sort)?n:"num_comments"}})),Y.push(i+"/comments/:partialPostId/:urlSafePostTitle?"),e.route(["comments",{post_id_unprefixed:"any"},{url_safe_post_title:"optional"}],(e=>{var t,i,n;return{kind:"comments",sub:r(e),post_id_unprefixed:e.post_id_unprefixed,focus_comment:null!=(t=e.query.comment)?t:null,sort_override:null!=(i=e.query.sort)?i:null,context:null!=(n=e.query.context)?n:null}})),Y.push(i+"/comments/:partialPostId/:urlSafePostTitle/:partialCommentId"),e.route(["comments",{post_id_unprefixed:"any"},{url_safe_post_title:"any"},{partial_comment_id:"any"}],(e=>{var t,i;return{kind:"comments",sub:r(e),post_id_unprefixed:e.post_id_unprefixed,focus_comment:e.partial_comment_id,sort_override:null!=(t=e.query.sort)?t:null,context:null!=(i=e.query.context)?i:null}}))}}H.route(["raw",{path:"rest"}],(e=>({kind:"raw",path:"/"+e.path.join("/")+"?"+r(e.query)}))),Y.push("/acknowledgements"),H.route(["acknowledgements"],K),Y.push("/appeal"),H.route(["appeal"],K),Y.push("/appeals"),H.route(["appeals"],K),Y.push("/avatar"),H.route(["appeals"],K),Y.push("/coins"),H.route(["coins"],K),Y.push("/coins/mobile"),H.route(["coins","mobile"],K),Y.push("/r/u_:profileName","/r/u_:profileName/:rest(.*)"),H.route(["r",{user:{kind:"starts-with",text:"u_"}},{remainder:"rest"}],(e=>({kind:"redirect",to:"/"+["user",e.user,...e.remainder].join("/")+"?"+r(e.query)}))),Y.push("/u/:profileName","/u/:profileName/:rest(.*)","/u/me/avatar"),H.route(["u",{user:"any"},{remainder:"rest"}],(e=>({kind:"redirect",to:"/"+["user",e.user,...e.remainder].join("/")+"?"+r(e.query)}))),Y.push("/verification/:verificationToken"),H.route(["verification",{vtoken:"any"}],K),Y.push("/label/subreddits"),H.route(["label","subreddits"],K),Y.push("/premium"),H.route(["premium"],K),Y.push("/framedGild/:thingId"),H.route(["framedGild",{thing:"any"}],K),Y.push("/framedModal/:type"),H.route(["framedModal",{type:"any"}],K),Y.push("/community-points/","/vault/","/web/community-points/"),H.route(["community-points"],K),H.route(["vault"],K),H.route(["web","community-points"],K),H.with(["user","me"],(e=>{Y.push("/user/me/avatar"),e.catchall(Q("redirect to current user"))})),H.with(["user",{user:"any"}],(e=>{Y.push("/user/:profileName/avatar"),e.route(["user",{profile_name:"any"},"avatar"],(e=>({kind:"redirect",to:"/avatar"}))),Y.push("/user/:profileName","/user/:profileName/comments","/user/:profileName/submitted","/user/:profileName/submitted/:rest(.*)"),e.route([{tab:["overview","comments","submitted",null]}],(e=>{var t,r,i;return{kind:"user",username:e.user,current:{kind:"sorted-tab",tab:null!=(t=e.tab)?t:"overview",sort:{sort:null!=(r=e.query.sort)?r:"submitted"===e.tab?"hot":"new",t:null!=(i=e.query.t)?i:"all"}}}})),Y.push("/user/:profileName/posts"),e.route(["posts"],(e=>({kind:"redirect",to:"/user/"+e.user+"/submitted?"+r(e.query)})));const t=["downvoted","hidden","saved","upvoted"];Y.push("/user/:profileName/:listingType("+t.join("|")+"|gilded|given)"),Y.push("/user/:profileName/gilded/:listingType(given)"),e.route([{tab:t}],(e=>({kind:"user",username:e.user,current:{kind:"unsorted-tab",tab:e.tab}}))),e.route(["gilded",{by:["received","given",null]}],(e=>{var t,r;return{kind:"user",username:e.user,current:{kind:"gild-tab",tab:"gilded",by:null!=(r=null!=(t=e.by)?t:e.query.show)?r:"received"}}})),e.route(["given"],(e=>({kind:"user",username:e.user,current:{kind:"gild-tab",tab:"gilded",by:"given"}}))),Y.push("/user/:profileName/snoo"),e.route(["snoo"],Q("snoo")),Y.push("/user/:profileName/draft/:draftId"),e.route(["draft",{draft_id:"any"}],Q("drafts")),Y.push("/user/:profileName/about/edit/moderation"),e.route(["about","edit","moderation"],Q("user profile moderation settings")),e.with(["m",{multireddit:"any"}],(e=>Z(e,"multireddit"))),Z(e,"user")})),H.with(["r",{subreddit:"any"}],(e=>{Y.push("/r/:subredditName/wiki/:wikiSubRoute(revisions)","/r/:subredditName/wiki/:wikiSubRoute(settings)/:wikiPageName+","/r/:subredditName/wiki/:wikiSubRoute(edit|create|revisions)/:wikiPageName+","/r/:subredditName/wiki/","/r/:subredditName/w/:wikiPageName*","/r/:subredditName/wiki/:wikiPageName+"),e.with([{w_wiki:["w","wiki"]}],(e=>{e.route([{wiki_path:"rest"}],(e=>({kind:"wiki",sub:{kind:"subreddit",base:["r",e.subreddit],subreddit:e.subreddit},path:e.wiki_path,query:e.query})))})),Z(e,"subreddit")})),H.route([{w_wiki:["w","wiki"]},{wiki_path:"rest"}],(e=>({kind:"wiki",sub:{kind:"homepage",base:[]},path:e.wiki_path,query:e.query}))),H.with(["message"],(e=>{const t=["inbox","unread","messages","comments","selfreply","mentions"];Y.push("/message/:pageName("+t.join("|")+"|compose|sent|moderator)"),e.route([{tab:[...t]}],(e=>({kind:"inbox",current:{tab:"inbox",inbox_tab:e.tab}}))),e.route(["compose"],(e=>({kind:"inbox",current:{tab:"compose",to:e.query.to,subject:e.query.subject,message:e.query.message}}))),e.route(["sent"],(e=>({kind:"inbox",current:{tab:"sent"}}))),e.route(["moderator"],(e=>({kind:"inbox",current:{tab:"mod"}}))),Y.push("/message/messages/:messageId"),e.route(["messages",{message_id:"any"}],(e=>({kind:"inbox",current:{tab:"message",msgid:e.message_id}})))})),Z(H,"home"),H.with(["mod"],(e=>{H.catchall(Q("not supported"))})),H.catchall(Q("not supported"));const X=[];for(const qe of Y)$.has(qe)?$.delete(qe):X.push("• unknown: "+qe);if($.size>0)for(const qe of $)X.push("• missing: "+qe);if(X.length>0){console.log("reddit router ::");for(const e of X)console.log(e)}const ee=d("load_more_unmounted"),te=d("load_more");function re(e){var t,r,i;const n={id:e.name,rank:"2"};return{kind:"counter",unique_id:"/vote/"+e.name+"/",time:Date.now(),special:"reddit-points",label:"Vote",incremented_label:"Voted",decremented_label:"Voted",count_excl_you:null!=(r=null!=(t=e.score_hidden)?t:e.hide_score)&&r?"hidden":e.score+(!0===e.likes?-1:!1===e.likes?1:0),you:!0===e.likes?"increment":!1===e.likes?"decrement":void 0,percent:e.upvote_ratio,actions:null!=(i=e.archived)&&i?{error:"archived <6mo"}:{increment:x({...n,dir:"1"}),decrement:x({...n,dir:"-1"}),reset:x({...n,dir:"0"})}}}function ie(t){if("t1"===t.kind||"t4"===t.kind){const e=t.data;return{kind:"thread",info:{time:1e3*e.created_utc,edited:!1,author:{name:"u/"+e.author,color_hash:e.author,link:"/u/"+e.author},pinned:!1},body:{kind:"text",content:e.body,markdown_format:"reddit"},display_mode:{body:"visible",comments:"collapsed"},link:e.context,layout:"reddit-comment",default_collapsed:!1,actions:[..."t1"===t.kind?[re(e)]:[],...e.context?[{kind:"link",url:e.context,text:"Context"}]:[],..."t4"===t.kind?[{kind:"link",url:"/message/messages/"+e.id,text:"Permalink"}]:[],{kind:"counter",count_excl_you:"none",you:e.new?"increment":void 0,unique_id:"/unread/"+e.name+"/",time:Date.now(),label:"Mark Unread",incremented_label:"🠶 New",actions:{increment:N.encode({kind:"mark_read",direction:"un",fullname:e.name}),reset:N.encode({kind:"mark_read",direction:"",fullname:e.name})}}],raw_value:t}}return{kind:"thread",body:{kind:"richtext",content:[e.p(e.error("Unsupported "+t.kind,t))]},display_mode:{body:"visible",comments:"collapsed"},layout:"error",default_collapsed:!1,actions:[],raw_value:t,link:"no"}}function ne(e,t,r){return{kind:"load_more",load_more:te.encode({kind:"context",subreddit:e,link_id:t,parent_id:r}),url:"/r/"+e+"/comments/"+t+"?comment="+r.replace("t1_","")+"&context=8",raw_value:[e,t,r]}}function oe(t,r={},i){try{return function(t,r={},i){var n,o,d;if(null!=r.force_expand||(r.force_expand="closed"),"t1"===t.kind){const o=t.data;return{kind:"thread",body:he(o),display_mode:{body:"visible",comments:"visible"},raw_value:t,link:A(o.permalink,{context:"3",sort:i.sort}),layout:"reddit-comment",info:{time:1e3*o.created_utc,edited:!1!==o.edited&&1e3*o.edited,author:ce(o,y(null!=(n=o.all_awardings)?n:[])),pinned:o.pinned||o.stickied||!1},actions:[le(o.name),{kind:"link",text:"Permalink",url:o.permalink?A(o.permalink,{context:"3",sort:i.sort}):"Error no permalink"},de(o.name),ue(o.name,o.saved),se(o.name,o.subreddit),...i.is_chat?[]:[re(o)],be(o.body)],default_collapsed:o.collapsed,replies:[...o.locked?[{kind:"thread",body:{kind:"richtext",content:[e.p(e.txt("This comment is locked.")),e.p(e.txt("Only moderators are able to comment on this thread."))]},display_mode:{body:"visible",comments:"collapsed"},raw_value:o.locked,link:"no",actions:[],default_collapsed:!1,layout:"reddit-post"}]:[],...o.replies?o.replies.data.children.map((e=>oe(e,r,pe(i,o.permalink)))):[]]}}if("t3"===t.kind){const e=t.data,i=null!=e.removed_by_category?(null!=(o=ke[e.removed_by_category])?o:ke.unsupported)(e.removed_by_category,e.subreddit_name_prefixed):void 0,n=e.name.substring(3);e.mod_reports.length,e.user_reports.length;const a=_e(e);return{kind:"thread",title:{text:e.title},flair:we(e),body:null!=i?{kind:"removed",removal_message:i,fetch_path:me.encode({path:"https://api.pushshift.io/reddit/submission/search?ids="+n}),body:a}:a,display_mode:"crosspost"===r.force_expand?{body:"visible",comments:"collapsed"}:{body:"collapsed",body_default:r.force_expand,comments:"collapsed"},raw_value:t,link:e.permalink,thumbnail:fe(e,r.force_expand),layout:"reddit-post",info:{time:1e3*e.created_utc,edited:!1!==e.edited&&1e3*e.edited,author:ce(e,[]),in:{link:"/"+e.subreddit_name_prefixed,name:e.subreddit_name_prefixed},pinned:e.stickied||!1},actions:[...null!=(d=r.show_post_reply_button)&&d?[le(e.name)]:[],{kind:"link",url:e.permalink,text:e.num_comments.toLocaleString()+" comment"+(1===e.num_comments?"":"s")},{kind:"link",url:"/domain/"+e.domain,text:e.domain},de(e.name),ue(e.name,e.saved),re(e),{kind:"link",url:e.permalink.replace("/comments/","/duplicates/"),text:"Duplicates"},se(e.name,e.subreddit)],default_collapsed:!1}}if("more"===t.kind){const e=t.data;if(0===e.children.length)return{kind:"load_more",load_more:te.encode({kind:"parent_permalink",permalink:i.permalink}),url:i.permalink,count:void 0,raw_value:t};if(null==r.link_fullname)throw new Error("!options.link_fullname");return{kind:"load_more",load_more:te.encode({kind:"api_loadmore",link_fullname:r.link_fullname,children:e.children,parent_permalink:i}),url:i.permalink,count:e.children.length,raw_value:t}}return{kind:"thread",title:{text:"unsupported listing kind "+t.kind},body:{kind:"text",content:"unsupported",markdown_format:"none"},display_mode:{body:"collapsed",comments:"collapsed"},raw_value:t,link:"TODO no link",layout:"error",actions:[],default_collapsed:!1}}(t,r,i)}catch(n){return console.log(n),{kind:"thread",body:{kind:"richtext",content:[e.p(e.error("Error! "+n.toString(),n))]},display_mode:{body:"visible",comments:"visible"},raw_value:{error:n,listing:t},link:"Error!",layout:"error",actions:[],default_collapsed:!1}}}function de(e){return{kind:"delete",data:v(e)}}const ae=d("report");function se(e,t){return{kind:"report",data:ae.encode({subreddit:t,fullname:e})}}function le(e){return{kind:"reply",text:"Reply",reply_info:Ce.encode({parent_id:e})}}function ue(e,t){return{kind:"counter",unique_id:`/save/${e}/`,time:Date.now(),label:"Save",incremented_label:"Unsave",style:"action-button",incremented_style:"save-button-saved",count_excl_you:"none",you:t?"increment":void 0,actions:{increment:N.encode({kind:"save",fullname:e,direction:""}),reset:N.encode({kind:"save",fullname:e,direction:"un"})}}}function ce(e,t){var r;return function(e){var t,r,i;const n={admin:"text-red-500",moderator:"text-green-500",unsupported:"text-red-500"};return{color_hash:e.author,name:e.author,link:"/u/"+e.author,flair:[...g(e.flair_bits),...e.is_submitter?ge([{elems:[{kind:"text",text:"«OP»"}],content_warning:!1,system:"text-blue-500"}]):[],...null!=(t=e.author_cakeday)&&t?ge([{elems:[{kind:"text",text:"«🍰»"}],content_warning:!1,system:"text-gray-500"}]):[],...null!=e.distinguished?ge([{elems:[{kind:"text",text:"«"+e.distinguished+"»"}],content_warning:!1,system:null!=(r=n[e.distinguished])?r:n.unsupported}]):[],...null!=(i=e.additional_flairs)?i:[]],pfp:null!=e.pfp&&""!==e.pfp?{url:e.pfp,hover:e.pfp}:void 0}}({author:e.author,flair_bits:{type:e.author_flair_type,text:e.author_flair_text,text_color:e.author_flair_text_color,background_color:e.author_flair_background_color,richtext:e.author_flair_richtext},additional_flairs:t,distinguished:e.distinguished,is_submitter:"is_submitter"in e&&(null!=(r=e.is_submitter)&&r),author_cakeday:e.author_cakeday,pfp:e.profile_img})}const me=d("fetch_removed_path");function pe(e,t){return{permalink:A(t,{sort:e.sort}),sort:e.sort,is_chat:e.is_chat}}const ke={anti_evil_ops:()=>({short:"Anti-Evil Operations",title:"Removed by Reddit's Anti-Evil Operations",body:"For violations of reddit's Content Policy: https://reddit.com/help/contentpolicy"}),community_ops:()=>({short:"Community Operations",title:"Sorry, this post was removed by Reddit's Community team.",body:"It's rare, but Reddit's Community Team will occasionally remove posts from feeds to keep communities safe and civil."}),legal_operations:()=>({short:"Legal Operations",title:"This post was removed for legal reasons",body:"«TODO fill this»"}),copyright_takedown:()=>({short:"Copyright Takedown",title:"Removed for Copyright Infringement",body:"«TODO fill this»"}),reddit:()=>({short:"Spam Filters",title:"Sorry, this post was removed by Reddit's spam filters.",body:"Reddit's automated bots frequently filter posts it thinks might be spam."}),author:()=>({short:"Author",title:"Removed by the author",body:"The author of this post decided to remove it."}),deleted:()=>({short:"Author",title:"Deleted by the author",body:"The author of this post decided to delete it."}),moderator:(e,t)=>({short:"Moderators",title:"Removed by moderators of "+t,body:"Moderators of "+t+" decided to remove this post, likely due to a violation of the subreddit rules."}),automod_filtered:()=>({short:"Filtered by AutoModerator",title:"This post was filtered by AutoModerator",body:"«TODO fill this»"}),unsupported:e=>({short:e,title:"This post was removed for «"+e+"»",body:"ThreadClient does not know what that means."})};function be(t){return{kind:"code",body:{kind:"richtext",content:[e.pre(t,"markdown")]}}}function he(e){var t;let r;"[deleted]"===e.author&&(JSON.stringify(e.rtjson)===JSON.stringify({document:[{c:[{e:"text",t:"[deleted]"}],e:"par"}]})?r=ke.deleted("deleted",e.subreddit_name_prefixed):JSON.stringify(e.rtjson)===JSON.stringify({document:[{c:[{e:"text",t:"[removed]"}],e:"par"}]})&&(r=ke.moderator("moderator",e.subreddit_name_prefixed)));const i={kind:"richtext",content:T(e.rtjson,{media_metadata:null!=(t=e.media_metadata)?t:{}})};return null!=r?{kind:"removed",removal_message:r,fetch_path:me.encode({path:"https://api.pushshift.io/reddit/comment/search?ids="+e.id}),body:i}:i}function _e(e){var t,r,i;if(e.crosspost_parent_list&&1===e.crosspost_parent_list.length)return{kind:"crosspost",source:oe({kind:"t3",data:e.crosspost_parent_list[0]},{force_expand:"crosspost"},pe({permalink:e.permalink,sort:"unsupported",is_chat:!1},e.permalink))};if(e.is_self)return{kind:"array",body:[e.rtjson.document.length?{kind:"richtext",content:T(e.rtjson,{media_metadata:null!=(t=e.media_metadata)?t:{}})}:e.url==="https://www.reddit.com"+e.permalink?{kind:"none"}:{kind:"link",url:e.url,embed_html:null==(r=e.media_embed)?void 0:r.content},e.poll_data?{kind:"poll",votable:"Cannot vote",total_votes:e.poll_data.total_vote_count,choices:e.poll_data.options.map((e=>{var t;return{name:e.text,votes:null!=(t=e.vote_count)?t:"hidden",id:e.id}})),vote_data:"",select_many:!1,your_votes:null!=e.poll_data.user_selection?[{id:e.poll_data.user_selection}]:[],close_time:e.poll_data.voting_end_timestamp}:void 0]};if(e.gallery_data)return{kind:"gallery",images:e.gallery_data.items.map((t=>{if(!e.media_metadata)throw new Error("missing media metadata");const r=e.media_metadata[t.media_id];if(!r)throw new Error("missing mediameta for "+t.media_id);return E(r,t.caption)}))};if(e.rpan_video)return{kind:"video",source:{kind:"video",sources:[{url:e.rpan_video.hls_url}]},gifv:!1};if(e.preview&&1===e.preview.images.length){const t=e.preview.images[0];if(t.variants.mp4){const e=t.variants.mp4,r=[...e.resolutions,e.source].sort(((e,t)=>t.width-e.width)).map((e=>({url:e.url,quality:e.width+"×"+e.height})));return{kind:"video",source:{kind:"video",sources:r,preview:[...r].reverse()},gifv:!0}}if(e.preview.enabled)return{kind:"captioned_image",url:t.source.url,w:t.source.width,h:t.source.height}}return{kind:"link",url:e.url,embed_html:null==(i=e.media_embed)?void 0:i.content}}function fe(e,t){var r,i,n,o,d,a;if("crosspost"!==t)return null!=(null==(d=null==(o=null==(n=null==(i=null==(r=e.preview)?void 0:r.images)?void 0:i[0])?void 0:n.resolutions)?void 0:o[0])?void 0:d.url)?{kind:"image",url:e.preview.images[0].resolutions[0].url}:e.rpan_video?{kind:"image",url:e.rpan_video.scrubber_media_url}:null!=e.thumbnail&&""!==e.thumbnail?e.thumbnail.includes("/")?{kind:"image",url:e.thumbnail}:{kind:"default",thumb:null!=(a=ge({self:"self",default:"default",image:"image",spoiler:"spoiler",nsfw:"nsfw",account:"account"})[e.thumbnail])?a:"error"}:{kind:"default",thumb:"default"}}function we(e){var t;const r=[];return r.push(...g({type:e.link_flair_type,text:e.link_flair_text,text_color:e.link_flair_text_color,background_color:e.link_flair_background_color,richtext:e.link_flair_richtext})),e.spoiler&&r.push({elems:[{kind:"text",text:"Spoiler"}],content_warning:!0}),e.over_18&&r.push({elems:[{kind:"text",text:"NSFW"}],content_warning:!0}),e.is_original_content&&r.push({elems:[{kind:"text",text:"OC"}],content_warning:!1}),r.push(...y(null!=(t=e.all_awardings)?t:[])),!0===e.approved&&r.push({elems:[{kind:"text",text:"✓ Approved"}],content_warning:!1,system:"text-green-500"}),r}const ge=e=>e;function ye(){const e="undefined"!=typeof location?location.host:"NOSTATE",t=["account","creddits","edit","flair","history","identity","livemanage","modconfig","modcontributors","modflair","modlog","modmail","modothers","modposts","modself","modwiki","mysubreddits","privatemessages","read","report","save","structuredstyles","submit","subscribe","vote","wikiedit","wikiread"].join(" ");return"raw!https://www.reddit.com/api/v1/authorize?"+r({client_id:f,response_type:"code",state:e,redirect_uri:w,duration:"permanent",scope:t})}async function xe(e){if("homepage"===e.kind)return{sidebar:null};if("userpage"===e.kind)return{sidebar:null};if("mod"===e.kind)return{sidebar:null};if("subreddit"===e.kind){const[t,r]=await Promise.all([Ie("/r/"+e.subreddit+"/api/widgets",{method:"GET",onerror:e=>{},cache:!0}),Ie("/r/"+e.subreddit+"/about",{method:"GET",onerror:e=>{},cache:!0})]),i={subreddit:e.subreddit,sub_t5:null!=r?r:null,widgets:null!=t?t:null};return{sidebar:L(i),header:W(i)}}if("multireddit"===e.kind){const[t]=await Promise.all([Ie("/"+["api","multi",...e.base].join("/"),{method:"GET",onerror:e=>{},cache:!0})]);return{sidebar:t?ve(t):null}}Ee(e)}function ve(t){const r=t.data;return[{kind:"widget",title:r.display_name,raw_value:t,widget_content:{kind:"body",body:{kind:"array",body:[{kind:"richtext",content:[e.p(e.txt("Curated by "),e.link("/u/"+r.owner,{is_user_link:r.owner.toLowerCase()},e.txt("u/"+r.owner))),e.p(e.txt("Created "),e.timeAgo(1e3*r.created_utc))]},{kind:"text",content:r.description_md,markdown_format:"reddit"}]}},actions_bottom:[{kind:"link",text:"Create a copy",url:"TODO"}]},{kind:"widget",title:"Subreddits ("+r.subreddits.length+")",raw_value:r.subreddits,widget_content:{kind:"list",items:r.subreddits.map((e=>({name:{kind:"text",text:"r/"+e.name},click:{kind:"link",url:"/r/"+e.name}})))}}]}function Ne(e){const t=e.banner_background_image||e.banner_img||"",r=e.community_icon||e.icon_img||"";return{banner:t?{desktop:t}:null,icon:r?{url:r}:null}}function Te(t,r,i){const n=[];return(null==t?void 0:t.data)?n.push({kind:"bio",...Ne(t.data.subreddit),name:{display:t.data.name,link_name:"u/"+t.data.name},menu:null,raw_value:t,body:{kind:"text",content:t.data.subreddit.public_description,markdown_format:"reddit"},subscribe:{kind:"counter",unique_id:"/follow/"+t.data.name+"/",time:Date.now(),label:"Follow",incremented_label:"Following",style:"pill-filled",incremented_style:"pill-empty",count_excl_you:t.data.is_friend?t.data.subreddit.subscribers-1:t.data.subreddit.subscribers,you:t.data.is_friend?"increment":void 0,actions:{error:"TODO implement add friend"}}},{kind:"widget",title:"About",widget_content:{kind:"body",body:{kind:"richtext",content:[e.h1(e.link("/u/"+t.data.name,{is_user_link:t.data.name},e.txt(t.data.name))),e.p(e.txt(t.data.link_karma+" post karma")),e.p(e.txt(t.data.comment_karma+" comment karma")),e.p(e.txt("Account created "),e.timeAgo(1e3*t.data.created_utc))]}},raw_value:t}):n.push({kind:"widget",title:"TODO",widget_content:{kind:"body",body:{kind:"richtext",content:[e.p(e.txt("Failed to fetch user info for this user :("))]}},raw_value:t}),(null==i?void 0:i.data)?n.push({kind:"widget",title:"Moderates",raw_value:i,widget_content:{kind:"list",items:i.data.map((e=>({icon:e.community_icon||e.icon_img||"undefined",name:{kind:"text",text:e.sr_display_name_prefixed},click:{kind:"link",url:e.url}})))}}):i||n.push({kind:"widget",title:"TODO",widget_content:{kind:"body",body:{kind:"richtext",content:[e.p(e.txt("Failed to fetch modded subs for this user :("))]}},raw_value:i}),(null==r?void 0:r.data)?n.push({kind:"widget",title:"Trophy Case",widget_content:{kind:"body",body:{kind:"richtext",content:[...r.data.trophies.map((({data:t})=>{const r=[...null!=t.url?[e.p(e.link(t.url,{},e.txt(t.url)))]:[],...null!=t.description?[e.p(e.txt(t.description))]:[]];return{kind:"body",body:{kind:"crosspost",source:{kind:"thread",title:{text:t.name},body:r.length?{kind:"richtext",content:r}:{kind:"none"},thumbnail:{kind:"image",url:t.icon_70},display_mode:{body:"collapsed",comments:"collapsed",body_default:"closed"},raw_value:t,link:t.icon_70,layout:"reddit-post",info:{time:null!=t.granted_at&&1e3*t.granted_at,edited:!1,pinned:!0},actions:[],default_collapsed:!1}}}}))]}},raw_value:t}):n.push({kind:"widget",title:"TODO",widget_content:{kind:"body",body:{kind:"richtext",content:[e.p(e.txt("Failed to fetch trophy case for this user :("))]}},raw_value:r}),n}function Oe(e){let t=H.parse(e);for(let r=0;"redirect"===t.kind&&r<100;r++)e=t.to,t=H.parse(e);return[t,e]}const Se={id:"reddit",async getPage(e){const t=new Map;try{const[i,n]=Oe(e);let o;if(console.log("PARSED URL:",i),"comments"===i.kind)o="/comments/"+i.post_id_unprefixed+"?"+r({sort:i.sort_override,comment:i.focus_comment,context:i.context});else if("duplicates"===i.kind)o="/duplicates/"+i.post_id_unprefixed+"?"+r({after:i.after,before:i.before,sort:i.sort,crossposts_only:""+i.crossposts_only});else if("subreddit"===i.kind)o="/"+[...i.sub.base,i.current_sort.v].join("/")+"?"+r({t:i.current_sort.t,before:i.before,after:i.after});else{if("wiki"!==i.kind)throw new Error("TODO "+i.kind);o="/"+[...i.sub.base,"wiki",...i.path].join("/")+"?"+r(i.query)}return{pivot:s(t,n,i,await Ie(o,{method:"GET"}))}}catch(i){const e=i;throw console.log(e),new Error("Error. If you're on firefox, try disabling Advanced Tracker Protection for this site. Also, try going to v1 in settings (v2 is WIP and incomplete). "+e.toString()+"\n"+e.stack)}},async getThread(t){try{const[i,n]=Oe(t);if(console.log("PARSED URL:",i),"comments"===i.kind){const e="/comments/"+i.post_id_unprefixed+"?"+r({sort:i.sort_override,comment:i.focus_comment,context:i.context}),[t,o]=await Promise.all([Ie(e,{method:"GET"}),xe(i.sub)]);return z(n,i,t,{...o})}if("duplicates"===i.kind){const e="/duplicates/"+i.post_id_unprefixed+"?"+r({after:i.after,before:i.before,sort:i.sort,crossposts_only:""+i.crossposts_only}),[t,o]=await Promise.all([Ie(e,{method:"GET"}),xe(i.sub)]);return z(n,i,t,{...o})}if("subreddit"===i.kind){const e="/"+[...i.sub.base,i.current_sort.v].join("/")+"?"+r({t:i.current_sort.t,before:i.before,after:i.after}),[t,o]=await Promise.all([Ie(e,{method:"GET"}),xe(i.sub)]);return z(n,i,t,{...o})}if("wiki"===i.kind){const e="/"+[...i.sub.base,"wiki",...i.path].join("/")+"?"+r(i.query),[t,o]=await Promise.all([Ie(e,{method:"GET"}),xe(i.sub)]);return z(n,i,t,{...o})}if("user"===i.kind){const e=n,[t,r,o,d]=await Promise.all([Ie(e,{method:"GET"}),Ie("/user/"+i.username+"/about",{method:"GET",onerror:e=>{},cache:!0}),Ie("/api/v1/user/"+i.username+"/trophies",{method:"GET",onerror:e=>{},cache:!0}),Ie("/user/"+i.username+"/moderated_subreddits",{method:"GET",onerror:e=>{},cache:!0})]);return z(n,i,t,{sidebar:Te(r,o,d)})}if("inbox"===i.kind)if("compose"===i.current.tab);else if("mod"===i.current.tab);else if("message"===i.current.tab);else{if("inbox"===i.current.tab){const e="/message/"+i.current.inbox_tab;return z(n,i,await Ie(e,{method:"GET"}),{sidebar:null})}"sent"===i.current.tab||Ee(i.current)}else{if("link_out"===i.kind)return{title:"LinkOut",navbar:F(),body:{kind:"one",item:{parents:[{kind:"thread",body:{kind:"richtext",content:[e.h1(e.link(i.out,{},e.txt("View on reddit.com"))),e.p(e.txt("ThreadClient does not support this URL"))]},display_mode:{comments:"visible",body:"visible"},link:n,raw_value:i,layout:"reddit-post",actions:[],default_collapsed:!1}],replies:[]}},display_style:"comments-view"};if("todo"===i.kind){return z(n,i,await Ie(i.path,{method:"GET",onerror:e=>({kind:"unsupported",extra:{title:e.message,stack:e.stack,console:e}})}),{sidebar:[{kind:"widget",title:"TODO",widget_content:{kind:"body",body:{kind:"richtext",content:[e.p(e.txt("This page "),e.code(n),e.txt(" is not supported (yet)")),e.p(e.txt(i.msg))]}},raw_value:i}]})}if("raw"===i.kind){return V(n,await Ie(i.path,{method:"GET"}),{sidebar:[{kind:"widget",title:"Raw",widget_content:{kind:"body",body:{kind:"richtext",content:[e.p(e.txt("This is a raw page.")),e.p(e.link(i.path,{},e.txt("View Rendered")))]}},raw_value:i}]})}if("redirect"===i.kind)return{title:"LinkOut",navbar:F(),body:{kind:"one",item:{parents:[{kind:"thread",body:{kind:"richtext",content:[e.h1(e.txt("Error! Redirect Loop")),e.p(e.txt("ThreadClient tried to redirect over 100 times.")),e.p(e.txt("Path: "),e.code(n),e.error("Code",i))]},display_mode:{comments:"visible",body:"visible"},link:n,raw_value:i,layout:"reddit-post",actions:[],default_collapsed:!1}],replies:[]}},display_style:"comments-view"};Ee(i)}return V(n,i,{sidebar:[{kind:"widget",title:"TODO",widget_content:{kind:"body",body:{kind:"richtext",content:[e.p(e.txt("This page "),e.code(n),e.txt(" is not supported (yet)")),e.p(e.txt(i.kind)),e.p(e.txt("View it on "),e.link("raw!https://reddit.com"+n,{},e.txt("reddit.com")),e.txt("."))]}},raw_value:i}]})}catch(i){const e=i;console.log(e);const r=e.toString().includes("NetworkError");return{title:"Error",navbar:F(),body:{kind:"one",item:{parents:[{kind:"thread",title:{text:"Error"},body:{kind:"text",content:`Error ${e.toString()}`+(r?". If you're using Firefox, try disabling 'Enhanced Tracker Protection'  for this site. Enhanced tracker protection indiscriminately blocks all  requests to social media sites, including Reddit.":"."),markdown_format:"none"},display_mode:{body:"visible",comments:"collapsed"},link:t,layout:"error",actions:[],default_collapsed:!1,raw_value:{}}],replies:[]}},display_style:"comments-view"}}},async login(e,t){const i=t.get("code"),n=t.get("state");if(null==i||null==n)throw new Error("No login requested");if(n!==location.host)throw new Error("Login was for "+n);const o=await fetch("https://www.reddit.com/api/v1/access_token",{method:"POST",mode:"cors",credentials:"omit",headers:{Authorization:"Basic "+btoa(f+":"),"Content-Type":"application/x-www-form-urlencoded"},body:r({grant_type:"authorization_code",code:i,redirect_uri:w})}).then((e=>e.json()));if(o.error)throw console.log(o.error),new Error("error "+o.error);const d={access_token:o.access_token,refresh_token:o.refresh_token,expires:Date.now()+1e3*o.expires_in,scope:o.scope};console.log(o,d),localStorage.setItem("reddit-secret",JSON.stringify(d))},async fetchRemoved(e){const t=me.decode(e),[r,i]=await fetch(t.path).then((async e=>[e.status,await e.text()])),n=JSON.parse(i.split("&lt;").join("<").split("&gt;").join(">").split("&amp;").join("&"));if(200!==r)throw console.log(r,n),new Error("Got status "+r);if(0===n.data.length)throw console.log(r,n),new Error("Post was deleted before it could be saved:.");const o=n.data[0];if("[deleted]"===o.selftext||"[removed]"===o.selftext||"[deleted]"===o.body||"[removed]"===o.body)throw new Error("Post was deleted before it could be saved.");if(o.selftext)return{kind:"text",content:o.selftext,markdown_format:"reddit"};if(o.body)return{kind:"text",content:o.body,markdown_format:"reddit"};throw new Error("no selftext or body")},async act(e){const t=N.decode(e);if("vote"===t.kind){const e=await Ie("/api/vote",{method:"POST",mode:"urlencoded",body:t.query});console.log(e)}else if("delete"===t.kind){const e=await Ie("/api/del",{method:"POST",mode:"urlencoded",body:{id:t.fullname}});console.log(e)}else if("save"===t.kind){const e=await Ie("/api/"+t.direction+"save",{method:"POST",mode:"urlencoded",body:{id:t.fullname}});console.log(e)}else if("subscribe"===t.kind){const e=await Ie("/api/subscribe",{method:"POST",mode:"urlencoded",body:{action:t.direction,sr_name:t.subreddit}});console.log(e)}else if("mark_read"===t.kind){const e=await Ie("/api/"+t.direction+"read_message/",{method:"POST",mode:"urlencoded",body:{id:t.fullname},override:!0});console.log(e)}else"log_out"===t.kind?localStorage.removeItem("reddit-secret"):De(t)},previewReply(e,t){Ce.decode(t);return{kind:"legacy",thread:{kind:"thread",body:{kind:"text",content:e,markdown_format:"reddit"},display_mode:{body:"visible",comments:"visible"},raw_value:[e,t],link:"no link",layout:"reddit-comment",info:{time:Date.now(),edited:!1,author:{name:"TODO You",color_hash:"TODO You",link:"/u/TODO You"},pinned:!1},actions:[{kind:"counter",special:"reddit-points",unique_id:null,time:Date.now(),label:"Vote",incremented_label:"Voted",decremented_label:"Voted",count_excl_you:0,you:"increment",percent:1,actions:{error:"reply not posted"}}],default_collapsed:!1}}},async sendReply(e,t){const r=Ce.decode(t),i=[];for(let a=0;a<=7;a++){if(4===a)continue;if(7===a)continue;const e="Testing 1<<"+a;i.push({e:"par",c:[{e:"text",t:e,f:[[1<<a,0,7],[64,8,e.length]]}]})}const n={document:i},o={api_type:"json",thing_id:r.parent_id,return_rtjson:"true",..."richtext_demo"===e?{richtext_json:JSON.stringify(n)}:{text:e}},d=await Ie("/api/comment",{method:"POST",mode:"urlencoded",body:o});if("json"in d){const e=d.json.errors.map((e=>"["+e[0]+"]: "+e[1]+" (in "+e[2]+")")).join("\n");throw console.log(e,d),new Error(e)}return console.log(d),oe({kind:"t1",data:d},{},{permalink:"TODO",sort:"unsupported",is_chat:!1})},async fetchReportScreen(e){const t=ae.decode(e),[r,i]=await Promise.all([await Ie("/r/"+t.subreddit+"/about/rules",{method:"GET",cache:!0}),await Ie("/r/"+t.subreddit+"/about",{method:"GET",cache:!0})]),n=t.fullname.startsWith("t1_")?"comment":t.fullname.startsWith("t3_")?"link":"unsupported",o=[],d=[];for(const a of r.rules){if("link"===a.kind){if("link"!==n)continue}else if("comment"===a.kind){if("comment"!==n)continue}else"all"===a.kind||S(a.kind);d.push({title:a.violation_reason,description:{kind:"text",content:a.description,markdown_format:"reddit"},report:{kind:"submit",data:je.encode({fullname:t.fullname,subreddit:t.subreddit,reason:{kind:"sub",id:a.short_name}})}})}if(i.data.free_form_reports){const e=100;d.push({title:"Custom Reason",report:{kind:"textarea",input_title:"Custom Reason",char_limit:e,data:je.encode({fullname:t.fullname,subreddit:t.subreddit,reason:{kind:"sub_other"},text_max:e})}})}o.push({title:"r/"+t.subreddit+"'s rules",report:{kind:"more",screens:d}});for(const a of r.site_rules_flow)o.push(Pe(t,a));return o},async sendReport(e,t){const r=je.decode(e);if(console.log(r,t),null==r.text_max){if(null!=t)throw new Error("never. got text in non-textual entry?")}else{if(null==t)throw new Error("never. missing text");if(t.length>r.text_max)throw new Error("report text too long (max "+r.text_max+")")}if("sub_other"===r.reason.kind&&null==t)throw new Error("never. missing text on sub_other");const i=await Ie("/api/report",{method:"POST",mode:"urlencoded",body:{sr_name:r.subreddit,thing_id:r.fullname,..."sub"===r.reason.kind?{rule_reason:r.reason.id}:"site"===r.reason.kind?{site_reason:r.reason.id,custom_text:null==t?void 0:t}:"sub_other"===r.reason.kind?{reason:t}:Ee(r.reason)}});if(console.log("GOT Response:",i),!0!==i.success)throw console.log(i),new Error("Got error response, check console");return{title:"sub_other"===r.reason.kind?"Report Sent!":r.reason.id,body:null!=t?{kind:"text",content:t,markdown_format:"none"}:{kind:"none"}}},async loadMore(e){var t;const r=te.decode(e);if("api_loadmore"===r.kind){const e=r.children,i="/api/morechildren?api_type=json&limit_children=false&children="+e.splice(0,100).join(",")+"&link_id="+encodeURIComponent(r.link_fullname)+"&sort="+r.parent_permalink.sort,n=await Ie(i,{method:"GET"});if(n.json.errors.length>0)throw console.log("got errors",n),new Error("Got errors: "+n.json.errors.join(", "));const o=[],d=new Map;for(const r of n.json.data.things){d.set(r.data.name,r);const e=d.get(r.data.parent_id);if(e){if("t1"!==e.kind)throw new Error("expected t1 here");(t=e.data).replies||(t.replies={kind:"Listing",data:{before:null,children:[],after:null}}),e.data.replies.data.children.push(r)}else o.push(r)}const a=o.map((e=>oe(e,{link_fullname:r.link_fullname},r.parent_permalink)));if(e.length>0){const t=a[a.length-1];if(t&&"load_more"===t.kind){const r=te.decode(t.load_more);if("api_loadmore"!==r.kind)throw new Error("bad (this is not good)");r.children=[...e,...r.children],t.load_more=te.encode(r)}else a.push({kind:"load_more",load_more:te.encode({kind:"api_loadmore",link_fullname:r.link_fullname,children:e,parent_permalink:r.parent_permalink}),url:r.parent_permalink.permalink,raw_value:e})}return a}if("parent_permalink"===r.kind){const e=await Ie(r.permalink,{method:"GET"}),[t,i]=Oe(r.permalink);if("comments"!==t.kind)throw new Error("bad link to parent_permalink: "+t.kind);const n=z(i,t,e,{sidebar:null});if("one"===n.body.kind)return n.body.item.replies;throw console.log("Error",n),new Error("todo support load more returning other body ("+n.body.kind+")")}if("context"===r.kind)throw new Error("TODO load more context");if("duplicates"===r.kind)throw new Error("TODO load more duplicates");Ee(r)},async loadMoreUnmounted(e){const t=ee.decode(e);if("listing"===t.kind){const e=await Ie(t.url,{method:"GET"}),[r,i]=Oe(t.url),n=z(i,r,e,{sidebar:null});if("listing"===n.body.kind)return{children:n.body.items,next:n.body.next};throw console.log("Error",n),new Error("todo support load more returning other body ("+n.body.kind+")")}if("TODO more"===t.kind)throw new Error("TODO more");Ee(t)},async hydrateInbox(e){const t=J.decode(e);if("inbox"===t.kind){const e=await Ie("/message/unread",{method:"GET"}),t=null!=e.data.after?{kind:"minimum",min:e.data.children.length}:e.data.children.length>0?{kind:"exact",value:e.data.children.length}:{kind:"zero"};return{messages:t,url:"zero"===t.kind?"/message/inbox":"/message/unread"}}if("modmail"===t.kind){const e=await Ie("/api/mod/conversations/unread/count",{method:"GET"});return{messages:e.notifications>0?{kind:"exact",value:e.notifications}:{kind:"zero"},url:"/mod/mail/all"}}Ee(t)}};function Ee(e){throw console.log("not never:",e),new Error("Expected never")}function Pe(e,t){var r;let i;if("nextStepReasons"in t)i={kind:"more",screens:t.nextStepReasons.map((t=>Pe(e,t)))};else if("fileComplaint"in t&&!0===t.fileComplaint){const r=t.complaintUrl.replace("%25%28thing%29",encodeURIComponent(e.fullname));i={kind:"more",screens:[{title:t.complaintPageTitle,description:{kind:"text",content:t.complaintPrompt,markdown_format:"none"},report:{kind:"link",url:"raw!"+r,text:t.complaintButtonText}}]}}else if("canWriteNotes"in t&&!0===t.canWriteNotes){const n=null!=(r=t.isAbuseOfReportButton)&&r?250:2e3;i={kind:"textarea",input_title:t.notesInputTitle,char_limit:n,data:je.encode({fullname:e.fullname,subreddit:e.subreddit,text_max:n,reason:{kind:"site",id:t.reasonText}})}}else i="canSpecifyUsernames"in t&&!0===t.canSpecifyUsernames?{kind:"link",url:"raw!https://reddit.com/report",text:"Open Reddit"}:{kind:"submit",data:je.encode({fullname:e.fullname,subreddit:e.subreddit,reason:{kind:"site",id:t.reasonText}})};return{title:t.reasonTextToShow,report:i}}const je=d("send_report"),Re=new Map;async function Ie(e,t){var r,i;try{const n=await async function(){const e=await D();return null==e?"":"Bearer "+e}(),o=function(e,t,r){var i;const[n,o]=q(t);if(!n.startsWith("/"))throw new Error("path didn't start with `/` : `"+t+"`");return null!=(i=r.override)&&i?I(e)+n+o.toString():(o.set("raw_json","1"),o.set("rtj","yes"),o.set("emotes_as_images","true"),o.set("gilding_detail","1"),o.set("profile_img","true"),I(e)+n+".json?"+o.toString())}(!!n,e,{override:t.override}),d={method:t.method,mode:"cors",credentials:"omit",headers:{...n?{Authorization:n}:{},..."POST"===t.method?{"Content-Type":{json:"application/json",urlencoded:"application/x-www-form-urlencoded"}[t.mode]}:{}},..."POST"===t.method?{body:"json"===t.mode?JSON.stringify(t.body):"urlencoded"===t.mode?Object.entries(t.body).flatMap((([e,t])=>null==t?[]:[encodeURIComponent(e)+"="+encodeURIComponent(t)])).join("&"):De(t)}:{}},a=JSON.stringify([o,d]),s=Re.get(a);if(null!=s&&null!=(r=t.cache)&&r)return s;const[l,u]=await fetch(o,d).then((async e=>[e.status,await e.json()]));if(200!==l){if(t.onstatus)return t.onstatus(l,u);throw console.log(l,u),new Error("got status "+l)}return null!=(i=t.cache)&&i&&Re.set(a,u),u}catch(n){if(console.log("Got error",n),t.onerror)return t.onerror(n);throw n}}const Ce=d("reply");function De(e){throw console.log(e),new Error("not unreachable")}export{ce as authorFromPostOrComment,y as awardingsToFlair,Se as client,de as deleteButton,S as expectUnsupported,be as getCodeButton,he as getCommentBody,re as getPointsOn,_e as getPostBody,we as getPostFlair,fe as getPostThumbnail,z as pageFromListing,le as replyButton,se as reportButton,ue as saveButton,pe as sortWrap,A as updateQuery,B as urlNotSupportedYet};
