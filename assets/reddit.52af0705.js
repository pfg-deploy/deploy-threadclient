import{r as o,s as tt,e as w,b as M,c as it,g as rt,d as nt}from"./index.31e50aa2.js";import{e as I}from"./base.50b98d34.js";async function ot(e,t){if(t.kind==="subreddit"){const i=()=>{},[r,n]=await Promise.all([_(`/r/${t.subreddit}/api/widgets`,{method:"GET",onerror:i,cache:!0}),_(`/r/${t.subreddit}/about`,{method:"GET",onerror:i,cache:!0})]),d={subreddit:t.subreddit,sub_t5:n??null,widgets:r??null};return dt(e,d)}else throw new Error("TODO sidebar for "+t.kind)}function dt(e,t){const i=t.widgets,r=l=>{const c=i.items[l];if(!c)throw new Error("bad widget "+l);return c},n=l=>at(e,l,t),d=[...t.sub_t5?[ut(e,t.sub_t5,t.subreddit)]:[],...t.sub_t5?[ct(e,t.sub_t5,t.subreddit,{collapsed:!!i})]:[],...i?i.layout.sidebar.order.map(l=>n(r(l))):[],...i?[n(r(i.layout.moderatorWidget))]:[]];return d.length===0&&d.push(he(e,"Failed to fetch sidebar for this page :(")),{items:d}}function at(e,t,i){try{return lt(e,t,i)}catch(r){return he(e,"Widget errored: "+r.toString())}}function ne(e,t,i){return S(e,{url:null,parent:null,replies:i.replies!=null?{items:i.replies}:null,client_id:a.id,kind:"post",content:t,internal_data:i.internal_data,display_style:"centered"})}function st(e,t,i,r){return ne(e,{kind:"post",title:{text:t},body:i,show_replies_when_below_pivot:!0,collapsible:!1},{internal_data:r})}function lt(e,t,i){if(t.kind==="moderators")return st(e,"Moderators",{kind:"richtext",content:[o.p(o.link(a,"/message/compose?to=/r/"+i.subreddit,{style:"pill-empty"},o.txt("Message the mods"))),o.ul(...t.mods.map(r=>o.li(o.p(o.link(a,"/u/"+r.name,{is_user_link:r.name},o.txt("u/"+r.name)),...Y({type:r.authorFlairType,text:r.authorFlairText,text_color:r.authorFlairTextColor,background_color:r.authorFlairBackgroundColor,richtext:r.authorFlairRichText}).flatMap(n=>[o.txt(" "),o.flair(n)]))))),o.p(o.link(a,"/r/"+i.subreddit+"/about/moderators",{},o.txt("View All Moderators")))]},{internal_data:{widget:t,subinfo:i}});if(t.kind==="subreddit-rules")return ne(e,{kind:"post",title:{text:t.shortName},body:{kind:"none"},show_replies_when_below_pivot:!0,collapsible:!1},{internal_data:{widget:t,subinfo:i},replies:t.data.map((r,n)=>ne(e,{kind:"post",title:{text:n+1+". "+r.shortName},body:{kind:"text",content:r.descriptionHtml,markdown_format:"reddit_html",client_id:a.id},show_replies_when_below_pivot:!0,collapsible:{default_collapsed:!0}},{internal_data:r}))});throw new Error("TODO support sidebar of type: "+t.kind)}function ut(e,t,i){return he(e,"TODO support id card widget")}function ct(e,t,i,{collapsed:r}){return ne(e,{kind:"post",title:{text:"old.reddit sidebar"},body:{kind:"text",client_id:a.id,markdown_format:"reddit_html",content:t.data.description_html},show_replies_when_below_pivot:!0,collapsible:{default_collapsed:r}},{internal_data:{t5:t,subreddit:i}})}function X(...e){console.log(...e)}async function Le(e){const t=new Map,i=Date.now(),r={};try{const[n,d]=re(e);if(console.log("PARSED URL:",n),n.kind==="link_out")return{content:r,pivot:S(r,{kind:"post",client_id:a.id,content:{kind:"post",title:{text:"Not Supported"},body:{kind:"richtext",content:[o.h1(o.link(a,"raw!"+n.out,{},o.txt("View on reddit.com"))),o.p(o.txt("ThreadClient does not support this URL"))]},show_replies_when_below_pivot:!1,collapsible:!1},display_style:"centered",parent:null,replies:null,url:null,internal_data:n})};if(n.kind==="todo")return{content:r,pivot:S(r,{kind:"post",client_id:a.id,content:{kind:"post",title:{text:"Not Supported"},body:{kind:"richtext",content:[o.h1(o.link(a,"raw!https://www.reddit.com"+n.path,{},o.txt("View on reddit.com"))),o.p(o.txt("ThreadClient does not yet support this URL")),o.p(o.txt(n.msg))]},show_replies_when_below_pivot:!1,collapsible:!1},display_style:"centered",parent:null,replies:null,url:null,internal_data:n})};if(n.kind==="raw"){const s=await _(n.path,{method:"GET"});return{content:r,pivot:ee(r,d,s)}}else if(n.kind==="redirect")return{content:r,pivot:S(r,{kind:"post",client_id:a.id,content:{kind:"post",title:{text:"Not Supported"},body:{kind:"richtext",content:[o.h1(o.link(a,"raw!https://www.reddit.com"+d,{},o.txt("View on reddit.com"))),o.p(o.txt("Error! Redirect Loop. ThreadClient tried to redirect more than 100 times."))]},show_replies_when_below_pivot:!1,collapsible:!1},display_style:"centered",parent:null,replies:null,url:null,internal_data:n})};const l=tt(n,{comments:s=>"/comments/"+s.post_id_unprefixed+"?"+w({sort:s.sort_override,comment:s.focus_comment,context:s.context}),duplicates:s=>"/duplicates/"+s.post_id_unprefixed+"?"+w({after:s.after,before:s.before,sort:s.sort,crossposts_only:""+s.crossposts_only}),subreddit:s=>"/"+[...s.sub.base,s.current_sort.v].join("/")+"?"+w({t:s.current_sort.t,before:s.before,after:s.after}),wiki:s=>"/"+[...s.sub.base,"wiki",...s.path].join("/")+"?"+w(s.query),user:()=>d,inbox:()=>d,subreddits:()=>d}),c=await _(l,{method:"GET"});return{content:r,pivot:mt(r,t,d,n,c)}}catch(n){const d=n;console.log(d);const l=d.toString().includes("NetworkError"),c=i>Date.now()-50,s=navigator.userAgent.includes("Firefox");if(l)return{content:r,pivot:S(r,{kind:"post",client_id:a.id,content:{kind:"post",title:{text:"Error Loading Page"},body:{kind:"richtext",content:[...c&&s?[o.h1(o.txt("Firefox Enhanced Tracking Protection may be active")),o.p(o.txt("Try disabling Enhanced Tracking Protection for this site.")),o.ul(o.ili(o.txt("Look at the left side of the URL bar for a shield icon")),o.ili(o.txt("Click it")),o.ili(o.txt("Flip the switch to turn Enhanced Tracking Protection off"))),o.p(o.txt("Enhanced Tracking Protection blocks ThreadClient from sending requests to Reddit, which prevents ThreadClient from functioning.")),o.h2(o.txt("Other things to check:"))]:[o.h1(o.txt("There was a network error loading this page")),o.h2(o.txt("Things to check:"))],o.ul(o.ili(o.txt("Make sure your internet is working")),o.ili(o.txt("Make sure "),o.link(a,"https://www.redditstatus.com/",{},o.txt("Reddit is working"))),o.ili(o.txt("If your browser has tracking protection, try disabling it.")))]},show_replies_when_below_pivot:!1,collapsible:!1},display_style:"centered",parent:null,replies:null,url:null,internal_data:[e,d,{is_networkerror:l,error_was_instant:c,browser_is_firefox:s}]})};throw d}}function S(e,t){const i=Ee("immediate value");return e[i]={data:t},i}function mt(e,t,i,r,n){if(Array.isArray(n)){if(n[0].data.children.length!==1)return ee(e,i,n);const d=n[0].data.children[0];if(d.kind!=="t3")return ee(e,i,n);const l=d.data.name,s=n[1].data.children[0];s&&s.kind==="t1"&&s.data.parent_id;const u=r.kind==="comments"?r.focus_comment:null,m={kind:"subreddit_unloaded",listing:{kind:"Listing",data:{before:null,children:[],after:null}},details:r.kind==="comments"?r.sub:"unknown",missing_replies:!0};W(t,m);let k=W(t,{kind:"post",post:d,replies:n[1],missing_replies:u!=null?!0:void 0});const D=k;if(u!=null){const b="t1_"+u.toLowerCase();t.has(b)?k=b:X("focused comment not found in tree `"+b+"`")}let O=k;for(;O!==D;){const b=t.get(O)?.data;if(b?.kind==="comment")O!==k&&(b.missing_replies=!0),O=b.comment.data.parent_id;else break}return T(e,t,k)}else if(n.kind==="Listing"){const d={kind:"subreddit_unloaded",listing:n,details:r.kind==="subreddit"?r.sub:"unknown"};W(t,d);const l=q(d);return T(e,t,l)}else if(n.kind==="wikipage"){const d={kind:"wikipage",listing:n,pathraw:i};W(t,d);const l=q(d);return T(e,t,l)}else n.kind==="t5"?X("TODO t5"):n.kind==="UserList"?X("TODO userlist"):v(n.kind);return ee(e,i,n)}function Fe(e){if(e.kind==="homepage")return"SR_home";if(e.kind==="mod")return"SR_mod";if(e.kind==="multireddit")return"SR_multi/u:"+e.user.toLowerCase()+"/m:"+e.multireddit.toLowerCase();if(e.kind==="userpage")return"SR_user/"+e.user.toLowerCase();if(e.kind==="subreddit")return"SR_sub/"+e.subreddit.toLowerCase();M(e)}function ee(e,t,i){return S(e,{kind:"post",client_id:a.id,parent:null,url:null,replies:null,content:{kind:"post",title:{text:"Error!"},collapsible:!1,body:{kind:"richtext",content:[...te(t),o.pre(JSON.stringify(i,null,"  "),"json")]},show_replies_when_below_pivot:!1},internal_data:null,display_style:"centered"})}function ye(e,t){const i=Me(e,t);return i?q(i):"__ERROR_FULLNAME__"}function q(e){if(e.kind==="comment")return e.comment.data.name;if(e.kind==="post")return e.post.data.name;if(e.kind==="subreddit_unloaded")return e.details==="unknown"?"__UNKNOWN_LISTING_ROOT":Fe(e.details);if(e.kind==="depth_more")return"DEPTH_MORE_"+e.parent_id;if(e.kind==="more")return"MORE_"+e.item.data.children.join(",");if(e.kind==="wikipage")return"WIKIPAGE_there_should_only_be_one";M(e)}function Me(e,t){if(e.kind==="t1")return{kind:"comment",comment:e};if(e.kind==="t3")return{kind:"post",post:e,replies:"not_loaded"};if(e.kind==="more")if(e.data.children.length===0){if(t==null){console.trace("TODO setUpCommentOrUnmounted was called with not loaded parent but req. parent submission");return}return{kind:"depth_more",item:e,parent_id:t}}else return{kind:"more",item:e};else{e.kind!=="t5"&&v(e.kind),X("TODO setUpCommentOrUnmounted",e.kind,e);return}}function ge(e,t,i){const r=Me(t,i);r!=null&&W(e,r)}function W(e,t){const i=q(t);if(e.get(i))return console.log("Note: Two objects with the same id were created. ID: `"+i+"`"),i;if(t.kind==="comment"){const n=t.comment;if(n.kind==="t1"){const d=n.data;if(d.replies)for(const l of d.replies.data.children)ge(e,l,d.link_id.replace("t3_",""))}else if(n.kind==="more"){if(n.data.name==="t1__")return i}else console.log("TODO setUpMap "+n.kind)}else if(t.kind==="post"){const n=t.post.data;if(n.crosspost_parent_list)for(const d of n.crosspost_parent_list)W(e,{kind:"post",post:{kind:"t3",data:d},replies:"not_loaded"});if(t.replies!=="not_loaded")for(const d of t.replies.data.children)ge(e,d,n.id)}else if(t.kind==="subreddit_unloaded")for(const n of t.listing.data.children)ge(e,n,"not_loaded");else t.kind==="more"||t.kind==="depth_more"||t.kind==="wikipage"||M(t);return e.set(i,{kind:"unprocessed",link:Ee("id: "+i),data:t}),i}function he(e,t,i){const r=Ee("immediate error value");return e[r]={error:t},r}function T(e,t,i){const r=t.get(i);if(!r)return he(e,"post was not found in tree (TODO load more) ("+i+")");if(r.kind==="unprocessed"){r.kind="processing";const n=pt(e,t,r);return e[r.link]={data:n},r.kind="processed",r.link}else{if(r.kind==="processing"||r.kind==="processed")return r.link;M(r.kind)}}function Ie(e){const t=e.data;return{creation_date:t.created_utc*1e3,edited:t.edited?{date:t.edited*1e3}:void 0,pinned:t.pinned||t.stickied||!1,in:e.kind==="t3"?{name:t.subreddit_name_prefixed,link:"/"+t.subreddit_name_prefixed,client_id:a.id}:void 0,comments:e.kind==="t3"?e.data.num_comments:void 0}}function pt(e,t,i){if(i.data.kind==="comment"){const r=i.data.comment,n=r.data,d={reply:{action:ce(n.name),locked:n.locked},items:[]};if(i.data.missing_replies??!1){if(n.replies&&n.replies.data.children.length>0){const s=S(e,{kind:"loader",key:U.encode({kind:"parent_permalink",post_id:n.link_id.replace("t3_",""),parent_id:n.id}),load_count:null,autoload:!0,parent:i.link,replies:null,url:null,client_id:a.id});d.items.push(s)}}else if(n.replies)for(const s of n.replies.data.children)d.items.push(T(e,t,ye(s,n.link_id.replace("t3_",""))));const l=t.get(n.parent_id),c=n.author==="FatFingerHelperBot";return{kind:"post",client_id:a.id,url:x(n.permalink,{context:"3"}),parent:T(e,t,n.parent_id),replies:d,content:{kind:"post",title:null,author:ke(n,Pe(n.all_awardings??[])),body:Ve(n),info:Ie(r),collapsible:{default_collapsed:c||(n.collapsed??!1)},show_replies_when_below_pivot:!0,actions:{vote:l?.data.kind==="post"&&l.data.post.data.discussion_type==="CHAT"?void 0:Q(n),code:Oe(n.body),other:[me(n.name),le(n.name),pe(n.name,n.saved),ue(n.name,n.subreddit)]}},internal_data:i.data,display_style:"centered"}}else if(i.data.kind==="post"){const r=i.data.post,n=r.data;return{kind:"post",client_id:a.id,url:n.permalink,parent:T(e,t,Fe({kind:"subreddit",subreddit:n.subreddit,base:["r",n.subreddit]})),replies:{reply:{action:ce(n.name),locked:n.locked},items:!i.data.missing_replies&&i.data.replies!=="not_loaded"?i.data.replies.data.children.map(d=>T(e,t,ye(d,n.id))):[S(e,{kind:"loader",key:U.encode({kind:"parent_permalink",post_id:n.id,parent_id:null}),autoload:!0,parent:i.link,replies:null,client_id:a.id,url:null,load_count:null})]},content:{kind:"post",title:{text:n.title},collapsible:{default_collapsed:!0},flair:Qe(n),author:ke(n),body:Ye(n),thumbnail:Ke(n,"open"),info:Ie(r),show_replies_when_below_pivot:!1,actions:{vote:Q(n),code:Oe(n.is_self?n.selftext:n.url),other:[{kind:"link",client_id:a.id,url:"/domain/"+n.domain,text:n.domain},le(n.name),pe(n.name,n.saved),{kind:"link",client_id:a.id,url:"/duplicates/"+n.id,text:"Duplicates"},ue(n.name,n.subreddit),me(n.name)]}},internal_data:i.data,display_style:"centered"}}else if(i.data.kind==="subreddit_unloaded"){const r=[];for(const d of i.data.listing.data.children)r.push(T(e,t,ye(d,void 0)));i.data.listing.data.after!=null&&r.push(T(e,t,"TODO next"));const n=i.data.details==="unknown"?null:"/"+i.data.details.base.join("/");return{kind:"post",client_id:a.id,url:n,parent:null,replies:{items:i.data.missing_replies?[S(e,{kind:"loader",key:U.encode({kind:"link_replies",url:n??"@ERROR"}),parent:i.link,replies:null,client_id:a.id,url:null,load_count:null,autoload:!0})]:r},content:{kind:"page",title:q(i.data),wrap_page:{sidebar:{items:i.data.details==="unknown"?[]:[S(e,{kind:"loader",key:U.encode({kind:"sidebar",sub:i.data.details}),parent:i.link,replies:null,client_id:a.id,url:null,load_count:null,autoload:!0})]},header:{kind:"bio",banner:null,icon:null,name:{display:q(i.data),link_name:q(i.data)},body:null,menu:null,raw_value:i}}},internal_data:i.data,display_style:"fullscreen"}}else if(i.data.kind==="depth_more"){const r=i.data.item.data;return{kind:"loader",client_id:a.id,parent:T(e,t,r.parent_id),replies:null,url:null,load_count:null,key:U.encode({kind:"parent_permalink",post_id:i.data.parent_id,parent_id:r.parent_id}),autoload:!1}}else if(i.data.kind==="more"){const r=i.data.item.data;return{kind:"loader",client_id:a.id,parent:T(e,t,r.parent_id),replies:null,url:null,load_count:r.children.length,key:U.encode({kind:"more",data:r}),autoload:!1}}else if(i.data.kind==="wikipage"){const r=i.data.listing,n=i.data.pathraw.substr(i.data.pathraw.lastIndexOf("/")+1);return{kind:"post",client_id:a.id,url:i.data.pathraw,parent:null,replies:null,content:{kind:"post",title:{text:n},collapsible:!1,body:{kind:"text",content:r.data.content_html,client_id:a.id,markdown_format:"reddit_html"},show_replies_when_below_pivot:!1,info:{edited:{date:r.data.revision_date*1e3}},author:At(r.data.revision_by),actions:{other:r.data.may_revise?[{kind:"link",client_id:a.id,text:"Edit",url:"TODO edit wiki page"}]:[]}},internal_data:i.data,display_style:"centered"}}else M(i.data)}const U=I("loader");function Ee(e){return Symbol(e)}async function kt(e,t){let i=U.decode(t.key);i.kind==="parent_permalink"&&(i={kind:"link_replies",url:`/comments/${i.post_id}/comment/${i.parent_id??""}?context=0`});const r=(n,d)=>{const l={kind:"loaded",parent:t.parent,replies:d,url:null,client_id:a.id};return{content:{...n,[e]:{data:l}}}};if(i.kind==="link_replies"){const n=await Le(i.url);return r(n.content,n.content[n.pivot].data.replies)}else{if(i.kind==="more")throw new Error("TODO more");if(i.kind==="vertical")throw new Error("TODO vertical");if(i.kind==="sidebar"){const n={};return r(n,await ot(n,i.sub))}else M(i)}}const oe=new Set(["/","/r/:subredditName/collection/:collectionId","/r/:subredditName/collection/:collectionId/:partialPostId","/r/:subredditName/collection/:collectionId/:partialPostId/:partialCommentId","/r/:subredditName/comments/:partialPostId/:urlSafePostTitle/:partialCommentId","/r/:subredditName/comments/:partialPostId/:urlSafePostTitle?","/r/:subredditName/duplicates/:partialPostId/:urlSafePostTitle?","/user/:subredditName/collection/:collectionId","/user/:subredditName/collection/:collectionId/:partialPostId","/user/:subredditName/collection/:collectionId/:partialPostId/:partialCommentId","/user/:subredditName/comments/:partialPostId/:urlSafePostTitle/:partialCommentId","/user/:subredditName/comments/:partialPostId/:urlSafePostTitle?","/user/:subredditName/duplicates/:partialPostId/:urlSafePostTitle?","","/best","/hot","/new","/rising","/controversial","/top","/gilded","/awarded","/acknowledgements","/appeal","/appeals","/avatar","/avatar/:username","/avatar/:username/:avatarId","/coins","/coins/mobile","/comments/:partialPostId/:urlSafePostTitle/:partialCommentId","/comments/:partialPostId/:urlSafePostTitle?","/community-points/","/community-points/documentation/*","/duplicates/:partialPostId/:urlSafePostTitle?","/econ-management","/explore","/explore/:categoryName","/framedGild/:thingId","/framedModal/:type","/label/subreddits","/me/f/mod","/me/f/mod/awarded","/me/f/mod/best","/me/f/mod/controversial","/me/f/mod/gilded","/me/f/mod/hot","/me/f/mod/new","/me/f/mod/rising","/me/f/mod/top","/me/m/:multiredditName","/me/m/:multiredditName/awarded","/me/m/:multiredditName/best","/me/m/:multiredditName/controversial","/me/m/:multiredditName/gilded","/me/m/:multiredditName/hot","/me/m/:multiredditName/new","/me/m/:multiredditName/rising","/me/m/:multiredditName/top","/me/m/:multiredditName/search","/message/inbox","/message/unread","/message/messages","/message/comments","/message/selfreply","/message/mentions","/message/compose","/message/sent","/message/moderator","/message/messages/:messageId([A-Za-z0-9]+)","/notifications/","/original","/original/:categoryName/:sort([a-z]+)?","/original/submit","/powerup","/powerups","/prediction","/predictions","/premium","/r/:subredditName","/r/:subredditName/awarded","/r/:subredditName/best","/r/:subredditName/controversial","/r/:subredditName/gilded","/r/:subredditName/hot","/r/:subredditName/new","/r/:subredditName/rising","/r/:subredditName/top","/r/:subredditName/about","/r/:subredditName/about/awards","/r/:subredditName/about/powerups","/r/:subredditName/about/muted","/r/:subredditName/about/badges","/r/:subredditName/about/banned","/r/:subredditName/about/chat","/r/:subredditName/about/settings","/r/:subredditName/about/contributors","/r/:subredditName/about/emojis","/r/:subredditName/about/emotes","/r/:subredditName/about/eventposts","/r/:subredditName/about/moderators","/r/:subredditName/about/rules","/r/:subredditName/about/removal","/r/:subredditName/about/modqueue","/r/:subredditName/about/reports","/r/:subredditName/about/spam","/r/:subredditName/about/talkhosts","/r/:subredditName/about/unmoderated","/r/:subredditName/about/edited","/r/:subredditName/about/postflair","/r/:subredditName/about/log","/r/:subredditName/about/flair","/r/:subredditName/about/edit","/r/:subredditName/about/userflair","/r/:subredditName/about/wiki","/r/:subredditName/about/wikicontributors","/r/:subredditName/about/wikibanned","/r/:subredditName/about/traffic","/r/:subredditName/about/scheduledposts","/r/:subredditName/about/broadcasting","/r/:subredditName/about/content","/r/:subredditName/about/predictions","/r/:subredditName/about/wiki/:wikiPageName*","/r/:subredditName/about/wiki/edit/:wikiPageName+","/r/:subredditName/about/wiki/create/:wikiPageName+","/r/:subredditName/about/wiki/settings/:wikiPageName+","/r/:subredditName/about/wiki/revisions/:wikiPageName+","/r/:subredditName/about/wiki/revisions","/r/:subredditName/about/wiki/wikibanned","/r/:subredditName/about/wiki/wikicontributors","/r/:subredditName/predictions","/r/:subredditName/search","/r/:subredditName/submit","/r/:subredditName/w/:wikiPageName*","/r/:subredditName/wiki/","/r/:subredditName/wiki/:wikiPageName+","/r/:subredditName/wiki/edit/:wikiPageName+","/r/:subredditName/wiki/create/:wikiPageName+","/r/:subredditName/wiki/revisions/:wikiPageName+","/r/:subredditName/wiki/revisions","/r/:subredditName/wiki/settings/:wikiPageName+","/r/mod","/r/mod/awarded","/r/mod/best","/r/mod/controversial","/r/mod/gilded","/r/mod/hot","/r/mod/new","/r/mod/rising","/r/mod/top","/r/mod/about","/r/mod/about/edited","/r/mod/about/modqueue","/r/mod/about/reports","/r/mod/about/spam","/r/mod/about/unmoderated","/r/u_:profileName","/r/u_:profileName/:rest(.*)","/report","/rpan/:partialPostId?","/rpan/r/:subredditName/:partialPostId?","/search","/settings","/settings/account","/settings/messaging","/settings/profile","/settings/privacy","/settings/notifications","/settings/feed","/settings/gold","/settings/payments","/settings/premium","/settings/creator","/settings/special","/settings/dsp","/settings/data-request","/submit","/subreddits/leaderboard","/subreddits/leaderboard/:categoryName/","/t/:topicSlug","/talk","/u/:profileName","/u/:profileName/:rest(.*)","/u/me/avatar","/user/:profileName","/user/:profileName/downvoted","/user/:profileName/hidden","/user/:profileName/saved","/user/:profileName/upvoted","/user/:profileName/gilded","/user/:profileName/given","/user/:profileName/about/awards","/user/:profileName/about/edit/moderation","/user/:profileName/avatar","/user/:profileName/comments","/user/:profileName/draft/:draftId","/user/:profileName/followers","/user/:profileName/gilded/given","/user/:profileName/posts","/user/:profileName/snoo","/user/:profileName/submit","/user/:profileName/submitted","/user/:profileName/submitted/:rest(.*)","/user/:username/m/:multiredditName","/user/:username/m/:multiredditName/awarded","/user/:username/m/:multiredditName/best","/user/:username/m/:multiredditName/controversial","/user/:username/m/:multiredditName/gilded","/user/:username/m/:multiredditName/hot","/user/:username/m/:multiredditName/new","/user/:username/m/:multiredditName/rising","/user/:username/m/:multiredditName/top","/user/:username/m/:multiredditName/search","/user/me","/user/me/:rest(.*)","/user/me/avatar","/vault/","/vault/burn","/verification/:verificationToken","/w/:wikiPageName*","/web/community-points/","/web/membership/:subredditName","/web/points-migration/","/web/special-membership/:subredditName","/wiki/","/wiki/:wikiPageName+","inexact|/prefs","inexact|/prefs/deactivate","inexact|/prefs/blocked","inexact|/user/:username/about/edit","inexact|/user/:username/about/edit/privacy"]),f=it(),p=[],y=e=>({kind:"link_out",out:"https://www.reddit.com"+e.path+"?"+w(e.query)}),L=e=>t=>({kind:"todo",path:t.path+"?"+w(t.query),msg:e});f.route(["raw",{path:"rest"}],e=>({kind:"raw",path:"/"+e.path.join("/")+"?"+w(e.query)}));p.push("/acknowledgements");f.route(["acknowledgements"],y);p.push("/appeal");f.route(["appeal"],y);p.push("/appeals");f.route(["appeals"],y);p.push("/avatar");f.route(["appeals"],y);p.push("/coins");f.route(["coins"],y);p.push("/coins/mobile");f.route(["coins","mobile"],y);p.push("/r/u_:profileName","/r/u_:profileName/:rest(.*)");f.route(["r",{user:{kind:"starts-with",text:"u_"}},{remainder:"rest"}],e=>({kind:"redirect",to:"/"+["user",e.user,...e.remainder].join("/")+"?"+w(e.query)}));p.push("/u/:profileName","/u/:profileName/:rest(.*)","/u/me/avatar");f.route(["u",{user:"any"},{remainder:"rest"}],e=>({kind:"redirect",to:"/"+["user",e.user,...e.remainder].join("/")+"?"+w(e.query)}));p.push("/verification/:verificationToken");f.route(["verification",{vtoken:"any"}],y);p.push("/label/subreddits");f.route(["label","subreddits"],y);p.push("/premium");f.route(["premium"],y);p.push("/framedGild/:thingId");f.route(["framedGild",{thing:"any"}],y);p.push("/framedModal/:type");f.route(["framedModal",{type:"any"}],y);p.push("/community-points/","/vault/","/web/community-points/");f.route(["community-points"],y);f.route(["vault"],y);f.route(["web","community-points"],y);function de(e,t){const i=n=>n.multireddit!=null&&n.user!=null?{kind:"multireddit",multireddit:n.multireddit,user:n.user,base:["user",n.user,"m",n.multireddit]}:n.user!=null?{kind:"userpage",user:n.user,base:["user",n.user]}:n.subreddit!=null?{kind:"subreddit",subreddit:n.subreddit,base:["r",n.subreddit]}:{kind:"homepage",base:[]};(t==="home"||t==="subreddit"||t==="user")&&(t==="home"&&p.push("/submit"),t==="subreddit"&&p.push("/r/:subredditName/submit"),t==="user"&&p.push("/user/:profileName/submit"),e.route(["submit"],L("submit post")));const r=["best","hot","new","rising","controversial","top","gilded","awarded"];if(t==="home"&&p.push("","/",...r.map(n=>"/"+n)),t==="subreddit"&&p.push("/r/:subredditName",...r.map(n=>"/r/:subredditName/"+n)),t==="multireddit"&&p.push("/user/:username/m/:multiredditName",...r.map(n=>"/user/:username/m/:multiredditName/"+n)),e.route([{sort:[...r,...t==="user"?[]:[null]]}],n=>({kind:"subreddit",sub:i(n),is_user_page:!1,current_sort:{v:n.sort??"hot",t:n.query.t??"all"},before:n.query.before??null,after:n.query.after??null})),t==="subreddit"||t==="user"||t==="home"){const n=t==="subreddit"?"/r/:subredditName":t==="user"?"/user/:subredditName":t==="home"?"":M(t);p.push(n+"/duplicates/:partialPostId/:urlSafePostTitle?"),e.route(["duplicates",{post_id_unprefixed:"any"},{url_safe_post_title:"optional"}],d=>({kind:"duplicates",sub:i(d),post_id_unprefixed:d.post_id_unprefixed,after:d.query.after??null,before:d.query.before??null,crossposts_only:d.query.crossposts_only==="true",sort:d.query.sort??"num_comments"})),p.push(n+"/comments/:partialPostId/:urlSafePostTitle?"),e.route(["comments",{post_id_unprefixed:"any"},{url_safe_post_title:"optional"}],d=>({kind:"comments",sub:i(d),post_id_unprefixed:d.post_id_unprefixed,focus_comment:d.query.comment??null,sort_override:d.query.sort??null,context:d.query.context??null})),p.push(n+"/comments/:partialPostId/:urlSafePostTitle/:partialCommentId"),e.route(["comments",{post_id_unprefixed:"any"},{url_safe_post_title:"any"},{partial_comment_id:"any"}],d=>({kind:"comments",sub:i(d),post_id_unprefixed:d.post_id_unprefixed,focus_comment:d.partial_comment_id,sort_override:d.query.sort??null,context:d.query.context??null}))}}f.with(["user","me"],e=>{p.push("/user/me/avatar"),e.catchall(L("redirect to current user"))});f.with(["user",{user:"any"}],e=>{p.push("/user/:profileName/avatar"),e.route(["user",{profile_name:"any"},"avatar"],i=>({kind:"redirect",to:"/avatar"})),p.push("/user/:profileName","/user/:profileName/comments","/user/:profileName/submitted","/user/:profileName/submitted/:rest(.*)"),e.route([{tab:["overview","comments","submitted",null]}],i=>({kind:"user",username:i.user,current:{kind:"sorted-tab",tab:i.tab??"overview",sort:{sort:i.query.sort??(i.tab==="submitted"?"hot":"new"),t:i.query.t??"all"}}})),p.push("/user/:profileName/posts"),e.route(["posts"],i=>({kind:"redirect",to:"/user/"+i.user+"/submitted?"+w(i.query)}));const t=["downvoted","hidden","saved","upvoted"];p.push(...[...t,"gilded","given"].map(i=>"/user/:profileName/"+i)),p.push("/user/:profileName/gilded/given"),e.route([{tab:t}],i=>({kind:"user",username:i.user,current:{kind:"unsorted-tab",tab:i.tab}})),e.route(["gilded",{by:["received","given",null]}],i=>({kind:"user",username:i.user,current:{kind:"gild-tab",tab:"gilded",by:i.by??i.query.show??"received"}})),e.route(["given"],i=>({kind:"user",username:i.user,current:{kind:"gild-tab",tab:"gilded",by:"given"}})),p.push("/user/:profileName/snoo"),e.route(["snoo"],L("snoo")),p.push("/user/:profileName/draft/:draftId"),e.route(["draft",{draft_id:"any"}],L("drafts")),p.push("/user/:profileName/about/edit/moderation"),e.route(["about","edit","moderation"],L("user profile moderation settings")),e.with(["m",{multireddit:"any"}],i=>de(i,"multireddit")),de(e,"user")});f.with(["r",{subreddit:"any"}],e=>{p.push("/r/:subredditName/wiki/revisions","/r/:subredditName/wiki/settings/:wikiPageName+","/r/:subredditName/wiki/edit/:wikiPageName+","/r/:subredditName/wiki/create/:wikiPageName+","/r/:subredditName/wiki/revisions/:wikiPageName+","/r/:subredditName/wiki/","/r/:subredditName/w/:wikiPageName*","/r/:subredditName/wiki/:wikiPageName+"),e.with([{w_wiki:["w","wiki"]}],t=>{t.route([{wiki_path:"rest"}],i=>({kind:"wiki",sub:{kind:"subreddit",base:["r",i.subreddit],subreddit:i.subreddit},path:i.wiki_path.length===0?["index"]:i.wiki_path,query:i.query}))}),de(e,"subreddit")});f.route([{w_wiki:["w","wiki"]},{wiki_path:"rest"}],e=>({kind:"wiki",sub:{kind:"homepage",base:[]},path:e.wiki_path,query:e.query}));f.with(["message"],e=>{const t=["inbox","unread","messages","comments","selfreply","mentions"];p.push(...t.map(i=>"/message/"+i)),e.route([{tab:[...t]}],i=>({kind:"inbox",current:{tab:"inbox",inbox_tab:i.tab}})),p.push("/message/compose"),e.route(["compose"],i=>({kind:"inbox",current:{tab:"compose",to:i.query.to,subject:i.query.subject,message:i.query.message}})),p.push("/message/sent"),e.route(["sent"],i=>({kind:"inbox",current:{tab:"sent"}})),p.push("/message/moderator"),e.route(["moderator"],i=>({kind:"inbox",current:{tab:"mod"}})),p.push("/message/messages/:messageId([A-Za-z0-9]+)"),e.route(["messages",{message_id:"any"}],i=>({kind:"inbox",current:{tab:"message",msgid:i.message_id}}))});de(f,"home");f.with(["mod"],e=>{f.catchall(L("not supported"))});f.with(["subreddits"],e=>{e.with(["mine"],t=>{t.route([{tab:[null,"subscriber","contributor","moderator"]}],i=>({kind:"subreddits",value:{tab:"mine",subtab:i.tab??"subscriber"}}))}),e.route([{tab:[null,"new","popular"]}],t=>({kind:"subreddits",value:{tab:t.tab??"popular"}}))});f.catchall(L("not supported"));const ae=[];for(const e of p)oe.has(e)?oe.delete(e):ae.push("\u2022 unknown: "+e);if(oe.size>0)for(const e of oe)ae.push("\u2022 missing: "+e);if(ae.length>0){console.log("reddit router ::");for(const e of ae)console.log(e)}const se="biw1k0YZmDUrjg",Se="https://thread.pfg.pw/login/reddit";function Y(e){if(e.type==null)return[];if(e.type==="text"&&(e.text==null||e.text===""))return[];const t=e.type==="richtext"?(e.richtext??[]).map(r=>r.e==="text"?{kind:"text",text:r.t}:r.e==="emoji"?{kind:"emoji",url:r.u,name:r.a,w:16,h:16}:(v(r.e),{kind:"text",text:"#TODO("+r.e+")"})):e.type==="text"?[{kind:"text",text:e.text}]:[{kind:"text",text:"TODO: "+e.type}],i=t.map(r=>r.kind==="text"?r.text:"").join("");return[{color:e.background_color??void 0,fg_color:e.text_color==="light"?"light":"dark",elems:t,content_warning:i.toLowerCase().startsWith("cw:")||i.toLowerCase().startsWith("tw:")}]}function Pe(e){const t=[];for(const i of e.sort((r,n)=>n.count-r.count)){t.length>0&&t.push({kind:"text",text:" "});const r=i.resized_static_icons[0];t.push({kind:"emoji",url:r.url,w:r.width,h:r.height,name:i.name}),i.count>1&&t.push({kind:"text",text:"\xD7"+i.count})}return t.length===0?[]:[{elems:t,content_warning:!1,system:"none"}]}function xe(e){return P.encode({kind:"vote",query:e})}function _t(e){return P.encode({kind:"delete",fullname:e})}const P=I("act");function Be(e,t){try{return ve(e.document,t)}catch(i){return console.log("Error parsing richtext:",i),[o.p(o.error("Error parsing richtext: "+i,i))]}}function ve(e,t){return e.map(i=>ft(i,t))}function v(e){console.log("Expected unsupported",e)}function Ne(e,t){if(e.status!=="valid")return{thumb:null,aspect:void 0,body:{kind:"richtext",content:[o.p(o.error("Bad Status "+e.status+", "+t,e))]}};if(e.e==="Image"){const i=e.p?.[0]??e.s;return{thumb:i.u??"error",aspect:i.x/i.y,body:{kind:"captioned_image",url:e.s.u,w:e.s.x,h:e.s.y,caption:t}}}if(e.e==="AnimatedImage"){const i=e.p?.[0];return{thumb:i?i.u:"error",aspect:i?i.x/i.y:void 0,body:{kind:"video",source:e.s.mp4!=null?{kind:"video",sources:[{url:e.s.mp4,quality:e.s.x+"\xD7"+e.s.y}]}:{kind:"img",url:e.s.gif},aspect:e.s.x/e.s.y,gifv:!0,caption:t}}}return e.e==="RedditVideo"?{thumb:null,aspect:void 0,body:{kind:"video",source:rt(e.id),aspect:e.x/e.y,gifv:e.isGif??!1,caption:t}}:(v(e.e),{thumb:null,aspect:void 0,body:{kind:"richtext",content:[o.p(o.error("TODO "+e.e+", "+t,e))]}})}function ft(e,t){switch(e.e){case"par":if(e.c.length===1&&(e.c[0]?.e==="gif"||e.c[0]?.e==="img")){const i=e.c[0],r=t.media_metadata[i.id];return r?o.kind("body",{body:Ne(r,i.id.split("|")[0]).body}):o.p(o.error("Missing media id "+i.id,r))}else return e.c.length===1&&e.c[0]?.e==="text"&&e.c[0].t.match(/^---+$/)?o.hr():o.p(...K(e.c,t));case"img":case"video":case"gif":{const i=t.media_metadata[e.id];return i?o.kind("body",{body:Ne(i,e.c).body}):o.p(o.error("unknown id "+e.id,t))}case"h":return o.hn(e.l,...K(e.c,t));case"hr":return o.hr();case"blockquote":return o.blockquote(...ve(e.c,t));case"list":return o.kind("list",{ordered:e.o},e.c.map(i=>o.li(...ve(i.c,t))));case"code":return o.pre(e.c.map(i=>{switch(i.e){case"raw":return i.t;case"unsupported":return"Err \xAB"+JSON.stringify(i)+"\xBB"}}).join(`
`));case"table":return o.table(e.h.map(i=>ht(i,t)),...e.c.map(i=>i.map(r=>bt(r,t))))}return v(e.e),o.p(o.error("TODO "+e.e,e))}function ht(e,t){return o.th(e.a!=null?{L:"left",C:"center",R:"right"}[e.a]:void 0,...K(e.c??[],t))}function bt(e,t){return o.td(...K(e.c,t))}function De(e){return e>=10240&&e<=10495}function Ce(e,t,i){if(t.length===0){e=e.replaceAll("\xAF_(\u30C4)_/\xAF","\xAF\\_(\u30C4)_/\xAF");let c=0,s=0;if([...e].forEach(u=>{const m=u.codePointAt(0);m!==8206&&m!==32&&(s+=1),De(m)&&c++}),c>s*.9&&c>10){const u=[];let m=[];for(const k of e.split(" "))[...k].filter(b=>De(b.codePointAt(0))).length>5?u.length>0?(m.length>0&&(u[u.length-1]+=" "+m.join(" ")),m=[],u.push(k)):(u.push([...m,k].join(" ")),m=[]):m.push(k);return u.push(...m),[o.txt(u.join(`
`))]}return[o.txt(e)]}const r=[];let n=0;const d=c=>{const s=e.substring(n,c);s.length>0&&r.push(o.txt(s))},l=[...e];return t.forEach(([c,s,u])=>{d(s),n=s+u;const m=l.slice(s,s+u).join(""),k=yt(c);k.error!=null?r.push(o.error(m,k.error)):k.code?r.push(o.code(m)):r.push(o.txt(m,{strong:k.strong,emphasis:k.emphasis,strikethrough:k.strike,superscript:k.super}))}),d(e.length),r}function wt(e,t){switch(e.e){case"text":return Ce(e.t,e.f??[]);case"r/":case"u/":return[o.link(a,"/"+e.e+e.t,{is_user_link:e.e==="u/"?e.t:void 0},o.txt((e.l?"/":"")+e.e+e.t))];case"link":return[o.link(a,e.u,{title:e.a},...Ce(e.t,e.f??[]))];case"br":return[o.br()];case"spoilertext":return[o.spoiler(...K(e.c,t))];case"raw":return[o.txt(e.t)];case"gif":case"img":{const i=t.media_metadata[e.id];return i?i.status!=="valid"?[o.error("Bad status "+i.status,i)]:i.e==="AnimatedImage"?[o.link(a,i.s.mp4??i.s.gif,{},o.txt("[embedded "+e.id.split("|")[0]+"]"))]:i.e==="Image"?i.t==="emoji"?[{kind:"emoji",url:i.s.u,name:":"+e.id.split("|")[2]+":"}]:[o.link(a,i.s.u,{},o.txt("[embedded "+e.id.split("|")[0]+"]"))]:[o.error("Unsupported "+i.e,i)]:[o.error("Missing media id "+e.id,i)]}}return v(e.e),[o.error("TODO "+e.e,e)]}function K(e,t){return(e??[]).flatMap(i=>wt(i,t))}function yt(e){return{strong:!!(e&1),emphasis:!!(e&2),strike:!!(e&8),super:!!(e&32),code:!!(e&64),error:e&-108?"unsupported style "+e.toString(2):void 0}}function gt(){const e=localStorage.getItem("reddit-secret");return!(e==null||e==="")}function Ae(e){return"https://"+(e?"oauth.reddit.com":"www.reddit.com")}function xt(e,t,i){const[r,n,d]=Ge(t);if(!r.startsWith("/"))throw new Error("path didn't start with `/` : `"+t+"`");return i.override??!1?Ae(e)+r+n.toString():(n.set("raw_json","1"),n.set("rtj","yes"),n.set("emotes_as_images","true"),n.set("gilding_detail","1"),n.set("profile_img","true"),Ae(e)+r+".json?"+n.toString()+(d===""?"":"#"+d))}let G=[];function vt(){return new Promise(e=>{G.push(e),G.length===1&&Tt().then(t=>{G.forEach(i=>i(t)),G=[]}).catch(t=>{console.log("Get access token error",t),G.forEach(i=>i(null)),G=[]})})}function Nt(){return[...crypto.getRandomValues(new Uint8Array(25))].map(e=>e.toString(16).padStart(2,"0")).join("")}async function Tt(){const e=localStorage.getItem("reddit-secret");if(e===""||e==null){const i=localStorage.getItem("reddit-app-data");let r;if(i!=null){const l=JSON.parse(i);if(l.expires<Date.now())r=l.device_id;else return l.access_token}else r=Nt();const n=await fetch("https://www.reddit.com/api/v1/access_token",{method:"POST",mode:"cors",credentials:"omit",headers:{Authorization:"Basic "+btoa(se+":"),"Content-Type":"application/x-www-form-urlencoded"},body:w({grant_type:"https://oauth.reddit.com/grants/installed_client",device_id:r,redirect_uri:Se})}).then(l=>l.json());if(n.error)throw console.log(n),new Error("error: "+JSON.stringify(n));const d={access_token:n.access_token,expires:Date.now()+n.expires_in*1e3,scope:n.scope,device_id:r};return localStorage.setItem("reddit-app-data",JSON.stringify(d)),d.access_token}const t=JSON.parse(e);if(console.log(t.expires,Date.now()),t.expires<Date.now()){console.log("Token expired, refreshing\u2026");const[i,r]=await fetch("https://www.reddit.com/api/v1/access_token",{method:"POST",mode:"cors",credentials:"omit",headers:{Authorization:"Basic "+btoa(se+":"),"Content-Type":"application/x-www-form-urlencoded"},body:nt`grant_type=refresh_token&refresh_token=${t.refresh_token}`}).then(async d=>[d.status,await d.json()]);if(i!==200)throw console.log("Error! got",r,"with status code",i),new Error("Status code "+i);if("error"in r)throw console.log("refresh attempt: ",r,t),new Error("Got error while refreshing token: "+r.error);const n={access_token:r.access_token,refresh_token:r.refresh_token??t.refresh_token,expires:Date.now()+r.expires_in*1e3,scope:r.scope};return console.log("Refresh info:",r,n),localStorage.setItem("reddit-secret",JSON.stringify(n)),console.log("Refreshed \u221A"),n.access_token}return t.access_token}async function Ot(){const e=await vt();return e==null?"":"Bearer "+e}function Ge(e){const[t,...i]=e.split("?"),r=i.join("?"),[n,...d]=r.split("#");return[t??"",new URLSearchParams(n),d.join("#")]}function x(e,t){const[i,r,n]=Ge(e);for(const[d,l]of Object.entries(t))l!=null?r.set(d,l):r.delete(d);return i+"?"+r.toString()+(n!==""?"#"+n:"")}function be(e,t,i){return{kind:"counter",client_id:a.id,increment:{icon:"join",color:"white",label:"Subscribe",undo_label:"Unsubscribe"},decrement:null,unique_id:"/subscribe/"+e+"/",time:Date.now(),style:"pill-filled",incremented_style:"pill-empty",count_excl_you:i?t-1:t,you:i?"increment":void 0,actions:{increment:P.encode({kind:"subscribe",subreddit:e,direction:"sub"}),reset:P.encode({kind:"subscribe",subreddit:e,direction:"unsub"})}}}function Et(e,t){try{return St(e,t)}catch(i){return console.log("widget error",i),{kind:"widget",title:"Error!",raw_value:e,widget_content:{kind:"body",body:{kind:"richtext",content:[o.p(o.error("Uh oh! Error "+i.toString(),e))]}}}}}function St(e,t){return e.kind==="moderators"?{kind:"widget",title:"Moderators",raw_value:e,widget_content:{kind:"body",body:{kind:"richtext",content:[o.p(o.link(a,"/message/compose?to=/r/"+t,{style:"pill-empty"},o.txt("Message the mods"))),o.ul(...e.mods.map(i=>o.li(o.p(o.link(a,"/u/"+i.name,{is_user_link:i.name},o.txt("u/"+i.name)),...Y({type:i.authorFlairType,text:i.authorFlairText,text_color:i.authorFlairTextColor,background_color:i.authorFlairBackgroundColor,richtext:i.authorFlairRichText}).flatMap(r=>[o.txt(" "),o.flair(r)]))))),o.p(o.link(a,"/r/"+t+"/about/moderators",{},o.txt("View All Moderators")))]}}}:e.kind==="community-list"?{kind:"widget",title:e.shortName,raw_value:e,widget_content:{kind:"list",items:e.data.map(i=>i.type==="subreddit"?{icon:i.communityIcon||void 0,name:{kind:"text",text:"r/"+i.name},click:{kind:"link",url:"/r/"+i.name},action:be(i.name,i.subscribers,i.isSubscribed)}:(v(i.type),{name:{kind:"text",text:"ERROR UNSUPPORTED"+i.type},click:{kind:"body",body:{kind:"richtext",content:[o.pre(JSON.stringify(i,null,"	"),"json")]}}}))}}:e.kind==="id-card"?{kind:"widget",title:"Error!",raw_value:e,widget_content:{kind:"body",body:{kind:"richtext",content:[o.p(o.error("Not supported "+e.kind,e))]}}}:e.kind==="menu"?{kind:"widget",title:"Error!",raw_value:e,widget_content:{kind:"body",body:{kind:"richtext",content:[o.p(o.error("Uh oh! TODO widget "+e.kind,e))]}}}:e.kind==="textarea"?{kind:"widget",title:e.shortName,raw_value:e,widget_content:{kind:"body",body:{kind:"text",client_id:a.id,content:e.textHtml,markdown_format:"reddit_html"}}}:e.kind==="subreddit-rules"?{kind:"widget",title:e.shortName,raw_value:e,widget_content:{kind:"list",items:e.data.map((i,r)=>({name:{kind:"text",text:""+(r+1)+". "+i.shortName},click:{kind:"body",body:{kind:"text",client_id:a.id,content:i.descriptionHtml,markdown_format:"reddit_html"}}}))}}:e.kind==="image"?{kind:"widget",title:e.shortName,raw_value:e,widget_content:{kind:"image",src:e.data[e.data.length-1].url,link_url:e.data[e.data.length-1].linkUrl,width:e.data[e.data.length-1].width,height:e.data[e.data.length-1].height}}:e.kind==="post-flair"?{kind:"widget",title:e.shortName,raw_value:e,widget_content:{kind:"list",items:e.order.map(i=>{const r=e.templates[i],n=Y({type:r.type,text:r.text,text_color:r.textColor,background_color:r.backgroundColor,richtext:r.richtext});return n.length!==1?(console.log("bad flair",r,n),{name:{kind:"text",text:"error bad flair"},click:{kind:"body",body:{kind:"richtext",content:[o.p(o.error("bad flair",[r,n]))]}}}):{name:{kind:"flair",flair:n[0]},click:{kind:"link",url:"/r/"+t+'/search?q=flair:"'+encodeURIComponent(r.text)+'"&restrict_sr=1'}}})}}:e.kind==="custom"?{kind:"widget",title:e.shortName,raw_value:e,widget_content:{kind:"iframe",height:""+e.height,srcdoc:`
            <head>
                <link rel="stylesheet" href="${e.stylesheetUrl}">
                <base target="_blank">
            </head>
            <body>${e.textHtml}</body>
        `}}:e.kind==="button"?{kind:"widget",title:e.shortName,raw_value:e,widget_content:{kind:"list",above_text:{kind:"text",content:e.description_html,client_id:a.id,markdown_format:"reddit_html"},items:e.buttons.map(i=>i.kind==="text"?{name:{kind:"text",text:i.text},click:{kind:"link",url:i.url}}:i.kind==="image"?{name:{kind:"image",src:i.url,w:i.width,h:i.height,alt:i.text},click:{kind:"link",url:i.linkUrl}}:(v(i.kind),{name:{kind:"text",text:"TODO "+i.kind},click:{kind:"body",body:{kind:"none"}}}))}}:e.kind==="calendar"?{kind:"widget",title:e.shortName,raw_value:e,widget_content:{kind:"body",body:{kind:"array",body:e.data.flatMap((i,r)=>[...r!==0?[{kind:"richtext",content:[o.hr()]}]:[],{kind:"text",client_id:a.id,content:i.titleHtml,markdown_format:"reddit_html"},{kind:"richtext",content:[o.p(o.timeAgo(i.startTime*1e3))]},{kind:"text",client_id:a.id,content:i.locationHtml,markdown_format:"reddit_html"},{kind:"text",client_id:a.id,content:i.descriptionHtml,markdown_format:"reddit_html"}])}}}:(v(e.kind),{kind:"widget",title:"Error!",raw_value:e,widget_content:{kind:"body",body:{kind:"richtext",content:[o.p(o.error("Uh oh! Unsupported widget "+e.kind,e))]}}})}function Pt(e,t){return{kind:"widget",title:e.data.title,raw_value:e,widget_content:{kind:"community-details",description:e.data.public_description},actions_bottom:[be(t,e.data.subscribers,e.data.user_is_subscriber??!1)]}}function Rt(e,t,{collapsed:i}){return{kind:"thread",raw_value:e,body:{kind:"text",client_id:a.id,markdown_format:"reddit_html",content:e.data.description_html},display_mode:{body:i?"collapsed":"visible",comments:"visible"},link:"/r/"+t+"/about/sidebar",layout:"reddit-post",title:{text:"old.reddit sidebar"},actions:[],default_collapsed:!1}}function jt(e){const t=e.widgets,i=d=>{const l=t.items[d];if(!l)throw new Error("bad widget "+d);return l},r=d=>Et(d,e.subreddit),n=[...e.sub_t5?[Pt(e.sub_t5,e.subreddit)]:[],...e.sub_t5?[Rt(e.sub_t5,e.subreddit,{collapsed:!!t})]:[],...t?t.layout.sidebar.order.map(d=>r(i(d))):[],...t?[r(i(t.layout.moderatorWidget))]:[]];return n.length===0&&n.push({kind:"widget",title:"Error",widget_content:{kind:"body",body:{kind:"richtext",content:[o.p(o.txt("Failed to fetch sidebar for this page :("))]}},raw_value:e}),n}function It(e){if(!e)return{kind:"thread",title:{text:"Listing"},body:{kind:"text",client_id:a.id,content:"Listing",markdown_format:"none"},display_mode:{body:"collapsed",comments:"collapsed"},link:"TODO no link",layout:"error",actions:[],default_collapsed:!1,raw_value:e};const t=[{text:"Posts",action:{kind:"link",client_id:a.id,url:"/r/"+e.subreddit},selected:!0}];e:if(e.widgets){const i=e.widgets?.layout.topbar.order.length;if(i===0)break e;if(i!==1){t.push({text:"ERROR Topbar Order",action:{kind:"link",client_id:a.id,url:"error"},selected:!1});break e}const r=e.widgets.items[e.widgets.layout.topbar.order[0]];if(r.kind!=="menu"){t.push({text:"ERROR Topbar Item",action:{kind:"link",client_id:a.id,url:"error"},selected:!1});break e}r.showWiki&&t.push({text:"Wiki",action:{kind:"link",client_id:a.id,url:"/r/"+e.subreddit+"/wiki/index"},selected:!1});const n=d=>{if("children"in d)return{text:d.text,selected:!1,action:{kind:"menu",children:d.children.map(n)}};if("url"in d)return{text:d.text,selected:!1,action:{kind:"link",client_id:a.id,url:d.url}};C(d)};t.push(...r.data.map(d=>({...n(d),selected:!1})))}return{kind:"bio",...e.sub_t5?Ze(e.sub_t5.data):{banner:null,icon:null},name:{display:e.sub_t5?.data.title,link_name:e.sub_t5?e.sub_t5.data.display_name_prefixed:"r/"+e.subreddit},body:null,subscribe:e.sub_t5?be(e.subreddit,e.sub_t5.data.subscribers,e.sub_t5.data.user_is_subscriber??!1):void 0,menu:t.length===1?null:t,raw_value:e}}const Te=I("deferred_inbox");function j(){return gt()?{actions:[{kind:"act",client_id:a.id,action:P.encode({kind:"log_out"}),text:"Log Out"}],inboxes:[{id:"/messages",name:"Messages",active_color:"orange",hydrate:Te.encode({kind:"inbox"}),url:"/message/inbox"},{id:"/modmail",name:"Modmail",active_color:"green",hydrate:Te.encode({kind:"modmail"}),url:"/mod/mail/all"}]}:{actions:[{kind:"link",client_id:a.id,url:qt(),text:"Log In"},{kind:"link",client_id:a.id,url:"raw!https://www.reddit.com/register",text:"Sign Up"}],inboxes:[]}}function J(e,t,i){const r=[];return i.warning&&r.push(...i.warning),{title:"Error View",navbar:j(),body:{kind:"one",item:{parents:[{kind:"thread",raw_value:t,body:{kind:"richtext",content:[...r,o.pre(JSON.stringify(t,null,"	"),"json")]},display_mode:{body:"visible",comments:"visible"},link:e,layout:"error",actions:[],default_collapsed:!1}],replies:[]}},sidebar:i.sidebar??void 0,display_style:"comments-view"}}function E(e,t,i,r){const n=t;if(Array.isArray(i)){if(i[0].data.children.length!==1)return J(e,i,{sidebar:r.sidebar,warning:te(e)});const d=i[0].data.children[0];if(d.kind!=="t3")return J(e,i,{sidebar:r.sidebar,warning:te(e)});const l=d.data.name,c=d.data.suggested_sort??"confidence",s=d.data.contest_mode,u=d.data.can_mod_post,m=d.data.permalink,k=d.data.locked,D=d.data.discussion_type==="CHAT",O=i[1].data.children,b=[],$=O[0];$&&$.kind==="t1"&&$.data.parent_id!==l&&b.push($e($.data.subreddit,(l??"").replace("t3_",""),$.data.parent_id.replace("t1_","")));let B=O.map(g=>F(g,{link_fullname:l},{permalink:m,sort:c,is_chat:D}));if(n.kind==="comments"&&n.focus_comment!=null){const g=R=>{if(R.length!==1)return;const N=R[0];if(N.kind==="thread")return N},z=R=>{const N=R.raw_value;if(typeof N=="object"&&N&&"data"in N&&typeof N.data=="object"&&N.data&&"name"in N.data&&typeof N.data.name=="string"){const je=N.data.name;return je.startsWith("t1_")?je.replace("t1_",""):void 0}};let h=g(B),we;for(;h;){if(z(h)===n.focus_comment){we=h;break}h=g(h.replies??[])}if(we){for(h=g(B);h&&h!==we;){b.push(h);const R=h.replies;h.replies=void 0,h=g(R??[])}if(h){b.push(h);const R=h.replies;h.replies=void 0,B=R??[]}else B=[]}}i[1].data.after!=null&&B.push({kind:"load_more",url:"TODO",load_more:A.encode({kind:"duplicates",lmurl:"todo"}),raw_value:i[1]});let H;return n.kind==="comments"?s&&!u?H=[{selected:!0,text:"Random",action:{kind:"link",client_id:a.id,url:x(m,{sort:"random"})}}]:H=[["confidence","Best"],["top","Top"],["new","New"],["controversial","Controversial"],["old","Old"],["random","Random"],["qa","Q&A"],["live","Live"]].map(([g,z])=>({selected:(n.sort_override??c)===g,text:z,action:{kind:"link",client_id:a.id,url:x(m,{sort:g})}})):n.kind==="duplicates"?H=[["num_comments","Comments"],["new","New"]].map(([g,z])=>({selected:n.sort===g,text:z,action:{kind:"link",client_id:a.id,url:x(m.replace("/comments","/duplicates"),{sort:g})}})):H=[{selected:!1,text:"error "+n.kind,action:{kind:"link",client_id:a.id,url:"error"}}],{title:d.kind==="t3"?d.data.title:"ERR top not t3",navbar:j(),body:{kind:"one",item:{parents:[F(d,{force_expand:b.length>0?"closed":"open",show_post_reply_button:!0},{permalink:m,sort:"unsupported",is_chat:D}),...s?[(()=>({kind:"thread",body:{kind:"richtext",content:[o.p(o.txt("This thread is in contest mode.")),o.p(o.txt(u?"As a mod, you can sort comments however you wish. Regular users have randomized sorting and cannot see scores.":"Sorting is randomized and scores are hidden."))]},display_mode:{body:"visible",comments:"collapsed"},raw_value:s,link:"no",actions:[],default_collapsed:!1,layout:"reddit-post"}))()]:[],...k?[(()=>({kind:"thread",body:{kind:"richtext",content:[o.p(o.txt("This thread is locked.")),o.p(o.txt(u?"Only mods like you can comment on this thread.":"You are not able to comment on this thread."))]},display_mode:{body:"visible",comments:"collapsed"},raw_value:k,link:"no",actions:[],default_collapsed:!1,layout:"reddit-post"}))()]:[],...b],menu:H,replies:B}},sidebar:r.sidebar??void 0,display_style:"comments-view"}}if(i.kind==="wikipage")return{title:e+" | Wiki",navbar:j(),body:{kind:"one",item:{parents:[{kind:"thread",raw_value:i,body:{kind:"text",client_id:a.id,markdown_format:"reddit_html",content:i.data.content_html},display_mode:{body:"visible",comments:"visible"},link:e,layout:"error",actions:[],default_collapsed:!1}],replies:[]}},sidebar:r.sidebar??void 0,display_style:"comments-view"};if(i.kind==="t5")return{title:e+" | Sidebar",navbar:j(),body:{kind:"one",item:{parents:[{kind:"thread",raw_value:i,body:{kind:"text",client_id:a.id,markdown_format:"reddit_html",content:i.data.description_html},display_mode:{body:"visible",comments:"visible"},link:e,layout:"reddit-post",title:{text:"old.reddit sidebar"},actions:[],default_collapsed:!1}],replies:[]}},sidebar:r.sidebar??void 0,display_style:"comments-view"};if(i.kind==="UserList")return{title:e,navbar:j(),body:{kind:"one",item:{parents:[{kind:"thread",body:{kind:"richtext",content:[o.h1(o.txt("User List")),o.table([o.th("left",o.txt("Username")),o.th("left",o.txt("Added")),o.th("left",o.txt("Perms"))],...i.data.children.map(d=>[o.td(o.link(a,"/u/"+d.name,{is_user_link:d.name},o.txt("u/"+d.name))),o.td(o.timeAgo(d.date*1e3)),o.td(...d.mod_permissions.flatMap((l,c)=>[...c!==0?[o.txt(", ")]:[],o.txt(l)]))]))]},display_mode:{body:"visible",comments:"visible"},raw_value:i,layout:"reddit-post",link:e,actions:[],default_collapsed:!1}],replies:[]}},sidebar:r.sidebar??void 0,display_style:"comments-view"};if(i.kind==="Listing"){i.data.before!=null;let d;if(i.data.after!=null){const s=x(e,{before:void 0,after:i.data.after});d={kind:"load_more_unmounted",load_more_unmounted:We.encode({kind:"listing",url:s}),url:s,count:void 0,raw_value:i}}const l=[["overview","Overview"],["comments","Comments"],["submitted","Submitted"]],c=[["upvoted","Upvoted"],["downvoted","Downvoted"],["hidden","Hidden"],["saved","Saved"]];return{title:e,navbar:j(),body:{kind:"listing",menu:n.kind==="subreddit"?[{selected:n.current_sort.v==="hot",text:"Hot",action:{kind:"link",client_id:a.id,url:"/"+[...n.sub.base,...n.is_user_page?["hot"]:[]].join("/")}},{selected:n.current_sort.v==="best",text:"Best",action:{kind:"link",client_id:a.id,url:"/"+[...n.sub.base,"best"].join("/")}},{selected:n.current_sort.v==="new",text:"New",action:{kind:"link",client_id:a.id,url:"/"+[...n.sub.base,"new"].join("/")}},{selected:n.current_sort.v==="rising",text:"Rising",action:{kind:"link",client_id:a.id,url:"/"+[...n.sub.base,"rising"].join("/")}},...[["top","Top"],["controversial","Controversial"]].map(([s,u])=>({selected:n.current_sort.v===s,text:n.current_sort.v===s?u+" ("+n.current_sort.t+")":u,action:{kind:"menu",children:[["hour","Hour"],["day","Day"],["week","Week"],["month","Month"],["year","Year"],["all","All Time"]].map(([m,k])=>({text:k,selected:n.current_sort.v===s&&n.current_sort.t===m,action:{kind:"link",client_id:a.id,url:"/"+[...n.sub.base,s].join("/")+"?t="+m}}))}}))]:n.kind==="user"?[...l.map(([s,u])=>({selected:n.current.tab===s,text:u,action:{kind:"show-line-two",children:[{selected:n.current.tab===s&&n.current.sort.sort==="hot",text:"Hot",action:{kind:"link",client_id:a.id,url:x("/"+["u",n.username,s].join("/"),{sort:"hot"})}},{selected:n.current.tab===s&&n.current.sort.sort==="new",text:"New",action:{kind:"link",client_id:a.id,url:x("/"+["u",n.username,s].join("/"),{sort:"new"})}},...[["top","Top"],["controversial","Controversial"]].map(([m,k])=>({selected:n.current.tab===s&&n.current.sort.sort===m,text:n.current.tab===s&&n.current.sort.sort===m?k+" ("+n.current.sort.t+")":k,action:{kind:"menu",children:[["hour","Hour"],["day","Day"],["week","Week"],["month","Month"],["year","Year"],["all","All Time"]].map(([D,O])=>({text:O,selected:n.current.tab===s&&n.current.sort.sort===m&&n.current.sort.t===D,action:{kind:"link",client_id:a.id,url:x("/"+["u",n.username,s].join("/"),{sort:m,t:D})}}))}}))]}})),{selected:n.current.tab==="gilded",text:"Gilded",action:{kind:"show-line-two",children:[{selected:n.current.tab==="gilded"&&n.current.by==="received",text:"Received",action:{kind:"link",client_id:a.id,url:"/"+["u",n.username,"gilded"].join("/")}},{selected:n.current.tab==="gilded"&&n.current.by==="given",text:"Given",action:{kind:"link",client_id:a.id,url:"/"+["u",n.username,"gilded","given"].join("/")}}]}},...c.map(([s,u])=>({selected:n.current.tab===s,text:u,action:{kind:"link",client_id:a.id,url:"/"+["u",n.username,s].join("/")}}))]:n.kind==="inbox"?[{selected:n.current.tab==="compose",text:"Compose",action:{kind:"link",client_id:a.id,url:"/message/compose"}},{selected:n.current.tab==="inbox",text:"Inbox",action:{kind:"show-line-two",children:[["inbox","All"],["unread","Unread"],["messages","Messages"],["comments","Comment Replies"],["selfreply","Post Replies"],["mentions","Username Mentions"]].map(([s,u])=>({text:u,selected:n.current.tab==="inbox"&&n.current.inbox_tab===s,action:{kind:"link",client_id:a.id,url:"/message/"+s}}))}},{selected:n.current.tab==="sent",text:"Sent",action:{kind:"link",client_id:a.id,url:"/message/sent"}}]:[{text:"Error! "+n.kind,selected:!1,action:{kind:"link",client_id:a.id,url:e}}],header:r.header??{kind:"thread",title:{text:"Listing"},body:{kind:"text",client_id:a.id,content:"Listing",markdown_format:"none"},display_mode:{body:"collapsed",comments:"collapsed"},link:"TODO no link",layout:"error",actions:[],default_collapsed:!1,raw_value:n},items:n.kind==="inbox"?i.data.children.map(s=>Dt(s)):i.data.children.map(s=>Ct(s,void 0,{permalink:e,sort:"unsupported",is_chat:!1})),next:d},sidebar:r.sidebar??void 0,display_style:"fullscreen-view"}}return v(i.kind),J(e,i,{sidebar:r.sidebar,warning:te(e)})}function te(e){const t=e.startsWith("/mod/")||e.startsWith("/mod?")||e.startsWith("/mod#")||e==="/mod";return t&&(e=e.replace("/mod","")),[o.h1(o.txt("This url is not supported yet")),t?o.h2(o.txt("View it on mod.reddit.com: "),o.link(a,"raw!https://mod.reddit.com"+e,{},o.txt("mod.reddit.com"+e))):o.h2(o.txt("View it on reddit.com: "),o.link(a,"raw!https://www.reddit.com"+e,{},o.txt("reddit.com"+e))),o.p(o.txt("Submit an issue "),o.link(a,"https://github.com/pfgithub/threadclient/issues",{},o.txt("here")),o.txt(" if you would like to see this supported. Mention the url: "),o.code(e))]}const We=I("load_more_unmounted"),A=I("load_more");function Q(e){const t={id:e.name,rank:"2"};return{kind:"counter",client_id:a.id,unique_id:"/vote/"+e.name+"/",time:Date.now(),increment:{icon:"up_arrow",color:"reddit-upvote",label:"Upvote",undo_label:"Undo Upvote"},decrement:{icon:"down_arrow",color:"reddit-downvote",label:"Downvote",undo_label:"Undo Downvote"},special:"reddit-points",count_excl_you:(e.score_hidden??e.hide_score??!1)&&e.score===1?"hidden":e.score+(e.likes===!0?-1:e.likes===!1?1:0),you:e.likes===!0?"increment":e.likes===!1?"decrement":void 0,percent:e.upvote_ratio,actions:e.archived??!1?{error:"archived <6mo"}:{increment:xe({...t,dir:"1"}),decrement:xe({...t,dir:"-1"}),reset:xe({...t,dir:"0"})}}}function Ue(e){if(e.kind==="t1"||e.kind==="t4"){const t=e.data;return{kind:"thread",info:{time:t.created_utc*1e3,edited:!1,author:{name:"u/"+t.author,link:"/u/"+t.author,color_hash:t.author,client_id:a.id},pinned:!1},body:{kind:"text",client_id:a.id,content:t.body_html,markdown_format:"reddit_html"},display_mode:{body:"visible",comments:"collapsed"},link:t.context,layout:"reddit-comment",default_collapsed:!1,actions:[...e.kind==="t1"?[Q(t)]:[],...t.context?[{kind:"link",client_id:a.id,url:t.context,text:"Context"}]:[],...e.kind==="t4"?[{kind:"link",client_id:a.id,url:"/message/messages/"+t.id,text:"Permalink"}]:[],{kind:"counter",client_id:a.id,neutral_icon:"envelope_open",increment:{icon:"envelope",color:"white",label:"Mark Unread",undo_label:"\u{1F836} New"},decrement:null,count_excl_you:"none",you:t.new?"increment":void 0,unique_id:"/unread/"+t.name+"/",time:Date.now(),actions:{increment:P.encode({kind:"mark_read",direction:"un",fullname:t.name}),reset:P.encode({kind:"mark_read",direction:"",fullname:t.name})}}],raw_value:e}}return{kind:"thread",body:{kind:"richtext",content:[o.p(o.error("Unsupported "+e.kind,e))]},display_mode:{body:"visible",comments:"collapsed"},layout:"error",default_collapsed:!1,actions:[],raw_value:e,link:"no"}}function Dt(e){if(e.kind==="t1"||e.kind==="t4"){const t=e.data;return{parents:[{kind:"thread",title:{text:t.subject},body:{kind:"none"},display_mode:{body:"visible",comments:"collapsed"},link:"no",layout:"reddit-post",default_collapsed:!1,actions:[],raw_value:e},Ue(e)],replies:typeof t.replies=="object"?t.replies.data.children.map(i=>Ue(i)):[]}}return{parents:[{kind:"thread",body:{kind:"richtext",content:[o.p(o.error("Unsupported "+e.kind,e))]},display_mode:{body:"visible",comments:"collapsed"},layout:"error",default_collapsed:!1,actions:[],raw_value:e,link:"no"}],replies:[]}}function Ct(e,t={},i){const r=F(e,t,i);return e.kind==="t1"&&"link_title"in e.data?{parents:[{kind:"thread",title:{text:e.data.link_title},info:{time:!1,edited:!1,in:{name:e.data.subreddit_name_prefixed,link:"/"+e.data.subreddit_name_prefixed},author:{color_hash:e.data.link_author,name:e.data.link_author,link:"/u/"+e.data.link_author,client_id:a.id},pinned:!1},body:{kind:"link",client_id:a.id,url:e.data.link_permalink},display_mode:{body:"visible",comments:"collapsed"},link:e.data.link_permalink,layout:"reddit-post",default_collapsed:!1,actions:[{kind:"link",client_id:a.id,url:e.data.link_permalink,text:"Permalink"}],raw_value:e,replies:[]},...e.data.parent_id===e.data.link_id?[]:[$e(e.data.subreddit,e.data.link_id.replace("t3_",""),e.data.parent_id.replace("t1_",""))],r],replies:[]}:{parents:[r],replies:[]}}function $e(e,t,i){return{kind:"load_more",load_more:A.encode({kind:"context",subreddit:e,link_id:t,parent_id:i}),url:"/r/"+e+"/comments/"+t+"?comment="+i.replace("t1_","")+"&context=8",raw_value:[e,t,i]}}function F(e,t={},i){try{return Ut(e,t,i)}catch(r){return console.log(r),{kind:"thread",body:{kind:"richtext",content:[o.p(o.error("Error! "+r.toString(),r))]},display_mode:{body:"visible",comments:"visible"},raw_value:{error:r,listing:e},link:"Error!",layout:"error",actions:[],default_collapsed:!1}}}function le(e){return{kind:"delete",client_id:a.id,data:_t(e)}}const He=I("report");function ue(e,t){return{kind:"report",client_id:a.id,data:He.encode({subreddit:t,fullname:e})}}function ce(e){return{kind:"reply",client_id:a.id,key:"reply-"+e,text:"Reply",reply_info:fe.encode({parent_id:e}),mode:"reply"}}function me(e){return{kind:"reply",client_id:a.id,key:"edit-"+e,text:"Edit",reply_info:fe.encode({parent_id:e}),mode:"edit"}}function pe(e,t){return{kind:"counter",client_id:a.id,increment:{icon:"bookmark",color:"green",label:"Save",undo_label:"Unsave"},decrement:null,unique_id:`/save/${e}/`,time:Date.now(),count_excl_you:"none",you:t?"increment":void 0,actions:{increment:P.encode({kind:"save",fullname:e,direction:""}),reset:P.encode({kind:"save",fullname:e,direction:"un"})}}}function ze(e){const t={admin:"admin",moderator:"moderator",unsupported:"error"};return{color_hash:e.author,client_id:a.id,name:e.author,link:"/u/"+e.author,flair:[...e.flair_bits?Y(e.flair_bits):[],...e.is_submitter?ie([{elems:[{kind:"text",text:"\xABOP\xBB"}],content_warning:!1,system:"op"}]):[],...e.author_cakeday??!1?ie([{elems:[{kind:"text",text:"\xAB\u{1F370}\xBB"}],content_warning:!1,system:"cake"}]):[],...e.distinguished!=null?ie([{elems:[{kind:"text",text:"\xAB"+e.distinguished+"\xBB"}],content_warning:!1,system:t[e.distinguished]??t.unsupported}]):[],...e.additional_flairs??[]],pfp:e.pfp!=null&&e.pfp!==""?{url:e.pfp,hover:e.pfp}:void 0}}function ke(e,t){return ze({author:e.author,flair_bits:{type:e.author_flair_type,text:e.author_flair_text,text_color:e.author_flair_text_color,background_color:e.author_flair_background_color,richtext:e.author_flair_richtext},additional_flairs:t,distinguished:e.distinguished,is_submitter:"is_submitter"in e?e.is_submitter??!1:!1,author_cakeday:e.author_cakeday,pfp:e.profile_img})}function At(e){return ze({author:e.data.name,flair_bits:null,additional_flairs:[],distinguished:null,is_submitter:!1,author_cakeday:!1,pfp:e.data.icon_img})}const Re=I("fetch_removed_path");function Je(e,t){return{permalink:x(t,{sort:e.sort}),sort:e.sort,is_chat:e.is_chat}}const _e={anti_evil_ops:()=>({short:"Anti-Evil Operations",title:"Removed by Reddit's Anti-Evil Operations",body:"For violations of reddit's Content Policy: https://reddit.com/help/contentpolicy"}),community_ops:()=>({short:"Community Operations",title:"Sorry, this post was removed by Reddit's Community team.",body:"It's rare, but Reddit's Community Team will occasionally remove posts from feeds to keep communities safe and civil."}),legal_operations:()=>({short:"Legal Operations",title:"This post was removed for legal reasons",body:"\xABTODO fill this\xBB"}),copyright_takedown:()=>({short:"Copyright Takedown",title:"Removed for Copyright Infringement",body:"\xABTODO fill this\xBB"}),reddit:()=>({short:"Spam Filters",title:"Sorry, this post was removed by Reddit's spam filters.",body:"Reddit's automated bots frequently filter posts it thinks might be spam."}),author:()=>({short:"Author",title:"Removed by the author",body:"The author of this post decided to remove it."}),deleted:()=>({short:"Author",title:"Deleted by the author",body:"The author of this post decided to delete it."}),moderator:(e,t)=>({short:"Moderators",title:"Removed by moderators of "+t,body:"Moderators of "+t+" decided to remove this post, likely due to a violation of the subreddit rules."}),automod_filtered:()=>({short:"Filtered by AutoModerator",title:"This post was filtered by AutoModerator",body:"\xABTODO fill this\xBB"}),content_takedown:()=>({short:"Content Takedown",title:"Sorry, this post was removed by Reddit.",body:"Reddit administrators occasionally remove posts that violate Reddit's User Agreement and Content Policy."}),unsupported:e=>({short:e,title:"This post was removed for \xAB"+e+"\xBB",body:"ThreadClient does not know what that means."})};function Oe(e){return{kind:"code",body:{kind:"richtext",content:[o.pre(e,"markdown")]}}}function Ve(e){let t;e.author==="[deleted]"&&(JSON.stringify(e.rtjson)===JSON.stringify({document:[{c:[{e:"text",t:"[deleted]"}],e:"par"}]})?t=_e.deleted("deleted",e.subreddit_name_prefixed):JSON.stringify(e.rtjson)===JSON.stringify({document:[{c:[{e:"text",t:"[removed]"}],e:"par"}]})&&(t=_e.moderator("moderator",e.subreddit_name_prefixed)));const i={kind:"richtext",content:Be(e.rtjson,{media_metadata:e.media_metadata??{}})};return t!=null?{kind:"removed",removal_message:t,fetch_path:Re.encode({path:"https://api.pushshift.io/reddit/comment/search?ids="+e.id}),body:i,client_id:a.id}:i}function Ye(e){if(e.crosspost_parent_list&&e.crosspost_parent_list.length===1)return{kind:"crosspost",source:F({kind:"t3",data:e.crosspost_parent_list[0]},{force_expand:"crosspost"},Je({permalink:e.permalink,sort:"unsupported",is_chat:!1},e.permalink)),client_id:a.id};if(e.is_self)return{kind:"array",body:[e.rtjson.document.length?{kind:"richtext",content:Be(e.rtjson,{media_metadata:e.media_metadata??{}})}:e.url==="https://www.reddit.com"+e.permalink?{kind:"none"}:{kind:"link",client_id:a.id,url:e.url,embed_html:e.media_embed?.content},e.poll_data?{kind:"poll",votable:"Cannot vote",total_votes:e.poll_data.total_vote_count,choices:e.poll_data.options.map(t=>({name:t.text,votes:t.vote_count??"hidden",id:t.id})),vote_data:"",select_many:!1,your_votes:e.poll_data.user_selection!=null?[{id:e.poll_data.user_selection}]:[],close_time:e.poll_data.voting_end_timestamp}:void 0]};if(e.gallery_data)return{kind:"gallery",images:e.gallery_data.items.map(t=>{if(!e.media_metadata)throw new Error("missing media metadata");const i=e.media_metadata[t.media_id];if(!i)throw new Error("missing mediameta for "+t.media_id);return Ne(i,t.caption)})};if(e.rpan_video)return{kind:"video",source:{kind:"video",sources:[{url:e.rpan_video.hls_url}]},gifv:!1};if(e.preview&&e.preview.images.length===1){const t=e.preview.images[0];if(t.variants.mp4){const i=t.variants.mp4,r=[...i.resolutions,i.source].sort((n,d)=>d.width-n.width).map(n=>({url:n.url,quality:n.width+"\xD7"+n.height}));return{kind:"video",source:{kind:"video",sources:r,preview:[...r].reverse()},gifv:!0}}if(e.preview.enabled)return{kind:"captioned_image",url:t.source.url,w:t.source.width,h:t.source.height}}return{kind:"link",client_id:a.id,url:e.url,embed_html:e.media_embed?.content}}function Ke(e,t){if(t!=="crosspost")return e.preview?.images?.[0]?.resolutions?.[0]?.url!=null?{kind:"image",url:e.preview.images[0].resolutions[0].url}:e.rpan_video?{kind:"image",url:e.rpan_video.scrubber_media_url}:e.thumbnail!=null&&e.thumbnail!==""?e.thumbnail.includes("/")?{kind:"image",url:e.thumbnail}:{kind:"default",thumb:ie({self:"self",default:"default",image:"image",spoiler:"spoiler",nsfw:"nsfw",account:"account"})[e.thumbnail]??"error"}:{kind:"default",thumb:"default"}}function Qe(e){const t=[];return t.push(...Y({type:e.link_flair_type,text:e.link_flair_text,text_color:e.link_flair_text_color,background_color:e.link_flair_background_color,richtext:e.link_flair_richtext})),e.spoiler&&t.push({elems:[{kind:"text",text:"Spoiler"}],content_warning:!0}),e.over_18&&t.push({elems:[{kind:"text",text:"NSFW"}],content_warning:!0}),e.is_original_content&&t.push({elems:[{kind:"text",text:"OC"}],content_warning:!1}),t.push(...Pe(e.all_awardings??[])),e.approved===!0&&t.push({elems:[{kind:"text",text:"\u2713 Approved"}],content_warning:!1,system:"approved"}),t}const ie=e=>e;function Ut(e,t={},i){if(t.force_expand??="closed",e.kind==="t1"){const r=e.data;return{kind:"thread",body:Ve(r),display_mode:{body:"visible",comments:"visible"},raw_value:e,link:x(r.permalink,{context:"3",sort:i.sort}),layout:"reddit-comment",info:{time:r.created_utc*1e3,edited:r.edited===!1?!1:r.edited*1e3,author:ke(r,Pe(r.all_awardings??[])),pinned:r.pinned||r.stickied||!1},actions:(()=>[ce(r.name),{kind:"link",client_id:a.id,text:"Permalink",url:r.permalink?x(r.permalink,{context:"3",sort:i.sort}):"Error no permalink"},me(r.name),le(r.name),pe(r.name,r.saved),ue(r.name,r.subreddit),...i.is_chat?[]:[Q(r)],Oe(r.body)])(),default_collapsed:r.collapsed,replies:[...r.locked?[(()=>({kind:"thread",body:{kind:"richtext",content:[o.p(o.txt("This comment is locked.")),o.p(o.txt("Only moderators are able to comment on this thread."))]},display_mode:{body:"visible",comments:"collapsed"},raw_value:r.locked,link:"no",actions:[],default_collapsed:!1,layout:"reddit-post"}))()]:[],...r.replies?r.replies.data.children.map(d=>F(d,t,Je(i,r.permalink))):[]]}}else if(e.kind==="t3"){const r=e.data,n=r.removed_by_category!=null?(_e[r.removed_by_category]??_e.unsupported)(r.removed_by_category,r.subreddit_name_prefixed):void 0,d=r.name.substring(3);r.mod_reports.length+r.user_reports.length>0;const l=Ye(r);return{kind:"thread",title:{text:r.title},flair:Qe(r),body:n!=null?{kind:"removed",removal_message:n,fetch_path:Re.encode({path:"https://api.pushshift.io/reddit/submission/search?ids="+d}),body:l,client_id:a.id}:l,display_mode:t.force_expand==="crosspost"?{body:"visible",comments:"collapsed"}:{body:"collapsed",body_default:t.force_expand,comments:"collapsed"},raw_value:e,link:r.permalink,thumbnail:Ke(r,t.force_expand),layout:"reddit-post",info:{time:r.created_utc*1e3,edited:r.edited===!1?!1:r.edited*1e3,author:ke(r,[]),in:{link:"/"+r.subreddit_name_prefixed,name:r.subreddit_name_prefixed},pinned:r.stickied||!1},actions:[...t.show_post_reply_button??!1?[ce(r.name)]:[],{kind:"link",client_id:a.id,url:r.permalink,text:r.num_comments.toLocaleString()+" comment"+(r.num_comments===1?"":"s")},{kind:"link",client_id:a.id,url:"/domain/"+r.domain,text:r.domain},me(r.name),le(r.name),pe(r.name,r.saved),Q(r),{kind:"link",client_id:a.id,url:r.permalink.replace("/comments/","/duplicates/"),text:"Duplicates"},ue(r.name,r.subreddit)],default_collapsed:!1}}else if(e.kind==="more"){const r=e.data;if(r.children.length===0)return{kind:"load_more",load_more:A.encode({kind:"parent_permalink",permalink:i.permalink}),url:i.permalink,count:void 0,raw_value:e};if(t.link_fullname==null)throw new Error("!options.link_fullname");return{kind:"load_more",load_more:A.encode({kind:"api_loadmore",link_fullname:t.link_fullname,children:r.children,parent_permalink:i}),url:i.permalink,count:r.children.length,raw_value:e}}else if(e.kind==="t5"){const{data:r}=e;return{kind:"thread",display_mode:{body:"collapsed",body_default:"closed",comments:"visible"},raw_value:e,link:r.url,layout:"reddit-post",title:{text:r.display_name_prefixed},thumbnail:{kind:"image",url:r.community_icon},body:{kind:"text",client_id:a.id,content:r.description_html,markdown_format:"reddit_html"},actions:[be(r.url.replace("/r/","").replace("/u/","u_"),r.subscribers,r.user_is_subscriber??!1)],default_collapsed:!0}}else return v(e.kind),{kind:"thread",title:{text:"unsupported listing kind "+e.kind},body:{kind:"text",client_id:a.id,content:"unsupported",markdown_format:"none"},display_mode:{body:"collapsed",comments:"collapsed"},raw_value:e,link:"TODO no link",layout:"error",actions:[],default_collapsed:!1}}function qt(){const e=typeof location<"u"?location.host:"NOSTATE",t=["account","creddits","edit","flair","history","identity","livemanage","modconfig","modcontributors","modflair","modlog","modmail","modothers","modposts","modself","modwiki","mysubreddits","privatemessages","read","report","save","structuredstyles","submit","subscribe","vote","wikiedit","wikiread"].join(" ");return"raw!https://www.reddit.com/api/v1/authorize?"+w({client_id:se,response_type:"code",state:e,redirect_uri:Se,duration:"permanent",scope:t})}async function Z(e){if(e.kind==="homepage")return{sidebar:null};if(e.kind==="userpage")return{sidebar:null};if(e.kind==="mod")return{sidebar:null};if(e.kind==="subreddit"){const[t,i]=await Promise.all([_(`/r/${e.subreddit}/api/widgets`,{method:"GET",onerror:n=>{},cache:!0}),_(`/r/${e.subreddit}/about`,{method:"GET",onerror:n=>{},cache:!0})]),r={subreddit:e.subreddit,sub_t5:i??null,widgets:t??null};return{sidebar:jt(r),header:It(r)}}if(e.kind==="multireddit"){const[t]=await Promise.all([_("/"+["api","multi",...e.base].join("/"),{method:"GET",onerror:i=>{},cache:!0})]);return{sidebar:t?Lt(t):null}}C(e)}function Lt(e){const t=e.data;return[{kind:"widget",title:t.display_name,raw_value:e,widget_content:{kind:"body",body:{kind:"array",body:[{kind:"richtext",content:[o.p(o.txt("Curated by "),o.link(a,"/u/"+t.owner,{is_user_link:t.owner.toLowerCase()},o.txt("u/"+t.owner))),o.p(o.txt("Created "),o.timeAgo(t.created_utc*1e3))]},{kind:"text",client_id:a.id,content:t.description_html,markdown_format:"reddit_html"}]}},actions_bottom:[{kind:"link",client_id:a.id,text:"Create a copy",url:"TODO"}]},{kind:"widget",title:"Subreddits ("+t.subreddits.length+")",raw_value:t.subreddits,widget_content:{kind:"list",items:t.subreddits.map(i=>({name:{kind:"text",text:"r/"+i.name},click:{kind:"link",client_id:a.id,url:"/r/"+i.name}}))}}]}function Ze(e){const t=e.banner_background_image||e.banner_img||"",i=e.primary_color||"",r=e.community_icon||e.icon_img||"";return{banner:t?{kind:"image",desktop:t}:i?{kind:"color",color:i}:null,icon:r?{url:r}:null}}function Ft(e,t,i){const r=[];return e?.data?r.push({kind:"bio",...Ze(e.data.subreddit),name:{display:e.data.name,link_name:"u/"+e.data.name},menu:null,raw_value:e,body:{kind:"text",client_id:a.id,content:e.data.subreddit.public_description_html,markdown_format:"reddit_html"},subscribe:{kind:"counter",client_id:a.id,increment:{icon:"join",color:"white",label:"Follow",undo_label:"Unfollow"},decrement:null,unique_id:"/follow/"+e.data.name+"/",time:Date.now(),style:"pill-filled",incremented_style:"pill-empty",count_excl_you:e.data.is_friend?e.data.subreddit.subscribers-1:e.data.subreddit.subscribers,you:e.data.is_friend?"increment":void 0,actions:{error:"TODO implement add friend"}}},{kind:"widget",title:"About",widget_content:{kind:"body",body:{kind:"richtext",content:[o.h1(o.link(a,"/u/"+e.data.name,{is_user_link:e.data.name},o.txt(e.data.name))),o.p(o.txt(e.data.link_karma+" post karma")),o.p(o.txt(e.data.comment_karma+" comment karma")),o.p(o.txt("Account created "),o.timeAgo(e.data.created_utc*1e3))]}},raw_value:e}):r.push({kind:"widget",title:"TODO",widget_content:{kind:"body",body:{kind:"richtext",content:[o.p(o.txt("Failed to fetch user info for this user :("))]}},raw_value:e}),i?.data?r.push({kind:"widget",title:"Moderates",raw_value:i,widget_content:{kind:"list",items:i.data.map(n=>({icon:n.community_icon||n.icon_img||"undefined",name:{kind:"text",text:n.sr_display_name_prefixed},click:{kind:"link",url:n.url}}))}}):i||r.push({kind:"widget",title:"TODO",widget_content:{kind:"body",body:{kind:"richtext",content:[o.p(o.txt("Failed to fetch modded subs for this user :("))]}},raw_value:i}),t?.data?r.push({kind:"widget",title:"Trophy Case",widget_content:{kind:"body",body:{kind:"richtext",content:[...t.data.trophies.map(({data:n})=>{const d=[...n.url!=null?[o.p(o.link(a,n.url,{},o.txt(n.url)))]:[],...n.description!=null?[o.p(o.txt(n.description))]:[]];return{kind:"body",body:{kind:"crosspost",client_id:a.id,source:{kind:"thread",title:{text:n.name},body:d.length?{kind:"richtext",content:d}:{kind:"none"},thumbnail:{kind:"image",url:n.icon_70},display_mode:{body:"collapsed",comments:"collapsed",body_default:"closed"},raw_value:n,link:n.icon_70,layout:"reddit-post",info:{time:n.granted_at!=null?n.granted_at*1e3:!1,edited:!1,pinned:!0},actions:[],default_collapsed:!1}}}})]}},raw_value:e}):r.push({kind:"widget",title:"TODO",widget_content:{kind:"body",body:{kind:"richtext",content:[o.p(o.txt("Failed to fetch trophy case for this user :("))]}},raw_value:t}),r}function re(e){let t=f.parse(e);for(let i=0;t.kind==="redirect"&&i<100;i++)e=t.to,t=f.parse(e);return[t,e]}function Gt(e){return e}const a={id:"reddit",getPage:Le,loader:kt,async getThread(e){try{const[t,i]=re(e);if(console.log("PARSED URL:",t),t.kind==="comments"){const[r,n]=await Promise.all([_(`/comments/${t.post_id_unprefixed}`,{method:"GET",query:{sort:t.sort_override,comment:t.focus_comment,context:t.context}}),Z(t.sub)]);return E(i,t,r,{...n})}else if(t.kind==="duplicates"){const[r,n]=await Promise.all([_(`/duplicates/${t.post_id_unprefixed}`,{method:"GET",query:{after:t.after,before:t.before,sort:t.sort,crossposts_only:""+t.crossposts_only}}),Z(t.sub)]);return E(i,t,r,{...n})}else if(t.kind==="subreddit"){const r="/"+[...t.sub.base,t.current_sort.v].join("/"),[n,d]=await Promise.all([_(r,{method:"GET",query:{t:t.current_sort.t,before:t.before,after:t.after}}),Z(t.sub)]);return E(i,t,n,{...d})}else if(t.kind==="wiki"){const r="/"+[...t.sub.base,"wiki",...t.path].join("/")+"?"+w(t.query),[n,d]=await Promise.all([_(r,{method:"GET"}),Z(t.sub)]);return E(i,t,n,{...d})}else if(t.kind==="user"){const r=i,[n,d,l,c]=await Promise.all([_(r,{method:"GET"}),_(`/user/${t.username}/about`,{method:"GET",onerror:s=>{},cache:!0}),_(`/api/v1/user/${t.username}/trophies`,{method:"GET",onerror:s=>{},cache:!0}),_(`/user/${t.username}/moderated_subreddits`,{method:"GET",onerror:s=>{},cache:!0})]);return E(i,t,n,{sidebar:Ft(d,l,c)})}else if(t.kind==="subreddits"){const n=await _(i,{method:"GET"});return E(i,t,n,{sidebar:null})}else if(t.kind==="inbox"){if(t.current.tab!=="compose"){if(t.current.tab!=="mod"){if(t.current.tab!=="message")if(t.current.tab==="inbox"){const r="/message/"+t.current.inbox_tab,n=await _(r,{method:"GET"});return E(i,t,n,{sidebar:null})}else t.current.tab==="sent"||C(t.current)}}}else{if(t.kind==="link_out")return{title:"LinkOut",navbar:j(),body:{kind:"one",item:{parents:[{kind:"thread",body:{kind:"richtext",content:[o.h1(o.link(a,"raw!"+t.out,{},o.txt("View on reddit.com"))),o.p(o.txt("ThreadClient does not support this URL"))]},display_mode:{comments:"visible",body:"visible"},link:i,raw_value:t,layout:"reddit-post",actions:[],default_collapsed:!1}],replies:[]}},display_style:"comments-view"};if(t.kind==="todo"){const r=await _(t.path,{method:"GET",onerror:n=>({kind:"unsupported",extra:{title:n.message,stack:n.stack,console:n}})});return E(i,t,r,{sidebar:[{kind:"widget",title:"TODO",widget_content:{kind:"body",body:{kind:"richtext",content:[o.p(o.txt("This page "),o.code(i),o.txt(" is not supported (yet)")),o.p(o.link(a,"raw!https://www.reddit.com"+t.path,{},o.txt("View on reddit.com"))),o.p(o.txt(t.msg))]}},raw_value:t}]})}else if(t.kind==="raw"){const r=await _(t.path,{method:"GET"});return J(i,r,{sidebar:[{kind:"widget",title:"Raw",widget_content:{kind:"body",body:{kind:"richtext",content:[o.p(o.txt("This is a raw page.")),o.p(o.link(a,t.path,{},o.txt("View Rendered")))]}},raw_value:t}]})}else{if(t.kind==="redirect")return{title:"LinkOut",navbar:j(),body:{kind:"one",item:{parents:[{kind:"thread",body:{kind:"richtext",content:[o.h1(o.txt("Error! Redirect Loop")),o.p(o.txt("ThreadClient tried to redirect over 100 times.")),o.p(o.txt("Path: "),o.code(i),o.error("Code",t))]},display_mode:{comments:"visible",body:"visible"},link:i,raw_value:t,layout:"reddit-post",actions:[],default_collapsed:!1}],replies:[]}},display_style:"comments-view"};C(t)}}return J(i,t,{sidebar:[{kind:"widget",title:"TODO",widget_content:{kind:"body",body:{kind:"richtext",content:[o.p(o.txt("This page "),o.code(i),o.txt(" is not supported (yet)")),o.p(o.txt(t.kind)),o.p(o.txt("View it on "),o.link(a,"raw!https://reddit.com"+i,{},o.txt("reddit.com")),o.txt("."))]}},raw_value:t}]})}catch(t){const i=t;console.log(i);const r=i.toString().includes("NetworkError");return{title:"Error",navbar:j(),body:{kind:"one",item:{parents:[{kind:"thread",title:{text:"Error"},body:{kind:"text",client_id:a.id,content:`Error ${i.toString()}`+(r?". If you're using Firefox, try disabling 'Enhanced Tracker Protection'  for this site. Enhanced tracker protection indiscriminately blocks all  requests to social media sites, including Reddit.":"."),markdown_format:"none"},display_mode:{body:"visible",comments:"collapsed"},link:e,layout:"error",actions:[],default_collapsed:!1,raw_value:{}}],replies:[]}},display_style:"comments-view"}}},async login(e,t){const i=t.get("code"),r=t.get("state");if(i==null||r==null)throw new Error("No login requested");if(r!==location.host)throw new Error("Login was for "+r);const n=await fetch("https://www.reddit.com/api/v1/access_token",{method:"POST",mode:"cors",credentials:"omit",headers:{Authorization:"Basic "+btoa(se+":"),"Content-Type":"application/x-www-form-urlencoded"},body:w({grant_type:"authorization_code",code:i,redirect_uri:Se})}).then(l=>l.json());if(n.error)throw console.log(n.error),new Error("error "+n.error);const d={access_token:n.access_token,refresh_token:n.refresh_token,expires:Date.now()+n.expires_in*1e3,scope:n.scope};console.log(n,d),localStorage.setItem("reddit-secret",JSON.stringify(d))},async fetchRemoved(e){const t=Re.decode(e),[i,r]=await fetch(t.path).then(async l=>[l.status,await l.text()]),n=JSON.parse(r.split("&lt;").join("<").split("&gt;").join(">").split("&amp;").join("&"));if(i!==200)throw console.log(i,n),new Error("Got status "+i);if(n.data.length===0)throw console.log(i,n),new Error("Post was deleted before it could be saved:.");const d=n.data[0];if(d.selftext==="[deleted]"||d.selftext==="[removed]"||d.body==="[deleted]"||d.body==="[removed]")throw new Error("Post was deleted before it could be saved.");if(d.selftext)return{kind:"text",client_id:a.id,content:d.selftext,markdown_format:"reddit"};if(d.body)return{kind:"text",client_id:a.id,content:d.body,markdown_format:"reddit"};throw console.log("got item",d),new Error("no selftext or body")},async act(e){const t=P.decode(e);if(t.kind==="vote"){const i=await _("/api/vote",{method:"POST",mode:"urlencoded",body:t.query});console.log(i)}else if(t.kind==="delete"){const i=await _("/api/del",{method:"POST",mode:"urlencoded",body:{id:t.fullname}});console.log(i)}else if(t.kind==="save"){const i=await _(`/api/${t.direction}save`,{method:"POST",mode:"urlencoded",body:{id:t.fullname}});console.log(i)}else if(t.kind==="subscribe"){const i=await _("/api/subscribe",{method:"POST",mode:"urlencoded",body:{action:t.direction,sr_name:t.subreddit}});console.log(i)}else if(t.kind==="mark_read"){const i=await _(`/api/${t.direction}read_message`,{method:"POST",mode:"urlencoded",body:{id:t.fullname},override:!0});console.log(i)}else t.kind==="log_out"?localStorage.removeItem("reddit-secret"):et(t)},previewReply(e,t){fe.decode(t);const i={kind:"thread",body:{kind:"text",client_id:a.id,content:e,markdown_format:"reddit"},display_mode:{body:"visible",comments:"visible"},raw_value:[e,t],link:"no link",layout:"reddit-comment",info:{time:!1,edited:!1,author:{name:"TODO You",color_hash:"TODO You",link:"/u/TODO You",client_id:a.id},pinned:!1},actions:[{kind:"counter",client_id:a.id,increment:{icon:"up_arrow",color:"reddit-upvote",label:"Upvote",undo_label:"Undo Upvote"},decrement:{icon:"down_arrow",color:"reddit-downvote",label:"Downvote",undo_label:"Undo Downvote"},special:"reddit-points",unique_id:null,time:0,count_excl_you:0,you:"increment",percent:1,actions:{error:"reply not posted"}}],default_collapsed:!1};return{kind:"legacy",client_id:a.id,thread:i}},async sendReply(e,t,i){const r=fe.decode(t),n=[];for(let u=0;u<=7;u++){if(u===4||u===7)continue;const m="Testing 1<<"+u;n.push({e:"par",c:[{e:"text",t:m,f:[[1<<u,0,7],[64,8,m.length]]}]})}const d={document:n},l={api_type:"json",thing_id:r.parent_id,return_rtjson:"true",...e==="richtext_demo"?{richtext_json:JSON.stringify(d)}:{text:e}},c={reply:"/api/comment",edit:"/api/editusertext"}[i],s=await _(c,{method:"POST",mode:"urlencoded",body:l});return console.log(s),F({kind:"t1",data:s},{},{permalink:"TODO",sort:"unsupported",is_chat:!1})},async fetchReportScreen(e){const t=He.decode(e),[i,r]=await Promise.all([await _(`/r/${t.subreddit}/about/rules`,{method:"GET",cache:!0}),await _(`/r/${t.subreddit}/about`,{method:"GET",cache:!0})]),n=t.fullname.startsWith("t1_")?"comment":t.fullname.startsWith("t3_")?"link":"unsupported",d=[],l=[];for(const c of i.rules){if(c.kind==="link"){if(n!=="link")continue}else if(c.kind==="comment"){if(n!=="comment")continue}else c.kind==="all"||v(c.kind);l.push({title:c.violation_reason,description:{kind:"text",client_id:a.id,content:c.description_html??"",markdown_format:"reddit_html"},report:{kind:"submit",data:V.encode({fullname:t.fullname,subreddit:t.subreddit,reason:{kind:"sub",id:c.short_name}})}})}r.data.free_form_reports&&l.push({title:"Custom Reason",report:{kind:"textarea",input_title:"Custom Reason",char_limit:100,data:V.encode({fullname:t.fullname,subreddit:t.subreddit,reason:{kind:"sub_other"},text_max:100})}}),d.push({title:"r/"+t.subreddit+"'s rules",report:{kind:"more",screens:l}});for(const c of i.site_rules_flow)d.push(Xe(t,c));return d},async sendReport(e,t){const i=V.decode(e);if(console.log(i,t),i.text_max==null){if(t!=null)throw new Error("never. got text in non-textual entry?")}else{if(t==null)throw new Error("never. missing text");if(t.length>i.text_max)throw new Error("report text too long (max "+i.text_max+")")}if(i.reason.kind==="sub_other"&&t==null)throw new Error("never. missing text on sub_other");const r=await _("/api/report",{method:"POST",mode:"urlencoded",body:{sr_name:i.subreddit,thing_id:i.fullname,...i.reason.kind==="sub"?{rule_reason:i.reason.id}:i.reason.kind==="site"?{site_reason:i.reason.id,custom_text:t??void 0}:i.reason.kind==="sub_other"?{reason:t}:C(i.reason)}});if(console.log("GOT Response:",r),r.success!==!0)throw console.log(r),new Error("Got error response, check console");return{title:i.reason.kind==="sub_other"?"Report Sent!":i.reason.id,body:t!=null?{kind:"text",client_id:a.id,content:t,markdown_format:"none"}:{kind:"none"}}},async loadMore(e){const t=A.decode(e);if(t.kind==="api_loadmore"){const i=[...t.children],r=i.splice(0,100),n=await _("/api/morechildren",{method:"GET",query:{api_type:"json",limit_children:"false",children:r.join(","),link_id:t.link_fullname,sort:t.parent_permalink.sort}}),d=[],l=new Map;for(const s of n.json.data.things){l.set(s.data.name,s);const u=l.get(s.data.parent_id);if(u){if(u.kind!=="t1")throw new Error("expected t1 here");u.data.replies||={kind:"Listing",data:{before:null,children:[],after:null}},u.data.replies.data.children.push(s)}else d.push(s)}const c=d.map(s=>F(s,{link_fullname:t.link_fullname},t.parent_permalink));if(i.length>0){const s=c[c.length-1];if(s&&s.kind==="load_more"){const u=A.decode(s.load_more);if(u.kind==="api_loadmore")u.children=[...i,...u.children],s.load_more=A.encode(u);else throw new Error("bad (this is not good)")}else c.push({kind:"load_more",load_more:A.encode({kind:"api_loadmore",link_fullname:t.link_fullname,children:i,parent_permalink:t.parent_permalink}),url:t.parent_permalink.permalink,raw_value:i})}return c}else if(t.kind==="parent_permalink"){const i=await _(t.permalink,{method:"GET"}),[r,n]=re(t.permalink);if(r.kind!=="comments")throw new Error("bad link to parent_permalink: "+r.kind);const d=E(n,r,i,{sidebar:null});if(d.body.kind==="one")return d.body.item.replies;throw console.log("Error",d),new Error("todo support load more returning other body ("+d.body.kind+")")}else{if(t.kind==="context")throw new Error("TODO load more context");if(t.kind==="duplicates")throw new Error("TODO load more duplicates");C(t)}},async loadMoreUnmounted(e){const t=We.decode(e);if(t.kind==="listing"){const i=await _(t.url,{method:"GET"}),[r,n]=re(t.url),d=E(n,r,i,{sidebar:null});if(d.body.kind==="listing")return{children:d.body.items,next:d.body.next};throw console.log("Error",d),new Error("todo support load more returning other body ("+d.body.kind+")")}else{if(t.kind==="TODO more")throw new Error("TODO more");C(t)}},async hydrateInbox(e){const t=Te.decode(e);if(t.kind==="inbox"){const r=(await _("/api/me",{method:"GET"})).data.inbox_count;return{messages:r===0?{kind:"zero"}:{kind:"exact",value:r},url:r===0?"/message/inbox":"/message/unread"}}else if(t.kind==="modmail"){const i=await _("/api/mod/conversations/unread/count",{method:"GET"});return{messages:i.notifications>0?{kind:"exact",value:i.notifications}:{kind:"zero"},url:"/mod/mail/all"}}else C(t)}};function C(e){throw console.log("not never:",e),new Error("Expected never")}function Xe(e,t){let i;if("nextStepReasons"in t)i={kind:"more",screens:t.nextStepReasons.map(r=>Xe(e,r))};else if("fileComplaint"in t&&t.fileComplaint===!0){const r=t.complaintUrl.replace("%25%28thing%29",encodeURIComponent(e.fullname));i={kind:"more",screens:[{title:t.complaintPageTitle,description:{kind:"text",client_id:a.id,content:t.complaintPrompt,markdown_format:"none"},report:{kind:"link",url:"raw!"+r,text:t.complaintButtonText}}]}}else if("canWriteNotes"in t&&t.canWriteNotes===!0){const r=t.isAbuseOfReportButton??!1?250:2e3;i={kind:"textarea",input_title:t.notesInputTitle,char_limit:r,data:V.encode({fullname:e.fullname,subreddit:e.subreddit,text_max:r,reason:{kind:"site",id:t.reasonText}})}}else"canSpecifyUsernames"in t&&t.canSpecifyUsernames===!0?i={kind:"link",url:"raw!https://reddit.com/report",text:"Open Reddit"}:i={kind:"submit",data:V.encode({fullname:e.fullname,subreddit:e.subreddit,reason:{kind:"site",id:t.reasonText}})};return{title:t.reasonTextToShow,report:i}}const V=I("send_report"),qe=new Map;async function _(e,t){try{const i=await Ot(),r=xt(!!i,x(e,t.query??{}),{override:t.override}),n={method:t.method,mode:"cors",credentials:"omit",headers:{...i?{Authorization:i}:{},...t.method==="POST"?{"Content-Type":{json:"application/json",urlencoded:"application/x-www-form-urlencoded"}[t.mode]}:{}},...t.method==="POST"?{body:t.mode==="json"?JSON.stringify(t.body):t.mode==="urlencoded"?Object.entries(t.body).flatMap(([m,k])=>k==null?[]:[encodeURIComponent(m)+"="+encodeURIComponent(k)]).join("&"):et(t)}:{}},d=JSON.stringify([r,n]),l=qe.get(d);if(l!=null&&(t.cache??!1))return l;const[c,s]=await fetch(r,n).then(async m=>[m.status,await m.json()]);if(c!==200){if(t.onstatus)return t.onstatus(c,s);throw console.log(c,s),new Error("got status "+c)}const u=s;if(typeof u=="object"){if("json"in u&&typeof u.json=="object"&&"errors"in u.json&&u.json.errors.length>0)throw new Error(u.json.errors.map(([m,k])=>m+": "+k).join(", "));if("jquery"in u&&Array.isArray(u.jquery)&&"success"in u&&u.success===!1)throw new Error(u.jquery.flatMap(m=>m[2]==="call"?m[3].map(k=>typeof k=="string"?k:""):[]).join(", "))}return(t.cache??!1)&&qe.set(d,s),s}catch(i){if(console.log("Got error",i),t.onerror)return t.onerror(i);throw i}}const fe=I("reply");function et(e){throw console.log(e),new Error("not unreachable")}export{ze as authorFromInfo,ke as authorFromPostOrComment,At as authorFromT2,Pe as awardingsToFlair,a as client,le as deleteButton,Gt as ec,me as editButton,v as expectUnsupported,Y as flairToGenericFlair,Oe as getCodeButton,Ve as getCommentBody,Q as getPointsOn,Ye as getPostBody,Qe as getPostFlair,Ke as getPostThumbnail,E as pageFromListing,re as parseLink,_ as redditRequest,ce as replyButton,ue as reportButton,pe as saveButton,Je as sortWrap,x as updateQuery,te as urlNotSupportedYet};
