import{e as u,y as k,z as L,A as J,B as T,D as a}from"./index.b7d67373.js";import{e as w}from"./base.50b98d34.js";function K(e,t){const n=[];function i(){r.length>0&&n.push(u.p(...r)),r=[]}let r=[];for(const o of Array.from(t)){const l=Q(e,o);l?(i(),n.push(l)):r.push(...U(e,o,{}))}return i(),n}function Q(e,t){if(t instanceof HTMLElement&&t.nodeName==="P")return u.p(...h(e,t.childNodes,{}))}function h(e,t,n){return Array.from(t).flatMap(i=>U(e,i,n))}function U(e,t,n){if(t instanceof Text){const r=(t.nodeValue??"[ENoNodeValue]").split(":"),o=[];let l=[];const s=()=>{l.length>0&&o.push(u.txt(l.join(":"),n)),l=[]};for(const d of r){const p=e.emojis.get(d);p?(s(),o.push(u.kind("emoji",{url:p.static_url,name:":"+d+":"}))):l.push(d)}return s(),o}if(t instanceof HTMLElement){let i=Array.from(t.classList).filter(l=>!(l.startsWith("h-")||l.startsWith("p-")||l.startsWith("u-")));const r=l=>i.includes(l)?(i=i.filter(s=>s!==l),!0):!1,o=(...l)=>i.length!==0?[u.error(i.map(s=>"."+s).join(""),t.outerHTML)]:l;if(t.nodeName==="A"){const l=t.getAttribute("href")??"no href";if(!l.startsWith("http://")&&!l.startsWith("https://"))return o(u.error("Bad link",l));if(r("hashtag")){r("mention");const s=h(e,t.childNodes,n),d=t.textContent;return d==null||!d.startsWith("#")?[u.error("bad hashtag",[s,t])]:o(u.link(c,"/"+e.host+"/timelines/tag/"+encodeURIComponent(d),{},...s))}if(r("mention")){const s=e.mentions.get(l);if(s)return o(u.link(c,"/"+e.host+"/accounts/"+s.id,{is_user_link:s.username},u.txt("@"+s.acct,n)))}return o(u.link(c,l,{},...h(e,t.childNodes,n)))}if(t.nodeName==="BR")return o(u.br());if(t.nodeName==="SPAN"){const l=h(e,t.childNodes,n);return i.includes("invisible")?[]:(r("ellipsis")&&l.push(u.txt("\u2026",n)),r("h-card"),o(...l))}return t.nodeName==="STRONG"||t.nodeName==="B"?h(e,t.childNodes,{...n,strong:!0}):t.nodeName==="EM"||t.nodeName==="I"?h(e,t.childNodes,{...n,emphasis:!0}):[u.error("<"+t.nodeName+">",{node:t,html:t.outerHTML})]}return[u.error("Unsupported Node",t)]}function Y(e,t,n){const i=document.createElement("div");i.innerHTML=t;const r=new Map;for(const s of n.emojis)r.set(s.shortcode,s);const o=new Map;for(const s of n.mentions)o.set(s.url,s);return[{host:e,emojis:r,mentions:o},i.childNodes]}function q(e,t,n){return K(...Y(e,t,n))}function O(e){const t={};if(e.kind==="home")return"/api/v1/timelines/home?"+k({...t});if(e.kind==="public")return"/api/v1/timelines/public?"+k({...t,local:"false"});if(e.kind==="local")return"/api/v1/timelines/public?"+k({...t,local:"true"});if(e.kind==="tag")return"/api/v1/timelines/tag/"+e.tag+"?"+k({...t});if(e.kind==="account")return"/api/v1/accounts/"+e.account_id+"/statuses?"+k({...t});L(e)}function X(e,t){if(t.kind==="home")return"/"+e+"/home";if(t.kind==="public")return"/"+e+"/public";if(t.kind==="local")return"/"+e+"/public/local";if(t.kind==="tag")return"/"+e+"/tags/"+t.tag;if(t.kind==="account")return"/"+e+"/accounts/"+t.account_id;L(t)}const A=J();A.with([{host:"any"}],e=>{e.route(["raw",{path:"rest"}],n=>({kind:"raw",path:"/"+n.path.join("/")+"?"+k(n.query),host:n.host})),e.route([],n=>({kind:"instance-home",host:n.host}));const t=n=>i=>({kind:"timeline",tl:n,host:i.host});e.route(["home"],t({kind:"home"})),e.route(["timelines","home"],t({kind:"home"})),e.route(["public"],t({kind:"public"})),e.route(["timelines","public"],t({kind:"public"})),e.route(["public","local"],t({kind:"local"})),e.route(["timelines","public","local"],t({kind:"local"})),e.route(["conversations"],n=>({kind:"todo",host:n.host})),e.route(["timelines","direct"],n=>({kind:"todo",host:n.host})),e.route(["tags",{tag:"any"}],n=>t({kind:"tag",tag:n.tag})(n)),e.route(["lists",{tag:"any"}],n=>({kind:"todo",host:n.host})),e.route(["notifications"],n=>({kind:"notifications",host:n.host})),e.route(["favourites"],n=>({kind:"todo",host:n.host})),e.route(["bookmarks"],n=>({kind:"todo",host:n.host})),e.route(["pinned"],n=>({kind:"todo",host:n.host})),e.route(["start"],n=>({kind:"todo",host:n.host})),e.route(["directory"],n=>({kind:"todo",host:n.host})),e.route(["explore"],n=>({kind:"todo",host:n.host})),e.route(["search"],n=>({kind:"todo",host:n.host})),e.route(["publish"],n=>({kind:"todo",host:n.host})),e.route(["statuses","new"],n=>({kind:"todo",host:n.host})),e.with(["accounts",{id:"any"}],n=>{n.route([],i=>t({kind:"account",account_id:i.id})(i)),n.route(["with_replies"],i=>({kind:"todo",host:i.host})),n.route(["followers"],i=>({kind:"todo",host:i.host})),n.route(["following"],i=>({kind:"todo",host:i.host})),n.route(["media"],i=>({kind:"todo",host:i.host}))}),e.with([{acct:{kind:"starts-with",text:"@"}}],n=>{n.catchall(i=>({kind:"acct_internal_redirect",host:i.host,acct:i.acct}))}),e.route(["timelines","tag",{tag:"any"}],n=>t({kind:"tag",tag:n.tag})(n)),e.route(["timelines","list",{id:"any"}],n=>({kind:"todo",host:n.host})),e.with(["statuses",{status_id:"any"}],n=>{n.route([],i=>({kind:"status",status:i.status_id,host:i.host})),n.route(["reblogs"],i=>({kind:"todo",host:i.host})),n.route(["favourites"],i=>({kind:"todo",host:i.host}))}),e.route(["follow_rquests"],n=>({kind:"todo",host:n.host})),e.route(["blocks"],n=>({kind:"todo",host:n.host})),e.route(["domain_blocks"],n=>({kind:"todo",host:n.host})),e.route(["mutes"],n=>({kind:"todo",host:n.host})),e.route(["lists"],n=>({kind:"todo",host:n.host})),e.catchall(n=>({kind:"404",reason:"Not Found",host:n.host}))});A.catchall(()=>({kind:"instance-selector"}));const E=e=>"https://"+location.host+"/login/mastodon/"+e;function z(e){return e==null||e===""?{actions:[],inboxes:[]}:{actions:[rt(e)?{kind:"link",client_id:c.id,text:"Log Out",url:"TODO log out from mastodon"}:{kind:"login",client_id:c.id,data:B.encode({host:e})}],inboxes:[]}}const Z=(e,t)=>({title:"Error",navbar:z(e),body:{kind:"one",item:{parents:[{kind:"thread",title:{text:"Error"},body:{kind:"text",client_id:c.id,content:t,markdown_format:"none"},display_mode:{body:"visible",comments:"collapsed"},link:"TODO no link",layout:"error",actions:[],default_collapsed:!1,raw_value:{}}],replies:[]}},display_style:"comments-view"}),$=()=>({kind:"thread",title:{text:"Listing"},body:{kind:"text",client_id:c.id,content:"Listing",markdown_format:"none"},display_mode:{body:"collapsed",comments:"collapsed"},link:"TODO no link",layout:"error",actions:[],default_collapsed:!1,raw_value:{}});function _(e,...t){return"https://"+e+"/"+t.join("/")}async function m(e,t,n="GET"){try{const i=localStorage.getItem("--use-mock"),[r,o]=await fetch((i??"")+t,{method:n,headers:{Accept:"application/json",...e?{Authorization:e.token_type+" "+e.access_token}:{}}}).then(async l=>[l.status,await l.json()]);return r!==200&&console.log("got status "+r,o),o}catch(i){return{error:"Failed to load! "+i.toString()}}}function tt(e,t){let n=[];return t.flatMap((i,r)=>{const o=nt(e,i);let l=[];if(i.in_reply_to_id!=null){if(t[r+1]?.id===i.in_reply_to_id)return n.unshift(o),[];l=[{kind:"load_more",url:"/"+e+"/statuses/"+i.in_reply_to_id,raw_value:i,load_more:gt.encode({kind:"context",host:e,parent_id:i.in_reply_to_id})}]}const s=n;return n=[],[{parents:[...l,o,...s],replies:[]}]})}function et(e,t){return t.type==="image"?{thumb:t.preview_url??"https://dummyimage.com/100x100/ff0000/000000&text=image",aspect:t.meta?.small?t.meta.small.width/t.meta.small.height:void 0,body:t.meta?{kind:"captioned_image",url:t.url,w:t.meta.original?.width??null,h:t.meta.original?.height??null,alt:t.description}:{kind:"link",url:t.url,client_id:c.id}}:t.type==="video"||t.type==="gifv"?{thumb:t.preview_url??"https://dummyimage.com/100x100/ff0000/000000&text=video",aspect:t.meta?.small?t.meta.small.width/t.meta.small.height:void 0,body:t.meta?{kind:"video",source:{kind:"video",sources:[{url:t.url,quality:t.meta.original?.width+"\xD7"+t.meta.original?.width}]},aspect:t.meta.original?t.meta.original.width/t.meta.original.height:void 0,gifv:t.type==="gifv"}:{kind:"link",url:t.url,client_id:c.id}}:t.type==="audio"?{thumb:t.preview_url??"https://winaero.com/blog/wp-content/uploads/2017/12/speaker-sound-audio-icon-256-big.png",aspect:1,body:{kind:"audio",url:t.url,alt:t.description}}:t.type==="unknown"?{thumb:t.preview_url??"https://dummyimage.com/100x100/ff0000/000000&text=unknown",aspect:1,body:{kind:"array",body:[{kind:"text",client_id:c.id,content:"alt: "+t.description,markdown_format:"none"},{kind:"link",client_id:c.id,url:t.url},...t.remote_url!=null?[{kind:"link",client_id:c.id,url:t.remote_url}]:[]]}}:(t.type,{thumb:"https://dummyimage.com/100x100/ff0000/000000&text="+encodeURIComponent(t.type),aspect:1,body:{kind:"link",client_id:c.id,url:t.url}})}function nt(...e){throw new Error("DELETE")}function it(e,t,n={}){try{return ot(e,t,n)}catch(i){return{kind:"post",title:{text:"Error!"},body:{kind:"richtext",content:[u.p(u.error("Error "+i.toString(),i))]},collapsible:!1}}}function ot(e,t,n={}){if(t.reblog)throw new Error("TODO SUPPORT REBLOG");return{kind:"post",title:null,body:{kind:"array",body:[{kind:"richtext",content:q(e,t.content,{emojis:t.emojis,mentions:t.mentions})},t.media_attachments.length===0?void 0:{kind:"gallery",images:t.media_attachments.map(r=>et(e,r))},t.poll?{kind:"poll",choices:t.poll.options.map((r,o)=>({name:r.title,votes:r.votes_count,id:""+o})),total_votes:t.poll.votes_count,votable:t.poll.expired?"Expired":!0,vote_data:t.poll.id,select_many:t.poll.multiple,your_votes:(t.poll.own_votes??[]).map(r=>({id:""+r})),close_time:new Date(t.poll.expires_at).getTime()}:void 0,t.card?{kind:"oembed",card:t.card,client_id:c.id}:void 0]},collapsible:{default_collapsed:!1},info:{creation_date:new Date(t.created_at).getTime(),comments:t.replies_count},author:{name:t.account.display_name+" (@"+t.account.acct+")",client_id:c.id,color_hash:t.account.username,link:"/"+e+"/accounts/"+t.account.id,flair:t.account.bot??!1?[{elems:[{kind:"text",text:"bot",styles:{}}],content_warning:!1}]:[],pfp:{url:t.account.avatar_static,full_size_animated:t.account.avatar}},flair:t.sensitive||t.spoiler_text?[{content_warning:t.sensitive,elems:[{kind:"text",text:t.spoiler_text||"Sensitive",styles:{}}]}]:void 0,actions:{vote:{kind:"counter",client_id:c.id,unique_id:e+"/favourite/"+t.id+"/",neutral_icon:"star",time:Date.now(),increment:{icon:"star",color:"yellow",label:"Favourite",undo_label:"Unfavourite"},decrement:null,count_excl_you:t.favourites_count+(t.favourited??!1?-1:0),you:t.favourited??!1?"increment":void 0,actions:{increment:N.encode({kind:"favourite",direction:"",status:t.id,host:e}),reset:N.encode({kind:"favourite",direction:"un",status:t.id,host:e})}},other:[{kind:"link",client_id:c.id,url:t.uri,text:"Source"}]}}}function I(e,t){return"raw!https://"+e+"/oauth/authorize?"+k({client_id:t.client_id,scope:"read write follow push",redirect_uri:E(e),response_type:"code"})}function b(e){return{get(t){if(!t)return;const n=localStorage.getItem(e(t));if(!(n==null||n===""))return JSON.parse(n)},set(t,n){if(!t)throw console.log(t,n),alert("bad set. check console."),new Error("set performed with no host");localStorage.setItem(e(t),JSON.stringify(n))}}}const f={app:b(e=>"mastodon-application-"+e),token:b(e=>"mastodon-secret-"+e),client_creds:b(e=>"mastodon-client-secret-"+e),client_did_error:b(e=>"mastodon-client-did-error-"+e)},N=w("act");function rt(e){return!!f.token.get(e)}async function x(e){if(!e)return;const t=f.token.get(e)??f.client_creds.get(e);if(!t){const n=f.app.get(e);if(!n||(f.client_did_error.get(e)??!1))return;const{data:i}=n,r=await fetch(_(e,"oauth","token"),{method:"post",mode:"cors",credentials:"omit",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({client_id:i.client_id,client_secret:i.client_secret,redirect_uri:E(e),grant_type:"client_credentials"})}).then(o=>o.json());if("error"in r){f.client_did_error.set(e,!0),console.log(r),alert("failed to get application token. will not try again. :: "+r.error);return}return f.client_creds.set(e,r),r}return t}function R(e,t){return a.stringLink("["+e+"]post_"+t)}function j(e,t){return a.stringLink("["+e+"]post-replies_"+t)}function lt(e,t){return a.stringLink("["+e+"]timeline-object_"+O(t))}function G(e,t,n){return a.stringLink("["+e+"]timeline-content_"+O(t)+"[max:"+n+"]")}function at(e,t,n){return a.stringLink("["+e+"]timeline-loader_"+O(t)+"[max:"+n+"]")}function st(e){return a.stringLink("["+e+"]instance-sidebar")}function ct(e){return a.stringLink("["+e+"]instance-timeline-switcher")}function dt(e){return a.stringLink("["+e+"]instance-info-request")}function H(e){return a.stringLink("["+e+"]instance-info-sidebar-widget")}function g(e){return a.stringLink("["+e+"]client")}function ut(){return a.stringLink("instance-selector")}function v(e,t,n){const i=R(e,n.id),r=a.stringLink("post-loadcontext_"+n.id);return a.fillLink(t,r,S.encode({kind:"context",host:e,center_id:n.id,center_parent:n.in_reply_to_id??null})),a.fillLink(t,i,{kind:"post",content:it(e,n),internal_data:n,parent:n.in_reply_to_id!=null?{loader:{kind:"vertical_loader",key:R(e,n.in_reply_to_id),temp_parent:g(e),load_count:null,request:r,client_id:c.id,autoload:!0}}:{loader:{kind:"vertical_loader",key:g(e),temp_parent:g(e),load_count:null,request:a.createSymbolLinkToError(t,"should never be unloaded",g(e)),client_id:c.id,autoload:!0}},replies:{display:"tree",loader:{kind:"horizontal_loader",key:j(e,n.id),load_count:n.replies_count,request:r,client_id:c.id,autoload:!0}},url:"/"+e+"/statuses/"+n.id,client_id:c.id}),i}function pt(e,t){e[t]||a.fillLink(e,t,{kind:"post",content:{kind:"post",title:{text:"Instance Selector"},body:{kind:"mastodon_instance_selector",client_id:c.id},collapsible:!1},internal_data:t,parent:null,replies:null,url:"/",client_id:c.id})}const B=w("login_url"),c={id:"mastodon",getLoginURL:async e=>{const{host:t}=B.decode(e);if(t==null)throw new Error("can't login without selecting host first");const n=f.app.get(t);if(n){if(n.host!==t)throw new Error("This should never happen.");return I(t,n.data)}const i=await fetch(_(t,"api/v1","apps"),{method:"post",mode:"cors",credentials:"omit",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({client_name:"ThreadClient",redirect_uris:E(t),scopes:"read write follow push",website:"https://thread.pfg.pw"})}).then(r=>r.json());if("error"in i)throw console.log(i),new Error("Got error:"+i.error);return f.app.set(t,{host:t,data:i}),I(t,i)},login:async(e,t)=>{if(e.length!==2)throw new Error("bad login");const n=e[1],i=t.get("code");if(i==null)throw new Error("missing code");const r=f.app.get(n);if(!r)throw new Error("An app was not registered - how did you even get here?");const{data:o}=r,l=await fetch(_(n,"oauth","token"),{method:"post",mode:"cors",credentials:"omit",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({client_id:o.client_id,client_secret:o.client_secret,redirect_uri:E(n),grant_type:"authorization_code",code:i,scope:"read write follow push"})}).then(s=>s.json());if("error"in l)throw console.log(l),new Error("Got error (check console): "+l.error);f.token.set(n,l),console.log(l)},getPage:async e=>{const t=A.parse(e)??{kind:"404",reason:"This should never happen"};if(t.kind==="instance-selector"){const o=ut(),l={};return pt(l,o),{pivot:o,content:l}}else if(t.kind==="404")throw new Error("TODO 404 PAGE");const n=t.host,i=await x(n);if(t.kind==="acct_internal_redirect"){const o=await m(i,_(n,T("api/v1/accounts/lookup",{acct:t.acct})));if("error"in o)throw new Error("mastodon error: "+o.error);const l=e.replace("/@"+t.acct,"/accounts/"+o.id);if(l===e)throw new Error("bad acct_internal_redirect");const s=await c.getPage(l);return M(s.content,n,o),s}const r={};if(a.fillLink(r,g(n),{kind:"post",content:{kind:"page",title:null,wrap_page:{sidebar:mt(r,n),header:{kind:"bio",banner:null,icon:null,name:{link_name:e},body:{kind:"none"},menu:null,raw_value:[e,t]}}},internal_data:"@root",parent:null,replies:null,client_id:c.id,url:null}),t.kind==="instance-home")return{content:r,pivot:a.createSymbolLinkToValue(r,{kind:"post",content:{kind:"post",title:{text:n},body:{kind:"richtext",content:[u.ul(...[["/"+n+"/timelines/public","Federated Timeline"],["/"+n+"/timelines/local","Local Timeline"]].map(([o,l])=>u.li(u.p(u.link(c,o,{},u.txt(l))))))]},collapsible:{default_collapsed:!1}},internal_data:0,parent:null,replies:null,url:null,client_id:"mastodon"})};if(t.kind==="timeline"){const o=y(r,n,t.tl);return{content:r,pivot:o}}else if(t.kind==="status"){const o=await m(i,_(n,"api/v1/statuses",t.status));if("error"in o)throw new Error("ERRORED; "+o.error+"; TODO SHOW EMSG SCREEN");const l=v(n,r,o);return{content:r,pivot:l}}else{if(t.kind==="notifications")throw new Error("TODO SUPPORT NOTIFICATIONS TAB");if(t.kind==="raw")throw new Error("TODO SUPPORT RAW VIEW");if(t.kind==="todo")throw new Error("TODO support page: "+e)}L(t)},async act(e){const t=N.decode(e);t.kind==="favourite"?await C(t.host,"api/v1/statuses/"+t.status+"/"+t.direction+"favourite"):t.kind==="follow"?await C(t.host,"api/v1/accounts/"+t.account_id+"/"+t.direction+"follow"):ft(t)},previewReply(e,t){throw new Error("TODO")},sendReply(e,t){throw new Error("NIY")},async loader(e){const t=S.decode(e),{host:n}=t,i=await x(t.host),r={};if(t.kind==="context"){const o=await m(i,_(n,"api/v1/statuses",t.center_id,"context"));if("error"in o)throw new Error("got error: "+o.error);const l=new Map;for(const d of o.descendants)l.has(d.in_reply_to_id)||l.set(d.in_reply_to_id,[]),l.get(d.in_reply_to_id).push(d.id);const s=d=>(l.get(d)??[]).map(p=>R(n,p));for(const d of o.descendants)v(n,r,d),a.fillLink(r,j(n,d.id),s(d.id));a.fillLink(r,j(n,t.center_id),s(t.center_id));for(const d of o.ancestors)v(n,r,d);return{content:r}}else if(t.kind==="timeline"){const o=await m(i,_(n,T(O(t.timeline),{since_id:void 0,min_id:void 0,max_id:t.max_id??void 0})));if("error"in o)throw new Error("got error: "+o.error);const l=G(n,t.timeline,t.max_id),s=o[o.length-1],d=o.map(p=>v(n,r,p));return s&&d.push(W(r,n,t.timeline,s.id)),a.fillLinkOnce(r,l,()=>d),{content:r}}else if(t.kind==="instance-info"){const o=await m(i,_(n,"api/v1/instance"));if("error"in o)throw new Error("got error: "+o.error);return a.fillLink(r,H(n),[a.fillLink(r,a.symbolLink("instance-info"),{kind:"post",content:{kind:"post",title:{text:o.title},thumbnail:o.thumbnail!=null?{kind:"image",url:o.thumbnail}:void 0,body:{kind:"richtext",content:[u.p(u.txt(o.stats.user_count.toLocaleString(void 0)+" users \xB7 "+o.stats.status_count.toLocaleString(void 0)+" statuses \xB7 "+o.stats.domain_count.toLocaleString(void 0)+" domains")),...q(n,o.description,{emojis:[],mentions:[]}),u.p(u.txt("Running version "+o.version))]},collapsible:{default_collapsed:!1}},internal_data:o,parent:null,url:null,replies:null,client_id:c.id}),...o.rules.length>0?[a.fillLink(r,a.symbolLink("instance-info"),{kind:"post",content:{kind:"post",title:{text:"Rules"},body:{kind:"none"},collapsible:!1},internal_data:o,parent:null,url:null,client_id:c.id,replies:{display:"tree",loader:a.prefilledHorizontalLoader(r,a.symbolLink("instance-info"),o.rules.map(l=>a.fillLink(r,a.symbolLink(""),{kind:"post",content:{kind:"post",title:{text:l.id+". "+l.text},body:{kind:"none"},collapsible:!1},parent:null,url:null,client_id:c.id,internal_data:l,replies:null})))}})]:[],a.fillLink(r,a.symbolLink("instance-info"),{kind:"post",content:{kind:"post",title:{text:"Contact"},body:{kind:"richtext",content:[u.p(u.txt(o.email))]},collapsible:!1},internal_data:o,parent:null,url:null,replies:o.contact_account!=null?{display:"repivot_list",loader:a.prefilledHorizontalLoader(r,a.symbolLink("instance-info"),[M(r,n,o.contact_account)])}:null,client_id:c.id}),a.fillLink(r,a.symbolLink("instance-info"),{kind:"post",content:{kind:"post",title:{text:"Configuration"},body:{kind:"richtext",content:[{kind:"code_block",lang:"json",text:JSON.stringify(o,null," ")}]},collapsible:{default_collapsed:!0}},internal_data:o,parent:null,url:null,replies:null,client_id:c.id})]),{content:r}}else L(t)},async loadMore(e){throw new Error("not used")},async loadMoreUnmounted(e){const t=V.decode(e),n=await x(t.tl_info.host),i=await ht(t.tl_info.host,n,t.tl_info.api_path,t.tl_info.web_path,$(),[],"*unused*");if(i.body.kind==="listing")return{children:i.body.items,next:i.body.next};throw console.log("ERROR got",i),new Error("TODO support "+i.body.kind)}};async function C(e,t){const n=await x(e),i=await m(n,_(e,t),"POST");if("error"in i)throw console.log(i),new Error("Got error: "+i.error)}function ft(e){throw console.log(e),new Error("Expected unreachable: "+e)}function _t(e,t,n){return a.fillLinkOnce(e,n.link??a.symbolLink(""),()=>({url:n.link_to??null,disallow_pivot:!0,parent:null,replies:n.replies??null,client_id:c.id,kind:"post",content:t,internal_data:0}))}function kt(e,t){function n(i){const r=a.createSymbolLinkToValue(e,i);return a.prefilledHorizontalLoader(e,r,i)}return _t(e,{kind:"post",title:{text:"Sidebar"},body:{kind:"none"},collapsible:!1},{link:ct(t),replies:{display:"repivot_list",loader:n([y(e,t,{kind:"home"}),y(e,t,{kind:"public"}),y(e,t,{kind:"local"})])}})}function M(e,t,n){return y(e,t,{kind:"account",account_id:n.id})}function mt(e,t){return{display:"tree",loader:a.prefilledHorizontalLoader(e,st(t),[kt(e,t),{kind:"horizontal_loader",key:H(t),load_count:1,client_id:c.id,autoload:!0,request:a.fillLink(e,dt(t),S.encode({kind:"instance-info",host:t}))}])}}function y(e,t,n){const i=lt(t,n);if(e[i])return i;e[i]={error:"filling\u2026"};const r={display:"repivot_list",loader:W(e,t,n,null)},o={loader:a.prefilledVerticalLoader(e,g(t),void 0)};return a.fillLink(e,i,{kind:"post",url:X(t,n),parent:o,replies:r,internal_data:n,client_id:c.id,content:{kind:"post",title:{text:n.kind},body:{kind:"none"},collapsible:{default_collapsed:!0}}})}function W(e,t,n,i){return{kind:"horizontal_loader",key:G(t,n,i),load_count:null,request:a.fillLinkOnce(e,at(t,n,i),()=>S.encode({kind:"timeline",host:t,timeline:n,max_id:i})),client_id:c.id,autoload:i==null}}async function ht(e,t,n,i,r,o,l){const s=_(e,n),d=await m(t,s);if("error"in d)return Z(e,"Error! "+d.error);const p=d[d.length-1];let P;if(p){const D=T("/"+e+i,{since_id:void 0,min_id:void 0,max_id:p.id}),F=T(n,{since_id:void 0,min_id:void 0,max_id:p.id});P={kind:"load_more_unmounted",load_more_unmounted:V.encode({kind:"timeline",tl_info:{host:e,api_path:F,web_path:D}}),url:D,raw_value:p}}return{title:l,navbar:z(e),body:{kind:"listing",header:r,menu:o,items:tt(e,d),next:P},display_style:"comments-view"}}const V=w("load_more_unmounted"),gt=w("load_more"),S=w("loader");export{c as client};
