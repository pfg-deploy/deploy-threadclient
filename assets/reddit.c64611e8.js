import{B as p,e as o,y as xe,K as at,x as S,A as x,M as We,z as st,N as lt,O as ut}from"./index.23debed6.js";import{e as U}from"./base.50b98d34.js";async function ct(e,t){if(t.kind==="subreddit"){const r=()=>{},[i,n]=await Promise.all([_(`/r/${t.subreddit}/api/widgets`,{method:"GET",onerror:r,cache:!0}),_(`/r/${t.subreddit}/about`,{method:"GET",onerror:r,cache:!0})]),d={subreddit:t.subreddit,sub_t5:n??null,widgets:i??null};return mt(e,d)}else throw new Error("TODO sidebar for "+t.kind)}function mt(e,t){const r=t.widgets,i=u=>{const s=r.items[u];if(!s)throw new Error("bad widget "+u);return s},n=u=>pt(e,u,t),d=[...t.sub_t5?[_t(e,t.sub_t5,t.subreddit)]:[],...t.sub_t5?[bt(e,t.sub_t5,t.subreddit,{collapsed:!!r})]:[],...r?r.layout.sidebar.order.map(u=>n(i(u))):[],...r?[n(i(r.layout.moderatorWidget))]:[]];return d.length===0&&d.push(p.createSymbolLinkToError(e,"Failed to fetch sidebar for this page :(",{content:e,subinfo:t})),d}function pt(e,t,r){try{return ft(e,t,r)}catch(i){const n=i;return p.createSymbolLinkToError(e,"Widget errored: "+n.toString(),{widget:t,e:n})}}function w(e,t,r){return p.createSymbolLinkToValue(e,{url:r.link_to??null,disallow_pivot:!0,parent:null,replies:r.replies??null,client_id:a.id,kind:"post",content:t,internal_data:r.internal_data})}function Q(e,t){const r=p.createSymbolLinkToValue(e,t);return p.prefilledHorizontalLoader(e,r,t)}function kt(e,t,r,i){return w(e,{kind:"post",title:{text:t},body:r,collapsible:!1},{internal_data:i})}function ft(e,t,r){if(t.kind==="moderators")return kt(e,"Moderators",{kind:"richtext",content:[o.p(o.link(a,"/message/compose?to=/r/"+r.subreddit,{style:"pill-empty"},o.txt("Message the mods"))),o.ul(...t.mods.map(i=>o.li(o.p(o.link(a,"/u/"+i.name,{is_user_link:i.name},o.txt("u/"+i.name)),...J({type:i.authorFlairType,text:i.authorFlairText,text_color:i.authorFlairTextColor,background_color:i.authorFlairBackgroundColor,richtext:i.authorFlairRichText}).flatMap(n=>[o.txt(" "),o.flair(n)]))))),o.p(o.link(a,"/r/"+r.subreddit+"/about/moderators",{},o.txt("View All Moderators")))]},{internal_data:{widget:t,subinfo:r}});if(t.kind==="subreddit-rules")return w(e,{kind:"post",title:{text:t.shortName},body:{kind:"none"},collapsible:!1},{internal_data:{widget:t,subinfo:r},replies:{display:"tree",loader:Q(e,t.data.map((i,n)=>w(e,{kind:"post",title:{text:n+1+". "+i.shortName},body:{kind:"text",content:i.descriptionHtml,markdown_format:"reddit_html",client_id:a.id},collapsible:{default_collapsed:!0}},{internal_data:i})))}});if(t.kind==="post-flair")return w(e,{kind:"post",title:{text:t.shortName},body:{kind:"none"},collapsible:!1},{internal_data:{widget:t,subinfo:r},replies:{display:"repivot_list",loader:Q(e,t.order.map(i=>{const n=t.templates[i],d=J({type:n.type,text:n.text,text_color:n.textColor,background_color:n.backgroundColor,richtext:n.richtext});return w(e,{kind:"post",title:null,flair:d,body:{kind:"none"},collapsible:!1},{internal_data:n,link_to:"/r/"+r.subreddit+'/search?q=flair:"'+encodeURIComponent(n.text)+'"&restrict_sr=1'})}))}});if(t.kind==="textarea")return w(e,{kind:"post",title:{text:t.shortName},body:{kind:"text",content:t.textHtml,markdown_format:"reddit_html",client_id:a.id},collapsible:!1},{internal_data:t});if(t.kind==="button")return w(e,{kind:"post",title:{text:t.shortName},body:{kind:"text",content:t.descriptionHtml,markdown_format:"reddit_html",client_id:a.id},collapsible:!1},{internal_data:t,replies:{display:"repivot_list",loader:Q(e,t.buttons.map(i=>w(e,{kind:"post",title:{text:i.kind==="text"?i.text:"TODO SUPPORT BUTTON KIND "+i.kind},body:{kind:"none"},collapsible:!1},{internal_data:i,link_to:i.kind==="image"?i.linkUrl:i.kind==="text"?i.url:void 0})))}});if(t.kind==="community-list")return w(e,{kind:"post",title:{text:t.shortName},body:{kind:"none"},collapsible:!1},{internal_data:t,replies:{display:"repivot_list",loader:Q(e,t.data.map(i=>i.type==="subreddit"?w(e,{kind:"post",title:{text:"r/"+i.name},thumbnail:{kind:"image",url:i.communityIcon||i.iconUrl},body:{kind:"none"},collapsible:{default_collapsed:!0},actions:{vote:Y(i.name,i.subscribers,i.isSubscribed)}},{internal_data:i,link_to:"/r/"+i.name}):(v(i.type),p.createSymbolLinkToError(e,"unsupported community type: "+i.type,i))))}});if(t.kind==="calendar")return w(e,{kind:"post",title:{text:t.shortName},body:{kind:"none"},collapsible:!1},{internal_data:t,replies:{display:"tree",loader:Q(e,t.data.map(i=>w(e,{kind:"post",title:{text:i.title},body:{kind:"array",body:[{kind:"richtext",content:[o.p(o.txt("From "),o.timeAgo(i.startTime*1e3),o.txt(", to "),o.timeAgo(i.endTime*1e3))]},...i.locationHtml!=null?[{kind:"text",client_id:a.id,content:i.locationHtml,markdown_format:"reddit_html"}]:[],...i.descriptionHtml!=null?[{kind:"text",client_id:a.id,content:i.descriptionHtml,markdown_format:"reddit_html"}]:[]]},collapsible:{default_collapsed:!0}},{internal_data:i})))}});if(t.kind==="image"){const i=t.data[t.data.length-1];return w(e,{kind:"special",tag_uuid:"FullscreenImage@-N0D1IW1oTVxv8LLf7Ed",not_typesafe_data:{url:i.url,link_url:i.linkUrl??null,w:i.width,h:i.height},fallback:{kind:"post",title:{text:t.shortName},body:{kind:"richtext",content:[{kind:"body",body:{kind:"captioned_image",url:i.url,w:i.width,h:i.height}},...i.linkUrl!=null?[o.p(o.link({id:a.id},i.linkUrl,{},o.txt(i.linkUrl)))]:[]]},collapsible:!1}},{internal_data:t})}else if(t.kind==="custom"){const i={kind:"iframe_srcdoc",srcdoc:`
                <head>
                    <link rel="stylesheet" href="${t.stylesheetUrl}">
                    <base target="_blank">
                </head>
                <body>${t.textHtml}</body>
            `,height_estimate:t.height};return w(e,{kind:"special",tag_uuid:"FullscreenEmbed@-N0D96jIL-HGWHWbWKn1",not_typesafe_data:i,fallback:{kind:"post",title:{text:t.shortName},body:i,collapsible:!1}},{internal_data:t})}else throw t.kind==="id-card"||t.kind==="menu"?new Error("TODO support widget of known type: "+t.kind):(v(t.kind),new Error("TODO support widget of type: "+t.kind))}function _t(e,t,r){return w(e,{kind:"post",title:{text:t.data.title},body:{kind:"text",content:t.data.public_description_html,markdown_format:"reddit_html",client_id:a.id},actions:{vote:Y(r,t.data.subscribers,t.data.user_is_subscriber??!1)},collapsible:!1},{internal_data:{content:e,t5:t,subreddit:r}})}function bt(e,t,r,{collapsed:i}){return w(e,{kind:"post",title:{text:"old.reddit sidebar"},body:{kind:"text",client_id:a.id,markdown_format:"reddit_html",content:t.data.description_html},collapsible:{default_collapsed:i}},{internal_data:{t5:t,subreddit:r}})}function ne(...e){console.log(...e)}async function He(e){const t=Date.now(),r={};try{const[i,n]=se(e);if(console.log("PARSED URL:",i),i.kind==="link_out")return{content:r,pivot:p.createSymbolLinkToValue(r,{kind:"post",client_id:a.id,content:{kind:"post",title:{text:"Not Supported"},body:{kind:"richtext",content:[o.h1(o.link(a,"raw!"+i.out,{},o.txt("View on reddit.com"))),o.p(o.txt("ThreadClient does not support this URL"))]},collapsible:!1},parent:null,replies:null,url:null,internal_data:i})};if(i.kind==="todo")return{content:r,pivot:p.createSymbolLinkToValue(r,{kind:"post",client_id:a.id,content:{kind:"post",title:{text:"Not Supported"},body:{kind:"richtext",content:[o.h1(o.link(a,"raw!https://www.reddit.com"+i.path,{},o.txt("View on reddit.com"))),o.p(o.txt("ThreadClient does not yet support this URL")),o.p(o.txt(i.msg))]},collapsible:!1},parent:null,replies:null,url:null,internal_data:i})};if(i.kind==="raw"){const s=await _(i.path,{method:"GET"});return{content:r,pivot:oe(r,n,s)}}else{if(i.kind==="redirect")return{content:r,pivot:p.createSymbolLinkToValue(r,{kind:"post",client_id:a.id,content:{kind:"post",title:{text:"Not Supported"},body:{kind:"richtext",content:[o.h1(o.link(a,"raw!https://www.reddit.com"+n,{},o.txt("View on reddit.com"))),o.p(o.txt("Error! Redirect Loop. ThreadClient tried to redirect more than 100 times."))]},collapsible:!1},parent:null,replies:null,url:null,internal_data:i})};if(i.kind==="subreddit_sidebar"){const s=await ct(r,i.sub);return{content:r,pivot:p.createSymbolLinkToValue(r,{kind:"post",client_id:a.id,content:{kind:"post",title:{text:"Sidebar"},body:{kind:"none"},collapsible:!1},parent:null,replies:{display:"tree",loader:p.prefilledHorizontalLoader(r,ze(i.sub),s)},url:"/"+[...i.sub.base,"@sidebar"].join("/"),internal_data:i})}}}const d=at(i,{comments:s=>"/comments/"+s.post_id_unprefixed+"?"+S({sort:s.sort_override,comment:s.focus_comment,context:s.context}),duplicates:s=>"/duplicates/"+s.post_id_unprefixed+"?"+S({after:s.after,before:s.before,sort:s.sort,crossposts_only:""+s.crossposts_only}),subreddit:s=>x(h(s.sub,s.current_sort),{before:s.before??void 0,after:s.after??void 0}),wiki:s=>"/"+[...s.sub.base,"wiki",...s.path].join("/")+"?"+S(s.query),user:()=>n,inbox:()=>n,subreddits:()=>n}),u=await _(d,{method:"GET"});return{content:r,pivot:ht(r,n,i,u)}}catch(i){const n=i;console.log(n);const d=n.toString().includes("NetworkError"),u=t>Date.now()-50,s=navigator.userAgent.includes("Firefox");if(d)return{content:r,pivot:p.createSymbolLinkToValue(r,{kind:"post",client_id:a.id,content:{kind:"post",title:{text:"Error Loading Page"},body:{kind:"richtext",content:[...u&&s?[o.h1(o.txt("Firefox Enhanced Tracking Protection may be active")),o.p(o.txt("Try disabling Enhanced Tracking Protection for this site.")),o.ul(o.ili(o.txt("Look at the left side of the URL bar for a shield icon")),o.ili(o.txt("Click it")),o.ili(o.txt("Flip the switch to turn Enhanced Tracking Protection off"))),o.p(o.txt("Enhanced Tracking Protection blocks ThreadClient from sending requests to Reddit, which prevents ThreadClient from functioning.")),o.h2(o.txt("Other things to check:"))]:[o.h1(o.txt("There was a network error loading this page")),o.h2(o.txt("Things to check:"))],o.ul(o.ili(o.txt("Make sure your internet is working")),o.ili(o.txt("Make sure "),o.link(a,"https://www.redditstatus.com/",{},o.txt("Reddit is working"))),o.ili(o.txt("If your browser has tracking protection, try disabling it. Tracking prevention often blocks requests to social media sites, such as Reddit.")))]},collapsible:!1},parent:null,replies:null,url:null,internal_data:[e,n,{is_networkerror:d,error_was_instant:u,browser_is_firefox:s}]})};throw n}}function h(e,t){return"/"+[...e.base,t.v==="unsupported"?"hot":t.v].join("/")+(t.v==="controversial"||t.v==="top"?"?t="+encodeURIComponent(t.t):"")}function $e(e){return e==="t5_hcxiu"||e==="t5_q7cbs"?{v:"new",t:"all"}:{v:"hot",t:"all"}}function ht(e,t,r,i){if(Array.isArray(i)){if(i[0].data.children.length!==1)return oe(e,t,i);const n=i[0].data.children[0];if(n.kind!=="t3")return oe(e,t,i);const d=n.data.name,s=i[1].data.children[0];s&&s.kind==="t1"&&s.data.parent_id;const l=r.kind==="comments"?r.focus_comment:null,c={kind:"subreddit_unloaded",listing:{kind:"Listing",data:{before:null,children:[],after:null}},details:{kind:"subreddit",base:["r",n.data.subreddit],subreddit:n.data.subreddit},missing_replies:!0,sort:$e(n.data.subreddit_id)};V(e,c);const f=We(t)[1].get("sort"),T={kind:"post",sort:f!=null?{v:f}:"default",suggested_sort:n.data.suggested_sort??"confidence"};let O=V(e,{kind:"post",post:n,replies:i[1],missing_replies:l!=null?!0:void 0,sort:T});if(l!=null){const g=X(`t1_${l.toLowerCase()}`,T);e[g]?O=g:ne("focused comment not found in tree `"+g.toString()+"`",O,e)}return O}else if(i.kind==="Listing"){const n={kind:"subreddit_unloaded",listing:i,details:r.kind==="subreddit"?r.sub:{kind:"error",pathraw:t,base:[t]},sort:r.kind==="subreddit"?r.current_sort:{v:"unsupported",t:"all"}};return V(e,n)}else{if(i.kind==="wikipage")return V(e,{kind:"wikipage",listing:i,pathraw:t});i.kind==="t5"?ne("TODO t5"):i.kind==="UserList"?ne("TODO userlist"):v(i.kind)}return oe(e,t,i)}function H(e,t){return(()=>{if(e.kind==="homepage")return"SR_home";if(e.kind==="mod")return"SR_mod";if(e.kind==="multireddit")return"SR_multi/u:"+e.user.toLowerCase()+"/m:"+e.multireddit.toLowerCase();if(e.kind==="userpage")return"SR_user/"+e.user.toLowerCase();if(e.kind==="subreddit")return"SR_sub/"+e.subreddit.toLowerCase();if(e.kind==="error")return"SR_eunsupported/"+e.pathraw;xe(e)})()+"[/"+t?.v+"?t="+t?.t+"]"}function oe(e,t,r){return p.createSymbolLinkToValue(e,{kind:"post",client_id:a.id,parent:null,url:null,replies:null,content:{kind:"post",title:{text:"Error!"},collapsible:!1,body:{kind:"richtext",content:[...de(t),o.pre(JSON.stringify(r,null,"  "),"json")]}},internal_data:null})}function B(e,t){return{kind:"post",sort:{v:t},suggested_sort:e?.suggested_sort??"confidence"}}function yt(e){return e==null||e.sort==="default"||e.suggested_sort===e.sort.v?"default":e.sort}function ge(e){return e==null||e.sort==="default"||e.suggested_sort===e.sort.v?"[sort:default]":"[sort:"+e.sort.v+"]"}function X(e,t){return p.stringLink("OBJECT_"+e+ge(t))}function je(e,t){return p.stringLink("OBJECT-REPLIES_"+e+ge(t))}function Ce(e,t){return p.stringLink("OBJECT-DEPTH-LOADER_"+e+ge(t))}function wt(e,t){return p.stringLink("OBJECT-CONTEXT-LOADER_"+e+ge(t))}function xt(e,t){return p.stringLink("SUBREDDIT_"+H(e,t))}function gt(e,t){return p.stringLink("SUBREDDIT-POSTS_"+H(e,t))}function vt(e,t){return p.stringLink("SUBREDDIT-LOAD-POSTS_"+H(e,t))}function Nt(e,t,r){return p.stringLink("SUBREDDIT-NEXTPAGE-CONTENT_["+H(e,t)+"]_"+r)}function Tt(e,t,r){return p.stringLink("SUBREDDIT-NEXTPAGE-REQUEST["+H(e,t)+"]_"+r)}function Ot(e){return p.stringLink("WIKIPAGE_"+e)}function ze(e){return p.stringLink("SIDEBAR_"+H(e,null))}function St(e){return p.stringLink("SIDEBAR-LOADER_"+H(e,null))}function Et(e,t){if(e.kind==="t1")return{kind:"comment",comment:e,parent_fullname:t.parent_fullname,sort:t.sort};if(e.kind==="t3")return{kind:"post",post:e,replies:"not_loaded",sort:t.sort};if(e.kind==="more")return e.data.children.length===0?{kind:"depth_more",item:e,parent_fullname:t.parent_fullname}:{kind:"more",item:e};e.kind!=="t5"&&v(e.kind),ne("TODO setUpCommentOrUnmounted",e.kind,e)}function Ne(e,t,r){const i=Et(t,{parent_fullname:r.parent_fullname,sort:r.sort});return i==null?p.createSymbolLinkToError(e,"eunsupported",t):V(e,i)}function j(e,t){const r=yt(t);return r==="default"?e.data.permalink:x(e.data.permalink,{sort:r.v})}function Ue(e){const t=e.data;return{creation_date:t.created_utc*1e3,edited:t.edited?{date:t.edited*1e3}:void 0,pinned:t.pinned||t.stickied||!1,in:e.kind==="t3"?{name:t.subreddit_name_prefixed,link:"/"+t.subreddit_name_prefixed,client_id:a.id}:void 0,comments:e.kind==="t3"?e.data.num_comments:void 0}}function Ae(e){return{kind:"link",text:"View on reddit.com",url:Je(e),client_id:"reddit"}}function V(e,t){const r={data:t};if(r.data.kind==="comment"){const i=r.data.comment,n=i.data,d=r.data.sort,u=je(n.name,d),s=Ce(n.name,d);p.fillLinkOnce(e,s,()=>z.encode({kind:"parent_permalink",post_id:n.link_id.replace("t3_",""),parent_id:n.id}));const l={display:"tree",reply:{action:fe(n.name),locked:n.locked},loader:{kind:"horizontal_loader",key:u,load_count:null,request:s,client_id:a.id,autoload:!0}},c=(()=>{if(!n.replies)return!0;const E=n.replies.data.children;if(r.data.missing_replies??!1)return!(E.length>0);if(E.length===1){const q=E[0];if(q.kind==="more"&&q.data.name==="t1__")return!1}return!0})(),m=(()=>n.replies?n.replies.data.children.map(E=>Ne(e,E,{parent_fullname:n.name,sort:d})):[])();c&&p.fillLink(e,u,m);const f=n.author==="FatFingerHelperBot",T=wt(n.name,d);p.fillLinkOnce(e,T,()=>z.encode({kind:"vertical",bottom_post:n.name,top_post:n.link_id}));const O={loader:{kind:"vertical_loader",key:X(n.parent_id,d),temp_parent:X(n.link_id,d),request:T,load_count:n.depth,client_id:a.id,autoload:!1}},g=X(n.name,d),A=x(n.permalink,{context:"3"});return p.fillLinkOnce(e,g,()=>({kind:"post",client_id:a.id,url:A,parent:O,replies:l,content:{kind:"post",title:null,author:he(n,De(n.all_awardings??[])),body:et(n),info:Ue(i),collapsible:{default_collapsed:f||(n.collapsed??!1)},actions:{vote:re(n),code:Pe(n.body),other:[_e(n.name),pe(n.name),be(n.name,n.saved),ke(n.name,n.subreddit),Ae(A)]}},internal_data:r.data})),g}else if(r.data.kind==="post"){const i=r.data.post,n=i.data,d=r.data.sort,u=je(n.name,d),s=Ce(n.name,d);p.fillLinkOnce(e,s,()=>z.encode({kind:"parent_permalink",post_id:n.id,parent_id:null}));const l={display:"tree",reply:{action:fe(n.name),locked:n.locked},loader:{kind:"horizontal_loader",key:u,load_count:n.num_comments,client_id:a.id,request:s,autoload:!0},sort_options:[{kind:"url",name:"Best",url:j(i,B(d,"confidence"))},{kind:"url",name:"Top",url:j(i,B(d,"top"))},{kind:"url",name:"New",url:j(i,B(d,"new"))},{kind:"url",name:"Controversial",url:j(i,B(d,"controversial"))},{kind:"url",name:"Old",url:j(i,B(d,"old"))},{kind:"url",name:"Random",url:j(i,B(d,"random"))},{kind:"url",name:"Q&A",url:j(i,B(d,"qa"))},{kind:"url",name:"Live",url:j(i,B(d,"live"))}]},c=(()=>r.data.replies==="not_loaded"?[]:r.data.replies.data.children.map(O=>Ne(e,O,{parent_fullname:n.name,sort:d})))();r.data.missing_replies!==!0&&r.data.replies!=="not_loaded"&&p.fillLink(e,u,c);const m=X(n.name,d),f=j(i,d);return p.fillLinkOnce(e,m,()=>({kind:"post",client_id:a.id,url:f,parent:{loader:p.prefilledVerticalLoader(e,V(e,{kind:"subreddit_unloaded",missing_replies:!0,listing:{kind:"Listing",data:{before:null,after:null,children:[]}},details:{kind:"subreddit",subreddit:n.subreddit,base:["r",n.subreddit]},sort:$e(n.subreddit_id)}),void 0)},replies:l,content:{kind:"post",title:{text:n.title},collapsible:{default_collapsed:!0},flair:it(n),author:he(n),body:tt(n),thumbnail:rt(n,"open"),info:Ue(i),actions:{vote:re(n),code:Pe(n.is_self?n.selftext:n.url),other:[{kind:"link",client_id:a.id,url:"/domain/"+n.domain,text:n.domain},pe(n.name),be(n.name,n.saved),{kind:"link",client_id:a.id,url:"/duplicates/"+n.id,text:"Duplicates"},ke(n.name,n.subreddit),_e(n.name),Ae(f)]}},internal_data:r.data})),m}else if(r.data.kind==="subreddit_unloaded"){const i=r.data,n=i.listing,d=gt(r.data.details,r.data.sort),u=vt(r.data.details,r.data.sort);p.fillLinkOnce(e,u,()=>z.encode({kind:"link_replies",url:x(h(i.details,i.sort),{before:void 0,after:void 0})}));const s={display:"repivot_list",loader:{kind:"horizontal_loader",key:d,load_count:null,request:u,client_id:a.id,autoload:!0},sort_options:[{kind:"url",name:"Hot",url:h(i.details,{v:"hot",t:"all"})},{kind:"url",name:"Best",url:h(i.details,{v:"best",t:"all"})},{kind:"url",name:"New",url:h(i.details,{v:"new",t:"all"})},{kind:"url",name:"Rising",url:h(i.details,{v:"rising",t:"all"})},{kind:"more",name:"Top",submenu:[{kind:"url",name:"Hour",url:h(i.details,{v:"top",t:"hour"})},{kind:"url",name:"Day",url:h(i.details,{v:"top",t:"day"})},{kind:"url",name:"Week",url:h(i.details,{v:"top",t:"week"})},{kind:"url",name:"Month",url:h(i.details,{v:"top",t:"month"})},{kind:"url",name:"Year",url:h(i.details,{v:"top",t:"year"})},{kind:"url",name:"All",url:h(i.details,{v:"top",t:"all"})}]},{kind:"more",name:"Controversial",submenu:[{kind:"url",name:"Hour",url:h(i.details,{v:"controversial",t:"hour"})},{kind:"url",name:"Day",url:h(i.details,{v:"controversial",t:"day"})},{kind:"url",name:"Week",url:h(i.details,{v:"controversial",t:"week"})},{kind:"url",name:"Month",url:h(i.details,{v:"controversial",t:"month"})},{kind:"url",name:"Year",url:h(i.details,{v:"controversial",t:"year"})},{kind:"url",name:"All",url:h(i.details,{v:"controversial",t:"all"})}]}]};if(!r.data.missing_replies&&(n.data.children.length>0||n.data.after!=null)){const c=[];for(const m of n.data.children)c.push(Ne(e,m,{parent_fullname:"@E_SUBREDDIT",sort:null}));if(n.data.after!=null){const m=Nt(r.data.details,r.data.sort,n.data.after),f=Tt(r.data.details,r.data.sort,n.data.after);c.push({kind:"horizontal_loader",key:m,load_count:null,request:f,client_id:a.id,autoload:!1})}p.fillLink(e,d,c)}const l=xt(r.data.details,r.data.sort);return p.fillLinkOnce(e,l,()=>({kind:"post",client_id:a.id,url:"/"+i.details.base.join("/"),parent:null,replies:s,content:{kind:"page",title:JSON.stringify(t),wrap_page:{sidebar:{display:"tree",loader:{kind:"horizontal_loader",key:ze(i.details),load_count:null,request:p.fillLinkOnce(e,St(i.details),()=>z.encode({kind:"sidebar",sub:i.details})),client_id:a.id,autoload:!0}},header:{kind:"bio",banner:null,icon:null,name:{display:JSON.stringify(t).toString(),link_name:JSON.stringify(t).toString()},body:null,menu:null,raw_value:r}}},internal_data:r.data})),l}else{if(r.data.kind==="depth_more")return p.createSymbolLinkToError(e,"ERROR; 'depth_more' be handled seperately by reply iterators",r);if(r.data.kind==="more")return p.createSymbolLinkToError(e,"ERROR; 'more' be handled seperately by reply iterators",r);if(r.data.kind==="wikipage"){const i=r.data,n=i.listing,d=i.pathraw.substring(i.pathraw.lastIndexOf("/")+1),u=Ot(i.pathraw);return p.fillLinkOnce(e,u,()=>({kind:"post",client_id:a.id,url:i.pathraw,parent:null,replies:null,content:{kind:"post",title:{text:d},collapsible:!1,body:{kind:"text",content:n.data.content_html,client_id:a.id,markdown_format:"reddit_html"},info:{edited:{date:n.data.revision_date*1e3}},author:Kt(n.data.revision_by),actions:{other:n.data.may_revise?[{kind:"link",client_id:a.id,text:"Edit",url:"TODO edit wiki page"}]:[]}},internal_data:r.data})),u}else xe(r.data)}}const z=U("loader");async function Pt(e){await new Promise(r=>setTimeout(r,1e3));let t=z.decode(e);if(t.kind==="parent_permalink"&&(t={kind:"link_replies",url:`/comments/${t.post_id}/comment/${t.parent_id??""}?context=0`}),t.kind==="sidebar"&&(t={kind:"link_replies",url:"/"+[...t.sub.base,"@sidebar"].join("/")}),t.kind==="link_replies")return{content:(await He(t.url)).content};if(t.kind==="more")throw new Error("TODO more");if(t.kind==="vertical")throw new Error("TODO vertical");xe(t)}const le=new Set(["/","/r/:subredditName/collection/:collectionId","/r/:subredditName/collection/:collectionId/:partialPostId","/r/:subredditName/collection/:collectionId/:partialPostId/:partialCommentId","/r/:subredditName/comments/:partialPostId/:urlSafePostTitle/:partialCommentId","/r/:subredditName/comments/:partialPostId/:urlSafePostTitle?","/r/:subredditName/duplicates/:partialPostId/:urlSafePostTitle?","/user/:subredditName/collection/:collectionId","/user/:subredditName/collection/:collectionId/:partialPostId","/user/:subredditName/collection/:collectionId/:partialPostId/:partialCommentId","/user/:subredditName/comments/:partialPostId/:urlSafePostTitle/:partialCommentId","/user/:subredditName/comments/:partialPostId/:urlSafePostTitle?","/user/:subredditName/duplicates/:partialPostId/:urlSafePostTitle?","","/best","/hot","/new","/rising","/controversial","/top","/gilded","/awarded","/acknowledgements","/appeal","/appeals","/avatar","/avatar/:username","/avatar/:username/:avatarId","/coins","/coins/mobile","/comments/:partialPostId/:urlSafePostTitle/:partialCommentId","/comments/:partialPostId/:urlSafePostTitle?","/community-points/","/community-points/documentation/*","/duplicates/:partialPostId/:urlSafePostTitle?","/econ-management","/explore","/explore/:categoryName","/framedGild/:thingId","/framedModal/:type","/label/subreddits","/me/f/mod","/me/f/mod/awarded","/me/f/mod/best","/me/f/mod/controversial","/me/f/mod/gilded","/me/f/mod/hot","/me/f/mod/new","/me/f/mod/rising","/me/f/mod/top","/me/m/:multiredditName","/me/m/:multiredditName/awarded","/me/m/:multiredditName/best","/me/m/:multiredditName/controversial","/me/m/:multiredditName/gilded","/me/m/:multiredditName/hot","/me/m/:multiredditName/new","/me/m/:multiredditName/rising","/me/m/:multiredditName/top","/me/m/:multiredditName/search","/message/inbox","/message/unread","/message/messages","/message/comments","/message/selfreply","/message/mentions","/message/compose","/message/sent","/message/moderator","/message/messages/:messageId([A-Za-z0-9]+)","/notifications/","/original","/original/:categoryName/:sort([a-z]+)?","/original/submit","/powerup","/powerups","/prediction","/predictions","/premium","/r/:subredditName","/r/:subredditName/awarded","/r/:subredditName/best","/r/:subredditName/controversial","/r/:subredditName/gilded","/r/:subredditName/hot","/r/:subredditName/new","/r/:subredditName/rising","/r/:subredditName/top","/r/:subredditName/about","/r/:subredditName/about/awards","/r/:subredditName/about/powerups","/r/:subredditName/about/muted","/r/:subredditName/about/badges","/r/:subredditName/about/banned","/r/:subredditName/about/chat","/r/:subredditName/about/settings","/r/:subredditName/about/contributors","/r/:subredditName/about/emojis","/r/:subredditName/about/emotes","/r/:subredditName/about/eventposts","/r/:subredditName/about/moderators","/r/:subredditName/about/rules","/r/:subredditName/about/removal","/r/:subredditName/about/modqueue","/r/:subredditName/about/reports","/r/:subredditName/about/spam","/r/:subredditName/about/talkhosts","/r/:subredditName/about/unmoderated","/r/:subredditName/about/edited","/r/:subredditName/about/postflair","/r/:subredditName/about/log","/r/:subredditName/about/flair","/r/:subredditName/about/edit","/r/:subredditName/about/userflair","/r/:subredditName/about/wiki","/r/:subredditName/about/wikicontributors","/r/:subredditName/about/wikibanned","/r/:subredditName/about/traffic","/r/:subredditName/about/scheduledposts","/r/:subredditName/about/broadcasting","/r/:subredditName/about/content","/r/:subredditName/about/predictions","/r/:subredditName/about/wiki/:wikiPageName*","/r/:subredditName/about/wiki/edit/:wikiPageName+","/r/:subredditName/about/wiki/create/:wikiPageName+","/r/:subredditName/about/wiki/settings/:wikiPageName+","/r/:subredditName/about/wiki/revisions/:wikiPageName+","/r/:subredditName/about/wiki/revisions","/r/:subredditName/about/wiki/wikibanned","/r/:subredditName/about/wiki/wikicontributors","/r/:subredditName/predictions","/r/:subredditName/search","/r/:subredditName/submit","/r/:subredditName/w/:wikiPageName*","/r/:subredditName/wiki/","/r/:subredditName/wiki/:wikiPageName+","/r/:subredditName/wiki/edit/:wikiPageName+","/r/:subredditName/wiki/create/:wikiPageName+","/r/:subredditName/wiki/revisions/:wikiPageName+","/r/:subredditName/wiki/revisions","/r/:subredditName/wiki/settings/:wikiPageName+","/r/mod","/r/mod/awarded","/r/mod/best","/r/mod/controversial","/r/mod/gilded","/r/mod/hot","/r/mod/new","/r/mod/rising","/r/mod/top","/r/mod/about","/r/mod/about/edited","/r/mod/about/modqueue","/r/mod/about/reports","/r/mod/about/spam","/r/mod/about/unmoderated","/r/u_:profileName","/r/u_:profileName/:rest(.*)","/report","/rpan/:partialPostId?","/rpan/r/:subredditName/:partialPostId?","/search","/settings","/settings/account","/settings/messaging","/settings/profile","/settings/privacy","/settings/notifications","/settings/feed","/settings/gold","/settings/payments","/settings/premium","/settings/creator","/settings/special","/settings/dsp","/settings/data-request","/submit","/subreddits/leaderboard","/subreddits/leaderboard/:categoryName/","/t/:topicSlug","/talk","/u/:profileName","/u/:profileName/:rest(.*)","/u/me/avatar","/user/:profileName","/user/:profileName/downvoted","/user/:profileName/hidden","/user/:profileName/saved","/user/:profileName/upvoted","/user/:profileName/gilded","/user/:profileName/given","/user/:profileName/about/awards","/user/:profileName/about/edit/moderation","/user/:profileName/avatar","/user/:profileName/comments","/user/:profileName/draft/:draftId","/user/:profileName/followers","/user/:profileName/gilded/given","/user/:profileName/posts","/user/:profileName/snoo","/user/:profileName/submit","/user/:profileName/submitted","/user/:profileName/submitted/:rest(.*)","/user/:username/m/:multiredditName","/user/:username/m/:multiredditName/awarded","/user/:username/m/:multiredditName/best","/user/:username/m/:multiredditName/controversial","/user/:username/m/:multiredditName/gilded","/user/:username/m/:multiredditName/hot","/user/:username/m/:multiredditName/new","/user/:username/m/:multiredditName/rising","/user/:username/m/:multiredditName/top","/user/:username/m/:multiredditName/search","/user/me","/user/me/:rest(.*)","/user/me/avatar","/vault/","/vault/burn","/verification/:verificationToken","/w/:wikiPageName*","/web/community-points/","/web/membership/:subredditName","/web/points-migration/","/web/special-membership/:subredditName","/wiki/","/wiki/:wikiPageName+","inexact|/prefs","inexact|/prefs/deactivate","inexact|/prefs/blocked","inexact|/user/:username/about/edit","inexact|/user/:username/about/edit/privacy"]),b=st(),k=[],N=e=>({kind:"link_out",out:"https://www.reddit.com"+e.path+"?"+S(e.query)}),G=e=>t=>({kind:"todo",path:t.path+"?"+S(t.query),msg:e});b.route(["raw",{path:"rest"}],e=>({kind:"raw",path:"/"+e.path.join("/")+"?"+S(e.query)}));k.push("/acknowledgements");b.route(["acknowledgements"],N);k.push("/appeal");b.route(["appeal"],N);k.push("/appeals");b.route(["appeals"],N);k.push("/avatar");b.route(["appeals"],N);k.push("/coins");b.route(["coins"],N);k.push("/coins/mobile");b.route(["coins","mobile"],N);k.push("/r/u_:profileName","/r/u_:profileName/:rest(.*)");b.route(["r",{user:{kind:"starts-with",text:"u_"}},{remainder:"rest"}],e=>({kind:"redirect",to:"/"+["user",e.user,...e.remainder].join("/")+"?"+S(e.query)}));k.push("/u/:profileName","/u/:profileName/:rest(.*)","/u/me/avatar");b.route(["u",{user:"any"},{remainder:"rest"}],e=>({kind:"redirect",to:"/"+["user",e.user,...e.remainder].join("/")+"?"+S(e.query)}));k.push("/verification/:verificationToken");b.route(["verification",{vtoken:"any"}],N);k.push("/label/subreddits");b.route(["label","subreddits"],N);k.push("/premium");b.route(["premium"],N);k.push("/framedGild/:thingId");b.route(["framedGild",{thing:"any"}],N);k.push("/framedModal/:type");b.route(["framedModal",{type:"any"}],N);k.push("/community-points/","/vault/","/web/community-points/");b.route(["community-points"],N);b.route(["vault"],N);b.route(["web","community-points"],N);function ue(e,t){const r=n=>n.multireddit!=null&&n.user!=null?{kind:"multireddit",multireddit:n.multireddit,user:n.user,base:["user",n.user,"m",n.multireddit]}:n.user!=null?{kind:"userpage",user:n.user,base:["user",n.user]}:n.subreddit!=null?{kind:"subreddit",subreddit:n.subreddit,base:["r",n.subreddit]}:{kind:"homepage",base:[]};(t==="home"||t==="subreddit"||t==="user")&&(t==="home"&&k.push("/submit"),t==="subreddit"&&k.push("/r/:subredditName/submit"),t==="user"&&k.push("/user/:profileName/submit"),e.route(["submit"],G("submit post")));const i=["best","hot","new","rising","controversial","top","gilded","awarded"];if(t==="home"&&k.push("","/",...i.map(n=>"/"+n)),t==="subreddit"&&k.push("/r/:subredditName",...i.map(n=>"/r/:subredditName/"+n)),t==="multireddit"&&k.push("/user/:username/m/:multiredditName",...i.map(n=>"/user/:username/m/:multiredditName/"+n)),e.route([{sort:[...i,...t==="user"?[]:[null]]}],n=>({kind:"subreddit",sub:r(n),is_user_page:!1,current_sort:{v:n.sort??"hot",t:n.query.t??"all"},before:n.query.before??null,after:n.query.after??null})),t==="subreddit"&&e.route(["@sidebar"],n=>({kind:"subreddit_sidebar",sub:r(n)})),t==="subreddit"||t==="user"||t==="home"){const n=t==="subreddit"?"/r/:subredditName":t==="user"?"/user/:subredditName":t==="home"?"":xe(t);k.push(n+"/duplicates/:partialPostId/:urlSafePostTitle?"),e.route(["duplicates",{post_id_unprefixed:"any"},{url_safe_post_title:"optional"}],d=>({kind:"duplicates",sub:r(d),post_id_unprefixed:d.post_id_unprefixed,after:d.query.after??null,before:d.query.before??null,crossposts_only:d.query.crossposts_only==="true",sort:d.query.sort??"num_comments"})),k.push(n+"/comments/:partialPostId/:urlSafePostTitle?"),e.route(["comments",{post_id_unprefixed:"any"},{url_safe_post_title:"optional"}],d=>({kind:"comments",sub:r(d),post_id_unprefixed:d.post_id_unprefixed,focus_comment:d.query.comment??null,sort_override:d.query.sort??null,sort_override_time:d.query.t??null,context:d.query.context??null})),k.push(n+"/comments/:partialPostId/:urlSafePostTitle/:partialCommentId"),e.route(["comments",{post_id_unprefixed:"any"},{url_safe_post_title:"any"},{partial_comment_id:"any"}],d=>({kind:"comments",sub:r(d),post_id_unprefixed:d.post_id_unprefixed,focus_comment:d.partial_comment_id,sort_override:d.query.sort??null,context:d.query.context??null}))}}b.with(["user","me"],e=>{k.push("/user/me/avatar"),e.catchall(G("redirect to current user"))});b.with(["user",{user:"any"}],e=>{k.push("/user/:profileName/avatar"),e.route(["user",{profile_name:"any"},"avatar"],r=>({kind:"redirect",to:"/avatar"})),k.push("/user/:profileName","/user/:profileName/comments","/user/:profileName/submitted","/user/:profileName/submitted/:rest(.*)"),e.route([{tab:["overview","comments","submitted",null]}],r=>({kind:"user",username:r.user,current:{kind:"sorted-tab",tab:r.tab??"overview",sort:{sort:r.query.sort??(r.tab==="submitted"?"hot":"new"),t:r.query.t??"all"}}})),k.push("/user/:profileName/posts"),e.route(["posts"],r=>({kind:"redirect",to:"/user/"+r.user+"/submitted?"+S(r.query)}));const t=["downvoted","hidden","saved","upvoted"];k.push(...[...t,"gilded","given"].map(r=>"/user/:profileName/"+r)),k.push("/user/:profileName/gilded/given"),e.route([{tab:t}],r=>({kind:"user",username:r.user,current:{kind:"unsorted-tab",tab:r.tab}})),e.route(["gilded",{by:["received","given",null]}],r=>({kind:"user",username:r.user,current:{kind:"gild-tab",tab:"gilded",by:r.by??r.query.show??"received"}})),e.route(["given"],r=>({kind:"user",username:r.user,current:{kind:"gild-tab",tab:"gilded",by:"given"}})),k.push("/user/:profileName/snoo"),e.route(["snoo"],G("snoo")),k.push("/user/:profileName/draft/:draftId"),e.route(["draft",{draft_id:"any"}],G("drafts")),k.push("/user/:profileName/about/edit/moderation"),e.route(["about","edit","moderation"],G("user profile moderation settings")),e.with(["m",{multireddit:"any"}],r=>ue(r,"multireddit")),ue(e,"user")});b.with(["r",{subreddit:"any"}],e=>{k.push("/r/:subredditName/wiki/revisions","/r/:subredditName/wiki/settings/:wikiPageName+","/r/:subredditName/wiki/edit/:wikiPageName+","/r/:subredditName/wiki/create/:wikiPageName+","/r/:subredditName/wiki/revisions/:wikiPageName+","/r/:subredditName/wiki/","/r/:subredditName/w/:wikiPageName*","/r/:subredditName/wiki/:wikiPageName+"),e.with([{w_wiki:["w","wiki"]}],t=>{t.route([{wiki_path:"rest"}],r=>({kind:"wiki",sub:{kind:"subreddit",base:["r",r.subreddit],subreddit:r.subreddit},path:r.wiki_path.length===0?["index"]:r.wiki_path,query:r.query}))}),ue(e,"subreddit")});b.route([{w_wiki:["w","wiki"]},{wiki_path:"rest"}],e=>({kind:"wiki",sub:{kind:"homepage",base:[]},path:e.wiki_path,query:e.query}));b.with(["message"],e=>{const t=["inbox","unread","messages","comments","selfreply","mentions"];k.push(...t.map(r=>"/message/"+r)),e.route([{tab:[...t]}],r=>({kind:"inbox",current:{tab:"inbox",inbox_tab:r.tab}})),k.push("/message/compose"),e.route(["compose"],r=>({kind:"inbox",current:{tab:"compose",to:r.query.to,subject:r.query.subject,message:r.query.message}})),k.push("/message/sent"),e.route(["sent"],r=>({kind:"inbox",current:{tab:"sent"}})),k.push("/message/moderator"),e.route(["moderator"],r=>({kind:"inbox",current:{tab:"mod"}})),k.push("/message/messages/:messageId([A-Za-z0-9]+)"),e.route(["messages",{message_id:"any"}],r=>({kind:"inbox",current:{tab:"message",msgid:r.message_id}}))});ue(b,"home");b.with(["mod"],e=>{b.catchall(G("not supported"))});b.with(["subreddits"],e=>{e.with(["mine"],t=>{t.route([{tab:[null,"subscriber","contributor","moderator"]}],r=>({kind:"subreddits",value:{tab:"mine",subtab:r.tab??"subscriber"}}))}),e.route([{tab:[null,"new","popular"]}],t=>({kind:"subreddits",value:{tab:t.tab??"popular"}}))});b.catchall(G("not supported"));const ce=[];for(const e of k)le.has(e)?le.delete(e):ce.push("\u2022 unknown: "+e);if(le.size>0)for(const e of le)ce.push("\u2022 missing: "+e);if(ce.length>0){console.log("reddit router ::");for(const e of ce)console.log(e)}const me="biw1k0YZmDUrjg",Re="https://thread.pfg.pw/login/reddit";function J(e){if(e.type==null)return[];if(e.type==="text"&&(e.text==null||e.text===""))return[];const t=e.type==="richtext"?(e.richtext??[]).flatMap(i=>i.e==="text"?[{kind:"text",text:i.t,styles:{}}]:i.e==="emoji"?[{kind:"emoji",url:i.u,name:i.a}]:(v(i.e),[{kind:"error",text:"#TODO("+i.e+")",value:i}])):e.type==="text"?[{kind:"text",text:e.text,styles:{}}]:[{kind:"error",text:"TODO: "+e.type,value:e}],r=t.map(i=>i.kind==="text"?i.text:"").join("");return[{color:e.background_color??void 0,elems:t,content_warning:r.toLowerCase().startsWith("cw:")||r.toLowerCase().startsWith("tw:")}]}function De(e){const t=[];for(const r of e.sort((i,n)=>n.count-i.count)){t.length>0&&t.push({kind:"text",text:" ",styles:{}});const i=r.resized_static_icons[0],n=r.resized_icons[r.resized_icons.length-1];t.push({kind:"emoji",url:i.url,name:r.name,hover:{url:n.url,w:n.width,h:n.height,description:r.description+" (price: "+r.coin_price+")"}}),r.count>1&&t.push({kind:"text",text:"\xD7"+r.count,styles:{}})}return t.length===0?[]:[{elems:t,content_warning:!1,system:"none"}]}function Te(e){return I.encode({kind:"vote",query:e})}function Rt(e){return I.encode({kind:"delete",fullname:e})}const I=U("act");function Ve(e,t){try{return Oe(e.document,t)}catch(r){return console.log("Error parsing richtext:",r),[o.p(o.error("Error parsing richtext: "+r,r))]}}function Oe(e,t){return e.map(r=>Dt(r,t))}function v(e){console.log("Expected unsupported",e)}function Se(e,t){if(e.status!=="valid")return{thumb:null,aspect:void 0,body:{kind:"richtext",content:[o.p(o.error("Bad Status "+e.status+", "+t,e))]}};if(e.e==="Image"){const r=e.p?.[0]??e.s;return{thumb:r.u??"error",aspect:r.x/r.y,body:{kind:"captioned_image",url:e.s.u,w:e.s.x,h:e.s.y,caption:t}}}if(e.e==="AnimatedImage"){const r=e.p?.[0];return{thumb:r?r.u:"error",aspect:r?r.x/r.y:void 0,body:{kind:"video",source:e.s.mp4!=null?{kind:"video",sources:[{url:e.s.mp4,quality:e.s.x+"\xD7"+e.s.y}]}:{kind:"img",url:e.s.gif},aspect:e.s.x/e.s.y,gifv:!0,caption:t}}}return e.e==="RedditVideo"?{thumb:null,aspect:void 0,body:{kind:"video",source:lt(e.id),aspect:e.x/e.y,gifv:e.isGif??!1,caption:t}}:(v(e.e),{thumb:null,aspect:void 0,body:{kind:"richtext",content:[o.p(o.error("TODO "+e.e+", "+t,e))]}})}function Dt(e,t){switch(e.e){case"par":if(e.c.length===1&&(e.c[0]?.e==="gif"||e.c[0]?.e==="img")){const r=e.c[0],i=t.media_metadata[r.id];return i?o.kind("body",{body:Se(i,r.id.split("|")[0]).body}):o.p(o.error("Missing media id "+r.id,i))}else return e.c.length===1&&e.c[0]?.e==="text"&&e.c[0].t.match(/^---+$/)?o.hr():o.p(...te(e.c,t));case"img":case"video":case"gif":{const r=t.media_metadata[e.id];return r?o.kind("body",{body:Se(r,e.c).body}):o.p(o.error("unknown id "+e.id,t))}case"h":return o.hn(e.l,...te(e.c,t));case"hr":return o.hr();case"blockquote":return o.blockquote(...Oe(e.c,t));case"list":return o.kind("list",{ordered:e.o},e.c.map(r=>o.li(...Oe(r.c,t))));case"code":return o.pre(e.c.map(r=>{switch(r.e){case"raw":return r.t;case"unsupported":return"Err \xAB"+JSON.stringify(r)+"\xBB"}}).join(`
`));case"table":return o.table(e.h.map(r=>It(r,t)),...e.c.map(r=>r.map(i=>Lt(i,t))))}return v(e.e),o.p(o.error("TODO "+e.e,e))}function It(e,t){return o.th(e.a!=null?{L:"left",C:"center",R:"right"}[e.a]:void 0,...te(e.c??[],t))}function Lt(e,t){return o.td(...te(e.c,t))}function qe(e){return e>=10240&&e<=10495}function Be(e,t,r){if(t.length===0){e=e.replaceAll("\xAF_(\u30C4)_/\xAF","\xAF\\_(\u30C4)_/\xAF");let s=0,l=0;if([...e].forEach(c=>{const m=c.codePointAt(0);m!==8206&&m!==32&&(l+=1),qe(m)&&s++}),s>l*.9&&s>10){const c=[];let m=[];for(const f of e.split(" "))[...f].filter(g=>qe(g.codePointAt(0))).length>5?c.length>0?(m.length>0&&(c[c.length-1]+=" "+m.join(" ")),m=[],c.push(f)):(c.push([...m,f].join(" ")),m=[]):m.push(f);return c.push(...m),[o.txt(c.join(`
`))]}return[o.txt(e)]}const i=[];let n=0;const d=s=>{const l=u.slice(n,n+s).join("");l.length>0&&i.push(o.txt(l))},u=[...e];return t.forEach(([s,l,c])=>{d(l),n=l+c;const m=u.slice(l,l+c).join(""),f=Ct(s);f.error!=null?i.push(o.error(m,f.error)):f.code?i.push(o.code(m)):i.push(o.txt(m,{strong:f.strong,emphasis:f.emphasis,strikethrough:f.strike,superscript:f.super}))}),d(u.length),i}function jt(e,t){switch(e.e){case"text":return Be(e.t,e.f??[]);case"r/":case"u/":return[o.link(a,"/"+e.e+e.t,{is_user_link:e.e==="u/"?e.t:void 0},o.txt((e.l?"/":"")+e.e+e.t))];case"link":return[o.link(a,e.u,{title:e.a},...Be(e.t,e.f??[]))];case"br":return[o.br()];case"spoilertext":return[o.spoiler(...te(e.c,t))];case"raw":return[o.txt(e.t)];case"gif":case"img":{const r=t.media_metadata[e.id];return r?r.status!=="valid"?[o.error("Bad status "+r.status,r)]:r.e==="AnimatedImage"?[o.link(a,r.s.mp4??r.s.gif,{},o.txt("[embedded "+e.id.split("|")[0]+"]"))]:r.e==="Image"?r.t==="emoji"?[{kind:"emoji",url:r.s.u,name:":"+e.id.split("|")[2]+":"}]:[o.link(a,r.s.u,{},o.txt("[embedded "+e.id.split("|")[0]+"]"))]:[o.error("Unsupported "+r.e,r)]:[o.error("Missing media id "+e.id,r)]}}return v(e.e),[o.error("TODO "+e.e,e)]}function te(e,t){return(e??[]).flatMap(r=>jt(r,t))}function Ct(e){return{strong:!!(e&1),emphasis:!!(e&2),strike:!!(e&8),super:!!(e&32),code:!!(e&64),error:e&-108?"unsupported style "+e.toString(2):void 0}}function Ut(){const e=localStorage.getItem("reddit-secret");return!(e==null||e==="")}function Fe(e){const r="https://"+(e?"oauth.reddit.com":"www.reddit.com"),i=localStorage.getItem("--use-mock");return i!=null?i+r:r}function At(e,t,r){const[i,n,d]=We(t);if(!i.startsWith("/"))throw new Error("path didn't start with `/` : `"+t+"`");if(r.override??!1)return Fe(e)+i+n.toString();n.set("raw_json","1"),n.set("rtj","yes"),n.set("emotes_as_images","true"),n.set("gilding_detail","1"),n.set("profile_img","true");const u=Fe(e)+i+".json?"+n.toString()+(d===""?"":"#"+d);return console.log("!PATHURL",u),u}let $=[];function qt(){return new Promise(e=>{$.push(e),$.length===1&&Ft().then(t=>{$.forEach(r=>r(t)),$=[]}).catch(t=>{console.log("Get access token error",t),$.forEach(r=>r(null)),$=[]})})}function Bt(){return[...crypto.getRandomValues(new Uint8Array(25))].map(e=>e.toString(16).padStart(2,"0")).join("")}async function Ft(){const e=localStorage.getItem("reddit-secret");if(e===""||e==null){const r=localStorage.getItem("reddit-app-data");let i;if(r!=null){const u=JSON.parse(r);if(u.expires<Date.now())i=u.device_id;else return u.access_token}else i=Bt();const n=await fetch("https://www.reddit.com/api/v1/access_token",{method:"POST",mode:"cors",credentials:"omit",headers:{Authorization:"Basic "+btoa(me+":"),"Content-Type":"application/x-www-form-urlencoded"},body:S({grant_type:"https://oauth.reddit.com/grants/installed_client",device_id:i,redirect_uri:Re})}).then(u=>u.json());if(n.error)throw console.log(n),new Error("error: "+JSON.stringify(n));const d={access_token:n.access_token,expires:Date.now()+n.expires_in*1e3,scope:n.scope,device_id:i};return localStorage.setItem("reddit-app-data",JSON.stringify(d)),d.access_token}const t=JSON.parse(e);if(console.log(t.expires,Date.now()),t.expires<Date.now()){console.log("Token expired, refreshing\u2026");const[r,i]=await fetch("https://www.reddit.com/api/v1/access_token",{method:"POST",mode:"cors",credentials:"omit",headers:{Authorization:"Basic "+btoa(me+":"),"Content-Type":"application/x-www-form-urlencoded"},body:ut`grant_type=refresh_token&refresh_token=${t.refresh_token}`}).then(async d=>[d.status,await d.json()]);if(r!==200)throw console.log("Error! got",i,"with status code",r),new Error("Status code "+r);if("error"in i)throw console.log("refresh attempt: ",i,t),new Error("Got error while refreshing token: "+i.error);const n={access_token:i.access_token,refresh_token:i.refresh_token??t.refresh_token,expires:Date.now()+i.expires_in*1e3,scope:i.scope};return console.log("Refresh info:",i,n),localStorage.setItem("reddit-secret",JSON.stringify(n)),console.log("Refreshed \u221A"),n.access_token}return t.access_token}async function Mt(){const e=await qt();return e==null?"":"Bearer "+e}function Y(e,t,r){return{kind:"counter",client_id:a.id,increment:{icon:"join",color:"white",label:"Subscribe",undo_label:"Unsubscribe"},decrement:null,unique_id:"/subscribe/"+e+"/",time:Date.now(),style:"pill-filled",incremented_style:"pill-empty",count_excl_you:r?t-1:t,you:r?"increment":void 0,actions:{increment:I.encode({kind:"subscribe",subreddit:e,direction:"sub"}),reset:I.encode({kind:"subscribe",subreddit:e,direction:"unsub"})}}}function Gt(e,t){try{return Wt(e,t)}catch(r){return console.log("widget error",r),{kind:"widget",title:"Error!",raw_value:e,widget_content:{kind:"body",body:{kind:"richtext",content:[o.p(o.error("Uh oh! Error "+r.toString(),e))]}}}}}function Wt(e,t){return e.kind==="moderators"?{kind:"widget",title:"Moderators",raw_value:e,widget_content:{kind:"body",body:{kind:"richtext",content:[o.p(o.link(a,"/message/compose?to=/r/"+t,{style:"pill-empty"},o.txt("Message the mods"))),o.ul(...e.mods.map(r=>o.li(o.p(o.link(a,"/u/"+r.name,{is_user_link:r.name},o.txt("u/"+r.name)),...J({type:r.authorFlairType,text:r.authorFlairText,text_color:r.authorFlairTextColor,background_color:r.authorFlairBackgroundColor,richtext:r.authorFlairRichText}).flatMap(i=>[o.txt(" "),o.flair(i)]))))),o.p(o.link(a,"/r/"+t+"/about/moderators",{},o.txt("View All Moderators")))]}}}:e.kind==="community-list"?{kind:"widget",title:e.shortName,raw_value:e,widget_content:{kind:"list",items:e.data.map(r=>r.type==="subreddit"?{icon:r.communityIcon||r.iconUrl||void 0,name:{kind:"text",text:"r/"+r.name},click:{kind:"link",url:"/r/"+r.name},action:Y(r.name,r.subscribers,r.isSubscribed)}:(v(r.type),{name:{kind:"text",text:"ERROR UNSUPPORTED"+r.type},click:{kind:"body",body:{kind:"richtext",content:[o.pre(JSON.stringify(r,null,"	"),"json")]}}}))}}:e.kind==="id-card"?{kind:"widget",title:"Error!",raw_value:e,widget_content:{kind:"body",body:{kind:"richtext",content:[o.p(o.error("Not supported "+e.kind,e))]}}}:e.kind==="menu"?{kind:"widget",title:"Error!",raw_value:e,widget_content:{kind:"body",body:{kind:"richtext",content:[o.p(o.error("Uh oh! TODO widget "+e.kind,e))]}}}:e.kind==="textarea"?{kind:"widget",title:e.shortName,raw_value:e,widget_content:{kind:"body",body:{kind:"text",client_id:a.id,content:e.textHtml,markdown_format:"reddit_html"}}}:e.kind==="subreddit-rules"?{kind:"widget",title:e.shortName,raw_value:e,widget_content:{kind:"list",items:e.data.map((r,i)=>({name:{kind:"text",text:""+(i+1)+". "+r.shortName},click:{kind:"body",body:{kind:"text",client_id:a.id,content:r.descriptionHtml,markdown_format:"reddit_html"}}}))}}:e.kind==="image"?{kind:"widget",title:e.shortName,raw_value:e,widget_content:{kind:"image",src:e.data[e.data.length-1].url,link_url:e.data[e.data.length-1].linkUrl,width:e.data[e.data.length-1].width,height:e.data[e.data.length-1].height}}:e.kind==="post-flair"?{kind:"widget",title:e.shortName,raw_value:e,widget_content:{kind:"list",items:e.order.map(r=>{const i=e.templates[r],n=J({type:i.type,text:i.text,text_color:i.textColor,background_color:i.backgroundColor,richtext:i.richtext});return n.length!==1?(console.log("bad flair",i,n),{name:{kind:"text",text:"error bad flair"},click:{kind:"body",body:{kind:"richtext",content:[o.p(o.error("bad flair",[i,n]))]}}}):{name:{kind:"flair",flair:n[0]},click:{kind:"link",url:"/r/"+t+'/search?q=flair:"'+encodeURIComponent(i.text)+'"&restrict_sr=1'}}})}}:e.kind==="custom"?{kind:"widget",title:e.shortName,raw_value:e,widget_content:{kind:"iframe",height:""+e.height,srcdoc:`
            <head>
                <link rel="stylesheet" href="${e.stylesheetUrl}">
                <base target="_blank">
            </head>
            <body>${e.textHtml}</body>
        `}}:e.kind==="button"?{kind:"widget",title:e.shortName,raw_value:e,widget_content:{kind:"list",above_text:{kind:"text",content:e.descriptionHtml,client_id:a.id,markdown_format:"reddit_html"},items:e.buttons.map(r=>r.kind==="text"?{name:{kind:"text",text:r.text},click:{kind:"link",url:r.url}}:r.kind==="image"?{name:{kind:"image",src:r.url,w:r.width,h:r.height,alt:r.text},click:{kind:"link",url:r.linkUrl}}:(v(r.kind),{name:{kind:"text",text:"TODO "+r.kind},click:{kind:"body",body:{kind:"none"}}}))}}:e.kind==="calendar"?{kind:"widget",title:e.shortName,raw_value:e,widget_content:{kind:"body",body:{kind:"array",body:e.data.flatMap((r,i)=>[...i!==0?[{kind:"richtext",content:[o.hr()]}]:[],{kind:"text",client_id:a.id,content:r.titleHtml,markdown_format:"reddit_html"},{kind:"richtext",content:[o.p(o.timeAgo(r.startTime*1e3))]},...r.locationHtml!=null?[{kind:"text",client_id:a.id,content:r.locationHtml,markdown_format:"reddit_html"}]:[],...r.descriptionHtml!=null?[{kind:"text",client_id:a.id,content:r.descriptionHtml,markdown_format:"reddit_html"}]:[]])}}}:(v(e.kind),{kind:"widget",title:"Error!",raw_value:e,widget_content:{kind:"body",body:{kind:"richtext",content:[o.p(o.error("Uh oh! Unsupported widget "+e.kind,e))]}}})}function Ht(e,t){return{kind:"widget",title:e.data.title,raw_value:e,widget_content:{kind:"community-details",description:e.data.public_description},actions_bottom:[Y(t,e.data.subscribers,e.data.user_is_subscriber??!1)]}}function $t(e,t,{collapsed:r}){return{kind:"thread",raw_value:e,body:{kind:"text",client_id:a.id,markdown_format:"reddit_html",content:e.data.description_html},display_mode:{body:r?"collapsed":"visible",comments:"visible"},link:"/r/"+t+"/about/sidebar",layout:"reddit-post",title:{text:"old.reddit sidebar"},actions:[],default_collapsed:!1}}function zt(e){const t=e.widgets,r=d=>{const u=t.items[d];if(!u)throw new Error("bad widget "+d);return u},i=d=>Gt(d,e.subreddit),n=[...e.sub_t5?[Ht(e.sub_t5,e.subreddit)]:[],...e.sub_t5?[$t(e.sub_t5,e.subreddit,{collapsed:!!t})]:[],...t?t.layout.sidebar.order.map(d=>i(r(d))):[],...t?[i(r(t.layout.moderatorWidget))]:[]];return n.length===0&&n.push({kind:"widget",title:"Error",widget_content:{kind:"body",body:{kind:"richtext",content:[o.p(o.txt("Failed to fetch sidebar for this page :("))]}},raw_value:e}),n}function Vt(e){if(!e)return{kind:"thread",title:{text:"Listing"},body:{kind:"text",client_id:a.id,content:"Listing",markdown_format:"none"},display_mode:{body:"collapsed",comments:"collapsed"},link:"TODO no link",layout:"error",actions:[],default_collapsed:!1,raw_value:e};const t=[{text:"Posts",action:{kind:"link",client_id:a.id,url:"/r/"+e.subreddit},selected:!0}];e:if(e.widgets){const r=e.widgets?.layout.topbar.order.length;if(r===0)break e;if(r!==1){t.push({text:"ERROR Topbar Order",action:{kind:"link",client_id:a.id,url:"error"},selected:!1});break e}const i=e.widgets.items[e.widgets.layout.topbar.order[0]];if(i.kind!=="menu"){t.push({text:"ERROR Topbar Item",action:{kind:"link",client_id:a.id,url:"error"},selected:!1});break e}i.showWiki&&t.push({text:"Wiki",action:{kind:"link",client_id:a.id,url:"/r/"+e.subreddit+"/wiki/index"},selected:!1});const n=d=>{if("children"in d)return{text:d.text,selected:!1,action:{kind:"menu",children:d.children.map(n)}};if("url"in d)return{text:d.text,selected:!1,action:{kind:"link",client_id:a.id,url:d.url}};F(d)};t.push(...i.data.map(d=>({...n(d),selected:!1})))}return{kind:"bio",...e.sub_t5?nt(e.sub_t5.data):{banner:null,icon:null},name:{display:e.sub_t5?.data.title,link_name:e.sub_t5?e.sub_t5.data.display_name_prefixed:"r/"+e.subreddit},body:null,subscribe:e.sub_t5?Y(e.subreddit,e.sub_t5.data.subscribers,e.sub_t5.data.user_is_subscriber??!1):void 0,menu:t.length===1?null:t,raw_value:e}}const Ee=U("deferred_inbox");function Je(e){return e.startsWith("/mod/")?"raw!https://mod.reddit.com"+e.replace("/mod/",""):"raw!https://www.reddit.com"+e}function C(e){const t=[{kind:"link",text:"View on reddit.com",url:Je(e),client_id:"reddit"}];return Ut()?{actions:[{kind:"act",client_id:a.id,action:I.encode({kind:"log_out"}),text:"Log Out"},...t],inboxes:[{id:"/messages",name:"Messages",active_color:"orange",hydrate:Ee.encode({kind:"inbox"}),url:"/message/inbox"},{id:"/modmail",name:"Modmail",active_color:"green",hydrate:Ee.encode({kind:"modmail"}),url:"/mod/mail/all"}]}:{actions:[{kind:"link",client_id:a.id,url:Xt(),text:"Log In",...t},{kind:"link",client_id:a.id,url:"raw!https://www.reddit.com/register",text:"Sign Up"},...t],inboxes:[]}}function Z(e,t,r){const i=[];return r.warning&&i.push(...r.warning),{title:"Error View",navbar:C(e),body:{kind:"one",item:{parents:[{kind:"thread",raw_value:t,body:{kind:"richtext",content:[...i,o.pre(JSON.stringify(t,null,"	"),"json")]},display_mode:{body:"visible",comments:"visible"},link:e,layout:"error",actions:[],default_collapsed:!1}],replies:[]}},sidebar:r.sidebar??void 0,display_style:"comments-view"}}function D(e,t,r,i){const n=t;if(Array.isArray(r)){if(r[0].data.children.length!==1)return Z(e,r,{sidebar:i.sidebar,warning:de(e)});const d=r[0].data.children[0];if(d.kind!=="t3")return Z(e,r,{sidebar:i.sidebar,warning:de(e)});const u=d.data.name,s=d.data.suggested_sort??"confidence",l=d.data.contest_mode,c=d.data.can_mod_post,m=d.data.permalink,f=d.data.locked,T=d.data.discussion_type==="CHAT",O=r[1].data.children,g=[],A=O[0];A&&A.kind==="t1"&&A.data.parent_id!==u&&g.push(Ke(A.data.subreddit,(u??"").replace("t3_",""),A.data.parent_id.replace("t1_","")));let E=O.map(P=>W(P,{link_fullname:u},{permalink:m,sort:s,is_chat:T}));if(n.kind==="comments"&&n.focus_comment!=null){const P=L=>{if(L.length!==1)return;const R=L[0];if(R.kind==="thread")return R},K=L=>{const R=L.raw_value;if(typeof R=="object"&&R&&"data"in R&&typeof R.data=="object"&&R.data&&"name"in R.data&&typeof R.data.name=="string"){const Le=R.data.name;return Le.startsWith("t1_")?Le.replace("t1_",""):void 0}};let y=P(E),ve;for(;y;){if(K(y)===n.focus_comment){ve=y;break}y=P(y.replies??[])}if(ve){for(y=P(E);y&&y!==ve;){g.push(y);const L=y.replies;y.replies=void 0,y=P(L??[])}if(y){g.push(y);const L=y.replies;y.replies=void 0,E=L??[]}else E=[]}}r[1].data.after!=null&&E.push({kind:"load_more",url:"TODO",load_more:M.encode({kind:"duplicates",lmurl:"todo"}),raw_value:r[1]});let q;return n.kind==="comments"?l&&!c?q=[{selected:!0,text:"Random",action:{kind:"link",client_id:a.id,url:x(m,{sort:"random"})}}]:q=[["confidence","Best"],["top","Top"],["new","New"],["controversial","Controversial"],["old","Old"],["random","Random"],["qa","Q&A"],["live","Live"]].map(([P,K])=>({selected:(n.sort_override??s)===P,text:K,action:{kind:"link",client_id:a.id,url:x(m,{sort:P})}})):n.kind==="duplicates"?q=[["num_comments","Comments"],["new","New"]].map(([P,K])=>({selected:n.sort===P,text:K,action:{kind:"link",client_id:a.id,url:x(m.replace("/comments","/duplicates"),{sort:P})}})):q=[{selected:!1,text:"error "+n.kind,action:{kind:"link",client_id:a.id,url:"error"}}],{title:d.kind==="t3"?d.data.title:"ERR top not t3",navbar:C(e),body:{kind:"one",item:{parents:[W(d,{force_expand:g.length>0?"closed":"open",show_post_reply_button:!0},{permalink:m,sort:"unsupported",is_chat:T}),...l?[(()=>({kind:"thread",body:{kind:"richtext",content:[o.p(o.txt("This thread is in contest mode.")),o.p(o.txt(c?"As a mod, you can sort comments however you wish. Regular users have randomized sorting and cannot see scores.":"Sorting is randomized and scores are hidden."))]},display_mode:{body:"visible",comments:"collapsed"},raw_value:l,link:"no",actions:[],default_collapsed:!1,layout:"reddit-post"}))()]:[],...f?[(()=>({kind:"thread",body:{kind:"richtext",content:[o.p(o.txt("This thread is locked.")),o.p(o.txt(c?"Only mods like you can comment on this thread.":"You are not able to comment on this thread."))]},display_mode:{body:"visible",comments:"collapsed"},raw_value:f,link:"no",actions:[],default_collapsed:!1,layout:"reddit-post"}))()]:[],...g],menu:q,replies:E}},sidebar:i.sidebar??void 0,display_style:"comments-view"}}if(r.kind==="wikipage")return{title:e+" | Wiki",navbar:C(e),body:{kind:"one",item:{parents:[{kind:"thread",raw_value:r,body:{kind:"text",client_id:a.id,markdown_format:"reddit_html",content:r.data.content_html},display_mode:{body:"visible",comments:"visible"},link:e,layout:"error",actions:[],default_collapsed:!1}],replies:[]}},sidebar:i.sidebar??void 0,display_style:"comments-view"};if(r.kind==="t5")return{title:e+" | Sidebar",navbar:C(e),body:{kind:"one",item:{parents:[{kind:"thread",raw_value:r,body:{kind:"text",client_id:a.id,markdown_format:"reddit_html",content:r.data.description_html},display_mode:{body:"visible",comments:"visible"},link:e,layout:"reddit-post",title:{text:"old.reddit sidebar"},actions:[],default_collapsed:!1}],replies:[]}},sidebar:i.sidebar??void 0,display_style:"comments-view"};if(r.kind==="UserList")return{title:e,navbar:C(e),body:{kind:"one",item:{parents:[{kind:"thread",body:{kind:"richtext",content:[o.h1(o.txt("User List")),o.table([o.th("left",o.txt("Username")),o.th("left",o.txt("Added")),o.th("left",o.txt("Perms"))],...r.data.children.map(d=>[o.td(o.link(a,"/u/"+d.name,{is_user_link:d.name},o.txt("u/"+d.name))),o.td(o.timeAgo(d.date*1e3)),o.td(...d.mod_permissions.flatMap((u,s)=>[...s!==0?[o.txt(", ")]:[],o.txt(u)]))]))]},display_mode:{body:"visible",comments:"visible"},raw_value:r,layout:"reddit-post",link:e,actions:[],default_collapsed:!1}],replies:[]}},sidebar:i.sidebar??void 0,display_style:"comments-view"};if(r.kind==="Listing"){r.data.before!=null;let d;if(r.data.after!=null){const l=x(e,{before:void 0,after:r.data.after});d={kind:"load_more_unmounted",load_more_unmounted:Ye.encode({kind:"listing",url:l}),url:l,count:void 0,raw_value:r}}const u=[["overview","Overview"],["comments","Comments"],["submitted","Submitted"]],s=[["upvoted","Upvoted"],["downvoted","Downvoted"],["hidden","Hidden"],["saved","Saved"]];return{title:e,navbar:C(e),body:{kind:"listing",menu:n.kind==="subreddit"?[{selected:n.current_sort.v==="hot",text:"Hot",action:{kind:"link",client_id:a.id,url:"/"+[...n.sub.base,...n.is_user_page?["hot"]:[]].join("/")}},{selected:n.current_sort.v==="best",text:"Best",action:{kind:"link",client_id:a.id,url:"/"+[...n.sub.base,"best"].join("/")}},{selected:n.current_sort.v==="new",text:"New",action:{kind:"link",client_id:a.id,url:"/"+[...n.sub.base,"new"].join("/")}},{selected:n.current_sort.v==="rising",text:"Rising",action:{kind:"link",client_id:a.id,url:"/"+[...n.sub.base,"rising"].join("/")}},...[["top","Top"],["controversial","Controversial"]].map(([l,c])=>({selected:n.current_sort.v===l,text:n.current_sort.v===l?c+" ("+n.current_sort.t+")":c,action:{kind:"menu",children:[["hour","Hour"],["day","Day"],["week","Week"],["month","Month"],["year","Year"],["all","All Time"]].map(([m,f])=>({text:f,selected:n.current_sort.v===l&&n.current_sort.t===m,action:{kind:"link",client_id:a.id,url:"/"+[...n.sub.base,l].join("/")+"?t="+m}}))}}))]:n.kind==="user"?[...u.map(([l,c])=>({selected:n.current.tab===l,text:c,action:{kind:"show-line-two",children:[{selected:n.current.tab===l&&n.current.sort.sort==="hot",text:"Hot",action:{kind:"link",client_id:a.id,url:x("/"+["u",n.username,l].join("/"),{sort:"hot"})}},{selected:n.current.tab===l&&n.current.sort.sort==="new",text:"New",action:{kind:"link",client_id:a.id,url:x("/"+["u",n.username,l].join("/"),{sort:"new"})}},...[["top","Top"],["controversial","Controversial"]].map(([m,f])=>({selected:n.current.tab===l&&n.current.sort.sort===m,text:n.current.tab===l&&n.current.sort.sort===m?f+" ("+n.current.sort.t+")":f,action:{kind:"menu",children:[["hour","Hour"],["day","Day"],["week","Week"],["month","Month"],["year","Year"],["all","All Time"]].map(([T,O])=>({text:O,selected:n.current.tab===l&&n.current.sort.sort===m&&n.current.sort.t===T,action:{kind:"link",client_id:a.id,url:x("/"+["u",n.username,l].join("/"),{sort:m,t:T})}}))}}))]}})),{selected:n.current.tab==="gilded",text:"Gilded",action:{kind:"show-line-two",children:[{selected:n.current.tab==="gilded"&&n.current.by==="received",text:"Received",action:{kind:"link",client_id:a.id,url:"/"+["u",n.username,"gilded"].join("/")}},{selected:n.current.tab==="gilded"&&n.current.by==="given",text:"Given",action:{kind:"link",client_id:a.id,url:"/"+["u",n.username,"gilded","given"].join("/")}}]}},...s.map(([l,c])=>({selected:n.current.tab===l,text:c,action:{kind:"link",client_id:a.id,url:"/"+["u",n.username,l].join("/")}}))]:n.kind==="inbox"?[{selected:n.current.tab==="compose",text:"Compose",action:{kind:"link",client_id:a.id,url:"/message/compose"}},{selected:n.current.tab==="inbox",text:"Inbox",action:{kind:"show-line-two",children:[["inbox","All"],["unread","Unread"],["messages","Messages"],["comments","Comment Replies"],["selfreply","Post Replies"],["mentions","Username Mentions"]].map(([l,c])=>({text:c,selected:n.current.tab==="inbox"&&n.current.inbox_tab===l,action:{kind:"link",client_id:a.id,url:"/message/"+l}}))}},{selected:n.current.tab==="sent",text:"Sent",action:{kind:"link",client_id:a.id,url:"/message/sent"}}]:[{text:"Error! "+n.kind,selected:!1,action:{kind:"link",client_id:a.id,url:e}}],header:i.header??{kind:"thread",title:{text:"Listing"},body:{kind:"text",client_id:a.id,content:"Listing",markdown_format:"none"},display_mode:{body:"collapsed",comments:"collapsed"},link:"TODO no link",layout:"error",actions:[],default_collapsed:!1,raw_value:n},items:n.kind==="inbox"?r.data.children.map(l=>Jt(l)):r.data.children.map(l=>Yt(l,void 0,{permalink:e,sort:"unsupported",is_chat:!1})),next:d},sidebar:i.sidebar??void 0,display_style:"fullscreen-view"}}return v(r.kind),Z(e,r,{sidebar:i.sidebar,warning:de(e)})}function de(e){const t=e.startsWith("/mod/")||e.startsWith("/mod?")||e.startsWith("/mod#")||e==="/mod";return t&&(e=e.replace("/mod","")),[o.h1(o.txt("This url is not supported yet")),t?o.h2(o.txt("View it on mod.reddit.com: "),o.link(a,"raw!https://mod.reddit.com"+e,{},o.txt("mod.reddit.com"+e))):o.h2(o.txt("View it on reddit.com: "),o.link(a,"raw!https://www.reddit.com"+e,{},o.txt("reddit.com"+e))),o.p(o.txt("Submit an issue "),o.link(a,"https://github.com/pfgithub/threadclient/issues",{},o.txt("here")),o.txt(" if you would like to see this supported. Mention the url: "),o.code(e))]}const Ye=U("load_more_unmounted"),M=U("load_more");function re(e){const t={id:e.name,rank:"2"};return{kind:"counter",client_id:a.id,unique_id:"/vote/"+e.name+"/",time:Date.now(),increment:{icon:"up_arrow",color:"orange",label:"Upvote",undo_label:"Undo Upvote"},decrement:{icon:"down_arrow",color:"indigo",label:"Downvote",undo_label:"Undo Downvote"},special:"reddit-points",count_excl_you:(e.score_hidden??e.hide_score??!1)&&e.score===1?"hidden":e.score+(e.likes===!0?-1:e.likes===!1?1:0),you:e.likes===!0?"increment":e.likes===!1?"decrement":void 0,percent:e.upvote_ratio,actions:e.archived??!1?{error:"archived <6mo"}:{increment:Te({...t,dir:"1"}),decrement:Te({...t,dir:"-1"}),reset:Te({...t,dir:"0"})}}}function Me(e){if(e.kind==="t1"||e.kind==="t4"){const t=e.data;return{kind:"thread",info:{time:t.created_utc*1e3,edited:!1,author:t.author!=null?{name:"u/"+t.author,link:"/u/"+t.author,color_hash:t.author,client_id:a.id}:void 0,pinned:!1},body:{kind:"text",client_id:a.id,content:t.body_html,markdown_format:"reddit_html"},display_mode:{body:"visible",comments:"collapsed"},link:t.context,layout:"reddit-comment",default_collapsed:!1,actions:[...e.kind==="t1"?[re(t)]:[],...t.context?[{kind:"link",client_id:a.id,url:t.context,text:"Context"}]:[],...e.kind==="t4"?[{kind:"link",client_id:a.id,url:"/message/messages/"+t.id,text:"Permalink"}]:[],{kind:"counter",client_id:a.id,neutral_icon:"envelope_open",increment:{icon:"envelope",color:"white",label:"Mark Unread",undo_label:"\u{1F836} New"},decrement:null,count_excl_you:"none",you:t.new?"increment":void 0,unique_id:"/unread/"+t.name+"/",time:Date.now(),actions:{increment:I.encode({kind:"mark_read",direction:"un",fullname:t.name}),reset:I.encode({kind:"mark_read",direction:"",fullname:t.name})}}],raw_value:e}}return{kind:"thread",body:{kind:"richtext",content:[o.p(o.error("Unsupported "+e.kind,e))]},display_mode:{body:"visible",comments:"collapsed"},layout:"error",default_collapsed:!1,actions:[],raw_value:e,link:"no"}}function Jt(e){if(e.kind==="t1"||e.kind==="t4"){const t=e.data;return{parents:[{kind:"thread",title:{text:t.subject},body:{kind:"none"},display_mode:{body:"visible",comments:"collapsed"},link:"no",layout:"reddit-post",default_collapsed:!1,actions:[],raw_value:e},Me(e)],replies:typeof t.replies=="object"?t.replies.data.children.map(r=>Me(r)):[]}}return{parents:[{kind:"thread",body:{kind:"richtext",content:[o.p(o.error("Unsupported "+e.kind,e))]},display_mode:{body:"visible",comments:"collapsed"},layout:"error",default_collapsed:!1,actions:[],raw_value:e,link:"no"}],replies:[]}}function Yt(e,t={},r){const i=W(e,t,r);return e.kind==="t1"&&"link_title"in e.data?{parents:[{kind:"thread",title:{text:e.data.link_title},info:{time:!1,edited:!1,in:{name:e.data.subreddit_name_prefixed,link:"/"+e.data.subreddit_name_prefixed},author:{color_hash:e.data.link_author,name:e.data.link_author,link:"/u/"+e.data.link_author,client_id:a.id},pinned:!1},body:{kind:"link",client_id:a.id,url:e.data.link_permalink},display_mode:{body:"visible",comments:"collapsed"},link:e.data.link_permalink,layout:"reddit-post",default_collapsed:!1,actions:[{kind:"link",client_id:a.id,url:e.data.link_permalink,text:"Permalink"}],raw_value:e,replies:[]},...e.data.parent_id===e.data.link_id?[]:[Ke(e.data.subreddit,e.data.link_id.replace("t3_",""),e.data.parent_id.replace("t1_",""))],i],replies:[]}:{parents:[i],replies:[]}}function Ke(e,t,r){return{kind:"load_more",load_more:M.encode({kind:"context",subreddit:e,link_id:t,parent_id:r}),url:"/r/"+e+"/comments/"+t+"?comment="+r.replace("t1_","")+"&context=8",raw_value:[e,t,r]}}function W(e,t={},r){try{return Qt(e,t,r)}catch(i){return console.log(i),{kind:"thread",body:{kind:"richtext",content:[o.p(o.error("Error! "+i.toString(),i))]},display_mode:{body:"visible",comments:"visible"},raw_value:{error:i,listing:e},link:"Error!",layout:"error",actions:[],default_collapsed:!1}}}function pe(e){return{kind:"delete",client_id:a.id,data:Rt(e)}}const Qe=U("report");function ke(e,t){return{kind:"report",client_id:a.id,data:Qe.encode({subreddit:t,fullname:e})}}function fe(e){return{kind:"reply",client_id:a.id,key:"reply-"+e,text:"Reply",reply_info:we.encode({parent_id:e}),mode:"reply"}}function _e(e){return{kind:"reply",client_id:a.id,key:"edit-"+e,text:"Edit",reply_info:we.encode({parent_id:e}),mode:"edit"}}function be(e,t){return{kind:"counter",client_id:a.id,increment:{icon:"bookmark",color:"green",label:"Save",undo_label:"Unsave"},decrement:null,unique_id:`/save/${e}/`,time:Date.now(),count_excl_you:"none",you:t?"increment":void 0,actions:{increment:I.encode({kind:"save",fullname:e,direction:""}),reset:I.encode({kind:"save",fullname:e,direction:"un"})}}}function Xe(e){const t={admin:"admin",moderator:"moderator",unsupported:"error"};return{color_hash:e.author,client_id:a.id,name:e.author,link:"/u/"+e.author,flair:[...e.flair_bits?J(e.flair_bits):[],...e.is_submitter?ae([{elems:[{kind:"text",text:"\xABOP\xBB",styles:{}}],content_warning:!1,system:"op"}]):[],...e.author_cakeday??!1?ae([{elems:[{kind:"text",text:"\xAB\u{1F370}\xBB",styles:{}}],content_warning:!1,system:"cake"}]):[],...e.distinguished!=null?ae([{elems:[{kind:"text",text:"\xAB"+e.distinguished+"\xBB",styles:{}}],content_warning:!1,system:t[e.distinguished]??t.unsupported}]):[],...e.additional_flairs??[]],pfp:e.pfp!=null&&e.pfp!==""?{url:e.pfp_over18?"https://dummyimage.com/50x50/ff0000/fff.png&text=%3E18":e.pfp,hover:e.pfp}:void 0}}function he(e,t){return Xe({author:e.author,flair_bits:{type:e.author_flair_type,text:e.author_flair_text,text_color:e.author_flair_text_color,background_color:e.author_flair_background_color,richtext:e.author_flair_richtext},additional_flairs:t,distinguished:e.distinguished,is_submitter:"is_submitter"in e?e.is_submitter??!1:!1,author_cakeday:e.author_cakeday,pfp:e.profile_img,pfp_over18:e.profile_over_18??!1})}function Kt(e){return Xe({author:e.data.name,flair_bits:null,additional_flairs:[],distinguished:null,is_submitter:!1,author_cakeday:!1,pfp:e.data.icon_img,pfp_over18:e.data.subreddit.over18})}const Ie=U("fetch_removed_path");function Ze(e,t){return{permalink:x(t,{sort:e.sort}),sort:e.sort,is_chat:e.is_chat}}const ye={anti_evil_ops:()=>({short:"Anti-Evil Operations",title:"Removed by Reddit's Anti-Evil Operations",body:"For violations of reddit's Content Policy: https://reddit.com/help/contentpolicy"}),community_ops:()=>({short:"Community Operations",title:"Sorry, this post was removed by Reddit's Community team.",body:"It's rare, but Reddit's Community Team will occasionally remove posts from feeds to keep communities safe and civil."}),legal_operations:()=>({short:"Legal Operations",title:"This post was removed for legal reasons",body:"\xABTODO fill this\xBB"}),copyright_takedown:()=>({short:"Copyright Takedown",title:"Removed for Copyright Infringement",body:"\xABTODO fill this\xBB"}),reddit:()=>({short:"Spam Filters",title:"Sorry, this post was removed by Reddit's spam filters.",body:"Reddit's automated bots frequently filter posts it thinks might be spam."}),author:()=>({short:"Author",title:"Removed by the author",body:"The author of this post decided to remove it."}),deleted:()=>({short:"Author",title:"Deleted by the author",body:"The author of this post decided to delete it."}),moderator:(e,t)=>({short:"Moderators",title:"Removed by moderators of "+t,body:"Moderators of "+t+" decided to remove this post, likely due to a violation of the subreddit rules."}),automod_filtered:()=>({short:"Filtered by AutoModerator",title:"This post was filtered by AutoModerator",body:"\xABTODO fill this\xBB"}),content_takedown:()=>({short:"Content Takedown",title:"Sorry, this post was removed by Reddit.",body:"Reddit administrators occasionally remove posts that violate Reddit's User Agreement and Content Policy."}),unsupported:e=>({short:e,title:"This post was removed for \xAB"+e+"\xBB",body:"ThreadClient does not know what that means."})};function Pe(e){return{kind:"code",body:{kind:"richtext",content:[o.pre(e,"markdown")]}}}function et(e){let t;e.author==="[deleted]"&&(JSON.stringify(e.rtjson)===JSON.stringify({document:[{c:[{e:"text",t:"[deleted]"}],e:"par"}]})?t=ye.deleted("deleted",e.subreddit_name_prefixed):JSON.stringify(e.rtjson)===JSON.stringify({document:[{c:[{e:"text",t:"[removed]"}],e:"par"}]})&&(t=ye.moderator("moderator",e.subreddit_name_prefixed)));const r={kind:"richtext",content:Ve(e.rtjson,{media_metadata:e.media_metadata??{}})};return t!=null?{kind:"removed",removal_message:t,fetch_path:Ie.encode({path:"https://api.pushshift.io/reddit/comment/search?ids="+e.id}),body:r,client_id:a.id}:r}function tt(e){if(e.crosspost_parent_list&&e.crosspost_parent_list.length===1)return{kind:"crosspost",source:W({kind:"t3",data:e.crosspost_parent_list[0]},{force_expand:"crosspost"},Ze({permalink:e.permalink,sort:"unsupported",is_chat:!1},e.permalink)),client_id:a.id};if(e.is_self)return{kind:"array",body:[e.rtjson.document.length?{kind:"richtext",content:Ve(e.rtjson,{media_metadata:e.media_metadata??{}})}:e.url==="https://www.reddit.com"+e.permalink?{kind:"none"}:{kind:"link",client_id:a.id,url:e.url,embed_html:e.media_embed?.content},e.poll_data?{kind:"poll",votable:"Cannot vote",total_votes:e.poll_data.total_vote_count,choices:e.poll_data.options.map(t=>({name:t.text,votes:t.vote_count??"hidden",id:t.id})),vote_data:"",select_many:!1,your_votes:e.poll_data.user_selection!=null?[{id:e.poll_data.user_selection}]:[],close_time:e.poll_data.voting_end_timestamp}:void 0]};if(e.gallery_data)return{kind:"gallery",images:e.gallery_data.items.map(t=>{if(!e.media_metadata)throw new Error("missing media metadata");const r=e.media_metadata[t.media_id];if(!r)throw new Error("missing mediameta for "+t.media_id);return Se(r,t.caption)})};if(e.rpan_video)return{kind:"video",source:{kind:"video",sources:[{url:e.rpan_video.hls_url}]},gifv:!1};if(e.preview&&e.preview.images.length===1){const t=e.preview.images[0];if(t.variants.mp4){const r=t.variants.mp4,i=[...r.resolutions,r.source].sort((n,d)=>d.width-n.width).map(n=>({url:n.url,quality:n.width+"\xD7"+n.height}));return{kind:"video",source:{kind:"video",sources:i,preview:[...i].reverse()},gifv:!0}}if(e.preview.enabled)return{kind:"captioned_image",url:t.source.url,w:t.source.width,h:t.source.height}}return{kind:"link",client_id:a.id,url:e.url,embed_html:e.media_embed?.content}}function rt(e,t){if(t!=="crosspost")return e.preview?.images?.[0]?.resolutions?.[0]?.url!=null?{kind:"image",url:e.preview.images[0].resolutions[0].url}:e.rpan_video?{kind:"image",url:e.rpan_video.scrubber_media_url}:e.thumbnail!=null&&e.thumbnail!==""?e.thumbnail.includes("/")?{kind:"image",url:e.thumbnail}:{kind:"default",thumb:ae({self:"self",default:"default",image:"image",spoiler:"spoiler",nsfw:"nsfw",account:"account"})[e.thumbnail]??"error"}:{kind:"default",thumb:"default"}}function it(e){const t=[];return t.push(...J({type:e.link_flair_type,text:e.link_flair_text,text_color:e.link_flair_text_color,background_color:e.link_flair_background_color,richtext:e.link_flair_richtext})),e.spoiler&&t.push({elems:[{kind:"text",text:"Spoiler",styles:{}}],content_warning:!0}),e.over_18&&t.push({elems:[{kind:"text",text:"NSFW",styles:{}}],content_warning:!0}),e.is_original_content&&t.push({elems:[{kind:"text",text:"OC",styles:{}}],content_warning:!1}),t.push(...De(e.all_awardings??[])),e.approved===!0&&t.push({elems:[{kind:"text",text:"\u2713 Approved",styles:{}}],content_warning:!1,system:"approved"}),t}const ae=e=>e;function Qt(e,t={},r){if(t.force_expand??="closed",e.kind==="t1"){const i=e.data;return{kind:"thread",body:et(i),display_mode:{body:"visible",comments:"visible"},raw_value:e,link:x(i.permalink,{context:"3",sort:r.sort}),layout:"reddit-comment",info:{time:i.created_utc*1e3,edited:i.edited===!1?!1:i.edited*1e3,author:he(i,De(i.all_awardings??[])),pinned:i.pinned||i.stickied||!1},actions:(()=>[fe(i.name),{kind:"link",client_id:a.id,text:"Permalink",url:i.permalink?x(i.permalink,{context:"3",sort:r.sort}):"Error no permalink"},_e(i.name),pe(i.name),be(i.name,i.saved),ke(i.name,i.subreddit),...r.is_chat?[]:[re(i)],Pe(i.body)])(),default_collapsed:i.collapsed,replies:[...i.locked?[(()=>({kind:"thread",body:{kind:"richtext",content:[o.p(o.txt("This comment is locked.")),o.p(o.txt("Only moderators are able to comment on this thread."))]},display_mode:{body:"visible",comments:"collapsed"},raw_value:i.locked,link:"no",actions:[],default_collapsed:!1,layout:"reddit-post"}))()]:[],...i.replies?i.replies.data.children.map(d=>W(d,t,Ze(r,i.permalink))):[]]}}else if(e.kind==="t3"){const i=e.data,n=i.removed_by_category!=null?(ye[i.removed_by_category]??ye.unsupported)(i.removed_by_category,i.subreddit_name_prefixed):void 0,d=i.name.substring(3);i.mod_reports.length+i.user_reports.length>0;const u=tt(i);return{kind:"thread",title:{text:i.title},flair:it(i),body:n!=null?{kind:"removed",removal_message:n,fetch_path:Ie.encode({path:"https://api.pushshift.io/reddit/submission/search?ids="+d}),body:u,client_id:a.id}:u,display_mode:t.force_expand==="crosspost"?{body:"visible",comments:"collapsed"}:{body:"collapsed",body_default:t.force_expand,comments:"collapsed"},raw_value:e,link:i.permalink,thumbnail:rt(i,t.force_expand),layout:"reddit-post",info:{time:i.created_utc*1e3,edited:i.edited===!1?!1:i.edited*1e3,author:he(i,[]),in:{link:"/"+i.subreddit_name_prefixed,name:i.subreddit_name_prefixed},pinned:i.stickied||!1},actions:[...t.show_post_reply_button??!1?[fe(i.name)]:[],{kind:"link",client_id:a.id,url:i.permalink,text:i.num_comments.toLocaleString()+" comment"+(i.num_comments===1?"":"s")},{kind:"link",client_id:a.id,url:"/domain/"+i.domain,text:i.domain},_e(i.name),pe(i.name),be(i.name,i.saved),re(i),{kind:"link",client_id:a.id,url:i.permalink.replace("/comments/","/duplicates/"),text:"Duplicates"},ke(i.name,i.subreddit)],default_collapsed:!1}}else if(e.kind==="more"){const i=e.data;if(i.children.length===0)return{kind:"load_more",load_more:M.encode({kind:"parent_permalink",permalink:r.permalink}),url:r.permalink,count:void 0,raw_value:e};if(t.link_fullname==null)throw new Error("!options.link_fullname");return{kind:"load_more",load_more:M.encode({kind:"api_loadmore",link_fullname:t.link_fullname,children:i.children,parent_permalink:r}),url:r.permalink,count:i.children.length,raw_value:e}}else if(e.kind==="t5"){const{data:i}=e;return{kind:"thread",display_mode:{body:"collapsed",body_default:"closed",comments:"visible"},raw_value:e,link:i.url,layout:"reddit-post",title:{text:i.display_name_prefixed},thumbnail:{kind:"image",url:i.community_icon},body:{kind:"text",client_id:a.id,content:i.description_html,markdown_format:"reddit_html"},actions:[Y(i.url.replace("/r/","").replace("/u/","u_"),i.subscribers,i.user_is_subscriber??!1)],default_collapsed:!0}}else return v(e.kind),{kind:"thread",title:{text:"unsupported listing kind "+e.kind},body:{kind:"text",client_id:a.id,content:"unsupported",markdown_format:"none"},display_mode:{body:"collapsed",comments:"collapsed"},raw_value:e,link:"TODO no link",layout:"error",actions:[],default_collapsed:!1}}function Xt(){const e=typeof location<"u"?location.host:"NOSTATE",t=["account","creddits","edit","flair","history","identity","livemanage","modconfig","modcontributors","modflair","modlog","modmail","modothers","modposts","modself","modwiki","mysubreddits","privatemessages","read","report","save","structuredstyles","submit","subscribe","vote","wikiedit","wikiread"].join(" ");return"raw!https://www.reddit.com/api/v1/authorize?"+S({client_id:me,response_type:"code",state:e,redirect_uri:Re,duration:"permanent",scope:t})}async function ie(e){if(e.kind==="homepage")return{sidebar:null};if(e.kind==="userpage")return{sidebar:null};if(e.kind==="mod")return{sidebar:null};if(e.kind==="subreddit"){const[t,r]=await Promise.all([_(`/r/${e.subreddit}/api/widgets`,{method:"GET",onerror:n=>{},cache:!0}),_(`/r/${e.subreddit}/about`,{method:"GET",onerror:n=>{},cache:!0})]),i={subreddit:e.subreddit,sub_t5:r??null,widgets:t??null};return{sidebar:zt(i),header:Vt(i)}}if(e.kind==="multireddit"){const[t]=await Promise.all([_("/"+["api","multi",...e.base].join("/"),{method:"GET",onerror:r=>{},cache:!0})]);return{sidebar:t?Zt(t):null}}if(e.kind==="error")return{sidebar:null};F(e)}function Zt(e){const t=e.data;return[{kind:"widget",title:t.display_name,raw_value:e,widget_content:{kind:"body",body:{kind:"array",body:[{kind:"richtext",content:[o.p(o.txt("Curated by "),o.link(a,"/u/"+t.owner,{is_user_link:t.owner.toLowerCase()},o.txt("u/"+t.owner))),o.p(o.txt("Created "),o.timeAgo(t.created_utc*1e3))]},{kind:"text",client_id:a.id,content:t.description_html,markdown_format:"reddit_html"}]}},actions_bottom:[{kind:"link",client_id:a.id,text:"Create a copy",url:"TODO"}]},{kind:"widget",title:"Subreddits ("+t.subreddits.length+")",raw_value:t.subreddits,widget_content:{kind:"list",items:t.subreddits.map(r=>({name:{kind:"text",text:"r/"+r.name},click:{kind:"link",client_id:a.id,url:"/r/"+r.name}}))}}]}function nt(e){const t=e.banner_background_image||e.banner_img||"",r=e.primary_color||"",i=e.community_icon||e.icon_img||"";return{banner:t?{kind:"image",desktop:t}:r?{kind:"color",color:r}:null,icon:i?{url:i}:null}}function er(e,t,r){const i=[];return e?.data?i.push({kind:"bio",...nt(e.data.subreddit),name:{display:e.data.name,link_name:"u/"+e.data.name},menu:null,raw_value:e,body:{kind:"text",client_id:a.id,content:e.data.subreddit.public_description_html,markdown_format:"reddit_html"},subscribe:{kind:"counter",client_id:a.id,increment:{icon:"join",color:"white",label:"Follow",undo_label:"Unfollow"},decrement:null,unique_id:"/follow/"+e.data.name+"/",time:Date.now(),style:"pill-filled",incremented_style:"pill-empty",count_excl_you:e.data.is_friend?e.data.subreddit.subscribers-1:e.data.subreddit.subscribers,you:e.data.is_friend?"increment":void 0,actions:{error:"TODO implement add friend"}}},{kind:"widget",title:"About",widget_content:{kind:"body",body:{kind:"richtext",content:[o.h1(o.link(a,"/u/"+e.data.name,{is_user_link:e.data.name},o.txt(e.data.name))),o.p(o.txt(e.data.link_karma+" post karma")),o.p(o.txt(e.data.comment_karma+" comment karma")),o.p(o.txt("Account created "),o.timeAgo(e.data.created_utc*1e3))]}},raw_value:e}):i.push({kind:"widget",title:"TODO",widget_content:{kind:"body",body:{kind:"richtext",content:[o.p(o.txt("Failed to fetch user info for this user :("))]}},raw_value:e}),r?.data?i.push({kind:"widget",title:"Moderates",raw_value:r,widget_content:{kind:"list",items:r.data.map(n=>({icon:n.community_icon||n.icon_img||"undefined",name:{kind:"text",text:n.sr_display_name_prefixed},click:{kind:"link",url:n.url}}))}}):r||i.push({kind:"widget",title:"TODO",widget_content:{kind:"body",body:{kind:"richtext",content:[o.p(o.txt("Failed to fetch modded subs for this user :("))]}},raw_value:r}),t?.data?i.push({kind:"widget",title:"Trophy Case",widget_content:{kind:"body",body:{kind:"richtext",content:[...t.data.trophies.map(({data:n})=>{const d=[...n.url!=null?[o.p(o.link(a,n.url,{},o.txt(n.url)))]:[],...n.description!=null?[o.p(o.txt(n.description))]:[]];return{kind:"body",body:{kind:"crosspost",client_id:a.id,source:{kind:"thread",title:{text:n.name},body:d.length?{kind:"richtext",content:d}:{kind:"none"},thumbnail:{kind:"image",url:n.icon_70},display_mode:{body:"collapsed",comments:"collapsed",body_default:"closed"},raw_value:n,link:n.icon_70,layout:"reddit-post",info:{time:n.granted_at!=null?n.granted_at*1e3:!1,edited:!1,pinned:!0},actions:[],default_collapsed:!1}}}})]}},raw_value:e}):i.push({kind:"widget",title:"TODO",widget_content:{kind:"body",body:{kind:"richtext",content:[o.p(o.txt("Failed to fetch trophy case for this user :("))]}},raw_value:t}),i}function se(e){let t=b.parse(e);for(let r=0;t.kind==="redirect"&&r<100;r++)e=t.to,t=b.parse(e);return[t,e]}function ir(e){return e}const a={id:"reddit",getPage:He,loader:Pt,async getThread(e){try{const[t,r]=se(e);if(console.log("PARSED URL:",t),t.kind==="comments"){const[i,n]=await Promise.all([_(`/comments/${t.post_id_unprefixed}`,{method:"GET",query:{sort:t.sort_override,comment:t.focus_comment,context:t.context}}),ie(t.sub)]);return D(r,t,i,{...n})}else if(t.kind==="duplicates"){const[i,n]=await Promise.all([_(`/duplicates/${t.post_id_unprefixed}`,{method:"GET",query:{after:t.after,before:t.before,sort:t.sort,crossposts_only:""+t.crossposts_only}}),ie(t.sub)]);return D(r,t,i,{...n})}else if(t.kind==="subreddit"){const i="/"+[...t.sub.base,t.current_sort.v].join("/"),[n,d]=await Promise.all([_(i,{method:"GET",query:{t:t.current_sort.t,before:t.before,after:t.after}}),ie(t.sub)]);return D(r,t,n,{...d})}else if(t.kind==="wiki"){const i="/"+[...t.sub.base,"wiki",...t.path].join("/")+"?"+S(t.query),[n,d]=await Promise.all([_(i,{method:"GET"}),ie(t.sub)]);return D(r,t,n,{...d})}else if(t.kind==="user"){const i=r,[n,d,u,s]=await Promise.all([_(i,{method:"GET"}),_(`/user/${t.username}/about`,{method:"GET",onerror:l=>{},cache:!0}),_(`/api/v1/user/${t.username}/trophies`,{method:"GET",onerror:l=>{},cache:!0}),_(`/user/${t.username}/moderated_subreddits`,{method:"GET",onerror:l=>{},cache:!0})]);return D(r,t,n,{sidebar:er(d,u,s)})}else if(t.kind==="subreddits"){const n=await _(r,{method:"GET"});return D(r,t,n,{sidebar:null})}else if(t.kind==="inbox"){if(t.current.tab!=="compose"){if(t.current.tab!=="mod"){if(t.current.tab!=="message")if(t.current.tab==="inbox"){const i="/message/"+t.current.inbox_tab,n=await _(i,{method:"GET"});return D(r,t,n,{sidebar:null})}else t.current.tab==="sent"||F(t.current)}}}else{if(t.kind==="link_out")return{title:"LinkOut",navbar:C(r),body:{kind:"one",item:{parents:[{kind:"thread",body:{kind:"richtext",content:[o.h1(o.link(a,"raw!"+t.out,{},o.txt("View on reddit.com"))),o.p(o.txt("ThreadClient does not support this URL"))]},display_mode:{comments:"visible",body:"visible"},link:r,raw_value:t,layout:"reddit-post",actions:[],default_collapsed:!1}],replies:[]}},display_style:"comments-view"};if(t.kind==="todo"){const i=await _(t.path,{method:"GET",onerror:n=>({kind:"unsupported",extra:{title:n.message,stack:n.stack,console:n}})});return D(r,t,i,{sidebar:[{kind:"widget",title:"TODO",widget_content:{kind:"body",body:{kind:"richtext",content:[o.p(o.txt("This page "),o.code(r),o.txt(" is not supported (yet)")),o.p(o.link(a,"raw!https://www.reddit.com"+t.path,{},o.txt("View on reddit.com"))),o.p(o.txt(t.msg))]}},raw_value:t}]})}else if(t.kind==="raw"){const i=await _(t.path,{method:"GET"});return Z(r,i,{sidebar:[{kind:"widget",title:"Raw",widget_content:{kind:"body",body:{kind:"richtext",content:[o.p(o.txt("This is a raw page.")),o.p(o.link(a,t.path,{},o.txt("View Rendered")))]}},raw_value:t}]})}else{if(t.kind==="redirect")return{title:"LinkOut",navbar:C(r),body:{kind:"one",item:{parents:[{kind:"thread",body:{kind:"richtext",content:[o.h1(o.txt("Error! Redirect Loop")),o.p(o.txt("ThreadClient tried to redirect over 100 times.")),o.p(o.txt("Path: "),o.code(r),o.error("Code",t))]},display_mode:{comments:"visible",body:"visible"},link:r,raw_value:t,layout:"reddit-post",actions:[],default_collapsed:!1}],replies:[]}},display_style:"comments-view"};if(t.kind==="subreddit_sidebar")throw new Error("ENOTSUPPORTED;SUBREDDIT-SIDEBAR;PAGE1");F(t)}}return Z(r,t,{sidebar:[{kind:"widget",title:"TODO",widget_content:{kind:"body",body:{kind:"richtext",content:[o.p(o.txt("This page "),o.code(r),o.txt(" is not supported (yet)")),o.p(o.txt(t.kind)),o.p(o.txt("View it on "),o.link(a,"raw!https://reddit.com"+r,{},o.txt("reddit.com")),o.txt("."))]}},raw_value:t}]})}catch(t){const r=t;console.log(r);const i=r.toString().includes("NetworkError");return{title:"Error",navbar:C(e),body:{kind:"one",item:{parents:[{kind:"thread",title:{text:"Error"},body:{kind:"text",client_id:a.id,content:`Error ${r.toString()}`+(i?". If you're using Firefox, try disabling 'Enhanced Tracker Protection'  for this site. Enhanced tracker protection indiscriminately blocks all  requests to social media sites, including Reddit.":"."),markdown_format:"none"},display_mode:{body:"visible",comments:"collapsed"},link:e,layout:"error",actions:[],default_collapsed:!1,raw_value:{}}],replies:[]}},display_style:"comments-view"}}},async login(e,t){const r=t.get("code"),i=t.get("state");if(r==null||i==null)throw new Error("No login requested");if(i!==location.host)throw new Error("Login was for "+i);const n=await fetch("https://www.reddit.com/api/v1/access_token",{method:"POST",mode:"cors",credentials:"omit",headers:{Authorization:"Basic "+btoa(me+":"),"Content-Type":"application/x-www-form-urlencoded"},body:S({grant_type:"authorization_code",code:r,redirect_uri:Re})}).then(u=>u.json());if(n.error)throw console.log(n.error),new Error("error "+n.error);const d={access_token:n.access_token,refresh_token:n.refresh_token,expires:Date.now()+n.expires_in*1e3,scope:n.scope};console.log(n,d),localStorage.setItem("reddit-secret",JSON.stringify(d))},async fetchRemoved(e){const t=Ie.decode(e),[r,i]=await fetch(t.path).then(async u=>[u.status,await u.text()]),n=JSON.parse(i.split("&lt;").join("<").split("&gt;").join(">").split("&amp;").join("&"));if(r!==200)throw console.log(r,n),new Error("Got status "+r);if(n.data.length===0)throw console.log(r,n),new Error("Post was deleted before it could be saved:.");const d=n.data[0];if(d.selftext==="[deleted]"||d.selftext==="[removed]"||d.body==="[deleted]"||d.body==="[removed]")throw new Error("Post was deleted before it could be saved.");if(d.selftext)return{kind:"text",client_id:a.id,content:d.selftext,markdown_format:"reddit"};if(d.body)return{kind:"text",client_id:a.id,content:d.body,markdown_format:"reddit"};throw console.log("got item",d),new Error("no selftext or body")},async act(e){const t=I.decode(e);if(t.kind==="vote"){const r=await _("/api/vote",{method:"POST",mode:"urlencoded",body:t.query});console.log(r)}else if(t.kind==="delete"){const r=await _("/api/del",{method:"POST",mode:"urlencoded",body:{id:t.fullname}});console.log(r)}else if(t.kind==="save"){const r=await _(`/api/${t.direction}save`,{method:"POST",mode:"urlencoded",body:{id:t.fullname}});console.log(r)}else if(t.kind==="subscribe"){const r=await _("/api/subscribe",{method:"POST",mode:"urlencoded",body:{action:t.direction,sr_name:t.subreddit}});console.log(r)}else if(t.kind==="mark_read"){const r=await _(`/api/${t.direction}read_message`,{method:"POST",mode:"urlencoded",body:{id:t.fullname},override:!0});console.log(r)}else t.kind==="log_out"?localStorage.removeItem("reddit-secret"):dt(t)},previewReply(e,t){we.decode(t);const r={kind:"thread",body:{kind:"text",client_id:a.id,content:e,markdown_format:"reddit"},display_mode:{body:"visible",comments:"visible"},raw_value:[e,t],link:"no link",layout:"reddit-comment",info:{time:!1,edited:!1,author:{name:"TODO You",color_hash:"TODO You",link:"/u/TODO You",client_id:a.id},pinned:!1},actions:[{kind:"counter",client_id:a.id,increment:{icon:"up_arrow",color:"orange",label:"Upvote",undo_label:"Undo Upvote"},decrement:{icon:"down_arrow",color:"indigo",label:"Downvote",undo_label:"Undo Downvote"},special:"reddit-points",unique_id:null,time:0,count_excl_you:0,you:"increment",percent:1,actions:{error:"reply not posted"}}],default_collapsed:!1};return{kind:"legacy",client_id:a.id,thread:r}},async sendReply(e,t,r){const i=we.decode(t),n=[];for(let c=0;c<=7;c++){if(c===4||c===7)continue;const m="Testing 1<<"+c;n.push({e:"par",c:[{e:"text",t:m,f:[[1<<c,0,7],[64,8,m.length]]}]})}const d={document:n},u={api_type:"json",thing_id:i.parent_id,return_rtjson:"true",...e==="richtext_demo"?{richtext_json:JSON.stringify(d)}:{text:e}},s={reply:"/api/comment",edit:"/api/editusertext"}[r],l=await _(s,{method:"POST",mode:"urlencoded",body:u});return console.log(l),W({kind:"t1",data:l},{},{permalink:"TODO",sort:"unsupported",is_chat:!1})},async fetchReportScreen(e){const t=Qe.decode(e),[r,i]=await Promise.all([await _(`/r/${t.subreddit}/about/rules`,{method:"GET",cache:!0}),await _(`/r/${t.subreddit}/about`,{method:"GET",cache:!0})]),n=t.fullname.startsWith("t1_")?"comment":t.fullname.startsWith("t3_")?"link":"unsupported",d=[],u=[];for(const s of r.rules){if(s.kind==="link"){if(n!=="link")continue}else if(s.kind==="comment"){if(n!=="comment")continue}else s.kind==="all"||v(s.kind);u.push({title:s.violation_reason,description:{kind:"text",client_id:a.id,content:s.description_html??"",markdown_format:"reddit_html"},report:{kind:"submit",data:ee.encode({fullname:t.fullname,subreddit:t.subreddit,reason:{kind:"sub",id:s.short_name}})}})}i.data.free_form_reports&&u.push({title:"Custom Reason",report:{kind:"textarea",input_title:"Custom Reason",char_limit:100,data:ee.encode({fullname:t.fullname,subreddit:t.subreddit,reason:{kind:"sub_other"},text_max:100})}}),d.push({title:"r/"+t.subreddit+"'s rules",report:{kind:"more",screens:u}});for(const s of r.site_rules_flow)d.push(ot(t,s));return d},async sendReport(e,t){const r=ee.decode(e);if(console.log(r,t),r.text_max==null){if(t!=null)throw new Error("never. got text in non-textual entry?")}else{if(t==null)throw new Error("never. missing text");if(t.length>r.text_max)throw new Error("report text too long (max "+r.text_max+")")}if(r.reason.kind==="sub_other"&&t==null)throw new Error("never. missing text on sub_other");const i=await _("/api/report",{method:"POST",mode:"urlencoded",body:{sr_name:r.subreddit,thing_id:r.fullname,...r.reason.kind==="sub"?{rule_reason:r.reason.id}:r.reason.kind==="site"?{site_reason:r.reason.id,custom_text:t??void 0}:r.reason.kind==="sub_other"?{reason:t}:F(r.reason)}});if(console.log("GOT Response:",i),i.success!==!0)throw console.log(i),new Error("Got error response, check console");return{title:r.reason.kind==="sub_other"?"Report Sent!":r.reason.id,body:t!=null?{kind:"text",client_id:a.id,content:t,markdown_format:"none"}:{kind:"none"}}},async loadMore(e){const t=M.decode(e);if(t.kind==="api_loadmore"){const r=[...t.children],i=r.splice(0,100),n=await _("/api/morechildren",{method:"GET",query:{api_type:"json",limit_children:"false",children:i.join(","),link_id:t.link_fullname,sort:t.parent_permalink.sort}}),d=[],u=new Map;for(const l of n.json.data.things){u.set(l.data.name,l);const c=u.get(l.data.parent_id);if(c){if(c.kind!=="t1")throw new Error("expected t1 here");c.data.replies||={kind:"Listing",data:{before:null,children:[],after:null}},c.data.replies.data.children.push(l)}else d.push(l)}const s=d.map(l=>W(l,{link_fullname:t.link_fullname},t.parent_permalink));if(r.length>0){const l=s[s.length-1];if(l&&l.kind==="load_more"){const c=M.decode(l.load_more);if(c.kind==="api_loadmore")c.children=[...r,...c.children],l.load_more=M.encode(c);else throw new Error("bad (this is not good)")}else s.push({kind:"load_more",load_more:M.encode({kind:"api_loadmore",link_fullname:t.link_fullname,children:r,parent_permalink:t.parent_permalink}),url:t.parent_permalink.permalink,raw_value:r})}return s}else if(t.kind==="parent_permalink"){const r=await _(t.permalink,{method:"GET"}),[i,n]=se(t.permalink);if(i.kind!=="comments")throw new Error("bad link to parent_permalink: "+i.kind);const d=D(n,i,r,{sidebar:null});if(d.body.kind==="one")return d.body.item.replies;throw console.log("Error",d),new Error("todo support load more returning other body ("+d.body.kind+")")}else{if(t.kind==="context")throw new Error("TODO load more context");if(t.kind==="duplicates")throw new Error("TODO load more duplicates");F(t)}},async loadMoreUnmounted(e){const t=Ye.decode(e);if(t.kind==="listing"){const r=await _(t.url,{method:"GET"}),[i,n]=se(t.url),d=D(n,i,r,{sidebar:null});if(d.body.kind==="listing")return{children:d.body.items,next:d.body.next};throw console.log("Error",d),new Error("todo support load more returning other body ("+d.body.kind+")")}else{if(t.kind==="TODO more")throw new Error("TODO more");F(t)}},async hydrateInbox(e){const t=Ee.decode(e);if(t.kind==="inbox"){const i=(await _("/api/me",{method:"GET"})).data.inbox_count;return{messages:i===0?{kind:"zero"}:{kind:"exact",value:i},url:i===0?"/message/inbox":"/message/unread"}}else if(t.kind==="modmail"){const r=await _("/api/mod/conversations/unread/count",{method:"GET"});return{messages:r.notifications>0?{kind:"exact",value:r.notifications}:{kind:"zero"},url:"/mod/mail/all"}}else F(t)}};function F(e){throw console.log("not never:",e),new Error("Expected never")}function ot(e,t){let r;if("nextStepReasons"in t)r={kind:"more",screens:t.nextStepReasons.map(i=>ot(e,i))};else if("fileComplaint"in t&&t.fileComplaint===!0){const i=t.complaintUrl.replace("%25%28thing%29",encodeURIComponent(e.fullname));r={kind:"more",screens:[{title:t.complaintPageTitle,description:{kind:"text",client_id:a.id,content:t.complaintPrompt,markdown_format:"none"},report:{kind:"link",url:"raw!"+i,text:t.complaintButtonText}}]}}else if("canWriteNotes"in t&&t.canWriteNotes===!0){const i=t.isAbuseOfReportButton??!1?250:2e3;r={kind:"textarea",input_title:t.notesInputTitle,char_limit:i,data:ee.encode({fullname:e.fullname,subreddit:e.subreddit,text_max:i,reason:{kind:"site",id:t.reasonText}})}}else"canSpecifyUsernames"in t&&t.canSpecifyUsernames===!0?r={kind:"link",url:"raw!https://reddit.com/report",text:"Open Reddit"}:r={kind:"submit",data:ee.encode({fullname:e.fullname,subreddit:e.subreddit,reason:{kind:"site",id:t.reasonText}})};return{title:t.reasonTextToShow,report:r}}const ee=U("send_report"),Ge=new Map;async function _(e,t){try{const r=await Mt(),i=At(!!r,x(e,t.query??{}),{override:t.override}),n={method:t.method,mode:"cors",credentials:"omit",headers:{...r?{Authorization:r}:{},...t.method==="POST"?{"Content-Type":{json:"application/json",urlencoded:"application/x-www-form-urlencoded"}[t.mode]}:{}},...t.method==="POST"?{body:t.mode==="json"?JSON.stringify(t.body):t.mode==="urlencoded"?Object.entries(t.body).flatMap(([m,f])=>f==null?[]:[encodeURIComponent(m)+"="+encodeURIComponent(f)]).join("&"):dt(t)}:{}},d=JSON.stringify([i,n]),u=Ge.get(d);if(u!=null&&(t.cache??!1))return u;const[s,l]=await fetch(i,n).then(async m=>[m.status,await m.json()]);if(s!==200){if(t.onstatus)return t.onstatus(s,l);throw console.log(s,l),new Error("got status "+s)}const c=l;if(typeof c=="object"){if("json"in c&&typeof c.json=="object"&&"errors"in c.json&&c.json.errors.length>0)throw new Error(c.json.errors.map(([m,f])=>m+": "+f).join(", "));if("jquery"in c&&Array.isArray(c.jquery)&&"success"in c&&c.success===!1)throw new Error(c.jquery.flatMap(m=>m[2]==="call"?m[3].map(f=>typeof f=="string"?f:""):[]).join(", "))}return(t.cache??!1)&&Ge.set(d,l),l}catch(r){if(console.log("Got error",r),t.onerror)return t.onerror(r);throw r}}const we=U("reply");function dt(e){throw console.log(e),new Error("not unreachable")}export{Xe as authorFromInfo,he as authorFromPostOrComment,Kt as authorFromT2,De as awardingsToFlair,a as client,Y as createSubscribeAction,pe as deleteButton,ir as ec,_e as editButton,v as expectUnsupported,J as flairToGenericFlair,Pe as getCodeButton,et as getCommentBody,re as getPointsOn,tt as getPostBody,it as getPostFlair,rt as getPostThumbnail,D as pageFromListing,se as parseLink,Je as rawlink,_ as redditRequest,fe as replyButton,ke as reportButton,be as saveButton,Ze as sortWrap,de as urlNotSupportedYet};
